"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[27498],{27498:function(e,a,o){o.r(a),o.d(a,{default:function(){return q}});o(56285);var r=o(61758),t={class:"row items-center no-wrap"},n={class:"col-auto"},s={class:"col-xs-4"},i={class:"col-xs-4"};function l(e,a){var o=(0,r.g2)("crearBotones"),l=(0,r.g2)("q-card-section"),c=(0,r.g2)("q-separator"),d=(0,r.g2)("sie-upload"),p=(0,r.g2)("q-select"),u=(0,r.g2)("q-card-main"),h=(0,r.g2)("q-card"),m=(0,r.g2)("sie-grid"),C=(0,r.g2)("footer-grid");return(0,r.uX)(),(0,r.Wv)(h,{class:"layout-v1 my-card",flat:"",bordered:""},{default:(0,r.k6)(function(){return[(0,r.bF)(l,null,{default:(0,r.k6)(function(){return[(0,r.Lk)("div",t,[a[2]||(a[2]=(0,r.Lk)("div",{class:"col"},[(0,r.Lk)("div",{class:"text-h6"},"Importación Tablas")],-1)),(0,r.Lk)("div",n,[(0,r.bF)(o,{option:e.name,buttons:e.buttons,nivelAcceso:e.nivelAcceso},null,8,["option","buttons","nivelAcceso"])])])]}),_:1}),(0,r.bF)(c),(0,r.bF)(l,null,{default:(0,r.k6)(function(){return[(0,r.bF)(h,{class:"col-12 q-card-legend"},{default:(0,r.k6)(function(){return[(0,r.bF)(u,{class:"row"},{default:(0,r.k6)(function(){return[(0,r.Lk)("div",s,[(0,r.bF)(d,{disabled:e.dissableButtonArchivo,"only-button":!0,preview:!1,onUpload:e.cargarPlantilla,allow:["txt","xlsx","xls"]},null,8,["disabled","onUpload"])]),a[3]||(a[3]=(0,r.Lk)("div",{class:"col-xs-1"},null,-1)),(0,r.Lk)("div",i,[(0,r.bF)(p,{"option-value":"value","option-label":"label",options:e.options,modelValue:e.option,"onUpdate:modelValue":a[0]||(a[0]=function(a){return e.option=a}),label:"Opción de Tabla",onInput:e.columns,placeholder:"Seleccione una opción"},null,8,["options","modelValue","onInput"])])]}),_:1})]}),_:1})]}),_:1}),(0,r.bF)(c),(0,r.bF)(l,null,{default:(0,r.k6)(function(){return[(0,r.Lk)("div",null,[(0,r.bF)(m,{class:"q-mt-xs fix-tab-height ag-theme-balham",columnDefs:e.columnDefs,rowData:e.rowData,frameworkComponents:e.frameworkComponents,onGridReady:e.onGridReady,rowSelection:"multiple",rowClassRules:"rowClassRules",rowMultiSelectWithClick:!0,onSelectionChanged:e.onSelectionChanged},null,8,["columnDefs","rowData","frameworkComponents","onGridReady","onSelectionChanged"]),(0,r.bF)(C,{modelValue:e.pagina,"onUpdate:modelValue":a[1]||(a[1]=function(a){return e.pagina=a}),max:e.pages,onLoad:e.getDataJson,rows:e.rowData},null,8,["modelValue","max","onLoad","rows"])])]}),_:1})]}),_:1})}var c=o(8445),d=o.n(c),p=o(99550),u=o.n(p),h=o(41562),m=o.n(h),C=o(76080),f=o.n(C),w=o(45254),b=o.n(w),O=(o(12563),o(30683),o(10239),o(11777),o(88567)),N=o(95718),E=o(53380),A=o(54489),g=o(64208),v=o(3112),D=o(12143),S=o(95477),B=o(80660),I=o(6123),k=o(62006),M=o(36408),T=o(42037),R=o(27560),$=o(75053),P=o(41615),F=o(33950),x=o(59089),L=o(64303),U=o(78840),G={components:{actionButton:U.A,QDate:D.A,QPopupProxy:S.A,QCard:O.A,QCardSection:N.A,QSelect:A.S,QOptionGroup:I.EX,QSeparator:E.A,sieGrid:M.A,QInput:g.A,footerGrid:R.A,sieModal:$.A,QCheckbox:v.A,Upload:F["default"],sieUpload:x.A,QDownloadFile:k.A,crearBotones:L.A,QCardMain:I.d1},data:function(){return{name:"Importacion Tablas",buttons:[],nivelAcceso:3,options:[{value:1,label:"Conceptos"},{value:2,label:"Talonarios"},{value:3,label:"Becas"},{value:4,label:"Becas Otorgadas"}],optionsKeys:{concepto:1,talonario:2,becas:3,becaOto:4},dissableButtonArchivo:!1,option:1,columnDefs:[],rowData:[],frameworkComponents:{},api:{},pages:1,pagina:1,optionApi:{1:"api/ConcobroController/postCargarConceptos",2:"api/talonarioController/postCargarTalonarios",3:"api/BecaController/postCargarBecas",4:"api/BecaController/postCargarBecaOto"},fileName:{1:"importacion_concobro.json",2:"importacion_talonarios.json",3:"importacion_becas.json",4:"importacion_becas_otorgadas.json"},optionApiImportar:{1:"api/ConcobroController/addConceptoCobro",2:"api/TalonarioController/addTalon",3:"api/becaController/postBeca",4:"api/becaController/postImportarBecaOotrgada"},rowsSeleccionadas:0,disabled:!1}},beforeMount:function(){var e=this;return b()(f()().m(function a(){var o;return f()().w(function(a){while(1)switch(a.n){case 0:return a.n=1,B.$http.get("api/TesoreriaServiciosController/getVerificarUserAdmin",{params:{params:{sieweb:!0}}});case 1:o=a.v,o||e.$router.push({name:"tesoreria.home"}),e.crearBotones();case 2:return a.a(2)}},a)}))()},methods:{getDataJson:function(){var e=this;return b()(f()().m(function a(){var o,r;return f()().w(function(a){while(1)switch(a.p=a.n){case 0:return a.p=0,a.n=1,B.$http.get("api/ConcobroController/getDataImportacion",{params:{parametros:{tipo:e.option,filename:e.fileName[e.option]}}});case 1:o=a.v,o.data&&(e.rowData=o.data,e.disabled=!0,e.crearBotones()),a.n=3;break;case 2:a.p=2,r=a.v,e.$alert(r.error?r.error.message:r.message);case 3:return a.a(2)}},a,null,[[0,2]])}))()},onGridReady:function(e){this.api=e.api,this.columns()},cargarPlantilla:function(e){var a=this;return b()(f()().m(function o(){var r,t,n,s;return f()().w(function(o){while(1)switch(o.p=o.n){case 0:return o.p=0,o.n=1,(0,F["default"])({file:e[0]});case 1:if(r=o.v,!(r.size>=1e8)){o.n=2;break}return o.a(2,a.$alert("El peso máximo del archivo debe ser de 10 Mb"));case 2:return o.p=2,a.$q.loading.show(),o.n=3,B.$http.post(a.optionApi[a.option],{parametros:{file:r,option:a.option}});case 3:t=o.v,a.rowData=t.data.rows,t.data.errores.length>0?a.$alert("(".concat(t.data.errores.length,") filas NO reconocidas")):a.$alert(t.message,"success"),setTimeout(function(){a.api.selectAll()},100),o.n=5;break;case 4:o.p=4,n=o.v,a.$alert(n.error?n.error.message:n.message);case 5:return o.p=5,a.$q.loading.hide(),o.f(5);case 6:o.n=8;break;case 7:o.p=7,s=o.v,a.$alert(s.error?s.error.message:s.message);case 8:return o.a(2)}},o,null,[[2,4,5,6],[0,7]])}))()},getData:function(){},crearBotones:function(){this.buttons=[{label:"Exportar Platilla",icon:"file_download",click:this.exportarPlantilla,minAcceso:P["default"].ACCESO_TOTAL},{label:"Importar ",icon:"upload",click:this.importar,minAcceso:P["default"].ACCESO_TOTAL,disable:this.disabled}]},exportarPlantilla:function(){var e=this;return b()(f()().m(function a(){var o,r,t;return f()().w(function(a){while(1)switch(a.p=a.n){case 0:return a.p=0,a.n=1,B.$http.post("api/TesoreriaServiciosController/postGenerarPlantilla",{params:{option:e.option}});case 1:return o=a.v,r='{"name":"'.concat(o.data.filename,'","ruta":"').concat(o.data.ruta,'","tipo":"xlsx"}'),a.n=2,P["default"].DESCARGAR_ARCHIVO(r);case 2:a.n=4;break;case 3:a.p=3,t=a.v,e.$alert(t.error?t.error.message:t.message,"warning");case 4:return a.a(2)}},a,null,[[0,3]])}))()},onSelectionChanged:function(){this.disabled=0===this.api.getSelectedRows().length,this.crearBotones()},importarConceptosDeCobro:function(e){var a=this;return b()(f()().m(function o(){var r,t,n,s,i,l,c,d,p,u;return f()().w(function(o){while(1)switch(o.p=o.n){case 0:r={procesadas:[],sinProcesar:[]},t=[],a.$q.loading.show(),n=m()(e),o.p=1,n.s();case 2:if((s=n.n()).done){o.n=9;break}return i=s.value,o.p=3,o.n=4,B.$http.get("api/ConcobroController/getCodigoConcepto");case 4:if(l=o.v,l&&l.data&&l.data.CONCOB&&0!==l.data.CONCOB.length){o.n=5;break}throw new Error("Error al obtener nuevo codigo de concepto de cobro");case 5:return c={CONCOB:l.data.CONCOB,CONDES:i.CONDES,MONCOD:i.MONCOD,MONTO:i.MONTO,CONMORA:i.CONMORA?i.CONMORA:0,AFEIGV:i.AFEIGV?i.AFEIGV:"",CONBECA:i.CONBECA,TIPMOV:i.TIPMOV,INGVAR:0===Number(i.INGVAR)?i.INGVAR:1,CONCOB_EXT:i.CONCOB_EXT?i.CONCOB_EXT:null},o.n=6,B.$http.post(a.optionApiImportar[a.option],{datos:c});case 6:d=o.v,r.procesadas.push(d),t.push(i.INDEX),o.n=8;break;case 7:o.p=7,p=o.v,r.sinProcesar.push(p);case 8:o.n=2;break;case 9:o.n=11;break;case 10:o.p=10,u=o.v,n.e(u);case 11:return o.p=11,n.f(),o.f(11);case 12:return a.clearSelectedRowsFromJson(t),a.$q.loading.hide(),o.a(2,a.mostrarMensaje(r))}},o,null,[[3,7],[1,10,11,12]])}))()},clearSelectedRowsFromJson:function(e){var a=this;return b()(f()().m(function o(){var r,t,n,s,i,l;return f()().w(function(o){while(1)switch(o.p=o.n){case 0:if(!(e.length>0)){o.n=9;break}r=[],t={indexs:r,jsonName:a.fileName[a.option]},n=m()(e),o.p=1,n.s();case 2:if((s=n.n()).done){o.n=5;break}if(i=s.value,r.push(i),100!==r.length){o.n=4;break}return t.indexs=r,o.n=3,B.$http.delete("api/TesoreriaServiciosController/deleteJson",{params:{params:t}});case 3:r=[];case 4:o.n=2;break;case 5:o.n=7;break;case 6:o.p=6,l=o.v,n.e(l);case 7:return o.p=7,n.f(),o.f(7);case 8:if(!(r.length>0)){o.n=9;break}return o.n=9,B.$http.delete("api/TesoreriaServiciosController/deleteJson",{params:{params:t}});case 9:return o.n=10,a.getDataJson();case 10:return o.a(2)}},o,null,[[1,6,7,8]])}))()},importarTalonarios:function(e){var a=this;return b()(f()().m(function o(){var r,t,n,s,i,l,c,d,p;return f()().w(function(o){while(1)switch(o.p=o.n){case 0:r={procesadas:[],sinProcesar:[]},t=[],a.$q.loading.show(),n=m()(e),o.p=1,n.s();case 2:if((s=n.n()).done){o.n=7;break}return i=s.value,o.p=3,l={NUMTAL:i.NUMTAL,NUMSER:i.NUMSER,NUMPAG:i.NUMPAG,TALDES:i.TALDES,DELECTRONICO:i.DELECTRONICO?i.DELECTRONICO:"N",SERIE_ELECTRONICO:"S"===i.DELECTRONICO?i.NUMSER:"",CODSUNAT:i.CODSUNAT},o.n=4,B.$http.post(a.optionApiImportar[a.option],{data:l});case 4:c=o.v,r.procesadas.push(c),t.push(i.INDEX),o.n=6;break;case 5:o.p=5,d=o.v,r.sinProcesar.push(d);case 6:o.n=2;break;case 7:o.n=9;break;case 8:o.p=8,p=o.v,n.e(p);case 9:return o.p=9,n.f(),o.f(9);case 10:return a.clearSelectedRowsFromJson(t),a.$q.loading.hide(),o.a(2,a.mostrarMensaje(r))}},o,null,[[3,5],[1,8,9,10]])}))()},importarBecas:function(e){var a=this;return b()(f()().m(function o(){var r,t,n,s,i,l,c,d,p;return f()().w(function(o){while(1)switch(o.p=o.n){case 0:r={procesadas:[],sinProcesar:[]},t=[],a.$q.loading.show(),n=m()(e),o.p=1,n.s();case 2:if((s=n.n()).done){o.n=7;break}return i=s.value,o.p=3,l={ANOBEC:i.ANOBEC,BECACOD:i.BECACOD,BECAPOR:i.BECAPOR?i.BECAPOR:0,BECADES:i.BECACOD?i.BECADES:""},o.n=4,B.$http.post(a.optionApiImportar[a.option],{datos:l});case 4:c=o.v,r.procesadas.push(c),t.push(i.INDEX),o.n=6;break;case 5:o.p=5,d=o.v,r.sinProcesar.push(d);case 6:o.n=2;break;case 7:o.n=9;break;case 8:o.p=8,p=o.v,n.e(p);case 9:return o.p=9,n.f(),o.f(9);case 10:return a.clearSelectedRowsFromJson(t),a.$q.loading.hide(),o.a(2,a.mostrarMensaje(r))}},o,null,[[3,5],[1,8,9,10]])}))()},importarBecaOto:function(e){var a=this;return b()(f()().m(function o(){var r,t,n,s,i,l,c,d,p;return f()().w(function(o){while(1)switch(o.p=o.n){case 0:r={procesadas:[],sinProcesar:[]},t=[],a.$q.loading.show(),n=m()(e),o.p=1,n.s();case 2:if((s=n.n()).done){o.n=7;break}return i=s.value,o.p=3,l={anio:i.ANOBEC?i.ANOBEC:"",codigoBeca:i.BECACOD?i.BECACOD:"",codigoAlumno:i.ALUCOD?i.ALUCOD:"",codigoMotivoBeca:i.MOTBECCOD?i.MOTBECCOD:"",mesInicioBeca:i.MESINIBEC?i.MESINIBEC:"",mesFinBeca:i.MESFINBEC?i.MESFINBEC:"",persona:i.ID_PERSONA,perfil:i.ID_PERFIL},o.n=4,B.$http.post(a.optionApiImportar[a.option],{datos:l});case 4:c=o.v,r.procesadas.push(c),t.push(i.INDEX),o.n=6;break;case 5:o.p=5,d=o.v,r.sinProcesar.push(d);case 6:o.n=2;break;case 7:o.n=9;break;case 8:o.p=8,p=o.v,n.e(p);case 9:return o.p=9,n.f(),o.f(9);case 10:return a.clearSelectedRowsFromJson(t),a.$q.loading.hide(),o.a(2,a.mostrarMensaje(r))}},o,null,[[3,5],[1,8,9,10]])}))()},mostrarMensaje:function(e){var a=e.sinProcesar,o=e.procesadas;if(1===a.length&&0===o.length){var r=u()(a,1),t=r[0];return this.$alert(t.error?t.error.message:t.message,"warning")}return 0===o.length&&a>0?this.$alert("(".concat(a.length,")Items No Procesados Satisfactoriamente"),"warning"):o.length>0&&0===a?this.$alert("(".concat(o.length,")Items Procesados Satisfactoriamente"),"success"):this.$alert("(".concat(o.length,")Items Procesados Satisfactoriamente, (").concat(a.length,")Items No Procesados Satisfactoriamente"),"success")},importar:function(){var e=this;if(this.rowsSeleccionadas=this.api.getSelectedRows(),0===this.rowsSeleccionadas.length)return this.$alert("Necesita seleccionar al menos una fila para importar","warning");this.$confirm("¿Desea realizar el proceso?").onOk(b()(f()().m(function a(){return f()().w(function(a){while(1)switch(a.n){case 0:if(e.option!==e.optionsKeys.concepto){a.n=1;break}return a.a(2,e.importarConceptosDeCobro(e.rowsSeleccionadas));case 1:if(e.option!==e.optionsKeys.talonario){a.n=2;break}return a.a(2,e.importarTalonarios(e.rowsSeleccionadas));case 2:if(e.option!==e.optionsKeys.becas){a.n=3;break}return a.a(2,e.importarBecas(e.rowsSeleccionadas));case 3:if(e.option!==e.optionsKeys.becaOto){a.n=4;break}return a.a(2,e.importarBecaOto(e.rowsSeleccionadas));case 4:return a.a(2)}},a)})))},columns:function(){var e={1:[{headerName:"Descripcion de Concepto",field:"CONDES",width:200},{headerName:"Moneda",field:"MONSIG",width:100},{headerName:"Monto",field:"MONTO",valueFormatter:T.toFixed,width:100,cellClass:"text-right"},{headerName:"Mora",field:"CONMORA",valueFormatter:T.toFixed,width:100,cellClass:"text-right"},{headerName:"Afecto a IGV",field:"AFEIGVDES",width:100},{headerName:"Afecto a Beca",field:"CONBECADES",width:100},{headerName:"Tipo de Movimiento",field:"TIPOMOVIMIENTO",width:135,cellClass:"text-center"},{headerName:"Ing. Varios",field:"INGVARDES",width:90},{headerName:"Codigo Externo",field:"CONCOB_EXT",width:120}],2:[{headerName:"Talonario",width:75,field:"NUMTAL"},{headerName:"Serie",width:75,field:"NUMSER"},{headerName:"Correlativo",width:100,field:"NUMPAG"},{headerName:"Descripcion",width:200,resizable:!0,field:"TALDES"},{headerName:"Código Sunat",field:"CODSUNAT",width:100},{headerName:"Electronico",field:"ELECTRONICO",width:125}],3:[{headerName:"Año",field:"ANOBEC",width:100},{headerName:"Código",field:"BECACOD",width:100},{headerName:"Descripción",field:"BECADES",width:200,resizable:!0},{headerName:"Tipo",field:"BECATIPODES",width:100},{headerName:"",field:"BECAPOR",width:100,cellClass:"text-right"}],4:[{headerName:"Año",width:75,sortable:!0,field:"ANOBEC"},{headerName:"Beca",width:150,resizable:!0,field:"BECACODDES"},{headerName:"Cod. Alumno",width:100,sortable:!0,field:"ALUCOD"},{headerName:"Alumno(a)",width:200,resizable:!0,sortable:!0,field:"NOMBREALUMNO"},{headerName:"Motivo",width:200,resizable:!0,sortable:!0,field:"MOTBECCODDES"},{headerName:"Mes de Inicio",width:100,field:"MESINIBECDES"},{headerName:"Mes de Fin",width:100,field:"MESFINBECDES"}]};this.columnDefs=d()(e[this.option]),this.getDataJson()}}},_=o(12807);const V=(0,_.A)(G,[["render",l]]);var q=V}}]);