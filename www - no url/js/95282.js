"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[95282],{95282:function(e,n,t){t.r(n),t.d(n,{default:function(){return te}});t(56285);var o=t(61758),a=t(58790),i={class:"row items-center no-wrap"},r={class:"col-auto"},c={class:"flex"},s={class:"q-pa-xs",style:{width:"50%"}},u={key:0,class:"q-pa-xs",style:{width:"50%"}},l={class:"row q-ma-xs q-col-gutter-sm"},m={class:"col-xs-12 q-pb-sm"},d={class:"col-xs-12"},f={class:"col-xs-12"};function p(e,n){var t=this,p=(0,o.g2)("q-btn"),h=(0,o.g2)("q-card-section"),b=(0,o.g2)("q-separator"),w=(0,o.g2)("q-tab"),g=(0,o.g2)("q-tabs"),v=(0,o.g2)("sie-table"),D=(0,o.g2)("QIframe"),k=(0,o.g2)("q-card"),y=(0,o.g2)("q-select"),S=(0,o.g2)("sie-modal"),A=(0,o.g2)("q-page");return(0,o.uX)(),(0,o.Wv)(A,{class:"q-pa-sm sie-flat"},{default:(0,o.k6)(function(){return[(0,o.bF)(k,{class:"layout-v1 my-card",flat:"",bordered:""},{default:(0,o.k6)(function(){return[(0,o.bF)(h,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",i,[n[6]||(n[6]=(0,o.Lk)("div",{class:"col row"},[(0,o.Lk)("span",{style:{"font-size":"20px","font-weight":"bold"}},"Subida de Documentos")],-1)),(0,o.Lk)("div",r,[(0,o.bF)(p,{class:"q-mr-sm",icon:"cloud_upload",color:"primary",label:"Subir documento",size:"sm",onClick:e.clickSubirDocumento},null,8,["onClick"]),(0,o.Lk)("input",{ref:"docInput",type:"file",accept:".docx,.pdf",style:{display:"none"},onChange:n[0]||(n[0]=function(){return e.setArchivo&&e.setArchivo.apply(e,arguments)})},null,544)])])]}),_:1}),(0,o.bF)(b),(0,o.Lk)("div",c,[(0,o.Lk)("div",s,[e.esAdmin?((0,o.uX)(),(0,o.Wv)(g,{key:0,modelValue:e.tab,"onUpdate:modelValue":n[1]||(n[1]=function(n){return e.tab=n}),align:"left",dense:"",style:{"font-weight":"semi-bold"},onInput:e.cambiarTab},{default:(0,o.k6)(function(){return[(0,o.bF)(w,{name:"contextual",label:"Contextuales"}),(0,o.bF)(w,{name:"plantilla",label:"Plantillas"})]}),_:1},8,["modelValue","onInput"])):(0,o.Q3)("v-if",!0),(0,o.bF)(v,{ref:"tablaDocumentos",dense:"",flat:"",bordered:"","wrap-cells":"",css:"height: calc(100vh - ".concat(e.esAdmin?160:125,"px); width: 100%; min-width: 300px;"),context:t,columns:e.columnsDocumentos,config:e.configDocumentos,"show-index":!0,data:e.dataDocumentos,"show-refresh":!0,selection:"single",onRowSelected:e.onRowSelected,onRefresh:n[2]||(n[2]=function(n){return e.getDocumentos(e.tab)})},null,8,["css","columns","config","data","onRowSelected"]),"plantilla"===e.tab?((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[],64)):(0,o.Q3)("v-if",!0)]),e.previewDocumentoURL?((0,o.uX)(),(0,o.CE)("div",u,[(0,o.bF)(D,{src:e.linkView(e.previewDocumentoURL),style:{height:"calc(100vh - 130px)"}},null,8,["src"])])):(0,o.Q3)("v-if",!0)])]}),_:1}),(0,o.bF)(S,{modelValue:e.modalSubirDocumentos,"onUpdate:modelValue":n[5]||(n[5]=function(n){return e.modalSubirDocumentos=n}),title:"Subir Documento",width:"600px",ok:"Subir",onSubmit:e.submitDocumento},{default:(0,o.k6)(function(){return[(0,o.bF)(h,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",l,[(0,o.Lk)("div",m,[n[7]||(n[7]=(0,o.Lk)("b",null,"Documento:",-1)),(0,o.Lk)("span",null,(0,a.v_)(e.formData.name),1)]),(0,o.Lk)("div",d,[(0,o.bF)(y,{modelValue:e.formData.categoria,"onUpdate:modelValue":n[3]||(n[3]=function(n){return e.formData.categoria=n}),options:e.categoriaDocumentos,label:"Categoría de Documento",disable:!e.esAdmin},null,8,["modelValue","options","disable"])]),(0,o.Lk)("div",f,[(0,o.bF)(y,{modelValue:e.formData.tipo,"onUpdate:modelValue":n[4]||(n[4]=function(n){return e.formData.tipo=n}),options:e.tipoDocumentos,label:"Tipo de Documento",disable:!e.esAdmin},null,8,["modelValue","options","disable"])])])]}),_:1})]}),_:1},8,["modelValue","onSubmit"])]}),_:1})}var h=t(76080),b=t.n(h),w=t(45254),g=t.n(w),v=(t(30683),t(70199),t(11777),t(83190),t(27153),t(6123)),D=t(57668),k=t(93616),y=t(30640),S=t(30545),A=t(65673),Q=t(82327),T=t(34262),q=t(11654),x=t(53093),C=t(26697),_=t(43346),L=t(53811),E=t(88865),F=t(66824),P=t(62006),$=t(95051),V=t(74656),R=t(33366),U=t(53380),I=t(56089),O=t(47206),N=t(60975),j=t(37500),J=t(33551),M=t(16648),X=t(9736),G=t(39893),z=t(2739),W=t(88706),B=t(20456),H=t(59089),K=t(33777),Z={data:function(){return{columnsDocumentos:[],dataDocumentos:[],configDocumentos:{}}},methods:{setColumnsDocumentos:function(){this.columnsDocumentos=[{name:"id_documento",label:"ID Documento",align:"center",field:"id_documento"},{name:"nombre",label:"Nombre",align:"left",field:"nombre"},{name:"tipo",label:"Tipo",align:"center",field:"tipo"},{name:"usucod",label:"Usuario",align:"center",field:"usucod"},{name:"fecha_subida",label:"Fecha Subida",align:"center",field:"fecha_subida"},{name:"edit",label:"",align:"left"}],this.configDocumentos={flat:!0,round:!0,color:"primary",fecha_subida:{component:"date",edit:!1},tipo:{renderHtml:function(e){var n={1:"Por Usuario",2:"General"};return"<span>".concat(n[e.tipo],"</span>")}},edit:{flat:!0,component:"button",icon:["delete"],tooltip:{delete:"Eliminar"},delete:function(e){var n=this;return g()(b()().m(function t(){return b()().w(function(t){while(1)switch(t.n){case 0:n.$confirm("¿Está seguro que desea eliminar el documento?").onOk(function(){n.eliminarDocumento(e)});case 1:return t.a(2)}},t)}))()}}}}}},Y={components:{QSelect:M.A,QToggle:v.c5,QCheckbox:v.vZ,sieSelect:k.A,QTable:S.A,QTd:v.Ef,QTr:v.qh,QPopupEdit:v.GT,sieModal:y.A,QList:A.A,QItem:Q.A,QItemSection:E.A,QItemLabel:F.A,QDownloadFile:P.A,QChip:$.A,QChatMessage:R.A,QSeparator:U.A,QSpinnerDots:v.FS,QIframe:I.A,QIcon:T.A,QAvatar:V.A,QBtn:q.A,MarkdownViewer:N.A,QInfiniteScroll:j.A,Skeleton:J.A,QInputV1:X.A,QForm:z.A,QMenu:W.A,QTab:x.A,QTabs:C.A,QTabPanel:_.A,QCardActions:B.A,sieUpload:H.A,QTabPanels:L.A,SieTable:K.A,QUploader:v.Iu,QPage:v.Tu,QCard:v.C$},mixins:[Z],data:function(){return{sie:(0,D["default"])(),urlToSave:"",previewDocumentoURL:"",tab:"contextual",modalSubirDocumentos:!1,formData:{name:"",tipo:1,fileName:"",archivo:null,extension:"",categoria:"contextual"},tipoDocumentos:[{label:"Por Usuario",value:1},{label:"General",value:2}],categoriaDocumentos:[{label:"Contextual",value:"contextual"},{label:"Plantilla",value:"plantilla"}],esAdmin:!1}},watch:{},methods:{required:G.required,linkView:function(e){return this.sie.token=this.sie.tokenViewer,(0,O.linkPreview)(e,this.sie)},uploadFileS3:function(e,n){var t=this;return g()(b()().m(function o(){var a,i,r;return b()().w(function(o){while(1)switch(o.p=o.n){case 0:return o.p=0,o.n=1,fetch("https://n8n.sieweb.com.pe/webhook/upload-s3",{method:"POST",headers:{"Content-Type":e.type,"X-File-Extension":n},body:e});case 1:return a=o.v,o.n=2,a.json();case 2:return i=o.v,o.a(2,i);case 3:o.p=3,r=o.v,t.$notify(r.error?r.error.message:r.message,"warning");case 4:return o.a(2)}},o,null,[[0,3]])}))()},registrarDocumento:function(e){var n=this;return g()(b()().m(function t(){var o,a,i;return b()().w(function(t){while(1)switch(t.n){case 0:return o={query:"POST",nombre:e.name,tipo:e.tipo,url_s3:e.fileName,usucod:n.sie.usucod,categoria:e.categoria,tags:e.tags||null},t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/ia-documentos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});case 1:return a=t.v,t.n=2,a.json();case 2:return i=t.v,t.a(2,i)}},t)}))()},registrarContenidoDocumento:function(e){return g()(b()().m(function n(){var t;return b()().w(function(n){while(1)switch(n.n){case 0:return t={query:"POST",key:e.url_s3,id_documento:Number(e.id_documento),usucod:e.usucod,tipo:e.tipo,categoria:e.categoria},n.n=1,fetch("https://n8n.sieweb.com.pe/webhook/conversion-s3",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 1:return n.a(2)}},n)}))()},getDocumentos:function(e){var n=this;return g()(b()().m(function t(){var o,a,i;return b()().w(function(t){while(1)switch(t.n){case 0:return o={query:"GET",categoria:e},t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/ia-documentos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});case 1:return a=t.v,t.n=2,a.json();case 2:i=t.v,i.length&&!i[0].id_documento&&(i=[]),n.dataDocumentos=i;case 3:return t.a(2)}},t)}))()},eliminarRegistroDocumento:function(e){return g()(b()().m(function n(){var t;return b()().w(function(n){while(1)switch(n.n){case 0:return t={query:"DELETE",id_documento:e.id_documento},n.n=1,fetch("https://n8n.sieweb.com.pe/webhook/ia-documentos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 1:return n.a(2)}},n)}))()},eliminarDocumentoS3:function(e){var n=this;return g()(b()().m(function t(){var o,a,i;return b()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/delete-s3?url_s3=".concat(e),{method:"DELETE"});case 1:return o=t.v,t.n=2,o.json();case 2:return a=t.v,t.a(2,a);case 3:t.p=3,i=t.v,n.$notify(i.error?i.error.message:i.message,"warning");case 4:return t.a(2)}},t,null,[[0,3]])}))()},eliminarContenidoDocumento:function(e){var n=this;return g()(b()().m(function t(){var o;return b()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/delete-contenido?id_documento=".concat(e.id_documento),{method:"DELETE",headers:{"Content-Type":"application/json"}});case 1:t.n=3;break;case 2:t.p=2,o=t.v,n.$notify(o.error?o.error.message:o.message,"warning");case 3:return t.a(2)}},t,null,[[0,2]])}))()},eliminarDocumento:function(e){var n=this;return g()(b()().m(function t(){return b()().w(function(t){while(1)switch(t.n){case 0:return n.$q.loading.show({message:"Eliminando documento..."}),t.n=1,n.eliminarDocumentoS3(e.url_s3);case 1:return t.n=2,n.eliminarRegistroDocumento(e);case 2:if("contextual"!==e.categoria){t.n=3;break}return t.n=3,n.eliminarContenidoDocumento(e);case 3:n.getDocumentos(n.tab),n.previewDocumentoURL="",n.$q.loading.hide(),n.$notify("Documento eliminado satisfactoriamente","success");case 4:return t.a(2)}},t)}))()},clickSubirDocumento:function(){this.$refs.docInput.click()},extraerEtiquetas:function(e){return g()(b()().m(function n(){var t,o,a;return b()().w(function(n){while(1)switch(n.n){case 0:return t="http://ies_bpastor.proyectpg.hyo/ies/api/PersonaController/extraerEtiquetas",n.n=1,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url_s3:e})});case 1:return o=n.v,n.n=2,o.json();case 2:return a=n.v,n.a(2,a)}},n)}))()},submitDocumento:function(){var e=this;return g()(b()().m(function n(){var t,o,a,i;return b()().w(function(n){while(1)switch(n.n){case 0:return e.$q.loading.show({message:"Subiendo documento..."}),n.n=1,e.uploadFileS3(e.formData.archivo,e.formData.extension);case 1:if(t=n.v,e.formData.fileName=t.fileName+".".concat(e.formData.extension),"plantilla"!==e.formData.categoria){n.n=3;break}return n.n=2,e.extraerEtiquetas(e.formData.fileName);case 2:o=n.v,e.formData.tags=o;case 3:return n.n=4,e.registrarDocumento(e.formData);case 4:if(a=n.v,i=a[0],"contextual"!==i.categoria){n.n=5;break}return n.n=5,e.registrarContenidoDocumento(i);case 5:e.tab=e.formData.categoria,e.getDocumentos(e.formData.categoria),e.onRowSelected(i),e.modalSubirDocumentos=!1,e.$q.loading.hide(),e.$notify("Documento subido satisfactoriamente","success");case 6:return n.a(2)}},n)}))()},setArchivo:function(e){var n=this;return g()(b()().m(function t(){var o,a,i;return b()().w(function(t){while(1)switch(t.p=t.n){case 0:if(t.p=0,o=e.target.files[0],o){t.n=1;break}return t.a(2);case 1:a=new FileReader,a.onload=g()(b()().m(function e(){var t,a;return b()().w(function(e){while(1)switch(e.n){case 0:t=o.name.split("."),a=t.pop().toLowerCase(),n.$q.loading.show(),n.formData.name=o.name,n.formData.archivo=o,n.formData.extension=a,n.formData.categoria=n.tab,n.$q.loading.hide();case 1:return e.a(2)}},e)})),n.modalSubirDocumentos=!0,a.readAsDataURL(o),t.n=3;break;case 2:t.p=2,i=t.v,n.$notify(i.error?i.error.message:i.message,"warning");case 3:return t.p=3,n.$q.loading.hide(),t.f(3);case 4:return t.a(2)}},t,null,[[0,2,3,4]])}))()},onRowSelected:function(e){this.previewDocumentoURL="https://n8n.sieweb.com.pe/webhook/documentosS3?key=".concat(e.url_s3,"&t=").concat(+(new Date).getTime())},cambiarTab:function(){var e=this;return g()(b()().m(function n(){return b()().w(function(n){while(1)switch(n.n){case 0:return e.$q.loading.show(),e.previewDocumentoURL="",n.n=1,e.getDocumentos(e.tab);case 1:e.$q.loading.hide();case 2:return n.a(2)}},n)}))()}},beforeMount:function(){var e=this;return g()(b()().m(function n(){return b()().w(function(n){while(1)switch(n.n){case 0:e.esAdmin=e.sie.ruta.nivel>=3,e.getDocumentos(e.tab),e.setColumnsDocumentos();case 1:return n.a(2)}},n)}))()}},ee=t(12807);const ne=(0,ee.A)(Y,[["render",p]]);var te=ne}}]);