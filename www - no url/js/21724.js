"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[21724],{21724:function(e,n,a){a.r(n),a.d(n,{default:function(){return $}});a(52776),a(81813);var t=a(61758),r={class:"row"},i={class:"col-xs-12"},o={key:1,class:"column"},l={class:"row q-pa-sm q-col-gutter-sm"},c={class:"col-xs-12 col-sm-4 col-md-4"},s={class:"col-xs-12 col-sm-12 col-md-12 q-pb-sm"},u={class:"col-xs-12 col-sm-6 col-md-6"},f={class:"col-xs-12 col-sm-6 col-md-6"};function d(e,n){var a=this,d=(0,t.g2)("header-btn"),m=(0,t.g2)("q-spinner-oval"),p=(0,t.g2)("q-inner-loading"),g=(0,t.g2)("sie-table"),h=(0,t.g2)("sie-vacio"),b=(0,t.g2)("q-card-section"),v=(0,t.g2)("q-card"),A=(0,t.g2)("q-input"),E=(0,t.g2)("date-time"),Y=(0,t.g2)("q-form"),V=(0,t.g2)("sie-modal"),F=(0,t.g2)("q-page");return(0,t.uX)(),(0,t.Wv)(F,{class:"academico-year q-pa-sm sie-flat"},{default:(0,t.k6)(function(){return[(0,t.bF)(v,null,{default:(0,t.k6)(function(){return[(0,t.bF)(d,{name:"Mantenimiento Año",buttons:e.buttons},null,8,["buttons"]),(0,t.bF)(b,{style:{height:"calc(100vh - 115px)"}},{default:(0,t.k6)(function(){return[(0,t.Lk)("div",r,[(0,t.Lk)("div",i,[(0,t.bF)(p,{visible:e.loadingDetalle},{default:(0,t.k6)(function(){return[(0,t.bF)(m,{size:"50px",color:"primary"})]}),_:1},8,["visible"]),e.dataYears.length>0?((0,t.uX)(),(0,t.Wv)(g,{key:0,selection:"single",showSearch:!0,ref:"table","save-cells":"",context:a,permiso:"> 1",css:"height:calc(100vh - 140px)",columns:e.configTbl.columnas,data:e.dataYears,config:e.dinamicos},null,8,["columns","data","config"])):((0,t.uX)(),(0,t.CE)("div",o,[(0,t.bF)(h,{icon:"settings_applications",style:{height:"calc(100vh - 140px)"}})]))])])]}),_:1})]}),_:1}),(0,t.bF)(V,{modelValue:e.openModal,"onUpdate:modelValue":n[5]||(n[5]=function(n){return e.openModal=n}),title:"Añadir nuevo año",ok:"Guardar",onSubmit:e.grabarYear,onClose:e.limpiarFormYear,css:{minWidth:"40vw"}},{default:(0,t.k6)(function(){return[(0,t.bF)(Y,{ref:"formMantenimientoYear"},{default:(0,t.k6)(function(){return[(0,t.Lk)("div",l,[(0,t.Lk)("div",c,[(0,t.bF)(A,{modelValue:e.formYear.ano,"onUpdate:modelValue":n[0]||(n[0]=function(n){return e.formYear.ano=n}),label:"Año","float-label":"Año",rules:[e.yearRule],"lazy-rules":"",onInput:n[1]||(n[1]=function(n){return e.formYear.ano=n.replace(/[^0-9]/g,"")}),maxlength:e.maxlength},null,8,["modelValue","rules","maxlength"])]),(0,t.Lk)("div",s,[(0,t.bF)(A,{modelValue:e.formYear.des,"onUpdate:modelValue":n[2]||(n[2]=function(n){return e.formYear.des=n}),label:"Descripción","float-label":"Descripción",rules:[e.required]},null,8,["modelValue","rules"])]),(0,t.Lk)("div",u,[(0,t.bF)(E,{modelValue:e.formYear.fecinicla,"onUpdate:modelValue":n[3]||(n[3]=function(n){return e.formYear.fecinicla=n}),label:"Fecha de inicio",type:"date"},null,8,["modelValue"]),(0,t.Q3)('sie-date(v-model="formYear.fecinicla" placeholder="Fecha de inicio")')]),(0,t.Lk)("div",f,[(0,t.bF)(E,{modelValue:e.formYear.fecfincla,"onUpdate:modelValue":n[4]||(n[4]=function(n){return e.formYear.fecfincla=n}),label:"Fecha de fin",type:"date"},null,8,["modelValue"]),(0,t.Q3)('sie-date(v-model="formYear.fecfincla" placeholder="Fecha de fin")')])])]}),_:1},512)]}),_:1},8,["modelValue","onSubmit","onClose"])]}),_:1})}var m=a(57008),p=a.n(m),g=a(76080),h=a.n(g),b=a(45254),v=a.n(b),A=(a(50310),a(9240),a(83190),a(6123)),E=a(24729),Y=a(88567),V=a(95718),F=a(93616),w=a(30640),I=a(57668),C=a(982),N=a(33777),y={data:function(){return{dinamicos:{DES:{component:"input",type:"string",permiso:"> 2",maxlength:250,input:function(e){return this.editarYear(e,"DES")}},FECINICLA:{component:"date",permiso:"> 2",edit:!0,input:function(e){return this.editarYear(e,"FECINICLA")}},FECFINCLA:{component:"date",edit:!0,input:function(e){return this.editarYear(e,"FECFINCLA")}},VIGENTE:{renderHtml:function(e,n,a){return a.checkbox({trueValue:"S",value:e.VIGENTE})},renderAction:function(e,n){var a=this;return v()(h()().m(function t(){var r,i;return h()().w(function(t){while(1)switch(t.n){case 0:return r=e.VIGENTE,n.VIGENTE="S"===n.VIGENTE?"N":"S",t.n=1,a.cambiarVigencia(n);case 1:i=t.v,i||(n.VIGENTE=r);case 2:return t.a(2)}},t)}))()}},ESTADO:{component:"select",label:"Seleccione",optionValue:"value",optionLabel:"label",options:[],input:function(e){return this.editarYear(e,"ESTADO")}},ACCIONES:{component:"button",icon:["delete"],permisos:{delete:"=== 3"},delete:function(e){this.eliminarYear(e.ANO)},flat:!0,color:"primary",dense:!1}},configTbl:{columnas:[{name:"ANO",label:"Año",field:"ANO",align:"left",sortable:!0},{name:"DES",label:"Descripción",field:"DES",align:"left",sortable:!0},{name:"FECINICLA",label:"Inicio",field:"FECINICLA",align:"center",sortable:!0},{name:"FECFINCLA",label:"Fin",field:"FECFINCLA",align:"center",sortable:!0},{name:"ESTADO",label:"Estado",field:"ESTADO",align:"left",sortable:!0},{name:"VIGENTE",label:"Vigente",field:"VIGENTE",align:"center",sortable:!0},{name:"ACCIONES",label:"Acciones",align:"center",tipo:"acciones"}],paginacion:{page:1,rowsPerPage:500}},dataYears:[]}}},k=a(39893),T=a(80340),S=a(51082),x=a(9736),D=a(49420),L=a(26319),q=a(2739),Q={components:{QForm:q.A,QInput:x.A,QTable:A.kH,QTr:A.qh,QTd:A.Ef,QCard:Y.A,QPopupEdit:A.GT,QCardSection:V.A,QToggle:A.c5,DateTime:D.A,Dialog:E.A,QPageSticky:A._U,sieSelect:F.A,sieModal:w.A,notify:C["default"],sieInfo:I["default"],dinamicos:y,sieTable:N.A,sieVacio:T.A,QInnerLoading:A.SQ,QSpinnerOval:A.VA,sieDate:S.A,QPage:A.Tu},mixins:[y],data:function(){var e=this;return{buttons:[{label:"Nuevo",icon:"add",permiso:">= 2",click:function(){e.openModal=!0}}],acceso:(0,I["default"])().ruta.nivel>=2,openModal:!1,formYear:{ano:"",des:"",fecinicla:null,fecfincla:null},opcEstado:[{label:"Inicio",value:"I"},{label:"Cierre",value:"C"},{label:"Proceso",value:"P"}],loadingDetalle:!1,maxlength:null}},methods:{required:k.required,init:function(){var e=this;return v()(h()().m(function n(){var a,t;return h()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,e.$http.get("api/HyoAnos/getConfig");case 1:return a=n.v,t=a.maxlength,e.maxlength=t,n.n=2,e.obtenerYears();case 2:return n.a(2)}},n)}))()},obtenerYears:function(){var e=this;return v()(h()().m(function n(){return h()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,e.$http.get("api/HyoAnos/getAllYears").then(function(n){e.dataYears=n.json,e.dinamicos.ESTADO.options=e.opcEstado});case 1:return n.a(2)}},n)}))()},yearRule:function(e){this.maxlength;if(!e)return"El año es obligatorio";if(e.length!==this.maxlength)return"El año debe tener ".concat(this.maxlength," dígitos");var n=this.dataYears.some(function(n){return n.ANO===e});return!n||"Este año ya está registrado"},grabarYear:function(){var e=this;return v()(h()().m(function n(){var a,t;return h()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,e.$refs.formMantenimientoYear.validate();case 1:if(a=n.v,a){n.n=2;break}return n.a(2);case 2:return t=p()({},e.formYear),t.fecinicla=t.fecinicla?(0,L.date)(t.fecinicla).iso:null,t.fecfincla=t.fecfincla?(0,L.date)(t.fecfincla).iso:null,n.n=3,e.$http.post("api/HyoAnos/creaAnualAcademico",{data:t}).then(function(n){e.openModal=!1,(0,C["default"])(n.json.message)}).then(function(){e.obtenerYears()}).catch(function(e){(0,C["default"])(e.error.message,"error")});case 3:return n.a(2)}},n)}))()},editarYear:function(e,n){var a=this;return v()(h()().m(function t(){var r,i,o,l,c;return h()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,r={},r[n]=e[n],i={year:e.ANO,data:r},t.n=1,a.$http.put("api/HyoAnos/updateYear",i);case 1:return o=t.v,a.$notify(o.json.message,"success"),t.a(2,!0);case 2:return t.p=2,c=t.v,l=c.error,a.$notify(l.message,"warning"),t.a(2,!1)}},t,null,[[0,2]])}))()},eliminarYear:function(e){var n=this;return v()(h()().m(function a(){var t;return h()().w(function(a){while(1)switch(a.n){case 0:return a.n=1,n.$confirmar("¿Esta seguro de eliminar el registro?");case 1:t=a.v,t&&n.$http.delete("api/HyoAnos/deleteYearAcademico",{params:{year:e}}).then(function(e){(0,C["default"])(e.json.message)}).then(function(){n.obtenerYears()}).catch(function(e){(0,C["default"])(e.error.message,"error")});case 2:return a.a(2)}},a)}))()},cambiarVigencia:function(e){var n=this;return v()(h()().m(function a(){var t,r,i,o;return h()().w(function(a){while(1)switch(a.p=a.n){case 0:if(a.p=0,t={year:e.ANO,vigente:e.VIGENTE},"N"!==e.VIGENTE){a.n=1;break}return(0,C["default"])("No puede quedar un año sin vigencia","warning"),a.a(2,!1);case 1:return a.n=2,n.$http.put("api/HyoAnos/setYearVigente",t);case 2:return r=a.v,a.n=3,n.obtenerYears();case 3:return n.$notify(r.json.message,"success"),a.a(2,!0);case 4:a.n=6;break;case 5:return a.p=5,o=a.v,i=o.error,n.$notify(i.message,"warning"),a.a(2,!1);case 6:return a.a(2)}},a,null,[[0,5]])}))()},limpiarFormYear:function(){this.formYear={ano:"",des:"",fecinicla:null,fecfincla:null}}},created:function(){this.init()}},O=a(12807);const G=(0,O.A)(Q,[["render",d]]);var $=G}}]);