"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[99598],{99598:function(e,a,o){o.r(a),o.d(a,{default:function(){return M}});o(71225),o(50310),o(5962),o(83190);var t=o(61758),n=o(29104),l=o(58790),i={class:"col"},r={key:0},c={key:0},s={key:1},d={class:"q-table tablaNueva tabla"},u={class:"q-tr"},p=["colspan"],f={class:"row"},h={key:0,class:"row"};function b(e,a){var o=(0,t.g2)("sie-upload"),b=(0,t.g2)("header-btn"),m=(0,t.g2)("q-search"),k=(0,t.g2)("q-icon"),v=(0,t.g2)("q-th"),g=(0,t.g2)("q-tr"),_=(0,t.g2)("q-td"),w=(0,t.g2)("q-select"),S=(0,t.g2)("q-popup-edit"),x=(0,t.g2)("q-table"),y=(0,t.g2)("q-card");return(0,t.uX)(),(0,t.CE)("div",i,[(0,t.bo)((0,t.bF)(o,{allow:["xlsx","xls","txt"],onUpload:e.uploadExcel,ref:"upload"},null,8,["onUpload"]),[[n.aG,!1]]),(0,t.bF)(b,{name:"Importar",buttons:e.buttons},null,8,["buttons"]),(0,t.bF)(y,{class:"q-ma-xs"},{default:(0,t.k6)(function(){return[(0,t.bF)(m,{"hide-underline":"",modelValue:e.filter,"onUpdate:modelValue":a[0]||(a[0]=function(a){return e.filter=a}),onInput:e.filtrarData},null,8,["modelValue","onInput"]),(0,t.bF)(x,{class:"newHead",columns:e.columns,data:e.data,style:{height:"70vh"},"hide-bottom":""},{header:(0,t.k6)(function(a){return[(0,t.bF)(g,{props:a},{default:(0,t.k6)(function(){return[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(e.columns,function(a){return(0,t.uX)(),(0,t.Wv)(v,{class:(0,l.C4)("text-"+a.align)},{default:(0,t.k6)(function(){return[a.isCheck?((0,t.uX)(),(0,t.Wv)(k,{key:1,class:"check",name:e.todosMarcados,color:"primary",onClick:e.marcarTodos},null,8,["name","onClick"])):((0,t.uX)(),(0,t.CE)("span",r,(0,l.v_)(a.label),1))]}),_:2},1032,["class"])}),256))]}),_:1},8,["props"])]}),"body-cell-codigo":(0,t.k6)(function(e){return[(0,t.bF)(_,{class:"tablaNueva",props:e},{default:(0,t.k6)(function(){return[(0,t.Lk)("span",null,(0,l.v_)(e.row.codigo),1)]}),_:2},1032,["props"])]}),"body-cell-nombre":(0,t.k6)(function(e){return[(0,t.bF)(_,{class:"tablaNueva",props:e},{default:(0,t.k6)(function(){return[(0,t.Lk)("span",null,(0,l.v_)(e.row.nombre),1)]}),_:2},1032,["props"])]}),"body-cell-tipo":(0,t.k6)(function(a){return[(0,t.bF)(_,{class:"tablaNueva",props:a},{default:(0,t.k6)(function(){return[(0,t.Lk)("span",null,(0,l.v_)(e.valorTipo(a.row.tipo)),1),(0,t.bF)(S,{modelValue:a.row.tipo,"onUpdate:modelValue":function(e){return a.row.tipo=e}},{default:(0,t.k6)(function(){return[(0,t.bF)(w,{class:"q-if-outlined",modelValue:a.row.tipo,"onUpdate:modelValue":function(e){return a.row.tipo=e},options:e.modos},null,8,["modelValue","onUpdate:modelValue","options"])]}),_:2},1032,["modelValue","onUpdate:modelValue"])]}),_:2},1032,["props"])]}),"body-cell-accion":(0,t.k6)(function(a){return[(0,t.bF)(_,{class:"tablaNueva",props:a},{default:(0,t.k6)(function(){return[(0,t.bF)(k,{class:"check",name:"delete",color:"primary",onClick:function(o){return e.eliminarAsistencia(a.row)}},null,8,["onClick"])]}),_:2},1032,["props"])]}),"body-cell-dateTime":(0,t.k6)(function(a){return[(0,t.bF)(_,{class:"tablaNueva",props:a},{default:(0,t.k6)(function(){return[(0,t.Lk)("span",null,(0,l.v_)(e.date(a.row.dateTime,"DD/MM/YYYY hh:mm a")),1)]}),_:2},1032,["props"])]}),"body-cell-id_tipo":(0,t.k6)(function(a){return[(0,t.bF)(_,{class:"tablaNueva",props:a},{default:(0,t.k6)(function(){return[(0,t.Lk)("span",null,(0,l.v_)(e.valorEstado(a.row.id_tipo)),1),(0,t.bF)(S,{modelValue:a.row.id_tipo,"onUpdate:modelValue":function(e){return a.row.id_tipo=e}},{default:(0,t.k6)(function(){return[(0,t.bF)(w,{class:"q-if-outlined",modelValue:a.row.id_tipo,"onUpdate:modelValue":function(e){return a.row.id_tipo=e},options:e.estados},null,8,["modelValue","onUpdate:modelValue","options"])]}),_:2},1032,["modelValue","onUpdate:modelValue"])]}),_:2},1032,["props"])]}),"body-cell-check":(0,t.k6)(function(a){return[(0,t.bF)(_,{class:"tablaNueva",props:a},{default:(0,t.k6)(function(){return[(0,t.bF)(k,{class:"check",name:e.devolverMarcado(a.row["$$index"])?"check_square":"check_box_outline_blank",color:"primary",onClick:function(o){return e.marcarFila(a.row)}},null,8,["name","onClick"])]}),_:2},1032,["props"])]}),"body-cell-profcod":(0,t.k6)(function(e){return[(0,t.bF)(_,{class:(0,l.C4)(["text-white tablaNueva",{"bg-positive":"NO"!==e.row.profcod,"bg-negative":"NO"===e.row.profcod||!e.row["id_turno"]}]),props:e},{default:(0,t.k6)(function(){return[e.row.id_turno||"NO"===e.row.profcod?((0,t.uX)(),(0,t.CE)("span",c,"Documento "+(0,l.v_)("NO"===e.row.profcod?"No ":" ")+" Asociado",1)):((0,t.uX)(),(0,t.CE)("span",s,"Sin turno asignado"))]}),_:2},1032,["props","class"])]}),_:1},8,["columns","data"]),(0,t.Lk)("table",d,[(0,t.Lk)("tbody",null,[(0,t.Lk)("tr",u,[(0,t.Lk)("td",{class:"q-td row",colspan:e.columns.length},[(0,t.Lk)("div",f,[0===e.data.length?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[(0,t.bF)(k,{name:"warning"}),a[1]||(a[1]=(0,t.Lk)("span",null," Sin datos disponibles",-1))],64)):((0,t.uX)(),(0,t.CE)(t.FK,{key:1},[e.loadSelection.length>0?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[a[2]||(a[2]=(0,t.Lk)("div",{class:"text-bold"},"Seleccionados: ",-1)),(0,t.Lk)("span",null,(0,l.v_)(e.loadSelection.length),1)],64)):(0,t.Q3)("v-if",!0)],64))]),a[4]||(a[4]=(0,t.Lk)("div",{class:"col"},null,-1)),e.data.length>0?((0,t.uX)(),(0,t.CE)("div",h,[a[3]||(a[3]=(0,t.Lk)("div",{class:"text-bold"},"Total: ",-1)),(0,t.Lk)("span",null,(0,l.v_)(e.data.length),1)])):(0,t.Q3)("v-if",!0)],8,p)])])])]}),_:1})])}var m=o(9504),k=o.n(m),v=o(76080),g=o.n(v),_=o(57008),w=o.n(_),S=o(45254),x=o.n(S),y=(o(30683),o(23825),o(52133),o(10239),o(89571),o(90095),o(6724),o(515),o(13715),o(24066),o(6123)),F=o(96122),E=o(30545),T=o(59089),$=o(33950),C=o(95718),q=o(57668),A=o(80660),V=o(18105),N=o(33001),L={components:{QTable:E.A,sieUpload:T.A,QCardSection:C.A,QTr:y.qh,QTd:y.Ef,QTh:y.EJ,QCheckbox:y.vZ,QScrollArea:F.A,QSelect:y.Si,QPopupEdit:y.GT,QCard:y.C$,QSearch:y.Ks,QIcon:y.bP},data:function(){return{permiso:(0,q["default"])().ruta.nivel,permiteNoIngreso:["0490"].indexOf((0,q["default"])().colcod)>=0,todosMarcados:"indeterminate_check_box",filter:null,data:[],dataBase:[],loadSelection:[],cantidadMarcas:0,modos:[{value:"E",label:"Entrada"},{value:"S",label:"Salida"}],estados:[{value:1,label:"Presente"},{value:2,label:"Tardanza"}],columns:[{name:"codigo",label:"DNI",field:"codigo",align:"center",sortable:!0},{name:"profcod",label:"asociado",field:"profcod",align:"center",sortable:!0,width:50},{name:"id_tipo",label:"ESTADO",field:"id_tipo",align:"center",sortable:!0,width:50},{name:"nombre",label:"Nombres",field:"nombre",align:"left",sortable:!0},{name:"tipo",label:"Tipo",field:"tipo",align:"center",sortable:!0},{name:"dateTime",label:"Fecha",field:"dateTime",align:"center"},{name:"accion",field:"accion",align:"center"}]}},computed:{buttons:function(){var e=[{label:"Importar",icon:"file_download",click:this.importFile}];return e.push({label:"Procesar",icon:"cogs",click:this.exportData}),e}},watch:{},methods:{date:V.Ay,marcarTodos:function(){switch(this.todosMarcados){case"indeterminate_check_box":case"check_square":this.loadSelection=[],this.validarTodos();break;default:this.filtrarData();break}},valorTipo:function(e){return"E"===e?"Entrada":"Salida"},valorEstado:function(e){return 1===e?"Presente":"Tardanza"},importFile:function(){this.$refs.upload.$el.querySelector("input").click()},exportData:function(){var e=this;return x()(g()().m(function a(){var o,t;return g()().w(function(a){while(1)switch(a.n){case 0:if(o=e.loadSelection,0!==o.length){a.n=1;break}return e.$notify("Debe seleccionar al menos un registro","warning"),a.a(2,!1);case 1:if(t={},o.forEach(function(){var a=x()(g()().m(function a(o){var n,l;return g()().w(function(a){while(1)switch(a.n){case 0:n=e.dataBase[o],t[n.codigo]||(t[e.dataBase[o].codigo]={}),t[n.codigo][n.tipo]||(l=w()({},n),delete l.codigo,delete l.tipo,t[n.codigo][n.tipo]=l);case 1:return a.a(2)}},a)}));return function(e){return a.apply(this,arguments)}}()),0!==Object.keys(t).length){a.n=2;break}return e.$notify("Debe corregir los registros seleccionados.","warning"),a.a(2);case 2:Object.keys(t).forEach(function(a){t[a]["S"]&&!t[a]["E"]&&!t[a]["S"].id_asistencia&&e.permiteNoIngreso&&(t[a]["E"]={id_turno:t[a]["S"].id_turno,dateTime:t[a]["S"].dateTime,tipoAsistencia:t[a]["S"].tipoAsistencia,id_tipo:999999,soloSalida:!0})}),e.$http.post("api/HyoAsistencia/procesarData",{data:t}).then(function(a){var o=a.json;e.$notify(o.message,"success")}),console.log({request:t}),console.log(o);case 3:return a.a(2)}},a)}))()},validarTodos:function(){switch(this.loadSelection.length){case 0:this.todosMarcados="check_box_outline_blank";break;default:this.todosMarcados=this.cantidadMarcas===this.loadSelection.length?"check_square":"indeterminate_check_box";break}},filtrarData:function(){var e=this,a=this.dataBase;this.loadSelection=[],this.cantidadMarcas=0,this.filter&&this.filter.length>0&&(a=(0,N.filterArray)(this.filter,{field:["codigo","nombre"],list:this.dataBase||[]})),a.forEach(function(a){var o=a.$$index,t=a.lock;t||(e.loadSelection.push(o),e.cantidadMarcas++)}),this.validarTodos(),this.data=a},devolverMarcado:function(e){return this.loadSelection.indexOf(e)>=0},marcarFila:function(e){console.log(e),e.lock||(this.loadSelection.indexOf(e["$$index"])+1?(this.loadSelection.splice(this.loadSelection.indexOf(e["$$index"]),1),this.validarTodos()):(this.loadSelection.push(e["$$index"]),this.validarTodos()))},eliminarAsistencia:function(e){this.dataBase.splice(e["$$index"],1),this.dataBase.forEach(function(e,a){e.$$index=a}),this.filtrarData()},uploadExcel:function(e){var a=this;return x()(g()().m(function o(){var t,n,l,i,r,c,s,d,u,p,f,h;return g()().w(function(o){while(1)switch(o.p=o.n){case 0:return t=e[0],o.p=1,n=[],l=[],o.n=2,(0,$.Upload)({url:"api/HyoArchivo/tmp/upload",file:t});case 2:return i=o.v,o.n=3,a.$http.post("api/HyoAsistencia/preImport",{pathExcel:i});case 3:r=o.v,c=0,f=k()(r);case 4:if((h=f()).done){o.n=6;break}return s=h.value,o.n=5,(0,A.stream)("api/HyoAsistencia/importarAsistencia",{method:"POST",data:{data:r[s]}},function(e){e&&"fila"in e?a.textoProgreso="Procesando fila: ".concat(e.fila," de ").concat(a.dataTemplate.length):e&&"progreso"in e&&(a.textoProgreso=e.progreso)});case 5:d=o.v,u=d.data,p=d.loadSelection,p.values.forEach(function(e){l.push(e+c)}),u.map(function(e){return e["$$index"]=e["$$index"]+c,e}),n=n.concat(u),c+=u.length,o.n=4;break;case 6:a.dataBase=n,a.loadSelection=l,a.filtrarData(),a.$notify("Se importaron los registros de marcación","success"),o.n=8;break;case 7:o.p=7,o.v;case 8:return o.a(2)}},o,null,[[1,7]])}))()}},mounted:function(){this.columns.unshift({name:"check",field:"check",align:"center",isCheck:!0})}},D=o(12807);const Q=(0,D.A)(L,[["render",b]]);var M=Q}}]);