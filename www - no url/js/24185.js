"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[24185],{24185:function(e,a,r){r.r(a),r.d(a,{default:function(){return _}});var t=r(61758),o=r(58790),i={class:"row items-center no-wrap"},n={class:"col"},l={class:"text-h6"},d={class:"row"},s={class:"col-sm-6 q-pa-xs"},c={class:"col-sm-6 q-pa-xs"};function h(e,a){var r=(0,t.g2)("q-card-section"),h=(0,t.g2)("q-separator"),f=(0,t.g2)("filtro-empresa-local"),u=(0,t.g2)("create-grid"),A=(0,t.g2)("q-card"),m=(0,t.g2)("sie-modal"),T=(0,t.g2)("q-page");return(0,t.uX)(),(0,t.Wv)(T,null,{default:(0,t.k6)(function(){return[(0,t.bF)(A,{class:"layout-v1 col my-card",flat:"",bordered:""},{default:(0,t.k6)(function(){return[(0,t.bF)(r,null,{default:(0,t.k6)(function(){return[(0,t.Lk)("div",i,[(0,t.Lk)("div",n,[(0,t.Lk)("div",l,(0,o.v_)(e.title),1),(0,t.Q3)("div.q-card-subtitle {{subtitle}}")]),a[1]||(a[1]=(0,t.Lk)("div",{class:"col-auto"},[(0,t.Q3)('q-btn.q-mr-sm( v-if ="nivelAcceso >= 2" slot="right" icon="add" color="primary" label="Apertura" size="sm" @click="apertura")'),(0,t.Q3)('q-btn.q-mr-sm( v-if ="nivelAcceso >= 2" slot="right" icon="add" color="primary" label="Nuevo" size="sm" @click="agregar")')],-1))])]}),_:1}),(0,t.bF)(h),(0,t.bF)(r,null,{default:(0,t.k6)(function(){return[(0,t.bF)(f,{onUpdateEmpresa:e.filtrar,onUpdateLocal:e.filtrarLocal},null,8,["onUpdateEmpresa","onUpdateLocal"]),(0,t.Q3)('.row.col-xs-12.col-md-6\n    q-select.q-if-outlined( v-model="empresa" :options="empresas" @input="filtrar" label="Empresa")\n.col-xs-12.col-md-6\n    q-select.q-if-outlined( v-model="local" :options="locales" @input="filtrarLocal" label="Local")'),(0,t.Lk)("div",d,[(0,t.Lk)("div",s,[a[2]||(a[2]=(0,t.Lk)("div",{class:"row q-pa-xs text-h6"},"1.- Asignacion de Talonarios",-1)),(0,t.Q3)('@clickdelete="deleted" @clickedit="edit" '),(0,t.bF)(u,{ref:"formcaja",onLoaded:e.loadedCaja,onLoadedData:e.loadedData,onRowClicked:e.rowClicked,refresh:e.refresh,config:e.config,methodAdd:e.methodAdd,methodUpdate:e.methodUpdate,onClickdelete:e.deletedCajaTalon,methodGet:e.methodGet,styles:"width: 100%; height: calc(100vh - 325px);"},null,8,["onLoaded","onLoadedData","onRowClicked","refresh","config","methodAdd","methodUpdate","onClickdelete","methodGet"])]),(0,t.Lk)("div",c,[a[3]||(a[3]=(0,t.Lk)("div",{class:"row q-pa-xs text-h6"},"2.- Usos de Talonarios",-1)),(0,t.bF)(u,{ref:"gridUso",noPage:!0,refresh:e.refreshUso,onClickedit:e.edit,config:e.configCajaTalonUso,methodDelete:"talonarioController/deleteCajaTalonUso",methodGet:"talonarioController/getCajaTalonUso",styles:"width: 100%; height: 200px"},null,8,["refresh","onClickedit","config"]),a[4]||(a[4]=(0,t.Lk)("div",{class:"row q-pa-xs text-h6"},"3.- Referencias de Talonarios",-1)),(0,t.bF)(u,{refresh:e.refreshReferencia,btnAdd:!0,onClickedit:e.editarReferencia,onClickadd:e.agregarReferencia,config:e.configTalonReferencia,methodDelete:"talonarioController/deleteTalonReferencia",methodGet:"talonarioController/getTalonReferencia",styles:"width: 100%; height: calc(100vh - 574px)"},null,8,["refresh","onClickedit","onClickadd","config"]),(0,t.Q3)('create-form(:dataform="dataEditReferencia" ref="modalReferencia" @updated="guardarReferencia" :idFormulario="26" :modal="true" v-model="openModalReferencia")')])])]}),_:1})]}),_:1}),(0,t.bF)(m,{esc:!0,escClick:!0,title:"Agregar Referencia",modelValue:e.openModalReferencia,"onUpdate:modelValue":a[0]||(a[0]=function(a){return e.openModalReferencia=a}),onSubmit:e.guardarReferencia,css:{"min-width":"750px","max-width":"750px",maxWidth:"90vw"}},{default:(0,t.k6)(function(){return[(0,t.bF)(u,{class:"col-sm-12 q-pa-sm",noPage:!0,ref:"referencias",config:e.configReferencias,methodGet:"talonarioController/getReferenciasXTalon",styles:"width: 100%; height: 250px"},null,8,["config"])]}),_:1},8,["modelValue","onSubmit"])]}),_:1})}var f=r(57008),u=r.n(f),A=(r(30683),r(71225),r(39866),r(77507),r(52133),r(10239),r(89571),r(50310),r(5962),r(6724),r(83190),r(62692),r(80660)),m=r(57668),T=r(7729),C=r(10213),p=r(30640),g=r(26697),U=r(53093),N=r(43346),D=r(53811),v=r(88567),R=r(95718),L=r(53380),w=r(6123),O=r(16648),M=r(982),E={components:{createGrid:T.A,QCard:v.A,QCardSection:R.A,QSeparator:L.A,QTabs:g.A,QTab:U.A,QTabPanels:D.A,QTabPanel:N.A,QPagination:w.ao,sieModal:p.A,QSearch:w.Ks,QSelect:O.A,QPage:w.Tu},data:function(){return{openModalReferencia:!1,methodGet:"talonarioController/getCajaTalon",methodAdd:"talonarioController/addCajaTalon",methodDelete:"talonarioController/deleteCajaTalon",methodUpdate:"talonarioController/updateCajaTalon",refresh:1,currentEdit:!1,title:"Talonario por Caja",subtitle:"Hisorial de aperturas de caja",nivelAcceso:(0,m["default"])().ruta.nivel,dataEdit:{},vjson:0,rowData:[],columnDefs:[],frameworkComponents:null,pagina:1,max:10,schema:{},openModal:!1,titleModalAdd:"",idFormulario:23,campoDelete:["ID_CAJA_USU"],campoMsgDelete:"NOMCOMP",campos:[],order:null,routeEdit:null,routeAdd:null,paramsEdit:{},modoAdd:1,modoEdit:1,refreshModal:1,refreshUso:1,openModalApertura:!1,monedas:[],config:{vjson:0,tabla:[{width:20,headerName:"Caja",field:"ID_CAJA",hide:!0},{width:20,headerName:"TIPUSO",field:"TIPUSO",hide:!0},{width:20,headerName:"CODSUNAT",field:"CODSUNAT",hide:!0},{width:20,headerName:"Empresa",field:"EMPCOD",hide:!0},{width:20,headerName:"ID_LOCAL",field:"ID_LOCAL",hide:!0},{width:180,headerName:"Caja",field:"NOMBRE"},{width:80,headerName:"código",field:"NUMTAL"},{width:240,headerName:"Talon",field:"TALDES"},{width:80,headerName:"Serie",field:"NUMSER"},{width:120,headerName:"Instrucod",field:"INSTRUCOD",hide:!0}],btnEdit:!1,btnDelete:!0,idFormulario:25,primary:["ID_CAJA","NUMTAL"],campoMsgDelete:"NUMTAL",order:null},configCajaTalonUso:{vjson:0,tabla:[{width:20,headerName:"Caja",field:"ID_TALON_USO",hide:!0},{width:80,headerName:"Código",field:"TIPUSO"},{width:505,headerName:"Uso del Talonario",field:"VALOR"},{headerName:"",field:"ESTADO",width:45,cellRenderer:checkbox,cellRendererParams:{tValue:1,fValue:0,change:this.changeUso}}],btnEdit:!1,btnDelete:!1,idFormulario:25,primary:["ID_TALON_USO"],campoMsgDelete:"VALOR",order:null,filtro:{ID_CAJA:0,NUMTAL:0}},configTalonReferencia:{vjson:0,tabla:[{width:20,headerName:"Caja",field:"ID_CAJA",hide:!0},{width:20,headerName:"CODSUNAT",field:"CODSUNAT",hide:!0},{width:20,headerName:"Código",field:"ID_TALON_REF",hide:!0},{width:80,headerName:"Código",field:"NUMTAL_REF"},{width:280,headerName:"Talon",field:"TALDES"},{width:80,headerName:"Serie",field:"NUMSER"},{width:100,headerName:"Correlativo",field:"NUMPAG"},{width:20,headerName:"Código",field:"NUMTAL",hide:!0},{width:20,headerName:"Código",field:"NUMTALCAJA",hide:!0}],btnEdit:!1,btnDelete:!0,idFormulario:26,primary:["ID_TALON_REF"],campoMsgDelete:"TALDES",order:null,filtro:{NUMTALCAJA:"00",ID_CAJA:0}},configReferencias:{order:null,vjson:0,btnEdit:!1,btnDelete:!1,idFormulario:26,primary:["NUMTAL"],campoMsgDelete:"CODSUNAT",filtro:{CODSUNAT:"00",ID_CAJA:0},tabla:[{width:20,headerName:"Caja",field:"ID_CAJA",hide:!0},{width:20,headerName:"CODSUNAT",field:"CODSUNAT",hide:!0},{width:20,headerName:"Código",field:"ID_TALON_REF",hide:!0},{width:80,headerName:"Código",field:"NUMTAL"},{width:80,headerName:"Serie",field:"NUMSER"},{width:120,headerName:"Correlativo",field:"NUMPAG"},{width:400,headerName:"Talon",field:"TALDES"},{headerName:"",field:"ESTADO",width:45,cellRenderer:checkbox,cellRendererParams:{tValue:1,fValue:0,change:this.changeReferencia}}]},decimales:2,currentData:{},dataEditReferencia:{},refreshReferencia:1,local:"T",empresa:"T",locales:[{label:"Todos",value:"T"}],empresas:[{label:"Todos",value:"T"}],rowIndex:0,api:null}},methods:{changeReferencia:function(e){},changeUso:function(e,a){var r=this,t=this.$refs.gridUso.rowData,o=["1","2","3"],i=["4","5"],n=[],l={};t.map(function(e){var a=e.TIPUSO,r=e.VALOR,t=e.ESTADO;l[a]=r,t&&n.push(a)});var d=this.currentData,s=d.NUMTAL,c=o.filter(function(e){return n.includes(e)});if(c.length>0&&["4","5"].includes(a.data.TIPUSO)&&1===e)return a.data.ESTADO=0,this.refreshUso=this.refreshUso+1,(0,C.alert)("el Talonario ".concat(s," no puede asignarse a ").concat(l[a.data.TIPUSO]," porque  tiene un uso '").concat(l[n[0]],"'"),"warning"),!1;var h=i.filter(function(e){return n.includes(e)});if(h.length>0&&1===e)return a.data.ESTADO=0,this.refreshUso=this.refreshUso+1,(0,C.alert)("el Talonario ".concat(s," no puede asignarse a ").concat(l[a.data.TIPUSO]," porque  tiene un uso '").concat(l[n[0]],"'"),"warning"),!1;var f=u()(u()({},d),a.data);A.$http.post("api/talonarioController/updateCajaTalonUso",{data:f}).then(function(t){r.refresh=r.refresh+1,(0,C.alert)(t.message,"success"),e&&a.data.TIPUSO?n.push(a.data.TIPUSO):n.splice(n.indexOf(a.data.TIPUSO),1);var o=n.length>0?n.join(","):null;d.TIPUSO=o,r.rowClicked({data:d,rowIndex:r.rowIndex})}).catch(function(e){var t=e.error;a.data.ESTADO=0,r.refreshUso=r.refreshUso+1,(0,C.alert)(t.message,"warning"),a.refreshCell()})},filtrar:function(e){this.empresa=e;var a={};"T"!==this.empresa&&(a={EMPCOD:this.empresa}),this.reloadTalonarioCaja(a)},filtrarLocal:function(e){this.local=e;var a="T"!==this.empresa?{EMPCOD:this.empresa}:{};"T"!==this.local&&(a={EMPCOD:this.empresa,ID_LOCAL:this.local}),this.reloadTalonarioCaja(a)},loadedCaja:function(e){var a=e.getModel().rowsToDisplay;if(a.length>0){this.rowIndex>a.length&&(this.rowIndex=0),e.getModel().rowsToDisplay[this.rowIndex].setSelected(!0);var r=this.$refs.formcaja.rowData[this.rowIndex];this.rowClicked({data:r,rowIndex:this.rowIndex})}else{var t={},o=this.configCajaTalonUso;t={ID_CAJA:0,NUMTAL:0},o.filtro=t,this.configCajaTalonUso=u()({},o);var i=this.configReferencias;t={NUMTALCAJA:"00",ID_CAJA:0},i.filtro=t,this.configReferencias=u()({},i)}},reloadTalonarioCaja:function(e){var a=u()({},this.config);a.filtro=e,this.config=a},loadedData:function(e){e&&this.loadedCaja(e)},rowClicked:function(e){this.rowIndex=e.rowIndex;var a=e.data,r=a.NUMTAL,t=a.TIPUSO,o=a.ID_CAJA,i=a.CODSUNAT,n=a.TALDES;this.currentData={NUMTAL:r,TIPUSO:t,ID_CAJA:o,CODSUNAT:i,TALDES:n};var l={NUMTAL:r,ID_CAJA:o};this.reloadUso(l);var d=u()({},this.configTalonReferencia);d.filtro={ID_CAJA:o,NUMTALCAJA:r},this.configTalonReferencia=d},reloadUso:function(e){var a=u()({},this.configCajaTalonUso);a.filtro=e,this.configCajaTalonUso=a},loadList:function(){this.refresh=this.refresh+1},agregarReferencia:function(){var e=this.currentData,a=e.TIPUSO,r=e.CODSUNAT,t=e.NUMTAL,o=e.ID_CAJA;if(this.dataEditReferencia={},["01","RE","03"].includes(r)&&null==a)return(0,C.alert)("No estapermitido referenciar talonarios sin uso definido"),!1;var i=[];a&&(i=a.length>1?a.split(","):[a]);var n={NUMTAL_REF:t,ID_CAJA:o};if(["07","08","RE"].includes(r))n.CODSUNAT=["01","03"];else{if(!["01","03"].includes(r)||!i.includes("4"))return(0,C.alert)("Las Facturas y Boletas de referencia deben tener un uso 'Mora'"),!1;n.CODSUNAT=[r]}var l=u()({},this.configReferencias);l.filtro=n,this.configReferencias=l,this.openModalReferencia=!0},editarReferencia:function(e){var a=e.data,r=a.NUMTAL_REF,t=a.NUMTAL,o=a.NUMCAJA,i=a.ID_TALON_REF;this.dataEditReferencia={NUMTAL_REF:r},this.currentData=u()(u()({},this.currentData),{},{NUMTAL:t,NUMCAJA:o,ID_TALON_REF:i}),this.openModalReferencia=!0},guardarReferencia:function(){var e=this,a=u()({},this.currentData),r=this.$refs.referencias.rowData.filter(function(e){return e.ESTADO}),t=a.ID_CAJA,o=a.NUMTAL,i=r.map(function(e){var a=e.ID_CAJA,r=e.NUMTAL;return{ID_CAJA:a,NUMTAL:o,NUMTAL_REF:r}}),n={ID_CAJA:t,NUMTAL:o};A.$http.post("api/talonarioController/updateTalonReferencia",{data:{data:i,filtro:n}}).then(function(a){(0,C.alert)(a.message,"success"),e.refreshReferencia=e.refreshReferencia+1,e.openModalReferencia=!1}).catch(function(e){var a=e.error;(0,C.alert)(a.message,"warning")})},updatedForm:function(e){if(!this.currentEdit){var a=e.ID_CAJA_USU,r=e.FECHA,t=e.TURNO;if(a&&r&&t){r=r.split("/").reverse().join("/");var o=u()({},this.configGrid);o.filtro={ID_CAJA_USU:a,FECHA:r,TURNO:t},this.configGrid=u()({},o)}}},edit:function(e){this.currentEdit=!0;var a=e.data,r=a.ID_CAJA_USU,t=a.NOMBRE,o=a.MONCOD,i=a.FECHA,n=a.TURNO,l=a.CIERRE;this.dataEdit={ID_CAJA_USU:r,NOMBRE:t,MONCOD:o,FECHA:i,TURNO:n,CIERRE:l};var d=u()({},this.configGrid);d.filtro={ID_CAJA_USU:r,FECHA:i,TURNO:n,MONCOD:o},this.configGrid=u()({},d),this.openModalApertura=!0},agregar:function(e){1===this.modoAdd?this.openModal=!0:this.$router.push({name:this.routeAdd})},deletedCajaTalon:function(e){var a=this,r=e.data,t=r.NOMBRE,o=r.NUMTAL,i=r.ID_CAJA;(0,C.confirm)("Esta seguro de eliminar el talonario: \n ".concat(o," de la caja ").concat(t),"delete").onOk(function(){A.$http.delete("api/".concat(a.methodDelete),{params:{ID_CAJA:i,NUMTAL:o}}).then(function(e){a.refresh=a.refresh+1,a.refreshUso=a.refreshUso+1,(0,C.alert)("Registro Eliminado")}).catch(function(e){var a=e.error;console.error(a),(0,C.alert)("No se puede eliminar el talonario ".concat(a.message),"warning")})})},getLocales:function(){var e=this,a={response:"combo",empcod:this.empresa};A.$http.get("api/empresaController/getLocales",{params:{parametros:a}}).then(function(a){var r=a.map(function(e){var a=e.ID_LOCAL,r=e.NOMBRE;return{value:a,label:r}});r.unshift({label:"Todos",value:"T"}),e.locales=r}).catch(function(e){e.error;(0,M["default"])("Error al cargar los locales","warning")})}},created:function(){var e=this;A.$http.get("api/empresaController/getEmpresas",{params:{response:"combo"}}).then(function(a){var r=a.map(function(e){var a=e.EMPCOD,r=e.RAZONSOCIAL;return{value:a,label:r}});r.unshift({label:"Todos",value:"T"}),e.empresas=r}).catch(function(e){e.error;(0,M["default"])("Error cargar los filtros","warning")})}},I=r(12807);const S=(0,I.A)(E,[["render",h]]);var _=S}}]);