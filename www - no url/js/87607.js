"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[87607],{87607:function(e,o,a){a.r(o),a.d(o,{default:function(){return Q}});a(56285);var t=a(61758),n=a(58790),l={class:"row"},i={class:"row"},s={key:0,class:"col"},r={key:0,class:"col"},c={key:0,class:"column"},d={key:1},u={class:"col"},p={class:"col row"},m={class:"row justify-around q-pa-sm"},f={class:"row col justify-center",size:"15px"},h={class:"col"},b={class:"col row q-ma-sm"},g={class:"col column"},v={class:"col column"},k={class:"col row"},D={class:"col row"};function C(e,o){var a=(0,t.g2)("sie-select"),C=(0,t.g2)("q-select"),A=(0,t.g2)("sie-date"),T=(0,t.g2)("q-th"),E=(0,t.g2)("q-tr"),y=(0,t.g2)("q-tooltip"),O=(0,t.g2)("q-radio"),V=(0,t.g2)("q-popup-edit"),L=(0,t.g2)("q-td"),w=(0,t.g2)("q-table"),S=(0,t.g2)("sie-modal"),_=(0,t.g2)("q-fab-action"),F=(0,t.g2)("q-fab"),P=(0,t.g2)("q-page-sticky"),U=(0,t.g2)("q-page");return(0,t.uX)(),(0,t.Wv)(U,{class:"column q-pa-md bg-white"},{default:(0,t.k6)(function(){return[(0,t.Lk)("div",l,[(0,t.bF)(a,{class:"col",type:"outlined",noBottom:"",modelValue:e.taller,"onUpdate:modelValue":o[0]||(o[0]=function(o){return e.taller=o}),options:e.listaTalleres,label:"TALLEDES",val:"TALLECOD",placeholder:e.$t("taller"),onSelected:e.seleccionaTaller},null,8,["modelValue","options","placeholder","onSelected"])]),(0,t.Lk)("div",i,[(0,t.bF)(C,{class:"q-if-outlined no-bottom",options:e.tipoAsistencia,modelValue:e.tipoReg,"onUpdate:modelValue":o[1]||(o[1]=function(o){return e.tipoReg=o}),"stack-label":"Tipo de Registro",onInput:e.seleccionaTipo},null,8,["options","modelValue","onInput"]),3!==e.tipoReg?((0,t.uX)(),(0,t.CE)("div",s,[1===e.tipoReg?((0,t.uX)(),(0,t.Wv)(C,{key:0,class:"col q-if-outlined no-bottom",options:e.meses,modelValue:e.mes,"onUpdate:modelValue":o[2]||(o[2]=function(o){return e.mes=o}),"stack-label":"Mes",onInput:e.seleccionaMes},null,8,["options","modelValue","onInput"])):((0,t.uX)(),(0,t.Wv)(C,{key:1,class:"col q-if-outlined no-bottom",options:e.periodos,modelValue:e.bimecod,"onUpdate:modelValue":o[3]||(o[3]=function(o){return e.bimecod=o}),"stack-label":"Periodo",onInput:e.seleccionaPeriodo},null,8,["options","modelValue","onInput"]))])):((0,t.uX)(),(0,t.Wv)(A,{key:1,class:"q-if-outlined no-bottom",modelValue:e.fecha,"onUpdate:modelValue":o[4]||(o[4]=function(o){return e.fecha=o}),options:e.diasDisp,onSelected:e.seleccionaFecha,placeholder:"fecha"},null,8,["modelValue","options","onSelected"]))]),e.dataAsistencia.length>0?((0,t.uX)(),(0,t.CE)("div",r,[(0,t.bF)(w,{"table-style":"height: 70vh","row-key":"USUCOD",data:e.dataAsistencia,columns:e.tablaConfig.columns,pagination:e.tablaConfig.paginacion,"onUpdate:pagination":o[5]||(o[5]=function(o){return e.tablaConfig.paginacion=o})},{header:(0,t.k6)(function(o){return[(0,t.bF)(E,null,{default:(0,t.k6)(function(){return[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(o.cols,function(a){return(0,t.uX)(),(0,t.Wv)(T,{key:a.name,class:"border-th",props:o},{default:(0,t.k6)(function(){return[a.fecha?((0,t.uX)(),(0,t.CE)("div",c,[(0,t.Lk)("span",null,(0,n.v_)(e.date(a.label,"ddd")),1),(0,t.Lk)("span",null,(0,n.v_)(e.date(a.label,"DD/MM")),1)])):((0,t.uX)(),(0,t.CE)("span",d,(0,n.v_)(a.label),1))]}),_:2},1032,["props"])}),128))]}),_:2},1024)]}),body:(0,t.k6)(function(o){return[(0,t.bF)(E,{props:o},{default:(0,t.k6)(function(){return[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(o.cols,function(a){return(0,t.uX)(),(0,t.Wv)(L,{key:a.name,class:"border-td",props:o,style:(0,n.Tr)([{"background-color":e.iconoColor[o.row[a.name]]},{position:"relative"}])},{default:(0,t.k6)(function(){return[a.fecha?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[(0,t.Lk)("span",u,[(0,t.eW)((0,n.v_)(e.iconoTipo[o.row[a.name]]),1),(0,t.bF)(y,null,{default:(0,t.k6)(function(){return[(0,t.eW)((0,n.v_)(e.iconoDesc[o.row[a.name]]),1)]}),_:2},1024)]),e.feriados.indexOf(a.name)<0?((0,t.uX)(),(0,t.Wv)(V,{key:0,class:"justify-center",modelValue:o.row[a.name],"onUpdate:modelValue":function(e){return o.row[a.name]=e},onHide:function(t){return e.cambiarEstado(o.row,a.name,o.row["__index"]),e.estadoAnt},onShow:function(t){return e.asignaAnterior(o.row[a.name])}},{default:(0,t.k6)(function(){return[(0,t.Lk)("div",p,[(0,t.Lk)("b",null,(0,n.v_)(e.date(a.label,"DD/MM")),1)]),(0,t.Lk)("div",m,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(e.estados,function(e){return(0,t.uX)(),(0,t.CE)("div",{key:e.ESTADOCOD,class:"q-ma-sm",style:{width:"20px",height:"20px !important"}},[(0,t.Lk)("div",{class:"col",style:(0,n.Tr)({color:e.COLORHEXT,"background-color":e.COLORHEXF}),color:"secondary"},[(0,t.bF)(O,{class:"col",modelValue:o.row[a.name],"onUpdate:modelValue":function(e){return o.row[a.name]=e},val:e.ESTADOCOD},null,8,["modelValue","onUpdate:modelValue","val"]),(0,t.Lk)("div",f,[(0,t.Lk)("span",null,(0,n.v_)(e.ESTADOETI),1)])],4)])}),128))])]}),_:2},1032,["modelValue","onUpdate:modelValue","onHide","onShow"])):(0,t.Q3)("v-if",!0)],64)):((0,t.uX)(),(0,t.Wv)(L,{key:1,class:"border-td"},{default:(0,t.k6)(function(){return[(0,t.Lk)("span",null,(0,n.v_)(o.row[a.name]),1)]}),_:2},1024))]}),_:2},1032,["props","style"])}),128))]}),_:2},1032,["props"])]}),_:1},8,["data","columns","pagination"])])):(0,t.Q3)("v-if",!0),(0,t.bF)(S,{modelValue:e.modalProcesar,"onUpdate:modelValue":o[7]||(o[7]=function(o){return e.modalProcesar=o}),title:"Procesar Asistencia",header:!0,noClose:e.cargando,loading:e.cargando,onSubmit:e.procesaData},{default:(0,t.k6)(function(){return[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(e.estados,function(a){return(0,t.uX)(),(0,t.CE)("div",{key:a.ESTADOCOD,class:"q-ma-sm"},[(0,t.Lk)("div",h,[(0,t.bF)(O,{class:"col",modelValue:e.estadoProcesar,"onUpdate:modelValue":o[6]||(o[6]=function(o){return e.estadoProcesar=o}),val:a.ESTADOCOD},{default:(0,t.k6)(function(){return[(0,t.eW)((0,n.v_)(a.ESTADODES),1)]}),_:2},1032,["modelValue","val"])])])}),128))]}),_:1},8,["modelValue","noClose","loading","onSubmit"]),(0,t.bF)(S,{modelValue:e.modalImprimir,"onUpdate:modelValue":o[13]||(o[13]=function(o){return e.modalImprimir=o}),title:e.$t("botones.imprimir"),header:!0,noClose:e.cargando,loading:e.cargando,onSubmit:e.imprimir},{default:(0,t.k6)(function(){return[(0,t.Lk)("div",b,[(0,t.Lk)("div",g,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(e.reportes,function(a){return(0,t.uX)(),(0,t.CE)("div",{key:a.repcod,class:"q-ma-sm"},[(0,t.bF)(O,{class:"col",modelValue:e.reporteData.reptipo,"onUpdate:modelValue":o[8]||(o[8]=function(o){return e.reporteData.reptipo=o}),val:a.repcod,color:"secondary"},{default:(0,t.k6)(function(){return[(0,t.eW)((0,n.v_)(a.desc),1)]}),_:2},1032,["modelValue","val"])])}),128))]),(0,t.Lk)("div",v,[(0,t.Lk)("div",k,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(e.tipoAsistencia,function(a){return(0,t.uX)(),(0,t.CE)("div",{key:a.value,class:"q-ma-sm"},[a.oculta?(0,t.Q3)("v-if",!0):((0,t.uX)(),(0,t.Wv)(O,{key:0,class:"col",modelValue:e.reporteData.tipoBusqueda,"onUpdate:modelValue":o[9]||(o[9]=function(o){return e.reporteData.tipoBusqueda=o}),val:a.value,color:"secondary"},{default:(0,t.k6)(function(){return[(0,t.eW)((0,n.v_)(a.label),1)]}),_:2},1032,["modelValue","val"]))])}),128))]),(0,t.bF)(a,{class:"col",type:"outlined",noBottom:"",modelValue:e.reporteData.SALON,"onUpdate:modelValue":o[10]||(o[10]=function(o){return e.reporteData.SALON=o}),options:e.listaTalleres,label:"TALLEDES",val:"TALLECOD",placeholder:e.$t("taller")},null,8,["modelValue","options","placeholder"]),(0,t.Lk)("div",D,[1===e.reporteData.tipoBusqueda?((0,t.uX)(),(0,t.Wv)(C,{key:0,class:"col q-if-outlined no-bottom",options:e.meses,modelValue:e.reporteData.mescod,"onUpdate:modelValue":o[11]||(o[11]=function(o){return e.reporteData.mescod=o}),"stack-label":"Mes"},null,8,["options","modelValue"])):((0,t.uX)(),(0,t.Wv)(C,{key:1,class:"col q-if-outlined no-bottom",options:e.periodos,modelValue:e.reporteData.bimecod,"onUpdate:modelValue":o[12]||(o[12]=function(o){return e.reporteData.bimecod=o}),"stack-label":"Periodo"},null,8,["options","modelValue"]))])])])]}),_:1},8,["modelValue","title","noClose","loading","onSubmit"]),(0,t.bF)(P,{position:"bottom-right",offset:[20,20]},{default:(0,t.k6)(function(){return[(0,t.bF)(F,{icon:"more_vert",direction:"up",color:"secondary"},{default:(0,t.k6)(function(){return[e.numEditados?((0,t.uX)(),(0,t.Wv)(_,{key:0,color:"secondary",icon:"save",onClick:e.grabar},{default:(0,t.k6)(function(){return[(0,t.bF)(y,{anchor:"bottom left",self:"bottom right"},{default:(0,t.k6)(function(){return[(0,t.eW)((0,n.v_)(e.$t("botones.guardar")),1)]}),_:1})]}),_:1},8,["onClick"])):(0,t.Q3)("v-if",!0),e.numEditados&&3===e.tipoReg?((0,t.uX)(),(0,t.Wv)(_,{key:1,color:"secondary",icon:"cog",onClick:o[14]||(o[14]=function(o){return e.modalProcesar=!0})},{default:(0,t.k6)(function(){return[(0,t.bF)(y,{anchor:"bottom left",self:"bottom right"},{default:(0,t.k6)(function(){return[(0,t.eW)((0,n.v_)(e.$t("botones.procesar")),1)]}),_:1})]}),_:1})):(0,t.Q3)("v-if",!0),(0,t.bF)(_,{color:"secondary",icon:"print",onClick:e.abrirModalReportes},{default:(0,t.k6)(function(){return[(0,t.bF)(y,{anchor:"bottom left",self:"bottom right"},{default:(0,t.k6)(function(){return[(0,t.eW)((0,n.v_)(e.$t("botones.imprimir")),1)]}),_:1})]}),_:1},8,["onClick"])]}),_:1})]}),_:1})]}),_:1})}a(10239),a(50310),a(90095),a(515),a(83190),a(27153),a(13715);var A=a(6123),T=a(80660),E=a(57668),y=a(80340),O=a(34858),V=a(51082),L=a(2819),w=a(30640),S=a(93616),_=a(24974),F=a(65818),P=a(18105),U=a(982),q={components:{QSelect:A.Si,sieUsuario:_.A,sieModal:w.A,sieVacio:y.A,QToggle:A.c5,QCheckbox:A.vZ,QBtnToggle:A.QL,sieSelect:S.A,QRadio:A.$,QClock:F.A,QTable:A.kH,QTh:A.EJ,QTr:A.qh,QTd:A.Ef,QTableColumns:A.$s,virtualList:O.Ay,QPopupEdit:A.GT,QChip:A.wQ,sieDate:V.A,QFabAction:A.B$,QPageSticky:A._U,QFab:A.l6,QPage:A.Tu,QTooltip:A.nC},data:function(){return{now:new Date,sie:(0,E["default"])(),mes:(new Date).getMonth()+1,bimecod:null,estados:[],listaTalleres:[],taller:null,tipoReg:null,tipoAsistencia:[{value:1,label:"Mes"},{value:2,label:"Periodo"},{value:3,label:"Dia",oculta:!0}],periodos:[{value:1,label:"Primer Periodo"},{value:2,label:"Segundo Periodo"},{value:3,label:"Tercer Periodo"},{value:4,label:"Cuarto Periodo"}],meses:[],dataAsistencia:[],dataFechas:[],feriados:[],tablaConfig:{},alto:0,iconoColor:{},iconoTipo:{},iconoDesc:{},editados:{},estadoSelect:null,estadoAnt:null,fecha:new Date,diasDisp:[],cantModif:0,modalProcesar:!1,estadoProcesar:null,cargando:!1,modalImprimir:!1,reportes:[],reporteData:{reptipo:"0",repcod:"reporteAsistenciaTalleres",tipoBusqueda:1,mescod:null,bimecod:null,SALON:null,txtFlgT:"N"}}},methods:{date:P.Ay,procesaData:function(){var e=this;if(this.estadoProcesar){this.cargando=!0;var o={tallecod:this.taller,fecha:this.fecha,estado:this.estadoProcesar};T.$http.get("api/HyoTalleasis/procesarAsistencia",{params:o}).then(function(o){var a=o.json;"mensajes.m0001"===a?((0,U["default"])(e.$t(a)),e.cargarData(),e.editados={},e.estadoProcesar=null):(0,U["default"])(e.$t(a),"error"),e.cargando=!1,e.modalProcesar=!1})}},generaParametros:function(){var e=this;return new Promise(function(o,a){var t={tallecod:e.taller};if(!e.taller)return!1;if(1===e.tipoReg){if(t.mes=e.mes,delete t.bimecod,delete t.dia,!e.mes)return!1}else if(3===e.tipoReg){if(t.dia=e.fecha,delete t.bimecod,delete t.mes,!e.fecha)return!1}else{if(t.bimecod=e.bimecod,!e.bimecod)return!1;delete t.mes,delete t.dia}o(t)})},seleccionaTipo:function(e){var o=this;3===e?0===this.diasDisp.length&&T.$http.get("api/HyoTalleasis/obtCabecerasAsistenciaMesTaller",{params:{tallecod:this.taller}}).then(function(e){var a=e.json;o.diasDisp=a.diasDisp}):this.diasDisp=[],this.generaParametros().then(function(e){o.generaTabla(e)})},seleccionaFecha:function(e){this.generaTabla({dia:e,tallecod:this.taller})},seleccionaPeriodo:function(e){this.generaTabla({bimecod:e,tallecod:this.taller})},seleccionaMes:function(e){this.generaTabla({mes:e,tallecod:this.taller})},generaTabla:function(e){var o=this;e||this.generaParametros().then(function(o){e=o}),T.$http.get("api/HyoTalleasis/obtCabecerasAsistenciaMesTaller",{params:e}).then(function(a){var t=a.json;o.dataFechas=t.diasDisp,o.feriados=t.feriados;var n={};n.columns=[{name:"NOMCOMP",field:"NOMCOMP",align:"left",label:o.$t("seguridad.nombre")}],n.paginacion={page:1,rowsPerPage:20},n.registrosSeleccionados=[],n.filter="",n.tipoSeleccion="single",n.estado="T",t.diasDisp.forEach(function(e){n.columns.push({name:e,field:e,align:"center",label:e,fecha:!0})}),o.tablaConfig=n,o.cargarData(e)})},seleccionaTaller:function(){this.dataFechas=[],this.feriados=[],this.diasDisp=[],this.seleccionaTipo(this.tipoReg),this.generaTabla()},cargarData:function(e){var o=this;this.dataAsistencia=[],e?T.$http.get("api/HyoTalleasis/obtAsistenciaMesTaller",{params:e}).then(function(e){var a=e.json;o.dataAsistencia=a.dataReturn}):this.generaParametros().then(function(e){T.$http.get("api/HyoTalleasis/obtAsistenciaMesTaller",{params:e}).then(function(e){var a=e.json;o.dataAsistencia=a.dataReturn})})},handleResize:function(){this.alto=window.innerHeight-105},asignaAnterior:function(e){this.estadoAnt=e},cambiarEstado:function(e,o,a){if(this.dataAsistencia[a][o]=e[o],this.editados[e.ALUCOD])this.editados[e.ALUCOD][o]?this.editados[e.ALUCOD][o].anterior!==e[o]?this.editados[e.ALUCOD][o].actual=e[o]:this.editados[e.ALUCOD][o].anterior&&delete this.editados[e.ALUCOD][o]:(this.editados[e.ALUCOD][o]={actual:e[o]},this.estadoAnt&&(this.editados[e.ALUCOD][o].anterior=this.estadoAnt));else{this.editados[e.ALUCOD]={};var t={actual:e[o]};this.estadoAnt&&(t["anterior"]=this.estadoAnt),this.editados[e.ALUCOD][o]=t}},grabar:function(){var e=this;if(Object.keys(this.editados).length>0){var o={dataInsert:this.editados,tallecod:this.taller};T.$http.get("api/HyoTalleasis/registrarAsistenciaBloque",{params:o}).then(function(o){var a=o.json;"mensajes.m0001"===a?((0,U["default"])(e.$t(a)),e.cargarData(),e.editados={}):(0,U["default"])(e.$t(a),"error")})}},abrirModalReportes:function(){this.modalImprimir=!0,this.reporteData.mescod=this.mes,this.reporteData.bimecod=this.bimecod},imprimir:function(){(0,L["default"])(this.reporteData,"webservice/reportes/reporte")}},computed:{numEditados:function(){return this.sie.ruta.nivel>1},maxLista:function(){var e=this.alto-200;return e/20}},unmounted:function(){window.removeEventListener("resize",this.handleResize)},created:function(){var e=this;this.tipoReg=1,T.$http.get("api/HyoHorasisEstado/listarHorasisEstado",{params:{momento:1}}).then(function(o){var a=o.json;a.forEach(function(o){e.iconoColor[o.ESTADOCOD]=o.COLORHEXF,e.iconoTipo[o.ESTADOCOD]=o.ESTADOETI,e.iconoDesc[o.ESTADOCOD]=o.ESTADODES}),e.estados=a}),T.$http.get("api/HyoTalleres/obtTalleresUsuario").then(function(o){var a=o.json;e.listaTalleres=a}),T.$http.get("api/HyoPercales/estadoFechaInstru").then(function(o){var a=o.json;a.length&&a[0].BIMECOD&&(e.bimecod=parseInt(a[0].BIMECOD))}),T.$http.get("api/HyoMeses/obtMeses").then(function(o){var a=o.json;a.forEach(function(o){e.meses.push({label:o.MESDES,value:parseInt(o.MESCOD)})}),window.addEventListener("resize",e.handleResize),e.handleResize()}),this.reportes=[{repcod:"0",desc:"Registro de asistencias "},{repcod:"1",desc:"Registro de asistencias (borrador)",descAdic:"-borrador"}]}},X=a(12807);const M=(0,X.A)(q,[["render",C]]);var Q=M}}]);