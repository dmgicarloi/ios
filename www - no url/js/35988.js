"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[35988],{35988:function(a,n,i){i.r(n),i.d(n,{default:function(){return U}});i(56285);var e=i(61758),t={class:"row q-pa-sm q-col-gutter-sm"},r={class:"col-12"},o={class:"col-12"};function s(a,n){var i=(0,e.g2)("header-btn"),s=(0,e.g2)("uos"),c=(0,e.g2)("q-card-section"),d=(0,e.g2)("q-card"),u=(0,e.g2)("q-input"),l=(0,e.g2)("q-form"),g=(0,e.g2)("sie-modal"),p=(0,e.g2)("q-page");return(0,e.uX)(),(0,e.Wv)(p,{class:"q-pa-sm intranet-unidades-organizativas sie-flat"},{default:(0,e.k6)(function(){return[(0,e.bF)(d,{flat:""},{default:(0,e.k6)(function(){return[(0,e.bF)(c,null,{default:(0,e.k6)(function(){return[!0===a.isLogged?((0,e.uX)(),(0,e.Wv)(i,{key:0,name:"Unidad Organizativa Google",buttons:a.buttons},null,8,["buttons"])):((0,e.uX)(),(0,e.Wv)(i,{key:1,name:"Unidad Organizativa Google",buttons:a.buttonsLogin,auto:!1},null,8,["buttons"])),(0,e.bF)(s,{opened:!1,data:a.unidadesOrganizativas,onAgregar:a.agregar,onEditar:a.editar,onEliminar:a.eliminar},null,8,["data","onAgregar","onEditar","onEliminar"])]}),_:1})]}),_:1}),(0,e.bF)(g,{modelValue:a.modalEditarUnidad,"onUpdate:modelValue":n[2]||(n[2]=function(n){return a.modalEditarUnidad=n}),title:"".concat("create"===a.action?"Crear":"Editar"," Unidad Organizativa"),onSubmit:a.saveUnidadOrganizativa},{default:(0,e.k6)(function(){return[(0,e.bF)(l,{ref:"unidadOrganizativa"},{default:(0,e.k6)(function(){return[(0,e.Lk)("div",t,[(0,e.Lk)("div",r,[(0,e.bF)(u,{modelValue:a.form.name,"onUpdate:modelValue":n[0]||(n[0]=function(n){return a.form.name=n}),label:"Nombre",rules:[function(a){return!!a||"Campo es requerido"}]},null,8,["modelValue","rules"])]),(0,e.Lk)("div",o,[(0,e.bF)(u,{modelValue:a.form.descripcion,"onUpdate:modelValue":n[1]||(n[1]=function(n){return a.form.descripcion=n}),type:"textarea",label:"Descripción"},null,8,["modelValue"])])])]}),_:1},512)]}),_:1},8,["modelValue","title","onSubmit"])]}),_:1})}var c=i(76080),d=i.n(c),u=i(45254),l=i.n(u),g=(i(12982),i(3110),i(10239),i(89571),i(52776),i(81813),i(6123)),p=i(46877),m=i(95718),f=i(30640),v=i(9736),h=i(2739),b=i(95655),w=i(81288),k={components:{QForm:h.A,QInput:v.A,QCardSection:m.A,sieModal:f.A,uos:p.A,QPage:g.Tu,QCard:g.C$},data:function(){return{buttons:[{icon:"plus",color:"primary",label:"Agregar",click:this.agregar},{label:"Cerrar Sesión",icon:"account_lock",click:this.cerrarSesionAdmin}],buttonsLogin:[{label:"Iniciar Sesión",icon:"vpn_key",click:this.login}],unidadesOrganizativas:[],modalEditarUnidad:!1,title:"",form:{name:"",descripcion:""},currentUnidadOrganizativa:null,action:"create",isLogged:!1}},methods:{saveUnidadOrganizativa:function(){var a=this;return l()(d()().m(function n(){var i,e,t;return d()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.n=1,a.$refs.unidadOrganizativa.validate();case 1:if(i=n.v,i){n.n=2;break}return n.a(2);case 2:if(n.p=2,"create"!==a.action){n.n=4;break}return e={name:a.form.name,description:a.form.descripcion},!0===a.currentUnidadOrganizativa.root?e.parentOrgUnitPath=a.currentUnidadOrganizativa.parentOrgUnitPath:e.parentOrgUnitId=a.currentUnidadOrganizativa.orgUnitId,n.n=3,a.$http.post("api/HyoDirectory/createOrgunits",e);case 3:t=n.v,t.children=[],!0===a.currentUnidadOrganizativa.root?a.unidadesOrganizativas.push(t):a.currentUnidadOrganizativa.children.push(t),a.$notify("Unidad organizativa creada","success"),n.n=7;break;case 4:if("update"!==a.action){n.n=7;break}return n.n=5,a.$http.put("api/HyoDirectory/updateOrgunits",{name:a.form.name,description:a.form.descripcion,orgUnitPath:a.currentUnidadOrganizativa.orgUnitPath.replace(/^\//,"")});case 5:return n.n=6,a.$http.get("api/HyoDirectory/getAllOrgunits");case 6:a.unidadesOrganizativas=n.v,a.$notify("Unidad organizativa actualizada","success");case 7:a.modalEditarUnidad=!1,n.n=9;break;case 8:n.p=8,n.v,a.$notify("No ha sido posible crear/modificar la unidad organizativa","warning");case 9:return n.a(2)}},n,null,[[2,8]])}))()},agregar:function(a){var n=Object.prototype.hasOwnProperty.call(a,"click");this.action="create",this.currentUnidadOrganizativa=!0===n?{parentOrgUnitPath:"/",root:!0}:a,this.form.name="",this.form.descripcion="",this.modalEditarUnidad=!0},editar:function(a){this.action="update",this.currentUnidadOrganizativa=a,this.title=a.name,this.form.name=a.name,this.form.descripcion=a.description,this.modalEditarUnidad=!0},eliminar:function(a,n){var i=this;return l()(d()().m(function e(){var t;return d()().w(function(e){while(1)switch(e.p=e.n){case 0:return e.n=1,i.$confirmar("Esta unidad organizativa no se podrá eliminar si tiene unidades organizativas secundarias, usuarios, dispositivos o unidades compartidas.","delete");case 1:if(t=e.v,!t){e.n=5;break}return e.p=2,e.n=3,i.$http.delete("api/HyoDirectory/deleteOrgunits",{params:{orgUnitPath:a.orgUnitPath.replace(/^\//,"")}});case 3:n.splice(n.indexOf(a),1),i.$notify("Unidad organizativa eliminada","success"),e.n=5;break;case 4:e.p=4,e.v,i.$notify("No ha sido posible eliminar la unidad organizativa","warning");case 5:return e.a(2)}},e,null,[[2,4]])}))()},login:function(){var a=this;return l()(d()().m(function n(){var i;return d()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,delete window.localStorage._apiGoogle,a.isLogged=!1,n.n=1,a.$http.post("api/HyoLoginGoogleAdmin/login");case 1:if(i=n.v,"string"!==typeof i){n.n=2;break}(0,b["default"])(i,"_system",500,500),n.n=4;break;case 2:return a.isLogged=!0,n.n=3,a.$http.get("api/HyoDirectory/getAllOrgunits");case 3:a.unidadesOrganizativas=n.v;case 4:n.n=6;break;case 5:n.p=5,n.v,a.$notify("Intentalo nuevamente.","warning");case 6:return n.a(2)}},n,null,[[0,5]])}))()},cerrarSesionAdmin:function(){var a=this;return l()(d()().m(function n(){var i,e,t;return d()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,n.n=1,a.$http.post("api/HyoLoginGoogleAdmin/cerrarSesionAdmin");case 1:i=n.v,e=i.message,a.$notify(e,"success"),a.$router.push({name:"intranet.muro"}),a.isLogged=!1,n.n=3;break;case 2:n.p=2,t=n.v,a.$notify(t.message,"warning");case 3:return n.a(2)}},n,null,[[0,2]])}))()}},created:function(){var a=this;this.login(),window.currentSieCloud=!1,(0,w.watchAuth2)(["_apiGoogle"],function(){var n=l()(d()().m(function n(i,e){var t,r,o,s;return d()().w(function(n){while(1)switch(n.p=n.n){case 0:o=e,n.n="_apiGoogle"===o?1:7;break;case 1:return a.$q.loading.show(),n.p=2,n.n=3,a.$http.post("api/HyoLoginGoogleAdmin/guardarCodigo",{codigo:i});case 3:return t=n.v,a.isLogged=!0,n.n=4,a.$http.get("api/HyoDirectory/getAllOrgunits");case 4:a.unidadesOrganizativas=n.v,a.$notify(t.message,"success"),n.n=6;break;case 5:n.p=5,s=n.v,r=s.error||{},a.$notify(r.msg||r.message||"No ha sido posible iniciar sesión.","warning");case 6:return a.$q.loading.hide(),n.a(3,7);case 7:return n.a(2)}},n,null,[[2,5]])}));return function(a,i){return n.apply(this,arguments)}}())},unmounted:function(){window.callback&&window.removeEventListener("storage",window.callback.cb)},beforeCreate:function(){window.callback&&window.removeEventListener("storage",window.callback.cb)}},y=i(12807);const O=(0,y.A)(k,[["render",s]]);var U=O}}]);