"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[43940],{43940:function(e,a,r){r.r(a),r.d(a,{default:function(){return ra}});var n=r(61758);function o(e,a){var r=(0,n.g2)("control-visita");return(0,n.uX)(),(0,n.Wv)(r,{ingresoColegio:0})}var t=r(8445),i=r.n(t),s={class:"row text-center q-py-md justify-center",style:{"font-size":"x-large"}},l={key:0,class:"row text-center q-py-md justify-center",style:{"font-size":"x-large"}},c={class:"col-xs-12"},u={class:"row justify-center items-center"},d={class:"row q-col-gutter-sm"},f={key:0,class:"col-xs-12 col-md-6"},m={key:1,class:"col-xs-12 col-md-6"},E={ref:"audioOk",src:"statics/sound/ok.mp3"},O={ref:"audioInfo",src:"statics/sound/duplicate.mp3"},p={ref:"audioError",src:"statics/sound/error.mp3"};function A(e,a){var r=this,o=(0,n.g2)("q-clock"),t=(0,n.g2)("q-toggle"),A=(0,n.g2)("q-input"),R=(0,n.g2)("sie-select"),I=(0,n.g2)("q-tooltip"),D=(0,n.g2)("q-btn"),P=(0,n.g2)("qr"),_=(0,n.g2)("control-visita-form"),h=(0,n.g2)("q-card-main"),C=(0,n.g2)("q-card"),g=(0,n.g2)("sie-table"),N=(0,n.g2)("sie-modal"),b=(0,n.g2)("ficha-rapida-persona-perfil"),S=(0,n.g2)("consulta-visita"),v=(0,n.g2)("sie-pdf"),L=(0,n.g2)("q-page");return(0,n.uX)(),(0,n.Wv)(L,null,{default:(0,n.k6)(function(){return[(0,n.bF)(C,{class:"q-ma-sm"},{default:(0,n.k6)(function(){return[(0,n.bF)(h,null,{default:(0,n.k6)(function(){return[(0,n.Lk)("div",s,[(0,n.bF)(o,{ref:"refClock"},null,512)]),e.ingresoColegio?((0,n.uX)(),(0,n.CE)("div",l,[(0,n.Lk)("div",c,[(0,n.bF)(t,{modelValue:e.registroIngreso,"onUpdate:modelValue":a[0]||(a[0]=function(a){return e.registroIngreso=a}),label:1===e.registroIngreso?"Registrar Ingreso":"Registrar Salida","true-value":1,"false-value":0,color:"green",onInput:e.cambiarModo},null,8,["modelValue","label","onInput"])])])):(0,n.Q3)("v-if",!0),(0,n.Lk)("div",u,[e.buscarVisitante?(0,n.Q3)("v-if",!0):((0,n.uX)(),(0,n.Wv)(A,{key:0,class:"no-bottom q-if-outlined txt-especial",ref:"refUsucod",modelValue:e.usucod,"onUpdate:modelValue":a[1]||(a[1]=function(a){return e.usucod=a}),autofocus:!0,"stack-label":"DNI o Código",onKeydown:e.registraPistola},null,8,["modelValue","onKeydown"])),e.buscarVisitante?((0,n.uX)(),(0,n.Wv)(R,{key:1,class:"q-pt-sm col-md-4",type:"outlined",modelValue:e.idPersona,"onUpdate:modelValue":a[2]||(a[2]=function(a){return e.idPersona=a}),val:"ID_PERSONA",label:"NOMCOMP",options:e.personasVisita,readonly:!1,placeholder:"Persona visitante",onSelected:e.cambiarVisitante},null,8,["modelValue","options","onSelected"])):(0,n.Q3)("v-if",!0),(0,n.bF)(D,{class:"q-ml-sm",icon:"search",color:"secondary",onClick:a[3]||(a[3]=function(a){return e.buscarVisitante=!e.buscarVisitante}),style:{height:"36px"}},{default:(0,n.k6)(function(){return[(0,n.bF)(I,null,{default:(0,n.k6)(function(){return i()(a[8]||(a[8]=[(0,n.eW)("Buscar Visitante",-1)]))}),_:1})]}),_:1}),(0,n.bF)(D,{class:"q-ml-sm",icon:"add",color:"secondary",onClick:e.openModalRegistrarPersonaVisita,style:{height:"36px"}},{default:(0,n.k6)(function(){return[(0,n.bF)(I,null,{default:(0,n.k6)(function(){return i()(a[9]||(a[9]=[(0,n.eW)("Agregar Visitante",-1)]))}),_:1})]}),_:1},8,["onClick"]),(0,n.bF)(D,{class:"q-ml-sm",icon:"remove_red_eye",color:"secondary",onClick:e.openModalVerRegistrVisita,style:{height:"36px"}},{default:(0,n.k6)(function(){return[(0,n.bF)(I,null,{default:(0,n.k6)(function(){return i()(a[10]||(a[10]=[(0,n.eW)("Consulta visita",-1)]))}),_:1})]}),_:1},8,["onClick"]),e.citasProgramadas.length?((0,n.uX)(),(0,n.Wv)(D,{key:2,class:"q-ml-sm",outline:"",color:"secondary",icon:"calendar",onClick:e.openModalCita,style:{height:"36px"}},{default:(0,n.k6)(function(){return[(0,n.bF)(I,null,{default:(0,n.k6)(function(){return i()(a[11]||(a[11]=[(0,n.eW)("Citas Programadas",-1)]))}),_:1})]}),_:1},8,["onClick"])):(0,n.Q3)("v-if",!0)]),(0,n.Lk)("div",d,[e.sinCamara?(0,n.Q3)("v-if",!0):((0,n.uX)(),(0,n.CE)("div",f,[["qr","id"].indexOf(e.tipoLectura)>=0&&!e.leyendoQr?((0,n.uX)(),(0,n.Wv)(P,{key:0,onLeeQr:e.leerRegistro,cargaAnterior:e.cargaAnterior},null,8,["onLeeQr","cargaAnterior"])):(0,n.Q3)("v-if",!0)])),e.seleccionado?((0,n.uX)(),(0,n.CE)("div",m,[(0,n.bF)(_,{persona:e.seleccionado,"load-repetir":e.loadRepetir,"existe-fecha-ingreso":e.existeFechaIngreso,hora:e.hora,onRegistrarVisita:e.registrarVisita},null,8,["persona","load-repetir","existe-fecha-ingreso","hora","onRegistrarVisita"])])):(0,n.Q3)("v-if",!0)])]}),_:1})]}),_:1}),(0,n.bF)(N,{modelValue:e.modalCita,"onUpdate:modelValue":a[4]||(a[4]=function(a){return e.modalCita=a}),ok:!1,footer:!1,title:"Citas Programadas"},{default:(0,n.k6)(function(){return[(0,n.bF)(g,{class:"q-pa-sm",type:"normal",data:e.citasProgramadas,columns:e.fields,config:e.configCita,selection:"single","save-cells":"",css:"height:calc(100vh - 170px)",context:r},null,8,["data","columns","config"])]}),_:1},8,["modelValue"]),(0,n.bF)(N,{ref:"refRegistroPersona",modelValue:e.modalPersonaVisita,"onUpdate:modelValue":a[5]||(a[5]=function(a){return e.modalPersonaVisita=a}),ok:!1,footer:!1,title:"Registrar Visitante"},{default:(0,n.k6)(function(){return[(0,n.bF)(b,{onAddPersona:e.addPersona,"load-dni":e.dni,"on-focus-dni":!0},null,8,["onAddPersona","load-dni"])]}),_:1},8,["modelValue"]),(0,n.bF)(N,{modelValue:e.modalVerRegistroVisita,"onUpdate:modelValue":a[6]||(a[6]=function(a){return e.modalVerRegistroVisita=a}),ok:!1,footer:!1,title:"Ver Registro de visitas"},{default:(0,n.k6)(function(){return[(0,n.bF)(S)]}),_:1},8,["modelValue"]),(0,n.bF)(N,{modelValue:e.modalTicket,"onUpdate:modelValue":a[7]||(a[7]=function(a){return e.modalTicket=a}),title:"Ticket",css:{"min-width":"600px"},ok:!1,onSubmit:e.imprimirTicket},{default:(0,n.k6)(function(){return[(0,n.bF)(v,{name:"ticket",style:{height:"calc(100vh - 252px) !important"}})]}),_:1},8,["modelValue","onSubmit"]),(0,n.Lk)("audio",E,null,512),(0,n.Lk)("audio",O,null,512),(0,n.Lk)("audio",p,null,512)]}),_:1})}var R=r(57008),I=r.n(R),D=r(76080),P=r.n(D),_=r(45254),h=r.n(_),C=(r(30683),r(71225),r(74260),r(50310),r(5962),r(32203),r(11777),r(83190),r(6123)),g=r(57668),N=r(80340),b=r(30640),S=r(93616),v=r(65818),L=r(33530),M=r(982),T=r(81288),w=(r(83077),r(39866),r(52133),r(25751),r(6724),r(62692),r(80660)),F=r(41615),k={data:function(){return{personasVisita:[]}},methods:{getTipoDocumentoIdentidad:function(){return h()(P()().m(function e(){var a;return P()().w(function(e){while(1)switch(e.n){case 0:return e.n=1,w.$http.get("api/personaController/getTipoDocumentoIdentidad");case 1:return a=e.v,e.a(2,a)}},e)}))()},getPersonaPorDocumento:function(e){return w.$http.get("api/personaController/getPersonaPorDocumento",{params:{params:{numdoc:e}}})},getPersonasVisita:function(){var e=arguments,a=this;return h()(P()().m(function r(){var n,o,t,i,s,l,c,u;return P()().w(function(r){while(1)switch(r.n){case 0:if(n=e.length>0&&void 0!==e[0]?e[0]:"E",o=!(e.length>1&&void 0!==e[1])||e[1],t=e.length>2?e[2]:void 0,i={},s=[],"E"!==n){r.n=1;break}i={whereNotIn:[1,2,3,8,15]},r.n=5;break;case 1:if("I"!==n){r.n=2;break}i={where:{id_perfil:8,estado:1}},r.n=5;break;case 2:if("A"!==n){r.n=5;break}if(i={where:{id_perfil:1}},!t){r.n=5;break}return r.n=3,w.$http.get("api/personaController/getPersona",{params:{params:{idPersona:t,consulta:{getFamiliares:1}}}});case 3:if(l=r.v,s=l.familiares.filter(function(e){return F["default"].REFERENCIA_PERSONA.HIJO===e.ID_REFPER}),!s.length){r.n=4;break}s=s.map(function(e){return e.ID_PERSONA}),r.n=5;break;case 4:return a.personasVisita=[],r.a(2,a.personasVisita);case 5:return r.n=6,w.$http.get("api/personaController/getPersonasVisita",{params:{params:i}});case 6:return c=r.v,c=c.filter(function(e,a){var r=!e.ID_PERSONA,n=c.findIndex(function(a){return a.ID_PERSONA===e.ID_PERSONA})===a;return r||n}),c=c.sort(function(e,a){var r=e.PERFIL.toUpperCase(),n=a.PERFIL.toUpperCase();return e.ID_PERFIL-a.ID_PERFIL||r<n?-1:e.ID_PERFIL-a.ID_PERFIL||r>n?1:0}),u=c.map(function(e,a){e.KEY=a++;var r=e.CODIGO||e.ALUCOD;return e.NOMCOMP||(e.NOMCOMP=e.PERSONA||e.NOMBRES||e.NOMBRE),e.NOMCOMP+=o?" (".concat(e.PERFIL,")")+" || "+r:" ",e}),a.personasVisita=u,s.length&&(a.personasVisita=a.personasVisita.filter(function(e){return s.includes(e.ID_PERSONA)})),r.a(2,a.personasVisita)}},r)}))()}}},V=r(16648),U=(r(515),r(58790)),x={class:"row q-col-gutter-sm"},y={class:"col-xs-12"},$={class:"row q-pa-sm q-col-gutter-sm"},B={class:"col-xs-12 col-sm-8 column justify-end"},q={class:"row q-col-gutter-sm"},j={class:"col-xs-12"},H={class:"col-xs-12"},Q={class:"col-xs-12"},X={class:"col-xs-12 col-sm-4"},G={class:"col-xs-12"},z={class:"col-xs-12"},Y={class:"text-bold"},W={class:"col-xs-12"},J={class:"row q-pa-sm q-col-gutter-sm"},K={class:"col-xs-12"},Z={class:"row q-col-gutter-sm"},ee={key:0,class:"col-xs-12 text-right q-mt-md q-pa-sm"},ae={class:"col-xs-12"},re={class:"row q-col-gutter-sm"},ne={class:"col-xs-12"};function oe(e,a){var r=this,o=(0,n.g2)("q-btn"),t=(0,n.g2)("q-input"),i=(0,n.g2)("q-img"),s=(0,n.g2)("q-checkbox"),l=(0,n.g2)("q-form"),c=(0,n.g2)("q-card-section"),u=(0,n.g2)("sie-table"),d=(0,n.g2)("sie-modal"),f=(0,n.g2)("q-card");return Object.keys(e.persona).length?((0,n.uX)(),(0,n.Wv)(f,{key:0,flat:""},{default:(0,n.k6)(function(){return[(0,n.bF)(c,null,{default:(0,n.k6)(function(){return[(0,n.Lk)("div",x,[(0,n.Lk)("div",y,[(0,n.bF)(l,{ref:"refForm"},{default:(0,n.k6)(function(){return[(0,n.Lk)("div",$,[(0,n.Lk)("div",B,[(0,n.Lk)("div",q,[(0,n.Lk)("div",j,[a[10]||(a[10]=(0,n.Lk)("span",{class:"text-bold"},"Visitante:",-1)),(0,n.Lk)("span",null,(0,U.v_)(e.persona.NOMCOMP.split("(")[0]),1)]),(0,n.Lk)("div",H,[a[11]||(a[11]=(0,n.Lk)("span",{class:"text-bold"},"Perfil:",-1)),(0,n.Lk)("span",null,(0,U.v_)(e.persona.PERFIL),1)]),(0,n.Lk)("div",Q,[a[12]||(a[12]=(0,n.Lk)("span",{class:"text-bold"},"Código:",-1)),(0,n.Lk)("span",null,(0,U.v_)(e.persona.CODIGO),1)]),e.alumnosAutorizadosDeRecojo.length?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"col-xs-12",onClick:a[0]||(a[0]=function(){return e.openModalAutorizadosRecojo&&e.openModalAutorizadosRecojo.apply(e,arguments)})},[a[13]||(a[13]=(0,n.Lk)("span",{class:"text-bold"},"Autorizado(s) de Recojo:",-1)),(0,n.bF)(o,{class:"q-ml-sm",icon:"directions_bus",color:"secondary",flat:"",dense:"",style:{padding:"0"}})])):(0,n.Q3)("v-if",!0)]),(0,n.bF)(t,{class:"q-mt-sm",modelValue:e.form.COMENTARIO,"onUpdate:modelValue":a[1]||(a[1]=function(a){return e.form.COMENTARIO=a}),label:"COMENTARIO"},null,8,["modelValue"]),(0,n.bF)(t,{class:"q-mt-sm",modelValue:e.form.EMPRESA,"onUpdate:modelValue":a[2]||(a[2]=function(a){return e.form.EMPRESA=a}),label:"EMPRESA"},null,8,["modelValue"]),(0,n.bF)(o,{class:"full-width q-mt-sm","icon-right":"view_comfy",label:e.titleModalAreas,color:"secondary",dense:"",onClick:e.openModalArea},null,8,["label","onClick"])]),(0,n.Lk)("div",X,[(0,n.bF)(i,{src:e.foto,ratio:1},null,8,["src"])]),(0,n.Lk)("div",G,[(0,n.bF)(s,{modelValue:e.repetir,"onUpdate:modelValue":a[3]||(a[3]=function(a){return e.repetir=a}),"true-value":!0,"false-value":!1,"left-label":"",label:"Repetir",color:"primary"},null,8,["modelValue"])]),(0,n.Lk)("div",z,[(0,n.Lk)("span",Y,(0,U.v_)(e.textFechaYHora)+" "+(0,U.v_)(e.fecha+" "+e.persona.hora),1)])])]}),_:1},512)]),(0,n.Lk)("div",W,[(0,n.Lk)("div",J,[(0,n.Lk)("div",K,[(0,n.bF)(o,{label:e.textRegistrarVisita,color:e.colorButton,onClick:e.registrarVisita},null,8,["label","color","onClick"])])])])])]}),_:1}),(0,n.bF)(d,{modelValue:e.modalArea,"onUpdate:modelValue":a[4]||(a[4]=function(a){return e.modalArea=a}),ok:"Guardar",title:e.titleModalAreas,onSubmit:e.guardarAreas,css:{"min-height":0,"min-width":e.maxWidthModalArea},esc:!0,escClick:!0},{default:(0,n.k6)(function(){return[(0,n.Lk)("div",Z,[e.esSalida?((0,n.uX)(),(0,n.CE)("div",ee,[(0,n.bF)(o,{label:e.btnCheckAtendido?"Desmarcar atendido a todos":"Marcar atendido a todos",color:"primary",flat:"",onClick:e.checkAllAtendido},null,8,["label","onClick"])])):(0,n.Q3)("v-if",!0),(0,n.Lk)("div",ae,[(0,n.bF)(u,{class:"q-pa-sm",ref:"refTableAreas",data:e.areas,columns:e.esSalida?e.fieldsAreaSalida:e.fieldsAreaIngreso,config:e.configArea,selection:e.esSalida?"none":"multiple","save-cells":"","load-selection":e.selectAreas,css:"height:calc(100vh - 300px)",context:r},null,8,["data","columns","config","selection","load-selection"])])])]}),_:1},8,["modelValue","title","onSubmit","css"]),(0,n.bF)(d,{modelValue:e.modalAutorizadosRecojo,"onUpdate:modelValue":a[5]||(a[5]=function(a){return e.modalAutorizadosRecojo=a}),ok:!!e.isAutRecojo&&"Asignar",onSubmit:e.asignarAutorizado,"footer:":!1,title:"Autorizados de recojo",css:{"min-width":e.maxWidthModalArea}},{default:(0,n.k6)(function(){return[(0,n.Lk)("div",re,[(0,n.Lk)("div",ne,[(0,n.bF)(u,{class:"q-pa-sm",ref:"refTableAutorizadoRecojo",data:e.alumnosAutorizadosDeRecojo,columns:e.fieldsAutorizadoRecojo,config:e.configAutorizadoRecojo,selection:e.isAutRecojo?"multiple":"single","save-cells":"",css:"height:calc(100vh - 300px)",context:r,"show-check-all":!1,onRowSelected:e.rowSelectAutRecojo},null,8,["data","columns","config","selection","onRowSelected"])])])]}),_:1},8,["modelValue","ok","onSubmit","css"]),(0,n.bF)(d,{modelValue:e.modalComentarioAutRec,"onUpdate:modelValue":a[7]||(a[7]=function(a){return e.modalComentarioAutRec=a}),ok:"Guardar",esc:!0,escClick:!0,title:"Comentario",onSubmit:e.guardarComentarioAutRecojo,css:{"max-width":e.maxWidthModalArea}},{default:(0,n.k6)(function(){return[(0,n.bF)(f,null,{default:(0,n.k6)(function(){return[(0,n.bF)(c,null,{default:(0,n.k6)(function(){return[(0,n.bF)(t,{modelValue:e.comentarioAutRec,"onUpdate:modelValue":a[6]||(a[6]=function(a){return e.comentarioAutRec=a}),label:"COMENTARIO",type:"textarea"},null,8,["modelValue"])]}),_:1})]}),_:1})]}),_:1},8,["modelValue","onSubmit","css"]),(0,n.bF)(d,{modelValue:e.modalComentario,"onUpdate:modelValue":a[9]||(a[9]=function(a){return e.modalComentario=a}),ok:"Guardar",title:"Comentario",onSubmit:e.guardarComentario,css:{"max-width":e.maxWidthModalArea}},{default:(0,n.k6)(function(){return[(0,n.bF)(f,null,{default:(0,n.k6)(function(){return[(0,n.bF)(c,null,{default:(0,n.k6)(function(){return[(0,n.bF)(t,{modelValue:e.comentario,"onUpdate:modelValue":a[8]||(a[8]=function(a){return e.comentario=a}),label:"COMENTARIO",type:"textarea"},null,8,["modelValue"])]}),_:1})]}),_:1})]}),_:1},8,["modelValue","onSubmit","css"])]}),_:1})):(0,n.Q3)("v-if",!0)}r(12563),r(23825),r(10239),r(90095),r(70199),r(27360),r(13715),r(24066),r(60858),r(64702),r(53514);var te={data:function(){return{config:{ACTION:{component:"button",icon:["edit as editar","delete as eliminar"],editar:function(e,a){var r=this;return h()(P()().m(function e(){return P()().w(function(e){while(1)switch(e.n){case 0:return r.rowControlVisita=a,e.n=1,r.openActualizar();case 1:return e.a(2)}},e)}))()},eliminar:function(e,a){var r=this;return h()(P()().m(function e(){return P()().w(function(e){while(1)switch(e.n){case 0:return r.rowControlVisita=a,e.n=1,r.deleteControlVisita();case 1:return e.a(2)}},e)}))()},tooltip:{editar:"Editar",eliminar:"Eliminar"},permisos:{editar:">1",eliminar:"===3"},flat:!0,dense:!0}},rows:[],fields:[{name:"ID",label:"ID",field:"ID",align:"left",sortable:!0},{name:"ID_PERSONA",label:"ID_PERSONA",field:"ID_PERSONA",align:"left",sortable:!0},{name:"FECHA_INGRESO",label:"FECHA_INGRESO",field:"FECHA_INGRESO",align:"left",sortable:!0},{name:"FECHA_SALIDA",label:"FECHA_SALIDA",field:"FECHA_SALIDA",align:"left",sortable:!0},{name:"CODARE",label:"CODARE",field:"CODARE",align:"left",sortable:!0},{name:"ID_PERSONA_V",label:"ID_PERSONA_V",field:"ID_PERSONA_V",align:"left",sortable:!0},{name:"MOTIVO",label:"MOTIVO",field:"MOTIVO",align:"left",sortable:!0},{name:"EMPRESA",label:"EMPRESA",field:"EMPRESA",align:"left",sortable:!0},{name:"USUCOD_INGRESO",label:"USUCOD_INGRESO",field:"USUCOD_INGRESO",align:"left",sortable:!0},{name:"USUCOD_SALIDA",label:"USUCOD_SALIDA",field:"USUCOD_SALIDA",align:"left",sortable:!0},{name:"ACTION",label:"Acción",field:"ACTION",align:"center",width:80}]}}},ie=(r(56285),{data:function(){var e=this;return{configArea:{DESARE:{prevent:!0},ID_RESPONSABLE:{component:"select",label:"Seleccione",options:[],optionValue:"ID_PERSONA",optionLabel:"NOMCOMP",prevent:!0},ID_PERSONA_VISITADO:{component:"select",label:"Seleccione",options:[],optionValue:"ID_PERSONA",optionLabel:"NOMCOMP",prevent:!0},ID_PERSONA_ALUMNO:{component:"select",label:"Seleccione",options:[],optionValue:"ID_PERSONA",optionLabel:"NOMCOMP",prevent:!0},MOTIVO:{component:"select",label:"Seleccione",options:[],optionValue:"SECUCOD",optionLabel:"SECUDES",prevent:!0},ATENDIDO:{renderHtml:function(e,a,r){return r.checkbox({trueValue:1,value:e.ATENDIDO})},renderAction:function(e,a){return h()(P()().m(function r(){return P()().w(function(r){while(1)switch(r.n){case 0:1===e.ATENDIDO?a.ATENDIDO=0:a.ATENDIDO=1;case 1:return r.a(2)}},r)}))()},prevent:!0},COMENTARIO:{component:"button",flat:!0,dense:!0,icon:["comment as comentar"],comentar:function(e,a,r){this.openModalComentario(),this.rowArea=e,this.comentario=e.COMENTARIO},prevent:!0},ACTION:{component:"button",icon:["paste as pegarRegistroCita","delete as eliminarRegistroCita"],tooltip:{pegarRegistroCita:"Pegar datos cita",eliminarRegistroCita:"Eliminar datos cita"},pegarRegistroCita:function(){var a=h()(P()().m(function a(r,n){return P()().w(function(a){while(1)switch(a.n){case 0:n.ID_PERSONA_VISITADO=e.dataCita&&Object.keys(e.dataCita).length&&e.dataCita.ID_PERSONA_VISITADO||null,n.ID_PERSONA_ALUMNO=e.dataCita&&Object.keys(e.dataCita).length&&e.dataCita.ID_PERSONA_ALUMNO||null,n.MOTIVO=e.dataCita&&Object.keys(e.dataCita).length&&e.dataCita.MOTIVO||null;case 1:return a.a(2)}},a)}));function r(e,r){return a.apply(this,arguments)}return r}(),eliminarRegistroCita:function(){var e=h()(P()().m(function e(a,r){return P()().w(function(e){while(1)switch(e.n){case 0:r.ID_PERSONA_VISITADO=null,r.ID_PERSONA_ALUMNO=null,r.MOTIVO=null;case 1:return e.a(2)}},e)}));function a(a,r){return e.apply(this,arguments)}return a}(),flat:!0,dense:!0}},rows:[],fieldsAreaIngreso:[{name:"DESARE",label:"Área",field:"DESARE",align:"left",sortable:!0},{name:"ID_PERSONA_VISITADO",label:"Personal de visita",field:"ID_PERSONA_VISITADO",align:"left",wrap:!0,sortable:!0},{name:"ID_PERSONA_ALUMNO",label:"Alumno",field:"ID_PERSONA_ALUMNO",align:"left",wrap:!0,sortable:!0},{name:"MOTIVO",label:"Motivo",field:"MOTIVO",align:"left",wrap:!0,sortable:!0}],fieldsAreaSalida:[{name:"DESARE",label:"Área",field:"DESARE",align:"left",sortable:!0},{name:"ID_PERSONA_VISITADO",label:"Personal Visitado",field:"ID_PERSONA_VISITADO",align:"left",wrap:!0,sortable:!0},{name:"ID_PERSONA_ALUMNO",label:"Alumno",field:"ID_PERSONA_ALUMNO",align:"left",wrap:!0,sortable:!0},{name:"MOTIVO",label:"Motivo",field:"MOTIVO",align:"left",wrap:!0,sortable:!0},{name:"COMENTARIO",label:"Comentario",field:"COMENTARIO",align:"center",sortable:!0},{name:"ATENDIDO",label:"Atendido",field:"ATENDIDO",align:"left",sortable:!0}]}},watch:{dataCita:{immediate:!0,handler:function(e){var a=this.fieldsAreaIngreso.find(function(e){return"ACTION"===e.name});this.dataCita&&Object.keys(this.dataCita).length&&!a&&this.fieldsAreaIngreso.push({name:"ACTION",label:"Acción",field:"ACTION",align:"center",wrap:!0,sortable:!0})}}}}),se={data:function(){return{configAutorizadoRecojo:{COMENTARIO:{component:"button",flat:!0,dense:!0,icon:["comment as comentar"],comentar:function(e,a,r){var n=this.$refs.refTableAutorizadoRecojo.rowsSelected();if(n.length<=0||n.length>1)return this.$notify("Seleccionar solo un alumno","warning"),!1;var o=!0;if(n.length>0&&n.forEach(function(e){e.ID_PERSONA!==a.ID_PERSONA&&(o=!1)}),!o)return!1;this.openModalComentarioAutRec(),this.rowAutRecojo=e,this.comentarioAutRec=e.COMENTARIO},prevent:!0}},fieldsAutorizadoRecojo:[{name:"RELDES",label:"Relación del visitante",field:"RELDES",align:"left",sortable:!0},{name:"NOMCOMP",label:"Alumno(a)",field:"NOMCOMP",align:"left",sortable:!0},{name:"NGS",label:"Ngs",field:"NGS",align:"left",wrap:!0,sortable:!0}]}}},le=r(39893),ce=r(2739),ue=r(9736),de=r(88567),fe=r(53399),me=r(95718),Ee=r(3112),Oe=r(26319),pe=r(21103),Ae={emits:["registrar-visita"],props:{persona:{type:Object,default:function(){}},existeFechaIngreso:{type:Boolean,default:function(){return!1}},loadRepetir:{type:Boolean,default:!1},hora:{type:String,default:!1}},mixins:[te,ie,se,k],components:{QForm:ce.A,QInput:ue.A,QCard:de.A,QImg:fe.A,QCardSection:me.A,QCheckbox:Ee.A,sieSelect:S.A,QBtn:C.Il},computed:{esSalida:function(){return this.persona.FECHA_INGRESO&&!this.persona.FECHA_SALIDA},isSmall:function(){return pe.A.sm||pe.A.xs},maxWidthModalArea:function(){return pe.A.sm||pe.A.xs?"100vw":"80vw"}},data:function(){return{required:le.require,buttons:[],openAdd:!0,action:"create",rowControlVisita:null,isAutRecojo:!1,form:{ID_PERSONA:this.persona.ID_PERSONA,FECHA_INGRESO:null,FECHA_SALIDA:null,COMENTARIO:null,EMPRESA:null,USUCOD_INGRESO:null,USUCOD_SALIDA:null},sieInfo:(0,g["default"])(),foto:null,modalArea:!1,modalComentario:!1,modalComentarioAutRec:!1,comentario:null,comentarioAutRec:null,rowArea:{},rowAutRecojo:{},areas:[],selectAreas:{key:"CODARE",values:[]},familiares:[],personalDelColegio:[],alumnos:[],motivos:[],textRegistrarVisita:this.esSalida?"Registrar Salida":"Registrar Ingreso",textFechaYHora:this.esSalida?"Fecha y Hora de salida: ":"Fecha y Hora de ingreso: ",colorButton:this.esSalida?"warning":"positive",titleModalAreas:"Seleccionar Área(s)",fecha:(0,Oe.formatDate)(new Date,"DD/MM/YYYY"),repetir:this.loadRepetir,btnCheckAtendido:!0,dataCita:{},alumnosAutorizadosDeRecojo:[],modalAutorizadosRecojo:!1}},methods:{openModalArea:function(){this.modalArea=!0},openModalAutorizadosRecojo:function(){this.modalAutorizadosRecojo=!0},guardarAreas:function(){var e=this;return h()(P()().m(function a(){var r;return P()().w(function(a){while(1)switch(a.p=a.n){case 0:return a.p=0,e.selectAreas.values=e.$refs.refTableAreas.rowsSelected().map(function(e){return e.CODARE}),a.n=1,e.validarRegistro();case 1:e.modalArea=!1,a.n=3;break;case 2:a.p=2,r=a.v,console.log("e",r),e.$notify(r.message,"warning");case 3:return a.a(2)}},a,null,[[0,2]])}))()},openModalComentario:function(){this.modalComentario=!0},updateControlVisitaArea:function(e,a){var r=this;return h()(P()().m(function n(){var o,t,i;return P()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,n.n=1,r.$http.post("api/ControlVisitaAreaController/updateControlVisitaArea",{params:e,id:a});case 1:o=n.v,t=o.message,r.$notify(t,"success"),n.n=3;break;case 2:n.p=2,i=n.v,r.$notify(i.message,"warning");case 3:return n.a(2)}},n,null,[[0,2]])}))()},guardarComentario:function(){var e=this,a=this.$refs.refTableAreas;a.selected.find(function(a){return a.ID===e.rowArea.ID}).COMENTARIO=this.comentario,this.modalComentario=!1},openModalComentarioAutRec:function(){this.modalComentarioAutRec=!0},guardarComentarioAutRecojo:function(){var e=this,a=this.$refs.refTableAutorizadoRecojo;a.selected.length>0?(a.selected.find(function(a){return a.ID===e.rowAutRecojo.ID}).COMENTARIO=this.comentarioAutRec,this.modalComentarioAutRec=!1):this.$notify("Seleccionar, primero, al alumno","warning")},validarRegistro:function(){var e=this;return h()(P()().m(function a(){var r,n,o,t,i,s;return P()().w(function(a){while(1)switch(a.p=a.n){case 0:return a.p=0,a.n=1,e.$refs.refForm.validate();case 1:if(r=a.v,r){a.n=2;break}return a.a(2);case 2:if(n=[],o=null,e.selectAreas.values.length||"0005"!==e.sieInfo.colcod||(t=e.areas.filter(function(e){return"01"===e.CODARE}).length,i=e.motivos.filter(function(e){return"002"===e.SECUCOD}).length,t&&i&&(n=[{CODARE:"01",ID_PERSONA_VISITADO:null,ID_PERSONA_ALUMNO:null,MOTIVO:"002",DESARE:"Evento",ATENDIDO:null,COMENTARIO:""}],e.selectAreas.values=n.map(function(e){return e.CODARE}),o="002")),e.selectAreas.values.length){a.n=3;break}throw e.modalArea=!0,new Error("Por favor seleccione mínimo una área");case 3:e.selectAreas.values.length&&e.areas.map(function(a){if(a.MOTIVO=a.MOTIVO||o,e.selectAreas.values.includes(a.CODARE)&&!a.MOTIVO)throw e.modalArea=!0,new Error("Por favor seleccione un motivo para el área de visita (".concat(a.DESARE,")"))}),a.n=5;break;case 4:throw a.p=4,s=a.v,new Error(s.message);case 5:return a.a(2)}},a,null,[[0,4]])}))()},registrarVisita:function(){var e=this;return h()(P()().m(function a(){var r,n;return P()().w(function(a){while(1)switch(a.p=a.n){case 0:return a.p=0,a.n=1,e.validarRegistro();case 1:e.esSalida&&(e.form={FECHA_SALIDA:new Date,USUCOD_SALIDA:e.sieInfo.usucod}),r=e.areas.filter(function(a){return e.selectAreas.values.includes(a.CODARE)}),r=r.map(function(e){var a={CODARE:e.CODARE,ID_PERSONA_VISITADO:e.ID_PERSONA_VISITADO||null,ID_PERSONA_ALUMNO:e.ID_PERSONA_ALUMNO||null,MOTIVO:e.MOTIVO,DESARE:e.DESARE,ID:e.ID||null,ATENDIDO:e.ATENDIDO||null,COMENTARIO:e.COMENTARIO||null};return a}),e.$emit("registrar-visita",e.form,r,e.persona.ID_PERSONA,e.repetir),a.n=3;break;case 2:a.p=2,n=a.v,e.$notify(n.message,"warning");case 3:return a.a(2)}},a,null,[[0,2]])}))()},checkAllAtendido:function(){var e=this;this.btnCheckAtendido=!this.btnCheckAtendido,this.btnCheckAtendido?this.areas.map(function(a){e.selectAreas.values.includes(a.CODARE)&&(a.ATENDIDO||(a.ATENDIDO=1))}):this.areas.map(function(a){e.selectAreas.values.includes(a.CODARE)&&a.ATENDIDO&&(a.ATENDIDO=0)})},getFotoPersona:function(){var e=this;return h()(P()().m(function a(){var r,n,o,t,i,s;return P()().w(function(a){while(1)switch(a.p=a.n){case 0:return r=e.sieInfo,a.n=1,e.$http.get("api/personaController/getPerfilesPorPersona",{params:{params:{idPersona:e.persona.ID_PERSONA}}});case 1:return n=a.v,o=n.perfiles,t={ID_PERFIL:e.persona.ID_PERFIL,PERFILES:o.map(function(e){return{ID_PERFIL:e.ID_PERFIL,CODIGO:e.CODIGO}}),TOKEN:r.token,USUCOD:r.usucod,COLCOD:r.colcod},i=btoa(JSON.stringify(t)),a.p=2,a.n=3,e.$http.get("api/PersonaController/getFotoPersona",{params:{TOKEN:i}});case 3:if(s=a.v,!Object.prototype.hasOwnProperty.call(s,"error")){a.n=4;break}return e.foto="statics/img/persona-visita/persona-incognita.png",a.a(2);case 4:e.foto="".concat(location.origin,"/").concat(w.API_LMS,"/api/PersonaController/getFotoPersona?TOKEN=").concat(i,"&t=").concat(+(new Date).getTime()),e.foto||(e.foto="statics/img/persona-visita/persona-incognita.png"),a.n=6;break;case 5:a.p=5,a.v,e.foto="statics/img/persona-visita/persona-incognita.png";case 6:return a.a(2)}},a,null,[[2,5]])}))()},getAreas:function(){var e=this;return h()(P()().m(function a(){var r,n;return P()().w(function(a){while(1)switch(a.p=a.n){case 0:return a.p=0,a.n=1,e.$http.get("api/EmpresaController/getAreas",{params:{parametros:{getAreas:!0}}});case 1:r=a.v,r.map(function(e){e.ID_PERSONA_VISITADO=null,e.ID_PERSONA_ALUMNO=null,e.MOTIVO=null}),r.forEach(function(a){"ADR"===a.CODARE&&(e.isAutRecojo=!0)}),e.areas=r,a.n=3;break;case 2:a.p=2,n=a.v,e.$notify(n.message,"warning");case 3:return a.a(2)}},a,null,[[0,2]])}))()},getPersonalDelColegio:function(){var e=this;return h()(P()().m(function a(){return P()().w(function(a){while(1)switch(a.n){case 0:return a.n=1,e.getPersonasVisita("I");case 1:return e.personalDelColegio=a.v,a.n=2,e.getPersonasVisita("I",!1);case 2:return e.configArea.ID_RESPONSABLE.options=a.v,a.n=3,e.getPersonasVisita("I",!1);case 3:e.configArea.ID_PERSONA_VISITADO.options=a.v;case 4:return a.a(2)}},a)}))()},getAlumnos:function(){var e=this;return h()(P()().m(function a(){return P()().w(function(a){while(1)switch(a.n){case 0:return a.n=1,e.getPersonasVisita("A");case 1:e.alumnos=a.v;case 2:return a.a(2)}},a)}))()},getMotivos:function(){var e=this;return h()(P()().m(function a(){var r,n;return P()().w(function(a){while(1)switch(a.p=a.n){case 0:return a.p=0,a.n=1,e.$http.get("api/TablaSeController/getTablaSe",{params:{params:{where:{princod:"428",estado:1}}}});case 1:r=a.v,e.motivos=r,e.configArea.MOTIVO.options=r,a.n=3;break;case 2:a.p=2,n=a.v,e.$notify(n.message,"warning");case 3:return a.a(2)}},a,null,[[0,2]])}))()},getListarAlumnosPorPersonaAutorizaRecojo:function(){var e=this;return h()(P()().m(function a(){var r;return P()().w(function(a){while(1)switch(a.n){case 0:return a.n=1,e.$http.get("api/AluMovController/getListarAlumnosPorPersonaAutorizaRecojo",{params:{parametros:{dni:e.persona.NUMERO}}});case 1:r=a.v,e.alumnosAutorizadosDeRecojo=r;case 2:return a.a(2)}},a)}))()},asignarAutorizado:function(){var e=this;return h()(P()().m(function a(){var r,n,o;return P()().w(function(a){while(1)switch(a.n){case 0:if(r=e.$refs.refTableAutorizadoRecojo.rowsSelected(),!(r.length<=0||r.length>1)){a.n=1;break}return e.$notify("Por favor selecciona solo un alumno","warning"),a.a(2,!1);case 1:n={ID_PERSONA:e.form.ID_PERSONA,FECHA_INGRESO:(0,Oe.formatDate)(new Date,"YYYY-MM-DD")+" "+e.hora,FECHA_SALIDA:(0,Oe.formatDate)(new Date,"YYYY-MM-DD")+" "+e.hora,USUCOD_INGRESO:null,USUCOD_SALIDA:e.sieInfo.usucod,ID_ALU_MOV:e.persona.ID_ALU_MOV||null},o=[{CODARE:"ADR",ID_PERSONA_VISITADO:null,MOTIVO:"ADR",ID:null,ATENDIDO:null,COMENTARIO:r[0].COMENTARIO,ID_PERSONA_ALUMNO:e.rowAutRecojo.ID_PERSONA_ALUMNO}],e.$emit("registrar-visita",n,o,e.form.ID_PERSONA,!1);case 2:return a.a(2)}},a)}))()},rowSelectAutRecojo:function(e){this.rowAutRecojo=e}},created:function(){var e=this;return h()(P()().m(function a(){var r;return P()().w(function(a){while(1)switch(a.p=a.n){case 0:return a.p=0,e.$q.loading.show(),e.form.EMPRESA=e.persona.EMPRESA,e.form.COMENTARIO=e.persona.COMENTARIO,e.textRegistrarVisita=e.esSalida?"Registrar Salida":"Registrar Ingreso",e.textFechaYHora=e.esSalida?"Fecha y Hora de salida: ":"Fecha y Hora de ingreso: ",e.colorButton=e.esSalida?"warning":"positive",a.n=1,e.getFotoPersona();case 1:return a.n=2,e.getAreas();case 2:return a.n=3,e.getPersonalDelColegio();case 3:return a.n=4,e.getAlumnos();case 4:return a.n=5,e.getMotivos();case 5:return a.n=6,e.getListarAlumnosPorPersonaAutorizaRecojo();case 6:e.persona.DATA_AREAS&&e.persona.DATA_AREAS.length&&(e.titleModalAreas="Áreas Visitadas",e.persona.DATA_AREAS.map(function(a){e.selectAreas.values.push(a.CODARE)}),e.areas=e.persona.DATA_AREAS,e.areas.map(function(e){e.ATENDIDO=1}),e.modalArea=!0),e.persona&&e.persona.DATA_CITA&&Object.keys(e.persona.DATA_CITA).length&&(e.dataCita=e.persona.DATA_CITA),e.repetir&&(e.selectAreas.values=e.persona.REPETIR_AREAS.map(function(e){return e.CODARE}),e.areas=e.persona.REPETIR_AREAS||[]),e.esSalida&&(e.repetir=!1),e.isAutRecojo&&e.fieldsAutorizadoRecojo.push({name:"COMENTARIO",label:"Comentario",field:"COMENTARIO",align:"center",sortable:!0}),e.$q.loading.hide(),a.n=8;break;case 7:a.p=7,r=a.v,e.$q.loading.hide(),e.$notify(r.message,"warning");case 8:return a.a(2)}},a,null,[[0,7]])}))()},watch:{"persona.DATA_CITA":{immediate:!0,handler:function(e){e&&(this.dataCita=this.persona.DATA_CITA)}},"persona.ID_PERSONA":{immediate:!0,handler:function(e){var a=this;return h()(P()().m(function r(){return P()().w(function(r){while(1)switch(r.n){case 0:if(!e){r.n=2;break}return r.n=1,a.getPersonasVisita("A",!1,a.form.ID_PERSONA);case 1:a.configArea.ID_PERSONA_ALUMNO.options=r.v;case 2:return r.a(2)}},r)}))()}}}},Re=r(12807);const Ie=(0,Re.A)(Ae,[["render",oe]]);var De=Ie,Pe=r(61847),_e=r(29104),he={class:"components--ficha-rapida-persona-perfil",style:{width:"600px"}},Ce={class:"row q-ma-xs q-col-gutter-md"},ge={class:"col-xs-12 col-lg-6"},Ne={class:"col-xs-12 col-lg-6"},be={class:"col-xs-12 col-lg-6"},Se={class:"col-xs-12 col-lg-6"},ve={class:"col-xs-12 col-lg-6"},Le={class:"col-xs-12 col-lg-6"},Me={class:"col-xs-12 text-right"};function Te(e,a){var r=(0,n.g2)("q-select"),o=(0,n.g2)("q-input"),t=(0,n.g2)("q-btn"),i=(0,n.g2)("q-card-section"),s=(0,n.g2)("q-card");return(0,n.uX)(),(0,n.CE)("div",he,[(0,n.bF)(s,{flat:""},{default:(0,n.k6)(function(){return[(0,n.bF)(i,null,{default:(0,n.k6)(function(){return[(0,n.bF)(i,null,{default:(0,n.k6)(function(){return[(0,n.Lk)("div",Ce,[(0,n.Lk)("div",ge,[(0,n.bF)(r,{modelValue:e.formPersona.ID_TIPODOC,"onUpdate:modelValue":a[0]||(a[0]=function(a){return e.formPersona.ID_TIPODOC=a}),"option-label":"ABREVIATURA","option-value":"ID_TIPODOC",label:"Tipo Documento*",options:e.comboDocumentos,onInput:e.setLenDocumento},null,8,["modelValue","options","onInput"])]),(0,n.Lk)("div",Ne,[(0,n.bF)(o,{ref:"refDni",type:"text",modelValue:e.formPersona.NUMERO_DOC,"onUpdate:modelValue":a[1]||(a[1]=function(a){return e.formPersona.NUMERO_DOC=a}),label:"Nro Documento*",mask:e.maskDocumento,maxlength:e.lenDoc,onBlur:e.validarPersonaExiste,onKeyup:(0,_e.jR)(e.validarPersonaExiste,["enter"])},null,8,["modelValue","mask","maxlength","onBlur","onKeyup"])]),(0,n.Lk)("div",be,[(0,n.bF)(o,{type:"text",modelValue:e.formPersona.APELLIDO_PATERNO,"onUpdate:modelValue":a[2]||(a[2]=function(a){return e.formPersona.APELLIDO_PATERNO=a}),label:"Primer Apellido*",onInput:e.firtLetterUper,readonly:e.participanteExiste&&!e.registroInterno},null,8,["modelValue","onInput","readonly"])]),(0,n.Lk)("div",Se,[(0,n.bF)(o,{type:"text",modelValue:e.formPersona.APELLIDO_MATERNO,"onUpdate:modelValue":a[3]||(a[3]=function(a){return e.formPersona.APELLIDO_MATERNO=a}),label:"Segundo Apellido",onInput:e.firtLetterUper,readonly:e.participanteExiste&&!e.registroInterno},null,8,["modelValue","onInput","readonly"])]),(0,n.Lk)("div",ve,[(0,n.bF)(o,{type:"text",modelValue:e.formPersona.NOMBRES,"onUpdate:modelValue":a[4]||(a[4]=function(a){return e.formPersona.NOMBRES=a}),label:"Nombres*",onInput:e.firtLetterUper,readonly:e.participanteExiste&&!e.registroInterno},null,8,["modelValue","onInput","readonly"])]),(0,n.Lk)("div",Le,[(0,n.bF)(r,{modelValue:e.formPersona.SEXO,"onUpdate:modelValue":a[5]||(a[5]=function(a){return e.formPersona.SEXO=a}),label:"Sexo*",options:e.sexos,"option-label":"label","option-value":"value"},null,8,["modelValue","options"])]),(0,n.Lk)("div",Me,[(0,n.bF)(t,{label:e.submitButtonName,color:"primary",onClick:e.guardarRegistro},null,8,["label","onClick"])])])]}),_:1})]}),_:1})]}),_:1})])}r(23513),r(52776),r(84433),r(81813),r(68017);var we=r(75053),Fe=r(53380),ke=r(99515),Ve=r(4437),Ue=r(33039),xe=r(36408),ye=r(27560),$e=r(96330),Be=r(95477),qe=r(78840),je=r(54267),He={emits:["sentData","closeModal","add-persona","dataPostRegistro"],props:{idPerfil:{type:Number,default:F["default"].PERFIL_VISITANTE},siscod:{type:[Number,String],default:F["default"].SISCOD,require:!1},registroInterno:{type:Boolean,default:!1},headerText:{type:String,default:"Registrar datos del Participante"},submitButtonName:{type:String,default:"Aceptar"},idPersona:{type:Number,default:null},loadDni:{type:String,default:""},onFocusDni:{type:Boolean,default:!1}},components:{sieGrid:xe.A,footerGrid:ye.A,headerGrid:$e.A,sieSelect:S.A,QCheckbox:Ee.A,QCard:de.A,QSelect:V.A,QCardSection:me.A,QSeparator:Fe.A,sieModal:we.A,QRadio:ke.A,QInput:ue.A,ubigeo:Ue.A,columnDefs:null,rowData:null,api:null,QPopupProxy:Be.A,QDate:Ve.A,actionButton:qe.A,QBtn:C.Il},data:function(){return{menorEdad:!1,comboMenorEdad:[],respPago:[],comboDocumentos:[],ruc:F["default"].TIPO_DOCUMENTO_RUC,dni:F["default"].TIPO_DOCUMENTO_DNI,lenRuc:11,lenDni:8,lenDoc:0,lenDocResp:0,sexos:F["default"].API_SEXO(),formPersona:{TIPO_PERSONA:F["default"].PERSONA_NATURAL,ID_TIPODOC:F["default"].TIPO_DOCUMENTO_DNI,ID_REFPER:null,NUMERO_DOC:"",APELLIDO_PATERNO:"",APELLIDO_MATERNO:"",NOMBRES:"",SEXO:"",FECHA_NACIMIENTO:"",NUMERO_CELULAR:"",CORREO:"",TIPOSEGURO:"",HOSPITAL:"",SEGURO:"",CLINICA:"",ES_PERSONAL:"N",ES_HIJO_PERSONAL:"N"},formResponsable:{ID_REFPER:F["default"].ID_REFPER_FAMILIA.P,ID_TIPODOC:F["default"].TIPO_DOCUMENTO_DNI,NUMERO_DOC:"",APELLIDO_PATERNO:"",APELLIDO_MATERNO:"",NOMBRES:"",SEXO:F["default"].SEXO.MASCULINO,FECHA_NACIMIENTO:"",NUMERO_CELULAR:"",CORREO:"",ES_PERSONAL:"N"},regexEmail:/^[\w\.-]+@[\w\.-]+\.\w+$/,familiares:[],credencialesFamilia:null,esUsuarioAlumno:["005","E02"].includes((0,g["default"])().tipcod),sieInfo:(0,g["default"])(),existeRespPago:!1,respPagoFound:{},idPerdoc:null,participanteExiste:!0,PERFIL_PERSONAL:F["default"].PERFIL_PERSONAL,PERFIL_HIJO_PERSONAL:F["default"].PERFIL_HIJO_PERSONAL,siscodTalleres:F["default"].SISCOD_TALLERES,combos:{tipoSeguro:[{SECUEQU:null,SECUDES:"EsSalud",SECUCOD:"E",ESTADO:1,PRINCOD:"418"},{SECUEQU:null,SECUDES:"Particular",SECUCOD:"P",ESTADO:1,PRINCOD:"418"},{SECUEQU:null,SECUDES:"SIS",SECUCOD:"S",ESTADO:1,PRINCOD:"418"}]},documentoAnterior:""}},computed:{maskDocumento:function(){return this.formPersona.ID_TIPODOC===this.dni?"########":""},maskDocumentoResponsable:function(){return this.formResponsable.ID_TIPODOC===this.dni?"########":""},registraseguro:function(){var e=window.location.host||"",a=e.split("."),r=a[0]||"";return["santisimo"].includes(r)}},methods:{closeModalCalendar:function(e){this.$refs[e].hide()},parentescoFueSeleccionado:function(){var e=this;return h()(P()().m(function a(){return P()().w(function(a){while(1)switch(a.n){case 0:if(!e.registroInterno){a.n=2;break}return a.n=1,e.buscarRespPago();case 1:return a.a(2);case 2:e.formPersona.ID_REFPER===F["default"].ID_REFPER_FAMILIA.P&&(e.formPersona.SEXO="M"),e.formPersona.ID_REFPER===F["default"].ID_REFPER_FAMILIA.M&&(e.formPersona.SEXO="F"),e.formResponsable.ID_REFPER===F["default"].ID_REFPER_FAMILIA.P?e.formResponsable.SEXO="M":e.formResponsable.ID_REFPER===F["default"].ID_REFPER_FAMILIA.M&&(e.formResponsable.SEXO="F");case 3:return a.a(2)}},a)}))()},clearPersona:function(){var e=this;return h()(P()().m(function a(){return P()().w(function(a){while(1)switch(a.n){case 0:e.formPersona.ID_TIPODOC=F["default"].TIPO_DOCUMENTO_DNI,e.formPersona.NUMERO_DOC="",e.formPersona.APELLIDO_MATERNO="",e.formPersona.APELLIDO_PATERNO="",e.formPersona.NOMBRES="",e.formPersona.SEXO=F["default"].SEXO.MASCULINO,e.formPersona.FECHA_NACIMIENTO="",e.formPersona.NUMERO_CELULAR="",e.formPersona.CORREO="",e.formPersona.TIPOSEGURO="",e.formPersona.HOSPITAL="",e.formPersona.SEGURO="",e.formPersona.CLINICA="";case 1:return a.a(2)}},a)}))()},clearResponsable:function(){var e=arguments,a=this;return h()(P()().m(function r(){var n;return P()().w(function(r){while(1)switch(r.n){case 0:n=!(e.length>0&&void 0!==e[0])||e[0],n&&(a.formResponsable.ID_REFPER=F["default"].ID_REFPER_FAMILIA.P),a.formResponsable.NUMERO_DOC="",a.formResponsable.APELLIDO_MATERNO="",a.formResponsable.APELLIDO_PATERNO="",a.formResponsable.NOMBRES="",a.formResponsable.SEXO=F["default"].SEXO.MASCULINO,a.formResponsable.FECHA_NACIMIENTO="",a.formResponsable.NUMERO_CELULAR="",a.formResponsable.CORREO="";case 1:return r.a(2)}},r)}))()},setLenDocumento:function(){var e=this;return h()(P()().m(function a(){return P()().w(function(a){while(1)switch(a.n){case 0:if(e.formPersona.ID_TIPODOC===e.dni?(e.lenDoc=e.lenDni,e.formPersona.NUMERO_DOC=e.formPersona.NUMERO_DOC.slice(0,e.lenDni)):e.formPersona.ID_TIPODOC===e.ruc?(e.lenDoc=e.lenRuc,e.formPersona.NUMERO_DOC=e.formPersona.NUMERO_DOC.slice(0,e.lenRuc)):e.lenDoc=30,e.registroInterno){a.n=1;break}return a.n=1,e.validarPersonaExiste();case 1:return a.a(2)}},a)}))()},setLenDocumentoRespPago:function(){this.formResponsable.ID_TIPODOC===this.dni?(this.lenDocResp=this.lenDni,this.formResponsable.NUMERO_DOC=this.formResponsable.NUMERO_DOC.slice(0,this.lenDni)):this.formResponsable.ID_TIPODOC===this.ruc?(this.lenDocResp=this.lenRuc,this.formResponsable.NUMERO_DOC=this.formResponsable.NUMERO_DOC.slice(0,this.lenRuc)):this.lenDocResp=30},getComprobantes:function(){var e=this;return h()(P()().m(function a(){var r;return P()().w(function(a){while(1)switch(a.n){case 0:return a.n=1,w.$http.get("api/personaController/getTipoDocumentoIdentidad");case 1:r=a.v,e.comboDocumentos=r;case 2:return a.a(2)}},a)}))()},firtLetterUper:function(e){var a=this;return h()(P()().m(function e(){return P()().w(function(e){while(1)switch(e.n){case 0:a.formPersona.APELLIDO_PATERNO&&(a.formPersona.APELLIDO_PATERNO=String(a.formPersona.APELLIDO_PATERNO).toUpperCase()),a.formPersona.APELLIDO_MATERNO&&(a.formPersona.APELLIDO_MATERNO=String(a.formPersona.APELLIDO_MATERNO).toUpperCase()),a.formPersona.NOMBRES&&(a.formPersona.NOMBRES=String(a.formPersona.NOMBRES).charAt(0).toUpperCase()+String(a.formPersona.NOMBRES).slice(1)),a.formResponsable.APELLIDO_PATERNO&&(a.formResponsable.APELLIDO_PATERNO=String(a.formResponsable.APELLIDO_PATERNO).toUpperCase()),a.formResponsable.APELLIDO_MATERNO&&(a.formResponsable.APELLIDO_MATERNO=String(a.formResponsable.APELLIDO_MATERNO).toUpperCase()),a.formResponsable.NOMBRES&&(a.formResponsable.NOMBRES=String(a.formResponsable.NOMBRES).charAt(0).toUpperCase()+String(a.formResponsable.NOMBRES).slice(1));case 1:return e.a(2)}},e)}))()},enviarDatosPersona:function(){var e={persona:this.persona,persona_documento:this.persona_documento,persona_celular:this.persona_telefono.celular,persona_telefono:this.persona_telefono.telefono,persona_correo:this.persona_correo};this.$emit("sentData",e)},closeModal:function(){this.$emit("closeModal")},fechaNacFueSeleccionada:function(){var e=this;return h()(P()().m(function a(){var r;return P()().w(function(a){while(1)switch(a.n){case 0:if(e.closeModalCalendar("qDateProxy1"),e.formPersona.FECHA_NACIMIENTO){a.n=1;break}return a.a(2);case 1:if(r=e.calcularEdad(e.formPersona.FECHA_NACIMIENTO),e.menorEdad=r<18,e.menorEdad?(e.setLenDocumentoRespPago(),e.formPersona.ID_REFPER=F["default"].REFERENCIA_PERSONA.HIJO):e.respPago.map(function(e){return e.value}).includes(e.formPersona.ID_REFPER)||(e.formPersona.ID_REFPER=null),!e.registroInterno||!e.menorEdad||e.idPersona){a.n=2;break}return a.n=2,e.buscarRespPago();case 2:return a.a(2)}},a)}))()},dayConverter:function(e){var a=e.replace("T"," ").split(" ")[0].split("-");return a="".concat(a[2],"/").concat(a[1],"/").concat(a[0]),a},diff_years:function(e,a){var r=(e.getTime()-a.getTime())/1e3;return r/=86400,Math.abs(Math.round(r/365.25))},calcularEdad:function(e){var a=new Date((0,je.convertToYMD)(e)),r=new Date;return this.diff_years(r,a)},utilValidarNumeroDocumento:function(e,a,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(a&&a.length!==r){var o=[this.dni,this.ruc];if(o.includes(e)){if(n)throw new Error("El número de documento del responsable de pago es incorrecto");throw new Error("El número de documento es incorrecto")}}return a},validarNumeroDocumento:function(){return this.formPersona.NUMERO_DOC=this.utilValidarNumeroDocumento(this.formPersona.ID_TIPODOC,this.formPersona.NUMERO_DOC,this.lenDoc),this.formPersona.NUMERO_DOC},validarNumeroDocumentoResponsable:function(){return this.formResponsable.NUMERO_DOC=this.utilValidarNumeroDocumento(this.formResponsable.ID_TIPODOC,this.formResponsable.NUMERO_DOC,this.lenDocResp,!0),this.formResponsable.NUMERO_DOC},validarFormPersona:function(){if(!this.formPersona.ID_TIPODOC)throw new Error("Debe seleccionar el Número de Documento del Participante");if(!this.formPersona.NUMERO_DOC)throw new Error("Debe completar el Número de Documento del Participante");if(this.formPersona.NUMERO_DOC&&this.validarNumeroDocumento(),!this.formPersona.APELLIDO_PATERNO)throw new Error("Debe completar el Primer Apellido del Participante");if(!this.formPersona.NOMBRES)throw new Error("Debe completar los Nombres del Participante");if(!this.formPersona.SEXO)throw new Error("Debe seleccionar el Sexo del Participante")},validarFormResponsable:function(){if(!this.formResponsable.ID_REFPER)throw new Error("Debe seleccionar el Parentesco del Responsable");if(!this.formResponsable.ID_TIPODOC)throw new Error("Debe seleccionar el Número de Documento del Responsable");if(this.formResponsable.ID_TIPODOC===this.formPersona.ID_TIPODOC&&this.formResponsable.NUMERO_DOC===this.formPersona.NUMERO_DOC)throw new Error("Los números de documento del participante y del responsable no pueden ser iguales");if(!this.formResponsable.NUMERO_DOC)throw new Error("Debe completar el Número de Documento del Responsable");if(this.formResponsable.NUMERO_DOC&&this.validarNumeroDocumentoResponsable(),!this.formResponsable.APELLIDO_PATERNO)throw new Error("Debe completar el Primer Apellido del Responsable");if(!this.formResponsable.NOMBRES)throw new Error("Debe completar los Nombres del Responsable");if(!this.formResponsable.SEXO)throw new Error("Debe seleccionar el Sexo del Responsable");if(!this.formResponsable.FECHA_NACIMIENTO)throw new Error("Debe seleccionar la Fecha De Nacimiento del Responsable");if(this.calcularEdad(this.formResponsable.FECHA_NACIMIENTO)<18)throw new Error("El responsable de pago debe ser mayor de edad");if(!this.formResponsable.NUMERO_CELULAR)throw new Error("Debe completar el Número de Celular del Responsable");if(!this.formResponsable.CORREO)throw new Error("Debe completar el Correo del Responsable");if(!this.regexEmail.test(this.formResponsable.CORREO))throw new Error("Debe ingresar un Correo válido para el Responsable")},registrarPersonaIndividual:function(e){var a=this;return h()(P()().m(function r(){var n,o,t,i,s,l,c;return P()().w(function(r){while(1)switch(r.p=r.n){case 0:return r.p=0,n=a.objPersona(e),o=a.comboDocumentos.find(function(a){return a.ID_TIPODOC===e.ID_TIPODOC}),t=a.sexos.find(function(a){return a.value===e.SEXO}),i=a.getNombreCompleto(e.APELLIDO_PATERNO,e.APELLIDO_MATERNO,e.NOMBRES),n.adicional={ES_RESPONSABLE:!0,ID_PERSONA_REG:0,DOCUMENTO_IDENTIDAD:o.ABREVIATURA,SEXO_DESC:t.label,NOMBRE_COMPLETO:i},n.persona_familia_det={ID_REFPER:a.formPersona.ID_REFPER},n.persona_perfil.push({ID_PERFIL:F["default"].PERFIL_APODERADO_FAMILIA}),s={persona:a.formPersona,persona_documento:{ID_TIPODOC:a.formPersona.ID_TIPODOC,NUMERO:a.formPersona.NUMERO_DOC},persona_perfil:{ID_PERFIL:a.idPerfil},persona_natural:{APELLIDO_PATERNO:a.formPersona.APELLIDO_PATERNO||null,APELLIDO_MATERNO:a.formPersona.APELLIDO_MATERNO||null,NOMBRES:a.formPersona.NOMBRES||null,SEXO:a.formPersona.SEXO||null}},r.n=1,w.$http.post("api/personaController/addPersonaAuxiliar",{parametros:s});case 1:return l=r.v,a.$notify(l.message,"success"),a.$emit("add-persona",a.formPersona),r.a(2,l);case 2:throw r.p=2,c=r.v,new Error(c.message);case 3:return r.a(2)}},r,null,[[0,2]])}))()},guardarRegistro:function(){var e=this;try{this.validarFormPersona(),this.menorEdad&&!this.idPersona&&this.validarFormResponsable();var a=this.idPersona?"actualizar":"registrar";this.$confirm("¿Esta seguro de ".concat(a," al participante?"),"info").onOk(h()(P()().m(function a(){var r,n;return P()().w(function(a){while(1)switch(a.p=a.n){case 0:if(!e.registroInterno){a.n=4;break}if(!e.idPersona){a.n=2;break}return a.n=1,e.updatePersona();case 1:return a.a(2);case 2:return a.n=3,e.addPersona();case 3:return a.a(2);case 4:if(a.p=4,e.$q.loading.show(),!e.menorEdad){a.n=6;break}return a.n=5,e.registrarMenorConResponsable(e.formPersona,e.formResponsable);case 5:r=a.v,a.n=8;break;case 6:return a.n=7,e.registrarPersonaIndividual(e.formPersona);case 7:r=a.v;case 8:e.$emit("dataPostRegistro",r.data),a.n=10;break;case 9:a.p=9,n=a.v,e.$alert(n.message,"warning");case 10:e.$q.loading.hide();case 11:return a.a(2)}},a,null,[[4,9]])})))}catch(e){this.$alert(e.message,"warning")}},addPersona:function(){var e=this;return h()(P()().m(function a(){var r,n,o,t,i,s,l,c,u,d,f;return P()().w(function(a){while(1)switch(a.p=a.n){case 0:if(a.p=0,r=e.sieInfo.famcod,e.sieInfo.famcod){a.n=3;break}return n={params:{where:{alucod:e.sieInfo.alucod}}},a.n=1,w.$http.get("api/AlumnoController/getAlumnos",{params:n});case 1:if(o=a.v,0!==o.data.length){a.n=2;break}throw new Error("El usuario no tiene familia relacionada");case 2:r=o.data[0].FAMCOD;case 3:if(e.existeRespPago||!e.menorEdad){a.n=5;break}return t={params:{ID_TIPODOC:e.formResponsable.ID_TIPODOC,NUMERO:e.formResponsable.NUMERO_DOC}},a.n=4,w.$http.get("api/personaController/getExistePersona",{params:t});case 4:if(i=a.v,!(i.data.length>0)){a.n=5;break}throw new Error("El responsable de pago ya existe");case 5:return s=e.objPersona(e.formPersona),a.n=6,w.$http.post("api/personaController/addPersonaAuxiliar",{parametros:s});case 6:return l=a.v,a.n=7,w.$http.put("api/personaController/putAsignarPersonaEnFamilia",{params:{famcod:r,codigo:s.persona_perfil.CODIGO,id_persona:l.data.ID_PERSONA,relacion:"E"}});case 7:if(!e.menorEdad){a.n=11;break}if(!e.existeRespPago){a.n=9;break}return c={ID_PERSONA_SUBCLIENTE:l.data.ID_PERSONA,ID_PERFIL_SUBCLIENTE:l.data.ID_PERFIL,ID_COMPROBANTE:3,ID_PERSONA:e.respPagoFound.ID_PERSONA,ID_PERFIL:F["default"].ID_REFPER_TO_PERFIL[e.formResponsable.ID_REFPER]},a.n=8,w.$http.post("api/personaController/postActualizarSubcliente",{params:c});case 8:a.n=11;break;case 9:return u=e.objPersona(e.formResponsable),u.persona_perfil.unshift({ID_PERFIL:F["default"].ID_REFPER_TO_PERFIL[e.formResponsable.ID_REFPER]}),a.n=10,w.$http.post("api/personaController/addPersonaAuxiliar",{parametros:u});case 10:return d=a.v,a.n=11,w.$http.put("api/personaController/putAsignarPersonaEnFamilia",{params:{famcod:r,codigo:u.persona_perfil.CODIGO,id_persona:d.data.ID_PERSONA,relacion:F["default"].REFPER_TO_ABR[e.formResponsable.ID_REFPER]}});case 11:e.$alert("El participante fue registrado con éxito","success"),e.$emit("closeModal",!0,l.data.ID_PERSONA,l.data.ID_PERFIL),a.n=13;break;case 12:a.p=12,f=a.v,e.$alert(f.error?f.error.message:f.message,"warning");case 13:return a.a(2)}},a,null,[[0,12]])}))()},buscarRespPago:function(){var e=this;return h()(P()().m(function a(){var r,n,o,t;return P()().w(function(a){while(1)switch(a.n){case 0:return e.$q.loading.show(),r={params:{famcod:e.sieInfo.famcod}},a.n=1,w.$http.get("api/personaController/getFamiliares",{params:r});case 1:if(n=a.v,o=n.find(function(a){return a.ID_REFPER===e.formResponsable.ID_REFPER}),!o){a.n=3;break}return e.existeRespPago=!0,a.n=2,w.$http.get("api/personaController/getPersonaAuxiliar",{params:{params:{idPersona:o.ID_PERSONA}}});case 2:t=a.v,e.respPagoFound=t.persona[0],e.llenarRespPago(t.persona[0]),a.n=4;break;case 3:e.clearResponsable(!1),e.existeRespPago=!1;case 4:e.$q.loading.hide();case 5:return a.a(2)}},a)}))()},getNombreCompleto:function(e,a,r){var n=e;return a&&(n+=" "+a),n+=", "+r,n},registrarMenorConResponsable:function(e,a){var r=this;return h()(P()().m(function n(){var o,t,i,s,l,c,u,d,f,m,E,O,p,A;return P()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,o=e.APELLIDO_PATERNO+" "+e.APELLIDO_MATERNO,o=o.trim(),t=[],e.ES_PERSONAL&&(e.ES_PERSONAL="N"),i=r.objPersona(e),s=r.objPersona(a),l=r.comboDocumentos.find(function(a){return a.ID_TIPODOC===e.ID_TIPODOC}),c=r.sexos.find(function(a){return a.value===e.SEXO}),u=r.getNombreCompleto(e.APELLIDO_PATERNO,e.APELLIDO_MATERNO,e.NOMBRES),i.adicional={ES_RESPONSABLE:!1,RESPECON:F["default"].ID_REFPER_TO_PERFIL[a.ID_REFPER],ID_PERSONA_REG:0,DOCUMENTO_IDENTIDAD:l.ABREVIATURA,RELACION:"HIJO",SEXO_DESC:c.label,NOMBRE_COMPLETO:u,TIPOSEGURO:r.formPersona.TIPOSEGURO,HOSPITAL:r.formPersona.HOSPITAL,SEGURO:r.formPersona.SEGURO,CLINICA:r.formPersona.CLINICA},i.persona_familia_det={ID_REFPER:F["default"].ID_REFPER_FAMILIA.E},d=r.comboDocumentos.find(function(e){return e.ID_TIPODOC===a.ID_TIPODOC}),f=r.sexos.find(function(e){return e.value===a.SEXO}),m=r.getNombreCompleto(a.APELLIDO_PATERNO,a.APELLIDO_MATERNO,a.NOMBRES),E=F["default"].REFERENCIA_FAMILIAR[a.ID_REFPER],s.adicional={ES_RESPONSABLE:!0,ID_PERSONA_REG:0,DOCUMENTO_IDENTIDAD:d.ABREVIATURA,SEXO_DESC:f.label,NOMBRE_COMPLETO:m,RELACION:E},s.persona_familia_det={ID_REFPER:a.ID_REFPER},s.persona_perfil.unshift({ID_PERFIL:F["default"].ID_REFPER_TO_PERFIL[a.ID_REFPER]}),t.push(s),t.push(i),O={famdes:o,familiares:t,esTalleres:!0,esAdmision:!1},n.n=1,w.$http.post("api/personaController/grabarRegistroFamiliaExterna",{params:O});case 1:return p=n.v,n.a(2,p);case 2:throw n.p=2,A=n.v,new Error(A.message);case 3:return n.a(2)}},n,null,[[0,2]])}))()},objPersona:function(e){var a={persona_documento:{AUTOGENERADO:0,ID_TIPODOC:e.ID_TIPODOC,NUMERO:e.NUMERO_DOC},persona:{TIPO_PERSONA:F["default"].PERSONA_NATURAL,FECHA_CREACION:""},persona_perfil:[{CODIGO:e.NUMERO_DOC,ID_PERFIL:F["default"].PERFIL_ALUMNO_EXTERNO}],persona_natural:{APELLIDO_PATERNO:e.APELLIDO_PATERNO,APELLIDO_MATERNO:e.APELLIDO_MATERNO,NOMBRES:e.NOMBRES,SEXO:e.SEXO,ESTADO_CIVIL:1,FECHA_NACIMIENTO:(0,je.convertToYMD)(e.FECHA_NACIMIENTO),CODIGOBANCO:"",ANOING:(new Date).getFullYear()}};return e.NUMERO_CELULAR&&(a.persona_celular={TIPO_TELEFONO:2,PRINCIPAL:1,EMERGENCIA:0,NUMERO:e.NUMERO_CELULAR}),e.CORREO&&(a.persona_correo={CORREO:e.CORREO,PRINCIPAL:1}),this.menorEdad&&"S"===e.ES_HIJO_PERSONAL&&a.persona_perfil.push({ID_PERFIL:F["default"].PERFIL_HIJO_PERSONAL}),"S"===e.ES_PERSONAL&&a.persona_perfil.push({ID_PERFIL:F["default"].PERFIL_PERSONAL}),a},convertDayFormat:function(e){var a=e.split("T")[0],r=a.split("-");return r[2]+"/"+r[1]+"/"+r[0]},llenarPersona:function(e){this.formPersona.ID_TIPODOC=e.ID_TIPODOC,this.formPersona.NUMERO_DOC=e.NUMDOC,this.formPersona.APELLIDO_MATERNO=e.APEMAT,this.formPersona.APELLIDO_PATERNO=e.APEPAT,this.formPersona.NOMBRES=e.NOMBRES,this.formPersona.SEXO=e.SEXO,this.formPersona.FECHA_NACIMIENTO=this.convertDayFormat(e.FECHA_NACIMIENTO),this.formPersona.NUMERO_CELULAR=e.CELULAR,this.formPersona.CORREO=e.CORREO,this.idPerdoc=e.IDPERDOC},llenarRespPago:function(e){this.formResponsable.NUMERO_DOC=e.NUMDOC,this.formResponsable.APELLIDO_MATERNO=e.APEMAT,this.formResponsable.APELLIDO_PATERNO=e.APEPAT,this.formResponsable.NOMBRES=e.NOMBRES,this.formResponsable.SEXO=e.SEXO,this.formResponsable.FECHA_NACIMIENTO=this.convertDayFormat(e.FECHA_NACIMIENTO),this.formResponsable.NUMERO_CELULAR=e.CELULAR,this.formResponsable.CORREO=e.CORREO},buscarPersona:function(){var e=this;return h()(P()().m(function a(){var r;return P()().w(function(a){while(1)switch(a.n){case 0:return a.n=1,w.$http.get("api/personaController/getPersonaAuxiliar",{params:{params:{idPersona:e.idPersona}}});case 1:r=a.v,e.llenarPersona(r.persona[0]);case 2:return a.a(2)}},a)}))()},validarPersonaExiste:function(){var e=this;return h()(P()().m(function a(){var r;return P()().w(function(a){while(1)switch(a.p=a.n){case 0:if(a.p=0,!e.validarNumeroDocumento()){a.n=2;break}return e.$q.loading.show(),a.n=1,e.searchDatos();case 1:e.$q.loading.hide();case 2:a.n=4;break;case 3:a.p=3,r=a.v,e.$notify(r.message,"warning");case 4:return a.a(2)}},a,null,[[0,3]])}))()},searchDatos:function(){var e=this;return h()(P()().m(function a(){var r,n;return P()().w(function(a){while(1)switch(a.n){case 0:if(r=e.formPersona.NUMERO_DOC,!(r&&r.length>0)||e.registroInterno){a.n=4;break}return a.n=1,w.$http.get("api/personaController/getPersonaPorDocumento",{params:{params:{numdoc:r}}});case 1:if(n=a.v,!n||!n.ID_PERSONA){a.n=2;break}return e.participanteExiste=!0,e.formPersona.APELLIDO_PATERNO=n.APEPAT,e.formPersona.APELLIDO_MATERNO=n.APEMAT,e.formPersona.NOMBRES=n.NOMBRES,e.formPersona.SEXO=n.SEXO,e.$emit("closeModal"),a.a(2);case 2:return a.n=3,e.completarDatosDni();case 3:e.participanteExiste=!1;case 4:return a.a(2)}},a)}))()},completarDatosDni:function(){var e=this;return h()(P()().m(function a(){var r;return P()().w(function(a){while(1)switch(a.n){case 0:if(e.formPersona.ID_TIPODOC!==F["default"].TIPO_DOCUMENTO_DNI){a.n=2;break}return e.$q.loading.show(),a.n=1,F["default"].API_BUSCAR_DATOS_DNI(e.formPersona.ID_TIPODOC,e.formPersona.NUMERO_DOC);case 1:r=a.v,e.$q.loading.hide(),r&&(e.formPersona.APELLIDO_PATERNO=r.APELLIDO_PATERNO,e.formPersona.APELLIDO_MATERNO=r.APELLIDO_MATERNO,e.formPersona.NOMBRES=r.NOMBRES,e.formPersona.SEXO=r.SEXO),e.documentoAnterior=e.formPersona.NUMERO_DOC;case 2:return a.a(2)}},a)}))()}},beforeMount:function(){var e=this;return h()(P()().m(function a(){return P()().w(function(a){while(1)switch(a.n){case 0:if(e.$q.loading.show(),e.getComprobantes(),e.setLenDocumento(),e.comboMenorEdad=[{value:F["default"].REFERENCIA_PERSONA.HIJO,label:"Hijo"}],e.respPago=[{value:F["default"].REFERENCIA_PERSONA.PADRE,label:"PADRE"},{value:F["default"].REFERENCIA_PERSONA.MADRE,label:"MADRE"},{value:F["default"].REFERENCIA_PERSONA.APODERADO,label:"APODERADO"}],e.idPersona){a.n=1;break}e.clearPersona(),e.clearResponsable(),a.n=2;break;case 1:return a.n=2,e.buscarPersona();case 2:e.$q.loading.hide();case 3:return a.a(2)}},a)}))()},mounted:function(){if(this.formPersona.NUMERO_DOC=this.loadDni,this.onFocusDni){var e=this.$refs.refDni;this.$nextTick(function(){e.forzedFocus()})}}};const Qe=(0,Re.A)(He,[["render",Te]]);var Xe=Qe,Ge={data:function(){var e=this;return{configCita:{CITA_ID:{renderHtml:function(e,a){return e.CITA_ID?a("span",{},e.CITA_ID):a("span",{},"")}},FH_INICIO:{component:"datetime",edit:!1},FH_FIN:{component:"datetime",edit:!1},PARENTESCO:{renderHtml:function(e,a,r){if(e.RESPONSABLE)return r.background({color:"transparent",textColor:"black",text:"Personal del Colegio"})}},NOMBRE:{renderHtml:function(e,a,r,n){var o=1,t=2,i=3,s=0;return s=5===this.seleccionado.ID_PERFIL?o:s,s=6===this.seleccionado.ID_PERFIL?t:s,s=7===this.seleccionado.ID_PERFIL?i:s,e.PARENTESCO_ID===s?n["$$background"]="primary":n["$$background"]="white",a("span",{},e.NOMBRE)}},ACTION:{component:"button",icon:["copy as copiarRegistroCita"],tooltip:{copiarRegistroCita:"Copiar Datos Cita"},copiarRegistroCita:function(){var a=h()(P()().m(function a(r){return P()().w(function(a){while(1)switch(a.n){case 0:e.dataCita={ID_PERSONA_VISITADO:r.ID_RESPONSABLE,ID_PERSONA_ALUMNO:r.ID_ALUMNO,MOTIVO:"001"},e.seleccionado=I()(I()({},e.seleccionado),{DATA_CITA:e.dataCita}),e.$notify("Datos copiados satisfactoriamente","success"),e.modalCita=!1;case 1:return a.a(2)}},a)}));function r(e){return a.apply(this,arguments)}return r}(),validate:{copiarRegistroCita:function(e){return e.CITA_ID}},colors:{copiarRegistroCita:"#21BA45"},flat:!0,dense:!0}},rows:[],fields:[{name:"CITA_ID",label:"Código",field:"CITA_ID",align:"left",sortable:!0},{name:"ASUNTO",label:"Asunto",field:"ASUNTO",align:"left",wrap:!0,sortable:!0},{name:"NOMBRE",label:"Nombre",field:"NOMBRE",align:"center",wrap:!0,sortable:!0},{name:"NOMBRE_ALUMNO",label:"Alumno(a)",field:"NOMBRE_ALUMNO",align:"center",wrap:!0,sortable:!0},{name:"PARENTESCO",label:"Parentesco",field:"PARENTESCO",align:"center",wrap:!0,sortable:!0},{name:"FH_INICIO",label:"Fecha Inicio",field:"FH_INICIO",align:"left",wrap:!0,sortable:!0},{name:"FH_FIN",label:"Fecha Fin",field:"FH_FIN",align:"center",wrap:!0,sortable:!0},{name:"ACTION",label:"Acción",field:"ACTION",align:"center",width:80}]}},watch:{dataCita:{immediate:!0,handler:function(e){e&&Object.keys(e).length&&this.fields.find(function(e){return"ACTION"===e.name})&&this.fields.push({name:"ACTION",label:"Acción",field:"ACTION",align:"center",wrap:!0,sortable:!0})}}}},ze=r(2819),Ye=r(84603),We=r(11768),Je={props:{ingresoColegio:{type:[String,Number],default:0}},mixins:[k,Ge],components:{QSelect:V.A,sieModal:b.A,qr:L.A,sieVacio:N.A,QToggle:C.c5,QCheckbox:C.vZ,QBtnToggle:C.QL,sieSelect:S.A,QRadio:C.$,date:C.p6,QClock:v.A,controlVisitaForm:De,consultaVisita:Pe["default"],fichaRapidaPersonaPerfil:Xe,siePdf:Ye.A,QPage:C.Tu,QCard:C.C$,QCardMain:C.d1,QInput:C.ie,QBtn:C.Il,QTooltip:C.nC},data:function(){return{idPersona:null,registroIngreso:1,registroSalida:0,buscarVisitante:!1,id_perfam:"",familiares:[],modalFamiliares:!1,optionTipoDocumento:[],form:{ID_TIPODOC:1},repetir:!1,loadRepetir:!1,repetirForm:{},repetirAreas:[],seleccionado:null,permiso:99999999,now:new Date,sie:(0,g["default"])(),idPerfil:null,tipoLectura:"qr",sinCamara:!1,cargaAnterior:!1,camera:"auto",usucod:"",optionSexo:[{label:"Masculino",value:"M"},{label:"Femenino",value:"F"}],tipoDiferenciado:[{label:"REGISTRAR INGRESO",value:0},{label:"REGISTRAR SALIDA",value:1}],tipoSelect:0,editar:!1,permiteSalida:!1,promesaDocumento:null,leyendoQr:!1,modalPersonaVisita:!1,modalVerRegistroVisita:!1,hora:null,existeFechaIngreso:!1,dni:"",modalCita:!1,citasProgramadas:[],idControlVisita:0,modalTicket:!1,objCita:{}}},watch:{tipoSelect:function(e){this.$http.put("api/HyoControl/updateControl",{campo:"alumnoES",numero:e})}},methods:{openModalRegistrarPersonaVisita:function(){this.dni="",this.modalPersonaVisita=!0},openModalVerRegistrVisita:function(){this.modalVerRegistroVisita=!0},openModalCita:function(){this.modalCita=!0},addPersona:function(e){var a=this;return h()(P()().m(function r(){return P()().w(function(r){while(1)switch(r.n){case 0:return a.modalPersonaVisita=!1,r.n=1,a.getPersonasVisita();case 1:return r.n=2,a.leerRegistro(e.NUMERO_DOC);case 2:return r.a(2)}},r)}))()},createControlVisita:function(e,a){var r=this;return h()(P()().m(function n(){var o,t;return P()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,n.n=1,r.$http.post("api/RegistroVisitaController/addRegistroVisita",{data:e,dataAreas:a});case 1:o=n.v,e.FECHA_SALIDA?(r.$notify("Se registró la salida satisfactoriamente","success"),r.idControlVisita=0):(r.$notify("Se registró el ingreso satisfactoriamente","success"),o&&o.ID&&(r.idControlVisita=o.ID)),n.n=3;break;case 2:n.p=2,t=n.v,r.$notify(t.message,"warning");case 3:return n.a(2)}},n,null,[[0,2]])}))()},registrarVisita:function(e,a,r,n){var o=this;return h()(P()().m(function t(){var i;return P()().w(function(t){while(1)switch(t.n){case 0:if(e.ID_PERSONA=r,e.FECHA_SALIDA||(e.FECHA_INGRESO=(0,Oe.formatDate)(new Date,"YYYY-MM-DD")+" "+o.hora),o.repetirForm=n?I()({},e):{},o.repetir=n,o.repetirAreas=a,!o.repetir){t.n=3;break}return t.n=1,o.$confirmar("¿Está seguro repetir el siguiente registro con la misma información?","info",{okLabel:"Si",cancelLabel:"No"});case 1:return i=t.v,t.n=2,o.createControlVisita(e,a);case 2:i||(o.repetir=!1),t.n=4;break;case 3:return t.n=4,o.createControlVisita(e,a);case 4:if(!o.idControlVisita){t.n=5;break}return t.n=5,o.generarTicket();case 5:o.existeFechaIngreso=!1,o.seleccionado=null,o.idPersona=null;case 6:return t.a(2)}},t)}))()},limpiarForm:function(e){var a=this;return h()(P()().m(function e(){return P()().w(function(e){while(1)switch(e.n){case 0:a.form={ID_TIPODOC:1};case 1:return e.a(2)}},e)}))()},generarTicket:function(){var e=this;return h()(P()().m(function a(){var r,n,o;return P()().w(function(a){while(1)switch(a.n){case 0:return e.modalTicket=!0,r={FORMATO:"pdf",ID:e.idControlVisita,REPCOD:"tcv"},n="ticket",o="webservice/reportes-intranet/jreport",a.n=1,e.$nextTick();case 1:(0,ze.exportFilePhp)(r,o,n,"ticket");case 2:return a.a(2)}},a)}))()},imprimirTicket:function(){window.print()},cambiarModo:function(e){this.registroIngreso?(0,M["default"])("Se registraran los Ingresos","info"):(0,M["default"])("Se registraran las salidas","info");var a=this.$refs.refUsucod;this.$nextTick(function(){a.focus()})},marcarAsistencia:function(e){var a=this;return h()(P()().m(function r(){var n,o,t,i,s,l,c,u;return P()().w(function(r){while(1)switch(r.p=r.n){case 0:return r.p=0,n=a.seleccionado.ID_PERSONA,r.n=1,a.$http.post("api/RegistroVisitaController/postRegistroVisita",{codigo:e,id_persona:n,asistenciaColegio:a.ingresoColegio,registroIngreso:a.registroIngreso});case 1:o=r.v,a.registroSalida=o.data.registroSalida,t=o.data?o.data.persona:{FAMILIARES:[],PERFILES:[]},o.data.tallerAhora.persona=t,t.FAMILIARES&&(a.familiares=t.FAMILIARES.filter(function(e){return e.NRODOC!==t.NUMDOC})),i=t.PERFILES,s=a.getPerfil(i),l=s.idPerfil,a.idPerfil=l,a.$refs.audioOk.play(),r.n=3;break;case 2:r.p=2,u=r.v,console.error(u),a.usucod=null,c=u&&u.error?u.error.message:"Ocurrio un error",(0,M["default"])(c,"warning"),a.$refs.audioError.play();case 3:return r.a(2)}},r,null,[[0,2]])}))()},getLastVisita:function(){var e=arguments,a=this;return h()(P()().m(function r(){var n,o,t;return P()().w(function(r){while(1)switch(r.p=r.n){case 0:return n=e.length>0&&void 0!==e[0]?e[0]:{},r.p=1,r.n=2,a.$http.get("api/RegistroVisitaController/getLastVisita",{params:{parametros:n}});case 2:return o=r.v,r.a(2,o);case 3:r.p=3,t=r.v,a.$notify(t.message,"warning");case 4:return r.a(2)}},r,null,[[1,3]])}))()},cambiarVisitante:function(e,a){var r=this;return h()(P()().m(function a(){return P()().w(function(a){while(1)switch(a.n){case 0:e&&0===e.ID_PERSONA&&(r.idPersona=null),r.seleccionado=e,r.leerRegistro(e.NUMERO),r.usucod=null,r.buscarVisitante=!1;case 1:return a.a(2)}},a)}))()},refactorizar:function(e){var a=[];for(var r in e){for(var n=e[r].data,o=0;o<n.length;o++){var t=1,i=2,s=3,l=0;l=5===this.objCita.ID_PERFIL?t:l,l=6===this.objCita.ID_PERFIL?i:l,l=7===this.objCita.ID_PERFIL?s:l,n[o].PARENTESCO_ID!==l&&(n[o].CITA_ID=0)}a=a.concat(n)}return a},getCitasProgramadas:function(e){var a=this;return h()(P()().m(function r(){var n,o,t;return P()().w(function(r){while(1)switch(r.p=r.n){case 0:return r.p=0,r.n=1,a.$http.get("api/HyoCita/validarCitaControlDeVisita",{params:{numeroDocumento:e}});case 1:return n=r.v,o=(0,We.A)(n.json,["CITA_ID"]),a.citasProgramadas=a.refactorizar(o),r.a(2,a.citasProgramadas);case 2:r.p=2,t=r.v,a.$notify(t.message,"No se pudo validar las citas programadas");case 3:return r.a(2)}},r,null,[[0,2]])}))()},leerRegistro:function(e,a,r){var n=this;return h()(P()().m(function r(){var o,t,i,s,l,c,u;return P()().w(function(r){while(1)switch(r.n){case 0:if(n.existeFechaIngreso=!1,n.leyendoQr=!0,e){r.n=1;break}return n.leyendoQr=!1,r.a(2,!1);case 1:e=e.toUpperCase();case 2:if(o=n.personasVisita.find(function(a){return a.CODIGO===e}),o||(o=n.personasVisita.find(function(a){return a.NUMERO===e})),n.objCita=o,!o){r.n=7;break}return n.seleccionado=null,n.$nextTick(),r.n=3,n.getLastVisita({id_persona:o.ID_PERSONA});case 3:if(t=r.v,!t||!t.ID_PERSONA){r.n=4;break}n.seleccionado=I()(I()({},o),t),n.existeFechaIngreso=!0,r.n=6;break;case 4:return n.citasProgramadas=[],r.n=5,n.getCitasProgramadas(o.NUMERO);case 5:n.citasProgramadas.length&&(i=n.citasProgramadas.find(function(e){return e.ID_ALUMNO}),s=i?i.ID_ALUMNO:null,l=n.citasProgramadas.find(function(e){return e.ID_RESPONSABLE}),c=l?l.ID_RESPONSABLE:null,n.seleccionado={DATA_CITA:{MOTIVO:"001",ID_PERSONA_ALUMNO:s,ID_PERSONA_VISITADO:c}},n.modalCita=!0),n.seleccionado=I()(I()({},n.seleccionado||{}),o);case 6:n.repetir?(n.seleccionado.REPETIR_AREAS=n.repetirAreas,n.seleccionado.ID_PERSONA_V=n.repetirForm.ID_PERSONA_V,n.seleccionado.MOTIVO=n.repetirForm.MOTIVO,n.seleccionado.EMPRESA=n.repetirForm.EMPRESA,n.seleccionado.COMENTARIO=n.repetirForm.COMENTARIO,n.loadRepetir=!0,n.repetir=!1,n.repetirForm={},n.repetirAreas=[]):n.loadRepetir=!1,n.seleccionado.hora=n.$refs.refClock.date,n.hora=C.p6.formatDate(new Date,"HH:mm:ss"),r.n=8;break;case 7:(0,M["default"])("No se encontró el visitante, registrelo","info"),n.seleccionado=null,n.$nextTick(),n.modalPersonaVisita=!0;case 8:if(n.usucod=null,u=1,!u){r.n=9;break}return n.leyendoQr=!1,r.a(2,!1);case 9:e?(e.indexOf("|")>=0&&(e=e.split("|")[0]),e=e.toUpperCase()):n.sinCamara=a,n.cargaAnterior=!0,n.usucod=null;case 10:return r.a(2)}},r)}))()},registraPistola:function(e){var a=this;return h()(P()().m(function r(){var n;return P()().w(function(r){while(1)switch(r.n){case 0:if(a.$q.loading.show(),13!==e.which){r.n=1;break}return n=a.usucod,a.dni=n,a.usucod=null,r.n=1,a.leerRegistro(n);case 1:a.$q.loading.hide();case 2:return r.a(2)}},r)}))()}},computed:{isLess:function(){return(0,T.isLess)()},modoDiferenciado:function(){return this.tipoDiferenciado[this.tipoSelect].label}},created:function(){var e=this;return h()(P()().m(function a(){var r;return P()().w(function(a){while(1)switch(a.n){case 0:return a.n=1,e.getTipoDocumentoIdentidad();case 1:return r=a.v,a.n=2,e.getPersonasVisita();case 2:e.optionTipoDocumento=r;case 3:return a.a(2)}},a)}))()}};const Ke=(0,Re.A)(Je,[["render",A]]);var Ze=Ke,ea={components:{controlVisita:Ze},data:function(){return{}}};const aa=(0,Re.A)(ea,[["render",o]]);var ra=aa}}]);