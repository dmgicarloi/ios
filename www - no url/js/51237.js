"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[51237],{51237:function(e,o,i){i.r(o),i.d(o,{default:function(){return W}});var n=i(8445),t=i.n(n),a=(i(71225),i(50310),i(5962),i(83190),i(61758)),l=i(58790),s={class:"column col q-ma-sm"},r={class:"row col justify-between"},c={class:"row col"},u={class:"q-px-xs q-mx-xs q-mb-sm border-field"},d={class:"row"},m={class:"row col justify-end"},f={class:"row"},g={key:1,class:"column justify-center q-mx-xs"},p={class:"column justify-center"},E={class:"row q-card"},h={class:"row"},O={class:"q-ma-sm"},R={key:0,class:"column col",style:{position:"relative"}},C={key:1,class:"column"},b={class:"row justify-center"},v=["src"],I={class:"column col",style:{position:"relative"}},A={class:"row justify-between"},S={class:"col row justify-end"},k={key:1,class:"row justify-center q-ma-sm"},y=["src"],T={key:1,class:"column col"},P={key:1,class:"row justify-center q-ma-sm"},N=["src"];function x(e,o){var i=(0,a.g2)("q-radio"),n=(0,a.g2)("q-select"),x=(0,a.g2)("q-input"),_=(0,a.g2)("q-btn"),L=(0,a.g2)("q-toolbar"),F=(0,a.g2)("sie-select"),M=(0,a.g2)("q-table"),U=(0,a.g2)("q-search"),D=(0,a.g2)("q-toggle"),q=(0,a.g2)("sie-upload"),B=(0,a.g2)("q-tooltip"),V=(0,a.g2)("sie-modal");return(0,a.uX)(),(0,a.CE)("div",s,[(0,a.bF)(L,{inverted:""},{default:(0,a.k6)(function(){return[(0,a.Lk)("div",r,[(0,a.Lk)("div",c,[(0,a.Lk)("fieldset",u,[o[20]||(o[20]=(0,a.Lk)("legend",{class:"leyenda"},"Generar Carnet por:",-1)),(0,a.Lk)("div",d,[(0,a.bF)(i,{class:"q-ma-sm",modelValue:e.tipoCarnet,"onUpdate:modelValue":o[0]||(o[0]=function(o){return e.tipoCarnet=o}),val:1,label:e.$t("salon"),color:"secondary"},null,8,["modelValue","label"]),(0,a.bF)(i,{class:"q-ma-sm",modelValue:e.tipoCarnet,"onUpdate:modelValue":o[1]||(o[1]=function(o){return e.tipoCarnet=o}),val:2,label:e.$t("familia"),color:"secondary"},null,8,["modelValue","label"])])])]),(0,a.Lk)("div",m,[(0,a.Lk)("div",f,[(0,a.bF)(n,{class:"flex q-if-outlined","float-label":"Modo de Impresión",options:e.modoImpresionOpciones,modelValue:e.configuracion.MODO_IMPRESION,"onUpdate:modelValue":o[2]||(o[2]=function(o){return e.configuracion.MODO_IMPRESION=o})},null,8,["options","modelValue"]),e.configuracion.MODO_IMPRESION.indexOf("etiquetas")>=0?((0,a.uX)(),(0,a.Wv)(x,{key:0,class:"q-if-outlined",modelValue:e.inicioEtk,"onUpdate:modelValue":o[3]||(o[3]=function(o){return e.inicioEtk=o}),type:"number",step:1,max:e.maxEtk[e.configuracion.MODO_IMPRESION],"float-label":"Iniciar en:"},null,8,["modelValue","max"])):(0,a.Q3)("v-if",!0),e.configuracion.MODO_IMPRESION.indexOf("etiquetas")<0?((0,a.uX)(),(0,a.CE)("div",g,[(0,a.bF)(_,{icon:"cog",color:"primary",style:{height:"20px"},size:"sm",onClick:e.openModal},{default:(0,a.k6)(function(){return[(0,a.eW)((0,l.v_)(e.$t("configurar")),1)]}),_:1},8,["onClick"])])):(0,a.Q3)("v-if",!0)])]),(0,a.Lk)("div",p,[(0,a.bF)(_,{icon:"file_export",color:"primary",style:{height:"20px"},size:"sm",onClick:o[4]||(o[4]=function(o){return e.exportCarnet(e.configuracion,!0)})},{default:(0,a.k6)(function(){return[(0,a.eW)((0,l.v_)(e.$t("exportar")),1)]}),_:1})])])]}),_:1}),1===e.tipoCarnet?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.Lk)("div",E,[(0,a.bF)(F,{class:"col",type:"outlined",modelValue:e.nivel,"onUpdate:modelValue":o[5]||(o[5]=function(o){return e.nivel=o}),options:e.niveles,label:"INSTRUDES",val:"INSTRUCOD",placeholder:"ngs.nivel",onInput:e.cambiarNivel},null,8,["modelValue","options","onInput"]),(0,a.bF)(F,{class:"col",type:"outlined",modelValue:e.grado,"onUpdate:modelValue":o[6]||(o[6]=function(o){return e.grado=o}),options:e.grados[e.nivel],label:"GRADODES",val:"GRADOCOD",placeholder:"ngs.grado",onInput:e.filtrarData},null,8,["modelValue","options","onInput"])]),(0,a.bF)(M,{class:"col q-my-sm","table-style":"max-height: 70vh","row-key":"NEMO",pagination:e.tablaNemos.paginacion,"onUpdate:pagination":o[7]||(o[7]=function(o){return e.tablaNemos.paginacion=o}),data:e.salones,columns:e.tablaNemos.columns,selection:e.tablaNemos.tipoSeleccion,selected:e.tablaNemos.registrosSeleccionados,"onUpdate:selected":o[8]||(o[8]=function(o){return e.tablaNemos.registrosSeleccionados=o}),"hide-bottom":""},null,8,["pagination","data","columns","selection","selected"])],64)):((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.bF)(F,{type:"outlined",modelValue:e.salon,"onUpdate:modelValue":o[9]||(o[9]=function(o){return e.salon=o}),options:e.salonesBase,label:"NEMODES",val:"NEMO",placeholder:"salon",onInput:e.seleccionaSalon},null,8,["modelValue","options","onInput"]),(0,a.Lk)("div",h,[(0,a.bF)(U,{class:"col q-if-outlined",modelValue:e.tablaEstudiantes.filter,"onUpdate:modelValue":o[10]||(o[10]=function(o){return e.tablaEstudiantes.filter=o})},null,8,["modelValue"])]),(0,a.bF)(M,{class:"col q-my-sm","table-style":"max-height: 70vh","row-key":"FAMCOD",pagination:e.tablaEstudiantes.paginacion,"onUpdate:pagination":o[11]||(o[11]=function(o){return e.tablaEstudiantes.paginacion=o}),data:e.estudiantes,columns:e.tablaEstudiantes.columns,selection:e.tablaEstudiantes.tipoSeleccion,selected:e.tablaEstudiantes.registrosSeleccionados,"onUpdate:selected":o[12]||(o[12]=function(o){return e.tablaEstudiantes.registrosSeleccionados=o}),"hide-bottom":"",filter:e.tablaEstudiantes.filter},null,8,["pagination","data","columns","selection","selected","filter"])],64)),(0,a.bF)(V,{modelValue:e.modalConfiguracion,"onUpdate:modelValue":o[18]||(o[18]=function(o){return e.modalConfiguracion=o}),onSubmit:o[19]||(o[19]=function(o){return e.exportCarnet(e.configuracion)})},{default:(0,a.k6)(function(){return[(0,a.Lk)("div",O,[(0,a.bF)(D,{modelValue:e.configuracion["OCULTAR_CABECERA"],"onUpdate:modelValue":o[13]||(o[13]=function(o){return e.configuracion["OCULTAR_CABECERA"]=o}),label:"Ocultar Cabecera",color:"secondary","true-value":1,"false-value":0},null,8,["modelValue"]),(0,a.Lk)("span",null,(0,l.v_)(e.configuracion["OCULTAR_CABECERA"]),1)]),1!==e.configuracion["OCULTAR_CABECERA"]?((0,a.uX)(),(0,a.CE)("div",R,[o[21]||(o[21]=(0,a.Lk)("span",{class:"text-bold",style:{"text-align":"center"}},"Escudo del Colegio",-1)),e.configuracion.CABECERA?((0,a.uX)(),(0,a.CE)("div",C,[(0,a.Lk)("div",b,[(0,a.Lk)("img",{src:e.configuracion.CABECERA,style:{display:"block","max-width":"60vw","max-height":"60vh"}},null,8,v),(0,a.bF)(_,{flat:"",dense:"",round:"",icon:"delete",style:{position:"absolute",right:"10px"},onClick:o[14]||(o[14]=function(o){return e.deleteImagen("CABECERA")})})])])):((0,a.uX)(),(0,a.Wv)(q,{key:0,onUpload:e.addEscudo,icon:"file",title:"Escudo del Colegio",allow:["png"]},null,8,["onUpload"]))])):(0,a.Q3)("v-if",!0),(0,a.Lk)("div",I,[(0,a.Lk)("div",A,[o[23]||(o[23]=(0,a.Lk)("div",{class:"col"},null,-1)),o[24]||(o[24]=(0,a.Lk)("span",{class:"text-bold col",style:{"text-align":"center"}},"Fondo Frontal",-1)),(0,a.Lk)("div",S,[(0,a.bF)(D,{class:"q-mr-sm",modelValue:e.repetirPosterior,"onUpdate:modelValue":o[15]||(o[15]=function(o){return e.repetirPosterior=o}),color:"secondary","checked-icon":"documents","unchecked-icon":"file_text_o",size:"sm"},{default:(0,a.k6)(function(){return[(0,a.bF)(B,null,{default:(0,a.k6)(function(){return t()(o[22]||(o[22]=[(0,a.eW)("Duplicar en posterior",-1)]))}),_:1})]}),_:1},8,["modelValue"])])]),e.configuracion.FRONTAL?((0,a.uX)(),(0,a.CE)("div",k,[(0,a.Lk)("img",{src:e.configuracion.FRONTAL,style:{display:"block","max-width":"60vw","max-height":"60vh"}},null,8,y),(0,a.bF)(_,{flat:"",dense:"",round:"",icon:"delete",style:{position:"absolute",right:"10px"},onClick:o[16]||(o[16]=function(o){return e.deleteImagen("FRONTAL")})})])):((0,a.uX)(),(0,a.Wv)(q,{key:0,onUpload:e.addFrontal,icon:"file",title:"Fondo Frontal",allow:["png"]},null,8,["onUpload"]))]),e.repetirPosterior?(0,a.Q3)("v-if",!0):((0,a.uX)(),(0,a.CE)("div",T,[o[25]||(o[25]=(0,a.Lk)("span",{class:"text-bold",style:{"text-align":"center"}},"Fondo Posterior",-1)),e.configuracion.POSTERIOR?((0,a.uX)(),(0,a.CE)("div",P,[(0,a.Lk)("img",{src:e.configuracion.POSTERIOR,style:{display:"block","max-width":"60vw","max-height":"60vh"}},null,8,N),(0,a.bF)(_,{flat:"",dense:"",round:"",icon:"delete",style:{position:"absolute",right:"10px"},onClick:o[17]||(o[17]=function(o){return e.deleteImagen("POSTERIOR")})})])):((0,a.uX)(),(0,a.Wv)(q,{key:0,onUpload:e.addPosterior,icon:"file",title:"Fondo Posterior",allow:["png"],remove:!0},null,8,["onUpload"]))]))]}),_:1},8,["modelValue"])])}i(39866),i(23825),i(77507),i(52133),i(10239),i(56285),i(90095),i(6724),i(70199),i(48426),i(515),i(27153),i(66307),i(13715),i(24066);var _=i(6123),L=i(30545),F=i(80660),M=i(78131),U=i(57668),D=i(93616),q=i(33001),B=i(30640),V=i(59089),w=i(33950),j=i(2819),$=i(69027),Q=i(982),H=(i(4026),{components:{QOptionGroup:_.EX,QRadio:_.$,QPageSticky:_._U,QCheckbox:_.vZ,sieSelect:D.A,QTable:L.A,SieModal:B.A,sieUpload:V.A,QToggle:_.c5,QSelect:_.Si,QToolbar:_.ZV,QInput:_.ie,QBtn:_.Il,QSearch:_.Ks,QTooltip:_.nC},data:function(){return{sie:(0,U["default"])(),tipoCarnet:1,salones:[],salonesBase:[],campos:[],salon:null,showHijos:!1,showPadres:!1,tablaNemos:{columns:[{name:"NEMO",field:"NEMO",align:"left"},{name:"NEMODES",field:"NEMODES",align:"left",label:this.$t("salon")}],paginacion:{page:1,rowsPerPage:40},registrosSeleccionados:[],tipoSeleccion:"single"},estudiantes:[],tablaEstudiantes:{columns:[{name:"FAMDES",field:"FAMDES",align:"left",label:this.$t("familia")}],paginacion:{page:1,rowsPerPage:40},registrosSeleccionados:[],tipoSeleccion:"multiple",filter:null},items:[{label:"Codigo de Alumno",value:"CODALU"},{label:"Nombre Completo",value:"NOMCOMP"},{label:"Nombre de Alumno",value:"NOMBRE"},{label:"Apellido Paterno",value:"PATERNO"},{label:"Apellido Materno",value:"MATERNO"},{label:"Salon",value:"SALON"},{label:"Nivel",value:"NIVEL"},{label:"Grado",value:"GRADO"},{label:"Sección",value:"SECCION"},{label:"Aula",value:"AULA"}],niveles:[],grados:{},nivel:"T",grado:"T",modalDetalle:!1,dataRevuelta:[],imagenes:{},repetirPosterior:!1,modoImpresionOpciones:[{value:"vertical",label:"Vertical"},{value:"horizontal",label:"Horizontal"},{value:"etiquetas004",label:"Etiquetas - 004"},{value:"etiquetas005",label:"Etiquetas - 005"}],modoImpresion:"vertical",configuracion:{MODO_IMPRESION:"vertical",OCULTAR_CABECERA:0,CABECERA:null,FRONTAL:null,POSTERIOR:null,REPETIR_POSTERIOR:0,TIPO:3},modalConfiguracion:!1,ocultaCabecera:!1,inicioEtk:1,maxEtk:{etiquetas004:33,etiquetas005:14}}},watch:{modoImpresion:function(){this.validaEtiquetas()},inicioEtk:function(){this.validaEtiquetas()}},methods:{validaEtiquetas:function(){this.modoImpresion.indexOf("etiquetas")>=0&&this.inicioEtk>this.maxEtk[this.modoImpresion]&&(this.inicioEtk=this.maxEtk[this.modoImpresion])},openModal:function(){var e=this;this.configuracion.CABECERA&&this.configuracion.CABECERA.indexOf("base64")<0&&F.$http.get("api/HyoConfigcarnets/decodeBase64",{params:{img:this.configuracion.CABECERA,tipo:3}}).then(function(o){e.configuracion.CABECERA=o.json}),this.configuracion.FRONTAL&&this.configuracion.FRONTAL.indexOf("base64")<0&&F.$http.get("api/HyoConfigcarnets/decodeBase64",{params:{img:this.configuracion.FRONTAL,tipo:3}}).then(function(o){e.configuracion.FRONTAL=o.json}),this.configuracion.POSTERIOR&&this.configuracion.POSTERIOR.indexOf("base64")<0&&F.$http.get("api/HyoConfigcarnets/decodeBase64",{params:{img:this.configuracion.POSTERIOR,tipo:3}}).then(function(o){e.configuracion.POSTERIOR=o.json}),this.modalConfiguracion=!0},exportCarnet:function(e,o){var i=this,n=e.MODO_IMPRESION,t=e.OCULTAR_CABECERA,a=e.REPETIR_POSTERIOR,l=e.TIPO,s=e.CABECERA,r=e.FRONTAL,c=e.POSTERIOR,u=e.MODO_IMPRESION_BASE,d=e.OCULTAR_CABECERA_BASE,m=e.REPETIR_POSTERIOR_BASE;s&&this.imagenes.escudo||r&&this.imagenes.frontal||c&&this.imagenes.posterior||u!==n||d!==t||m!==a?(0,$.dialogConfirm)({message:"¿Desea guardar la configuración?"}).then(function(e){if(e){var f={MODO_IMPRESION:n,OCULTAR_CABECERA:t,REPETIR_POSTERIOR:a,TIPO:l};u!==n&&(f.MODO_IMPRESION=n),d!==t&&(f.OCULTAR_CABECERA=t),m!==a&&(f.REPETIR_POSTERIOR=a),s&&i.imagenes.escudo&&(f.CABECERA=i.imagenes.escudo),r&&i.imagenes.frontal&&(f.FRONTAL=i.imagenes.frontal),c&&i.imagenes.posterior&&(f.POSTERIOR=i.imagenes.posterior),F.$http.post("api/HyoConfigcarnets/saveConfig",{info:f}).then(function(e){var n=e.json;(0,Q["default"])(i.$t("mensajes."+n.msg),n.type),n.type||(i.imagenes={},i.cargaInicial(),o?i.exportar(!0):i.modalConfiguracion=!1)})}else o?i.exportar(!1):i.modalConfiguracion=!1}):o?this.exportar(!1):this.modalConfiguracion=!1},exportar:function(e){var o=this;if(console.log({grabado:e}),1===this.tipoCarnet&&this.tablaNemos.registrosSeleccionados.length>0||2===this.tipoCarnet&&this.tablaEstudiantes.registrosSeleccionados.length>0){var i="",n={ano:this.sie.ano,repcod:"carnetAsistenciaQr",tipoCarnet:this.tipoCarnet,modoImpresion:this.modoImpresion};if(1===this.tipoCarnet){var t=this.tablaNemos.registrosSeleccionados.map(function(e){return e.NEMO});i="?nemos="+t.join(","),n.nemos=t}else{var a=this.tablaEstudiantes.registrosSeleccionados.map(function(e){return e.ALUCOD});i="?famcods="+a.join(","),n.famcods=a}if(["reportePdf","reporteExcel"].includes(this.modoImpresion))return void(0,j.exportFilePhp)(n,"webservice/reportes/reporte");if(Object.keys(this.imagenes).length>0&&!e&&Object.keys(this.imagenes).forEach(function(e){if(o.imagenes[e].name){var n=o.imagenes[e].name,t={archivo:n.substring(0,n.lastIndexOf(".")),extension:n.substring(n.lastIndexOf(".")+1,n.length)};i=i+"&"+e+"="+JSON.stringify(t)}}),i=i+"&modo="+this.configuracion.MODO_IMPRESION,this.configuracion.MODO_IMPRESION.indexOf("etiquetas")>=0&&(i=i+"&inicio="+this.inicioEtk),1===this.OCULTAR_CABECERA&&(i+="&ocultaCabecera=S"),this.imagenes["frontal"]&&this.repetirPosterior&&!e){var l=this.imagenes.frontal.name,s={archivo:l.substring(0,l.lastIndexOf(".")),extension:l.substring(l.lastIndexOf(".")+1,l.length)};i=i+"&posterior="+JSON.stringify(s)}var r=this.sie.api+"/HyoFamilias/generarCarnet"+i+"&token2="+this.sie.token+"&access_token="+this.sie.token;console.log(r),(0,M["default"])(r,"data.html",!0)}},seleccionaSalon:function(e){var o=this;this.tablaEstudiantes.registrosSeleccionados=[],F.$http.get("api/HyoFamilias/obtFamiliasNemo",{params:{nemo:e}}).then(function(e){o.estudiantes=e})},deleteImagen:function(e){var o=this;F.$http.post("api/HyoConfigcarnets/limpiarImagen",{img:e,modo_impresion:this.configuracion.MODO_IMPRESION}).then(function(i){o.configuracion[e]=null})},subirImagenFinal:function(e,o){var i=this;(0,w.Upload)({url:"api/HyoArchivo/tmp/upload",file:o[0]}).then(function(n){i.imagenes[e]=n,console.log(o,n);var t=n.name,a={archivo:t.substring(0,t.lastIndexOf(".")),extension:t.substring(t.lastIndexOf(".")+1,t.length)};F.$http.post("api/HyoConfigcarnets/codificarImagen",{img:a}).then(function(o){var n=o.json;switch(e){case"escudo":i.configuracion.CABECERA=n;break;case"frontal":i.configuracion.FRONTAL=n;break;case"posterior":i.configuracion.POSTERIOR=n;break}})}).catch(function(){})},addEscudo:function(e){this.subirImagenFinal("escudo",e)},addFrontal:function(e){this.subirImagenFinal("frontal",e)},addPosterior:function(e){this.subirImagenFinal("posterior",e)},cambiarNivel:function(){this.grado="T",this.filtrarData()},cargaInicial:function(){var e=this;F.$http.get("api/HyoConfigcarnets/getDatos",{params:{tipo:3}}).then(function(o){var i=o.json;Object.keys(i).length>0?(i.MODO_IMPRESION_BASE=i.MODO_IMPRESION,i.OCULTAR_CABECERA_BASE=i.OCULTAR_CABECERA,i.REPETIR_POSTERIOR_BASE=i.REPETIR_POSTERIOR,e.configuracion=i):e.configuracion={MODO_IMPRESION:"vertical",OCULTAR_CABECERA:0,CABECERA:null,FRONTAL:null,POSTERIOR:null,REPETIR_POSTERIOR:0,TIPO:1}})},filtrarData:function(){this.salones=Object.assign(this.salonesBase),"T"!==this.nivel&&(this.salones=(0,q.filterArray)(this.nivel,{field:"INSTRUCOD",list:this.salones}),"T"!==this.grado&&(this.salones=(0,q.filterArray)(this.grado,{field:"GRADOCOD",list:this.salones})))}},computed:{todos:function(){var e=this.campos.length===this.items.length;return this.campos.length!==this.items.length&&this.campos.length>0&&(e=null),e}},created:function(){var e=this;this.cargaInicial(),"0076"===this.sie.colcod&&(this.modoImpresionOpciones.push({value:"etiquetasEspecial",label:"Etiquetas Propias"}),this.modoImpresion="etiquetasEspecial",this.maxEtk["etiquetasEspecial"]=21),Promise.all([F.$http.get("api/HyoSalones/listaSalones"),F.$http.get("api/HyoInstrus/obtInstru"),F.$http.get("api/HyoGradoNivs/obtGrados",{params:{agrupado:!0,todos:"T"}})]).then(function(o){e.salonesBase=o[0].json,o[1].json.unshift({INSTRUCOD:"T",INSTRUDES:"Todos"}),e.niveles=o[1].json,e.grados=o[2].json,e.filtrarData()})}}),X=i(12807);const G=(0,X.A)(H,[["render",x]]);var W=G}}]);