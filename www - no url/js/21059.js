"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[21059],{21059:function(e,o,n){n.r(o),n.d(o,{default:function(){return H}});var t=n(8445),i=n.n(t),a=(n(71225),n(50310),n(5962),n(83190),n(61758)),l=n(58790),s={class:"column col q-ma-sm"},r={class:"row justify-between"},c={class:"row"},u={class:"row"},d={key:0,class:"items-center"},m={key:1,class:"items-center"},p={class:"row"},g={class:"row"},f={class:"q-ma-sm"},E={key:0,class:"column col",style:{position:"relative"}},O={key:1,class:"column"},h={class:"row justify-center"},R=["src"],C={class:"column col",style:{position:"relative"}},b={class:"row justify-between"},v={class:"col row justify-end"},I={key:1,class:"row justify-center q-ma-sm"},A=["src"],S={key:1,class:"column col"},k={key:1,class:"row justify-center q-ma-sm"},T=["src"];function y(e,o){var n=(0,a.g2)("q-radio"),t=(0,a.g2)("q-select"),y=(0,a.g2)("q-btn"),P=(0,a.g2)("q-input"),N=(0,a.g2)("sie-select"),x=(0,a.g2)("q-table"),_=(0,a.g2)("q-search"),M=(0,a.g2)("q-toggle"),L=(0,a.g2)("sie-upload"),F=(0,a.g2)("q-tooltip"),U=(0,a.g2)("sie-modal"),D=(0,a.g2)("q-page-sticky");return(0,a.uX)(),(0,a.CE)("div",s,[o[25]||(o[25]=(0,a.Lk)("span",{class:"text-bold"},"Generar Carnet por:",-1)),(0,a.Lk)("div",r,[(0,a.Lk)("div",c,[(0,a.bF)(n,{class:"q-ma-sm",modelValue:e.tipoCarnet,"onUpdate:modelValue":o[0]||(o[0]=function(o){return e.tipoCarnet=o}),val:1,label:e.$t("salon"),color:"secondary"},null,8,["modelValue","label"]),(0,a.bF)(n,{class:"q-ma-sm",modelValue:e.tipoCarnet,"onUpdate:modelValue":o[1]||(o[1]=function(o){return e.tipoCarnet=o}),val:2,label:e.$t("intranet.estudiante"),color:"secondary"},null,8,["modelValue","label"])]),(0,a.Lk)("div",u,[(0,a.bF)(t,{class:"flex q-if-outlined","float-label":"Modo de Impresión",options:e.modoImpresionOpciones,modelValue:e.configuracion.MODO_IMPRESION,"onUpdate:modelValue":o[2]||(o[2]=function(o){return e.configuracion.MODO_IMPRESION=o})},null,8,["options","modelValue"]),e.configuracion.MODO_IMPRESION.indexOf("etiquetas")<0?((0,a.uX)(),(0,a.CE)("div",d,[(0,a.bF)(y,{round:"",flat:"",dense:"",icon:"cog",onClick:e.openModal},null,8,["onClick"])])):(0,a.Q3)("v-if",!0),e.configuracion.MODO_IMPRESION.indexOf("etiquetas")>=0?((0,a.uX)(),(0,a.CE)("div",m,[(0,a.bF)(P,{class:"q-if-outlined",modelValue:e.inicioEtk,"onUpdate:modelValue":o[3]||(o[3]=function(o){return e.inicioEtk=o}),type:"number",step:1,max:e.maxEtk[e.configuracion.MODO_IMPRESION],"float-label":"Iniciar en:"},null,8,["modelValue","max"])])):(0,a.Q3)("v-if",!0)])]),1===e.tipoCarnet?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.Lk)("div",p,[(0,a.bF)(N,{class:"col",type:"outlined",modelValue:e.nivel,"onUpdate:modelValue":o[4]||(o[4]=function(o){return e.nivel=o}),options:e.niveles,label:"INSTRUDES",val:"INSTRUCOD",placeholder:"ngs.nivel",onInput:e.cambiarNivel},null,8,["modelValue","options","onInput"]),(0,a.bF)(N,{class:"col",type:"outlined",modelValue:e.grado,"onUpdate:modelValue":o[5]||(o[5]=function(o){return e.grado=o}),options:e.grados[e.nivel],label:"GRADODES",val:"GRADOCOD",placeholder:"ngs.grado",onInput:e.filtrarData},null,8,["modelValue","options","onInput"])]),(0,a.bF)(x,{class:"col q-my-sm","table-style":"max-height: 70vh","row-key":"NEMO",pagination:e.tablaNemos.paginacion,"onUpdate:pagination":o[6]||(o[6]=function(o){return e.tablaNemos.paginacion=o}),data:e.salones,columns:e.tablaNemos.columns,selection:e.tablaNemos.tipoSeleccion,selected:e.tablaNemos.registrosSeleccionados,"onUpdate:selected":o[7]||(o[7]=function(o){return e.tablaNemos.registrosSeleccionados=o}),"hide-bottom":""},null,8,["pagination","data","columns","selection","selected"])],64)):((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.bF)(N,{type:"outlined",modelValue:e.salon,"onUpdate:modelValue":o[8]||(o[8]=function(o){return e.salon=o}),options:e.salonesBase,label:"NEMODES",val:"NEMO",placeholder:"salon",onInput:e.seleccionaSalon},null,8,["modelValue","options","onInput"]),(0,a.Lk)("div",g,[(0,a.bF)(_,{class:"col q-if-outlined",modelValue:e.tablaEstudiantes.filter,"onUpdate:modelValue":o[9]||(o[9]=function(o){return e.tablaEstudiantes.filter=o})},null,8,["modelValue"])]),(0,a.bF)(x,{class:"col q-my-sm","table-style":"max-height: 70vh","row-key":"ALUCOD",pagination:e.tablaEstudiantes.paginacion,"onUpdate:pagination":o[10]||(o[10]=function(o){return e.tablaEstudiantes.paginacion=o}),data:e.estudiantes,columns:e.tablaEstudiantes.columns,selection:e.tablaEstudiantes.tipoSeleccion,selected:e.tablaEstudiantes.registrosSeleccionados,"onUpdate:selected":o[11]||(o[11]=function(o){return e.tablaEstudiantes.registrosSeleccionados=o}),"hide-bottom":"",filter:e.tablaEstudiantes.filter},null,8,["pagination","data","columns","selection","selected","filter"])],64)),(0,a.bF)(U,{modelValue:e.modalConfiguracion,"onUpdate:modelValue":o[17]||(o[17]=function(o){return e.modalConfiguracion=o}),onSubmit:o[18]||(o[18]=function(o){return e.exportCarnet(e.configuracion)})},{default:(0,a.k6)(function(){return[(0,a.Lk)("div",f,[(0,a.bF)(M,{modelValue:e.configuracion["OCULTAR_CABECERA"],"onUpdate:modelValue":o[12]||(o[12]=function(o){return e.configuracion["OCULTAR_CABECERA"]=o}),label:"Ocultar Cabecera",color:"secondary","true-value":1,"false-value":0},null,8,["modelValue"]),(0,a.Lk)("span",null,(0,l.v_)(e.configuracion["OCULTAR_CABECERA"]),1)]),1!==e.configuracion["OCULTAR_CABECERA"]?((0,a.uX)(),(0,a.CE)("div",E,[o[20]||(o[20]=(0,a.Lk)("span",{class:"text-bold",style:{"text-align":"center"}},"Escudo del Colegio",-1)),e.configuracion.CABECERA?((0,a.uX)(),(0,a.CE)("div",O,[(0,a.Lk)("div",h,[(0,a.Lk)("img",{src:e.configuracion.CABECERA,style:{display:"block","max-width":"60vw","max-height":"60vh"}},null,8,R),(0,a.bF)(y,{flat:"",dense:"",round:"",icon:"delete",style:{position:"absolute",right:"10px"},onClick:o[13]||(o[13]=function(o){return e.deleteImagen("CABECERA")})})])])):((0,a.uX)(),(0,a.Wv)(L,{key:0,onUpload:e.addEscudo,icon:"file",title:"Escudo del Colegio",allow:["png"]},null,8,["onUpload"]))])):(0,a.Q3)("v-if",!0),(0,a.Lk)("div",C,[(0,a.Lk)("div",b,[o[22]||(o[22]=(0,a.Lk)("div",{class:"col"},null,-1)),o[23]||(o[23]=(0,a.Lk)("span",{class:"text-bold col",style:{"text-align":"center"}},"Fondo Frontal",-1)),(0,a.Lk)("div",v,[(0,a.bF)(M,{class:"q-mr-sm",modelValue:e.repetirPosterior,"onUpdate:modelValue":o[14]||(o[14]=function(o){return e.repetirPosterior=o}),color:"secondary","checked-icon":"documents","unchecked-icon":"file_text_o",size:"sm"},{default:(0,a.k6)(function(){return[(0,a.bF)(F,null,{default:(0,a.k6)(function(){return i()(o[21]||(o[21]=[(0,a.eW)("Duplicar en posterior",-1)]))}),_:1})]}),_:1},8,["modelValue"])])]),e.configuracion.FRONTAL?((0,a.uX)(),(0,a.CE)("div",I,[(0,a.Lk)("img",{src:e.configuracion.FRONTAL,style:{display:"block","max-width":"60vw","max-height":"60vh"}},null,8,A),(0,a.bF)(y,{flat:"",dense:"",round:"",icon:"delete",style:{position:"absolute",right:"10px"},onClick:o[15]||(o[15]=function(o){return e.deleteImagen("FRONTAL")})})])):((0,a.uX)(),(0,a.Wv)(L,{key:0,onUpload:e.addFrontal,icon:"file",title:"Fondo Frontal",allow:["png"]},null,8,["onUpload"]))]),e.repetirPosterior?(0,a.Q3)("v-if",!0):((0,a.uX)(),(0,a.CE)("div",S,[o[24]||(o[24]=(0,a.Lk)("span",{class:"text-bold",style:{"text-align":"center"}},"Fondo Posterior",-1)),e.configuracion.POSTERIOR?((0,a.uX)(),(0,a.CE)("div",k,[(0,a.Lk)("img",{src:e.configuracion.POSTERIOR,style:{display:"block","max-width":"60vw","max-height":"60vh"}},null,8,T),(0,a.bF)(y,{flat:"",dense:"",round:"",icon:"delete",style:{position:"absolute",right:"10px"},onClick:o[16]||(o[16]=function(o){return e.deleteImagen("POSTERIOR")})})])):((0,a.uX)(),(0,a.Wv)(L,{key:0,onUpload:e.addPosterior,icon:"file",title:"Fondo Posterior",allow:["png"],remove:!0},null,8,["onUpload"]))]))]}),_:1},8,["modelValue"]),(0,a.bF)(D,{expand:"",position:"bottom-right",offset:[20,20]},{default:(0,a.k6)(function(){return[(0,a.bF)(y,{fab:"",round:"",color:"secondary",icon:"file_export",onClick:o[19]||(o[19]=function(o){return e.exportCarnet(e.configuracion,!0)})})]}),_:1})])}n(39866),n(23825),n(77507),n(52133),n(10239),n(56285),n(90095),n(6724),n(70199),n(48426),n(515),n(27153),n(66307),n(13715),n(24066);var P=n(6123),N=n(30545),x=n(80660),_=n(78131),M=n(57668),L=n(93616),F=n(33001),U=n(30640),D=n(59089),B=n(33950),q=n(2819),V=n(69027),w=n(982),j=(n(4026),{components:{QOptionGroup:P.EX,QRadio:P.$,QPageSticky:P._U,QCheckbox:P.vZ,sieSelect:L.A,QTable:N.A,SieModal:U.A,sieUpload:D.A,QToggle:P.c5,QSelect:P.Si,QBtn:P.Il,QInput:P.ie,QSearch:P.Ks,QTooltip:P.nC},data:function(){return{sie:(0,M["default"])(),tipoCarnet:1,salones:[],salonesBase:[],campos:[],salon:null,tablaNemos:{columns:[{name:"NEMO",field:"NEMO",align:"left"},{name:"NEMODES",field:"NEMODES",align:"left",label:this.$t("salon")}],paginacion:{page:1,rowsPerPage:40},registrosSeleccionados:[],tipoSeleccion:"single"},estudiantes:[],tablaEstudiantes:{columns:[{name:"NOMCOMP",field:"NOMCOMP",align:"left",label:this.$t("intranet.estudiante")}],paginacion:{page:1,rowsPerPage:40},registrosSeleccionados:[],tipoSeleccion:"multiple",filter:null},items:[{label:"Codigo de Alumno",value:"CODALU"},{label:"Nombre Completo",value:"NOMCOMP"},{label:"Nombre de Alumno",value:"NOMBRE"},{label:"Apellido Paterno",value:"PATERNO"},{label:"Apellido Materno",value:"MATERNO"},{label:"Salon",value:"SALON"},{label:"Nivel",value:"NIVEL"},{label:"Grado",value:"GRADO"},{label:"Sección",value:"SECCION"},{label:"Aula",value:"AULA"}],niveles:[],grados:{},nivel:"T",grado:"T",modalDetalle:!1,dataRevuelta:[],imagenes:{},repetirPosterior:!1,modoImpresionOpciones:[{value:"vertical",label:"Vertical"},{value:"horizontal",label:"Horizontal"},{value:"etiquetas004",label:"Etiquetas - 004"},{value:"etiquetas005",label:"Etiquetas - 005"}],modoImpresion:"vertical",configuracion:{MODO_IMPRESION:"vertical",OCULTAR_CABECERA:0,CABECERA:null,FRONTAL:null,POSTERIOR:null,REPETIR_POSTERIOR:0,TIPO:1},modalConfiguracion:!1,ocultaCabecera:!1,inicioEtk:1,maxEtk:{etiquetas004:33,etiquetas005:14}}},watch:{modoImpresion:function(){this.validaEtiquetas()},inicioEtk:function(){this.validaEtiquetas()}},methods:{validaEtiquetas:function(){this.modoImpresion.indexOf("etiquetas")>=0&&this.inicioEtk>this.maxEtk[this.modoImpresion]&&(this.inicioEtk=this.maxEtk[this.modoImpresion])},openModal:function(){var e=this;this.configuracion.CABECERA&&this.configuracion.CABECERA.indexOf("base64")<0&&x.$http.get("api/HyoConfigcarnets/decodeBase64",{params:{img:this.configuracion.CABECERA,tipo:1}}).then(function(o){e.configuracion.CABECERA=o.json}),this.configuracion.FRONTAL&&this.configuracion.FRONTAL.indexOf("base64")<0&&x.$http.get("api/HyoConfigcarnets/decodeBase64",{params:{img:this.configuracion.FRONTAL,tipo:1}}).then(function(o){e.configuracion.FRONTAL=o.json}),this.configuracion.POSTERIOR&&this.configuracion.POSTERIOR.indexOf("base64")<0&&x.$http.get("api/HyoConfigcarnets/decodeBase64",{params:{img:this.configuracion.POSTERIOR,tipo:1}}).then(function(o){e.configuracion.POSTERIOR=o.json}),this.modalConfiguracion=!0},exportCarnet:function(e,o){var n=this,t=e.MODO_IMPRESION,i=e.OCULTAR_CABECERA,a=e.REPETIR_POSTERIOR,l=e.TIPO,s=e.CABECERA,r=e.FRONTAL,c=e.POSTERIOR,u=e.MODO_IMPRESION_BASE,d=e.OCULTAR_CABECERA_BASE,m=e.REPETIR_POSTERIOR_BASE;s&&this.imagenes.escudo||r&&this.imagenes.frontal||c&&this.imagenes.posterior||u!==t||d!==i||m!==a?(0,V.dialogConfirm)({message:"¿Desea guardar la configuración?"}).then(function(e){if(e){var p={MODO_IMPRESION:t,OCULTAR_CABECERA:i,REPETIR_POSTERIOR:a,TIPO:l};u!==t&&(p.MODO_IMPRESION=t),d!==i&&(p.OCULTAR_CABECERA=i),m!==a&&(p.REPETIR_POSTERIOR=a),s&&n.imagenes.escudo&&(p.CABECERA=n.imagenes.escudo),r&&n.imagenes.frontal&&(p.FRONTAL=n.imagenes.frontal),c&&n.imagenes.posterior&&(p.POSTERIOR=n.imagenes.posterior),x.$http.post("api/HyoConfigcarnets/saveConfig",{info:p}).then(function(e){var t=e.json;(0,w["default"])(n.$t("mensajes."+t.msg),t.type),t.type||(n.imagenes={},n.cargaInicial(),o?n.exportar(!0):n.modalConfiguracion=!1)})}else console.log(o),o?n.exportar(!1):n.modalConfiguracion=!1}):o?this.exportar(!1):this.modalConfiguracion=!1},exportar:function(e){var o=this;if(1===this.tipoCarnet&&this.tablaNemos.registrosSeleccionados.length>0||2===this.tipoCarnet&&this.tablaEstudiantes.registrosSeleccionados.length>0){var n="",t={ano:this.sie.ano,repcod:"carnetAsistenciaQr",tipoCarnet:this.tipoCarnet,modoImpresion:this.modoImpresion};if(1===this.tipoCarnet){var i=this.tablaNemos.registrosSeleccionados.map(function(e){return e.NEMO});n="?nemos="+i.join(","),t.nemos=i}else{var a=this.tablaEstudiantes.registrosSeleccionados.map(function(e){return e.ALUCOD});n="?alucods="+a.join(","),t.alucods=a}if(["reportePdf","reporteExcel"].includes(this.modoImpresion))return void(0,q.exportFilePhp)(t,"webservice/reportes/reporte");if(Object.keys(this.imagenes).length>0&&!e&&Object.keys(this.imagenes).forEach(function(e){if(o.imagenes[e].name){var t=o.imagenes[e].name,i={archivo:t.substring(0,t.lastIndexOf(".")),extension:t.substring(t.lastIndexOf(".")+1,t.length)};n=n+"&"+e+"="+JSON.stringify(i)}}),n=n+"&modo="+this.configuracion.MODO_IMPRESION,this.configuracion.MODO_IMPRESION.indexOf("etiquetas")>=0&&(n=n+"&inicio="+this.inicioEtk),1===this.OCULTAR_CABECERA&&(n+="&ocultaCabecera=S"),this.imagenes["frontal"]&&this.repetirPosterior&&!e){var l=this.imagenes.frontal.name,s={archivo:l.substring(0,l.lastIndexOf(".")),extension:l.substring(l.lastIndexOf(".")+1,l.length)};n=n+"&posterior="+JSON.stringify(s)}var r=this.sie.api+"/HyoAlumnos/generarCarnet"+n+"&token2="+this.sie.token+"&access_token="+this.sie.token;console.log(r),(0,_["default"])(r,"data.html",!0)}},seleccionaSalon:function(e){var o=this;this.tablaEstudiantes.registrosSeleccionados=[],x.$http.get("api/HyoAlumnos/obtAlumnos",{params:{parametros:{aula:e}}}).then(function(e){var n=e.json;o.estudiantes=n})},deleteImagen:function(e){var o=this;x.$http.post("api/HyoConfigcarnets/limpiarImagen",{img:e,modo_impresion:this.configuracion.MODO_IMPRESION}).then(function(n){o.configuracion[e]=null})},subirImagenFinal:function(e,o){var n=this;(0,B.Upload)({url:"api/HyoArchivo/tmp/upload",file:o[0]}).then(function(t){n.imagenes[e]=t,console.log(o,t);var i=t.name,a={archivo:i.substring(0,i.lastIndexOf(".")),extension:i.substring(i.lastIndexOf(".")+1,i.length)};x.$http.post("api/HyoConfigcarnets/codificarImagen",{img:a}).then(function(o){var t=o.json;switch(e){case"escudo":n.configuracion.CABECERA=t;break;case"frontal":n.configuracion.FRONTAL=t;break;case"posterior":n.configuracion.POSTERIOR=t;break}})}).catch(function(){})},addEscudo:function(e){this.subirImagenFinal("escudo",e)},addFrontal:function(e){this.subirImagenFinal("frontal",e)},addPosterior:function(e){this.subirImagenFinal("posterior",e)},cambiarNivel:function(){this.grado="T",this.filtrarData()},cargaInicial:function(){var e=this;x.$http.get("api/HyoConfigcarnets/getDatos",{params:{tipo:1}}).then(function(o){var n=o.json;Object.keys(n).length>0?(n.MODO_IMPRESION_BASE=n.MODO_IMPRESION,n.OCULTAR_CABECERA_BASE=n.OCULTAR_CABECERA,n.REPETIR_POSTERIOR_BASE=n.REPETIR_POSTERIOR,e.configuracion=n):e.configuracion={MODO_IMPRESION:"vertical",OCULTAR_CABECERA:0,CABECERA:null,FRONTAL:null,POSTERIOR:null,REPETIR_POSTERIOR:0,TIPO:1}})},filtrarData:function(){this.salones=Object.assign(this.salonesBase),"T"!==this.nivel&&(this.salones=(0,F.filterArray)(this.nivel,{field:"INSTRUCOD",list:this.salones}),"T"!==this.grado&&(this.salones=(0,F.filterArray)(this.grado,{field:"GRADOCOD",list:this.salones})))}},computed:{todos:function(){var e=this.campos.length===this.items.length;return this.campos.length!==this.items.length&&this.campos.length>0&&(e=null),e}},created:function(){var e=this;this.cargaInicial(),"0076"===this.sie.colcod&&(this.modoImpresionOpciones.push({value:"etiquetasEspecial",label:"Etiquetas Propias"}),this.modoImpresion="etiquetasEspecial",this.maxEtk["etiquetasEspecial"]=21),Promise.all([x.$http.get("api/HyoSalones/listaSalones"),x.$http.get("api/HyoInstrus/obtInstru"),x.$http.get("api/HyoGradoNivs/obtGrados",{params:{agrupado:!0,todos:"T"}})]).then(function(o){e.salonesBase=o[0].json,o[1].json.unshift({INSTRUCOD:"T",INSTRUDES:"Todos"}),e.niveles=o[1].json,e.grados=o[2].json,e.filtrarData()})}}),$=n(12807);const Q=(0,$.A)(j,[["render",y]]);var H=Q}}]);