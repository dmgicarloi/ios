"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[44796],{44796:function(e,o,n){n.r(o),n.d(o,{default:function(){return _}});var r=n(8445),i=n.n(r),a=n(61758),t=n(29104),s={class:"column content-stretch"},l={key:0,class:"row justify-center",style:{"padding-top":"6px"}};function u(e,o){var n=(0,a.g2)("q-icon"),r=(0,a.g2)("q-input"),u=(0,a.g2)("q-btn"),c=(0,a.g2)("router-link"),d=(0,a.g2)("q-form"),m=(0,a.g2)("servicios-login"),p=(0,a.g2)("terminosCondiciones"),f=(0,a.g2)("q-dialog"),g=(0,a.g2)("formPersona"),h=(0,a.g2)("registroExitoso"),b=(0,a.g2)("actualizarCorreo");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(d,{class:"form-login q-pa-sm",ref:"form",onSubmit:(0,t.D$)(e.onLogin,["prevent"]),novalidate:"",autocomplete:"on"},{default:(0,a.k6)(function(){return[e.isMobile?((0,a.uX)(),(0,a.Wv)(r,{key:0,modelValue:e.colnameField,"onUpdate:modelValue":o[0]||(o[0]=function(o){return e.colnameField=o}),placeholder:"Nombre del colegio",rules:[function(e){return e&&e.length>0||"Campo requerido"}],autocomplete:"colname",custom:!1},{prepend:(0,a.k6)(function(){return[(0,a.bF)(n,{class:"icon-login",color:"primary",name:"school"})]}),append:(0,a.k6)(function(){return[(0,a.bF)(n,{class:"icon-login",color:"primary",name:"help_outline",onClick:e.alertColegio},null,8,["onClick"])]}),_:1},8,["modelValue","rules"])):(0,a.Q3)("v-if",!0),(0,a.bF)(r,{ref:"username",modelValue:e.usernameField,"onUpdate:modelValue":o[1]||(o[1]=function(o){return e.usernameField=o}),placeholder:"Usuario",rules:[function(e){return e&&e.length>0||"Campo requerido"}],autocomplete:"username",custom:!1},{prepend:(0,a.k6)(function(){return[(0,a.bF)(n,{class:"icon-login",color:"primary",name:"person"})]}),_:1},8,["modelValue","rules"]),(0,a.bF)(r,{type:e.isPwd?"password":"text",modelValue:e.passwordField,"onUpdate:modelValue":o[3]||(o[3]=function(o){return e.passwordField=o}),placeholder:"Contraseña",rules:[function(e){return e&&e.length>0||"Campo requerido"}],autocomplete:"current-password",maxlength:e.passlength,custom:!1},{prepend:(0,a.k6)(function(){return[(0,a.bF)(n,{class:"icon-login",color:"primary",name:"lock"})]}),append:(0,a.k6)(function(){return[(0,a.bF)(n,{class:"icon-login",color:"primary",name:e.isPwd?"visibility_off":"visibility",onClick:o[2]||(o[2]=function(o){return e.isPwd=!e.isPwd})},null,8,["name"])]}),_:1},8,["type","modelValue","rules","maxlength"]),(0,a.Lk)("div",s,[(0,a.bF)(u,{class:"text-bold",color:"primary",type:"submit"},{default:(0,a.k6)(function(){return i()(o[8]||(o[8]=[(0,a.eW)("Ingresar",-1)]))}),_:1}),"taller"===e.estaller?((0,a.uX)(),(0,a.Wv)(u,{key:0,class:"q-mt-sm text-bold",color:"primary",type:"button",onClick:e.iraTalleres},{default:(0,a.k6)(function(){return i()(o[9]||(o[9]=[(0,a.eW)("Nuevo",-1)]))}),_:1},8,["onClick"])):(0,a.Q3)("v-if",!0),(0,a.bF)(c,{class:"label-login",to:e.recuperacion},{default:(0,a.k6)(function(){return i()(o[10]||(o[10]=[(0,a.eW)("Olvidó su contraseña",-1)]))}),_:1},8,["to"])])]}),_:1},8,["onSubmit"]),e.isLogin&&!e.isMobile?((0,a.uX)(),(0,a.CE)("div",l,[e.isGoogle?((0,a.uX)(),(0,a.Wv)(m,{key:0,"on-sign":e.onSign,type:"_apiGoogle"},null,8,["on-sign"])):(0,a.Q3)("v-if",!0),e.isMicrosoft?((0,a.uX)(),(0,a.Wv)(m,{key:1,"on-sign":e.onSign,type:"_apiOneDrive"},null,8,["on-sign"])):(0,a.Q3)("v-if",!0)])):(0,a.Q3)("v-if",!0),(0,a.bF)(f,{modelValue:e.openModalTerminosYCondiciones,"onUpdate:modelValue":o[4]||(o[4]=function(o){return e.openModalTerminosYCondiciones=o})},{default:(0,a.k6)(function(){return[(0,a.bF)(p,{onAceptoTerminos:e.aceptoTermCondiciones,onClose:e.cerrarTerminos,cancel:""},null,8,["onAceptoTerminos","onClose"])]}),_:1},8,["modelValue"]),(0,a.bF)(f,{modelValue:e.openModalFormPersona,"onUpdate:modelValue":o[5]||(o[5]=function(o){return e.openModalFormPersona=o}),persistent:""},{default:(0,a.k6)(function(){return[(0,a.bF)(g,{siscod:e.siscodTalleres,onCloseModal:e.closeModalFormPersona,onDataPostRegistro:e.getDataPostRegistro,onActualizacionCorreo:e.actualizacionCorreo},null,8,["siscod","onCloseModal","onDataPostRegistro","onActualizacionCorreo"])]}),_:1},8,["modelValue"]),(0,a.bF)(f,{modelValue:e.openModalRegistroExitoso,"onUpdate:modelValue":o[6]||(o[6]=function(o){return e.openModalRegistroExitoso=o})},{default:(0,a.k6)(function(){return[(0,a.bF)(h,{mensaje:e.mensajeExitoso,credentials:e.dataPostRegistro.credentials,onIniciarSesion:e.iniciarSesionTalleres},null,8,["mensaje","credentials","onIniciarSesion"])]}),_:1},8,["modelValue"]),(0,a.bF)(f,{modelValue:e.openModalActualizarCorreo,"onUpdate:modelValue":o[7]||(o[7]=function(o){return e.openModalActualizarCorreo=o})},{default:(0,a.k6)(function(){return[(0,a.bF)(b,{idPersona:e.idPersonaCorreo,onCloseModal:e.closeModalActualizarCorreo},null,8,["idPersona","onCloseModal"])]}),_:1},8,["modelValue"])])}var c=n(76080),d=n.n(c),m=n(57008),p=n.n(m),f=n(45254),g=n.n(f),h=(n(30683),n(10239),n(70199),n(11777),n(515),n(52776),n(81813),n(7346),n(906),n(60858),n(64702),n(53514),n(83972)),b=n(6123),w=n(36153),v=n(54885),k=n(69027),C=n(81288),F=n(34262),M=n(9736),A=n(96303),y=n(2739),P=n(78357),S=n(42205),$=n(49646),T=n(76676),I=n(76458),O=n(97100),E=n(36980);function L(){return V.apply(this,arguments)}function V(){return V=g()(d()().m(function e(){return d()().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,e.n=1,(0,k.dialog)({title:"Permisos",message:"¿Permitir que SieWeb envie notificaciones?",ok:"Permitir",cancel:"Rechazar"});case 1:return e.a(2,!0);case 2:return e.p=2,e.v,e.a(2,!1)}},e,null,[[0,2]])})),V.apply(this,arguments)}var x={setup:function(){var e=(0,h.fG)();return{v$:e}},components:{QIcon:F.A,QInput:M.A,QField:A.A,QForm:y.A,QDialog:S.A,formPersona:$.A,ServiciosLogin:P.A,registroExitoso:I.A,actualizarCorreo:O.A,terminosCondiciones:T.A,QBtn:b.Il},props:{estaller:{type:[String,Number],default:0}},mounted:function(){if("/login"!==this.$route.path){if("/login/taller"===this.$route.path)return;this.$router.push({name:"login"})}},data:function(){return{recuperacion:{name:"login.recuperacion"},nombrecolegio:window.location.hostname?window.location.hostname.split(".")[0]:"dominio",isMobile:C.isMobil,isPwd:!0,isLogin:!1,isGoogle:!1,isMicrosoft:!1,conLogin:!0,openModalTerminosYCondiciones:!1,openModalFormPersona:!1,openModalRegistroExitoso:!1,openModalActualizarCorreo:!1,mensajeExitoso:"",dataPostRegistro:{},idPersonaCorreo:null,siscodTalleres:30}},computed:p()(p()({},(0,E.aH)("login",{colname:function(e){return e.LOGIN.colname},username:function(e){return e.LOGIN.username},password:function(e){return e.LOGIN.password}})),{},{colnameField:{get:function(){return this.colname},set:function(e){this.updateField({form:"LOGIN",path:"colname",value:e})}},usernameField:{get:function(){return this.username},set:function(e){this.updateField({form:"LOGIN",path:"username",value:e})}},passwordField:{get:function(){return this.password},set:function(e){this.updateField({form:"LOGIN",path:"password",value:e})}},passlength:function(){return this.$store.state.usuario.$colegio&&this.$store.state.usuario.$colegio.passlength}}),methods:p()(p()({},(0,E.PY)("login",["updateField"])),{},{getDataColegio:function(){var e=this;return g()(d()().m(function o(){var n;return d()().w(function(o){while(1)switch(o.n){case 0:return o.n=1,e.$http.get("api/HyoColegios/getDataColegio",{params:{params:{fields:["COLCOD"]}}});case 1:return n=o.v,o.a(2,n)}},o)}))()},aceptoTermCondiciones:function(){this.openModalTerminosYCondiciones=!1,this.openModalFormPersona=!0},closeModalFormPersona:function(){this.openModalFormPersona=!1},closeModalActualizarCorreo:function(){this.openModalActualizarCorreo=!1},getDataPostRegistro:function(e){this.dataPostRegistro=e,this.openModalFormPersona=!1,this.openModalRegistroExitoso=!0,this.mensajeExitoso=e.html+"<br><strong>Para mayor seguridad, esta información ha sido enviada a su correo electrónico.</strong><br><br>También puede iniciar sesión directamente con el botón a continuación:</br>"},iniciarSesionTalleres:function(e){var o=this;return g()(d()().m(function n(){return d()().w(function(n){while(1)switch(n.n){case 0:return o.usernameField=e.username,o.passwordField=e.password,n.n=1,o.$nextTick();case 1:return n.n=2,o.submit();case 2:return n.a(2)}},n)}))()},iniciarSesionFromInscripcionAdmision:function(e){var o=this;return g()(d()().m(function n(){return d()().w(function(n){while(1)switch(n.n){case 0:return o.usernameField=e.username,o.passwordField=e.password,n.n=1,o.$nextTick();case 1:return n.n=2,o.submit();case 2:return n.a(2)}},n)}))()},actualizacionCorreo:function(e){this.idPersonaCorreo=e,this.openModalFormPersona=!1,this.openModalActualizarCorreo=!0},iraTalleres:function(){var e=this;return g()(d()().m(function o(){return d()().w(function(o){while(1)switch(o.n){case 0:e.openModalTerminosYCondiciones=!0;case 1:return o.a(2)}},o)}))()},alertColegio:function(){(0,k.swal)("Información","Aquí debe colocar el nombre del colegio. Para mayor información ingresar a la plataforma web de su colegio.")},submit:function(e,o){var n=arguments,r=this;return g()(d()().m(function e(){var i,a,t,s,l,u,c,m,f,g;return d()().w(function(e){while(1)switch(e.p=e.n){case 0:if(i=n.length>2&&void 0!==n[2]?n[2]:{},a=r.$store||i.store,t=r.$router||i.router,o){e.n=3;break}if(r.isMobile||r.conLogin){e.n=1;break}if(-1!==["SIE","sie","SIEWEB","sieweb","demo","DEMO"].indexOf(r.username)){e.n=1;break}return e.a(2,(0,k.swal)("Advertencia","Solo puede ingresar con su cuenta de Microsoft").catch(function(){}));case 1:return e.n=2,r.$refs.form.validate();case 2:if(s=e.v,!0===s){e.n=3;break}return e.a(2,(0,k.swal)("Advertencia","Debe llenar todos los campos").catch(function(){}));case 3:e.p=3,l=!1,e.n=9;break;case 4:if(!C.isMobil){e.n=8;break}if(!o){e.n=5;break}l=!0,e.n=7;break;case 5:return e.n=6,L();case 6:l=e.v;case 7:e.n=9;break;case 8:l=!1;case 9:return w.A.show(),e.n=10,a.dispatch("login/submit",p()({isNotification:l,forced:o},i));case 10:u=e.v,c=u.sistema,m="taller"===r.estaller,localStorage.setItem("esTaller",JSON.stringify({value:Boolean(m)})),c.INTERNO?t.push({name:c.MODULO}):C.isMobil||(window.location.href="".concat(window.location.origin,"/").concat(c.MODULO)),e.n=12;break;case 11:e.p=11,g=e.v,console.error("Error:",g),f="El usuario no existe",g&&g.custom&&(f=g.message),g&&g.error&&g.error.custom&&(f=g.error.message),(0,k.swal)("Advertencia",f).catch(function(){}),w.A.hide();case 12:return e.a(2)}},e,null,[[3,11]])}))()},onLogin:function(){var e=this;return g()(d()().m(function o(){var n,r,i,a,t,s,l;return d()().w(function(o){while(1)switch(o.p=o.n){case 0:return o.p=0,n=e.$store,r=e.$router,o.n=1,n.dispatch("login/getInfo");case 1:if(i=o.v,!(i&&i["2fa"]||n.state.usuario.$colegio["2fa"])){o.n=11;break}return localStorage.setItem("has2fa",JSON.stringify({value:!0})),o.p=2,w.A.show(),o.n=3,n.dispatch("login/get2Fa",{dispatch:n.dispatch});case 3:if(a=o.v,!(a&&a.intentos&&a.intentos.bloqueado)){o.n=4;break}return(0,k.swal)("Error",a.intentos.message).catch(function(){}),w.A.hide(),o.a(2);case 4:if(!a||!a.usuarioBloqueado){o.n=5;break}return(0,k.swal)("Error",a.message).catch(function(){}),w.A.hide(),o.a(2);case 5:if(!a.res2fa||!a.res2fa.activar2fa){o.n=7;break}return a.tryLogin={username:e.username,password:e.password},a.cloud=!(null===n||void 0===n||null===(t=n.state)||void 0===t||null===(t=t.usuario)||void 0===t||null===(t=t.$colegio)||void 0===t||!t.cloud),localStorage.setItem("temp_need2FA",JSON.stringify(a)),o.n=6,r.replace({name:"login.2fa"});case 6:o.n=8;break;case 7:e.submit();case 8:w.A.hide(),o.n=10;break;case 9:o.p=9,s=o.v,console.error(s),w.A.hide();case 10:o.n=12;break;case 11:console.log(" NO tiene 2fa activo"),e.submit();case 12:o.n=14;break;case 13:o.p=13,l=o.v,console.log(l.message),e.submit();case 14:return o.a(2)}},o,null,[[2,9],[0,13]])}))()},onSign:function(e){this.submit({},!0,{email:e})},cerrarTerminos:function(){var e=this;return g()(d()().m(function o(){return d()().w(function(o){while(1)switch(o.n){case 0:e.openModalTerminosYCondiciones=!1;case 1:return o.a(2)}},o)}))()}}),created:function(){var e=this;return g()(d()().m(function o(){var n,r,i,a,t,s,l;return d()().w(function(o){while(1)switch(o.n){case 0:return"taller"===e.estaller&&e.iraTalleres(),o.n=1,e.$http.get("api/login/configLoginExterno");case 1:if(n=o.v,r=n.conLogin,i=n.disponible,a=n.google,t=n.microsoft,e.isLogin=i,e.isGoogle=a,e.isMicrosoft=t,e.conLogin=r,s=e.$route.query&&e.$route.query["sie-token"],"string"!==typeof s||""===s){o.n=2;break}return e.$router.replace({query:{}}),e.submit({},!0,{token:s}),o.a(2);case 2:if(v.A.has("SESSID_GROUP")&&e.submit({},!0),!e.$route.query.esAdmision){o.n=3;break}if(l=JSON.parse(e.$route.query.esAdmision),!l||!l.inscripcion){o.n=3;break}return l.credentials={username:atob(l.username),password:atob(l.password)},o.n=3,e.iniciarSesionFromInscripcionAdmision(l.credentials);case 3:return o.a(2)}},o)}))()}},q=n(12807);const N=(0,q.A)(x,[["render",u]]);var _=N}}]);