"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[7706],{7706:function(t,i,e){e.r(i),e.d(i,{default:function(){return R}});var n=e(8445),o=e.n(n),r=e(61758),s=e(58790);function a(t,i){var e=(0,r.g2)("q-icon"),n=(0,r.g2)("q-item-side"),a=(0,r.g2)("q-item-tile"),u=(0,r.g2)("q-chip"),l=(0,r.g2)("q-item-main"),c=(0,r.g2)("sie-usuario"),d=(0,r.g2)("q-item"),f=(0,r.g2)("q-list"),m=(0,r.g2)("q-card"),h=(0,r.g2)("sie-vacio"),p=(0,r.g2)("ver"),v=(0,r.g2)("q-page");return(0,r.uX)(),(0,r.Wv)(v,{class:"row bg-white-mobile"},{default:(0,r.k6)(function(){return[t.forms.length?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,s.C4)(["overflow-auto",{"col-md-4 col-0":t.id,"col-12":!t.id}])},[(0,r.bF)(m,{class:"q-ma-sm-sm q-card-mobile"},{default:(0,r.k6)(function(){return[(0,r.bF)(f,{class:"q-pa-none",separator:"",link:""},{default:(0,r.k6)(function(){return[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.forms,function(f,m){return(0,r.uX)(),(0,r.Wv)(d,{key:m,onClick:function(i){return t.clickDefault(f.id)},class:(0,s.C4)({"q-item-active":t.id===f.id})},{default:(0,r.k6)(function(){return[(0,r.bF)(n,null,{default:(0,r.k6)(function(){return[(0,r.Lk)("div",{class:"q-item-icon q-item-inverted flex flex-center",style:(0,s.Tr)({"background-color":f.color})},[(0,r.bF)(e,{name:f.icon},null,8,["name"])],4)]}),_:2},1024),(0,r.bF)(l,null,{default:(0,r.k6)(function(){return[(0,r.bF)(a,{label:"",lines:"1"},{default:(0,r.k6)(function(){return[(0,r.eW)((0,s.v_)(f.title),1)]}),_:2},1024),(0,r.bF)(a,{sublabel:"",lines:"1"},{default:(0,r.k6)(function(){return[(0,r.eW)((0,s.v_)(f.subtitle),1)]}),_:2},1024),(0,r.bF)(a,{sublabel:""},{default:(0,r.k6)(function(){return[(0,r.bF)(u,{small:"",color:"secondary"},{default:(0,r.k6)(function(){return o()(i[0]||(i[0]=[(0,r.Lk)("div",null,"Vigente",-1)]))}),_:1})]}),_:1})]}),_:2},1024),f.usucod?((0,r.uX)(),(0,r.Wv)(n,{key:0,right:""},{default:(0,r.k6)(function(){return[(0,r.bF)(c,{usucod:f.usucod},null,8,["usucod"])]}),_:2},1024)):(0,r.Q3)("v-if",!0)]}),_:2},1032,["onClick","class"])}),128))]}),_:1})]}),_:1})],2)):((0,r.uX)(),(0,r.Wv)(h,{key:1,class:(0,s.C4)({"col-md-4 col-0":t.id,"col-12":!t.id}),title:"No existen formularios"},null,8,["class"])),t.id?((0,r.uX)(),(0,r.Wv)(p,{key:2,class:"col-md-8 col-12 q-pa-sm-sm overflow-auto",id:t.id},null,8,["id"])):(0,r.Q3)("v-if",!0)]}),_:1})}e(10239),e(11777);var u=e(80660),l=e(13813),c=e(80340),d=e(6123),f=e(24974),m={class:"column relative-position"};function h(t,i){var e=(0,r.g2)("detail-form"),n=(0,r.g2)("formly"),o=(0,r.g2)("sie-vacio"),s=(0,r.g2)("q-spinner-oval"),a=(0,r.g2)("q-inner-loading");return(0,r.uX)(),(0,r.CE)("div",m,[t.valid?((0,r.uX)(),(0,r.Wv)(n,{key:0,data:t.form,"is-submit":"",onSubmit:t.submit,onStart:t.start,onEnd:t.end},{default:(0,r.k6)(function(){return[t.detail&&t.valid&&t.esOtros?((0,r.uX)(),(0,r.Wv)(e,{key:0,id:t.id},null,8,["id"])):(0,r.Q3)("v-if",!0)]}),_:1},8,["data","onSubmit","onStart","onEnd"])):((0,r.uX)(),(0,r.Wv)(o,{key:1,class:"col",title:t.message,icon:t.icon},null,8,["title","icon"])),(0,r.bF)(a,{visible:t.loading},{default:(0,r.k6)(function(){return[(0,r.bF)(s,{size:"50px",color:"primary"})]}),_:1},8,["visible"])])}var p=e(57668),v=e(982),g=e(57008),b=e.n(g),y=(e(12563),e(70199),e(515),e(83190),e(27153),e(7346),e(99637)),k=e(69027),F=e(78786),O=e(30451),I=function(){return{form:{$errors:{}},model:{},fields:[],title:null,subtitle:null,button:"botones.guardar",time:0,timeTotal:0,final:!0,introduction:!1,continue:!1,secuence:!1,position:1,total:1,progress:!1,type:null,result:null}},$={emits:["start","submit","end"],props:{data:{type:Object,default:function(){return{}}},isSubmit:Boolean},data:function(){return I()},methods:{assignForm:function(t){var i=this,e=b()(b()({},I()),t);(0,y["default"])(e,function(t,e){i[e]=t}),this.message?this.message=this.$t(this.message):this.message=null,this.button?this.button=this.$t(this.button):this.button=null},submit:function(){var t=this;if(this.introduction&&!this.continue||!Array.isArray(this.fields)||!this.fields.length)return this.$emit("start");this.$refs.form.validate().then(function(){if(!t.form.$valid)return Promise.reject(new Error("Formulario incompleto"))}).then(function(){var i=[];(0,y["default"])(t.model,function(e,n){if("string"===typeof n&&n&&parseInt(n)){var o={id:parseInt(n)};if(null==e||""===e)o.value=null;else try{o.value=JSON.parse(JSON.stringify(e))}catch(t){o.value=null}var r=(0,F["default"])(t.fields,function(t){return t.key===n+""});o.options=-1!==r&&!!t.fields[r]&&Object.prototype.hasOwnProperty.call(t.fields[r],"options"),i.push(o)}}),t.$emit("submit",i)}).catch(function(t){(0,k.dialogConfirm)({title:t.message,message:"Revisar y responde correctamente las preguntas enmarcadas en rojo",cancel:!1})})},end:function(){this.$emit("end")}},watch:{data:function(t){this.assignForm(t)}},created:function(){this.data&&this.assignForm(this.data)},render:function(){var t=this,i=[(0,r.h)("div",{},this.title)],e=[(0,r.h)("div",{slot:"subtitle"},this.subtitle)],n=(0,r.h)(d.u0,{class:"col q-pl-sm"},{default:function(){return i},subtitle:function(){return e}});return(0,r.h)(d.C$,{class:"relative-position q-card-mobile"},{default:function(){return[(0,r.h)("div",{class:"row items-center q-pl-sm"},[!!t.type&&(0,r.h)(O.A,{icon:t.type.icon,color:t.type.color,tooltip:t.type.title}),n]),(0,r.h)(d.d6),(0,r.h)(d.d1,{style:"min-height: 160px"},{default:function(){return[(0,r.h)((0,r.$y)("formly-form"),{ref:"form",tag:"div",model:t.model,fields:t.fields,form:t.form}),t.$slots.default?t.$slots.default():[]]}}),(0,r.h)(d.d6),!!t.isSubmit&&!t.final&&(0,r.h)(d.zZ,{class:"justify-center"},{default:function(){return[(0,r.h)(d.Il,{color:"primary",rounded:!0,onClick:t.submit},{default:function(){return t.button}})]}})]}})}},_=e(5106),q="No se puede mostrar el formulario",C="info",T={components:{QInnerLoading:d.SQ,QSpinnerOval:d.VA,sieVacio:c.A,formly:$,detailForm:_.A},props:{id:{type:Number,required:!0},detail:{type:Boolean}},data:function(){return{form:{},loading:!1,valid:!1,esOtros:(0,p["default"])().esOtros,message:q,icon:C}},methods:{buildForm:function(t){var i=this;"number"===typeof t&&0!==t?(this.loading=!0,this.form={},u.$http.get("api/HyoFormulario/getHistory",{params:{id:t,detail:this.detail}}).then(function(t){i.valid=!0,i.loading=!1,i.$nextTick(function(){i.form=t})}).catch(function(t){i.valid=!1,i.loading=!1,t&&t.error&&t.error.params?(i.message=t.error.message||q,t.error.params.success?(i.icon="timer_on",i.valid=!0,i.$nextTick(function(){i.form={error:!0,final:!0,continue:!0,message:i.message,time:t.error.params.time}})):(i.icon="timer_off",i.$nextTick(function(){i.form={}}))):(i.message=q,i.icon=C,i.$nextTick(function(){i.form={}}))})):(this.valid=!1,this.form={})},submit:function(t){var i=this;this.loading=!0;var e=this.form&&this.form.idHistoriaUsuario;this.form={},u.$http.post("api/HyoFormulario/save",{idForm:this.id,idUser:e,fields:t}).then(function(t){i.loading=!1,i.valid=!0,i.$nextTick(function(){i.form=t})}).catch(function(t){i.loading=!1,i.form={}})},start:function(){var t=this;this.loading=!0,u.$http.post("api/HyoFormulario/startForm",{id:this.id}).then(function(i){t.valid=!0,t.loading=!1,t.$nextTick(function(){t.form=i})}).catch(function(i){t.valid=!1,t.loading=!1,t.$nextTick(function(){t.form={}})})},end:function(){var t=this;this.form&&this.form.error?((0,v["default"])("Se cargará el examen","info"),setTimeout(function(){t.buildForm(t.id)},200)):(0,v["default"])("Terminó el examen","info")}},created:function(){this.buildForm(this.id)},watch:{id:function(t){this.buildForm(this.id)}}},Q=e(12807);const S=(0,Q.A)(T,[["render",h]]);var A=S,x={props:{id:{type:Number}},components:{sieVacio:c.A,QChip:d.wQ,sieUsuario:f.A,ver:A,QPage:d.Tu,QCard:d.C$,QList:d.Mb,QItem:d.H0,QItemSide:d.n1,QIcon:d.bP,QItemMain:d.mF,QItemTile:d.lp},data:function(){return{forms:[]}},methods:{getForms:function(){var t=this;this.loadForms=u.$http.get("api/HyoFormulario/obtFormulariosDisponibles",{params:{tipo:3,q:!0}}).catch(function(t){return console.error(t),{json:[]}}).then(function(i){var e=i.json;t.loading=!1,t.forms=(0,l["default"])(e,function(t){return{id:t["ID_HISTORIA_FORMULARIO"],type:t["ID_TIPO_FORMULARIO"],title:t["TITULO"],subtitle:t["DESCRIPCION"],start:t["FORMATO_INICIO"],end:t["FORMATO_FIN"],icon:t["ICONO"],color:t["COLOR"],usucod:!!t["POR_HIJO"]&&t["DEST_USUCOD"]}})})},ver:function(t){this.$router.push({name:"intranet.sugerencias",params:{id:t}})},clickDefault:function(t){this.ver(t)}},created:function(){this.getForms()}};const w=(0,Q.A)(x,[["render",a]]);var R=w}}]);