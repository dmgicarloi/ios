"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[17570],{17570:function(e,n,o){o.r(n),o.d(n,{default:function(){return j}});var t=o(61758),r=o(58790),i={class:"absolute-full bg-white z-max flex flex-center"},a={class:"step-header text-center"},s={class:"text-grey-7"},c={class:"verification-code-container q-mb-md"},u={class:"verification-code-inputs"},l={class:"otp-boxes"},d={class:"row q-col-gutter-md"},f={class:"col-xs-12"},h={class:"row q-mt-md justify-center"},m={class:"row q-col-gutter-md"},p={class:"col-xs-12"},g={class:"row q-col-gutter-md"},v={class:"col-xs-12 q-mt-xl"};function w(e,n){var o=(0,t.g2)("q-card-section"),w=(0,t.g2)("q-btn"),b=(0,t.g2)("q-chip"),C=(0,t.g2)("q-card"),A=(0,t.g2)("q-form");return(0,t.uX)(),(0,t.CE)("div",i,[(0,t.bF)(A,{modelValue:e.fomValidate,"onUpdate:modelValue":n[2]||(n[2]=function(n){return e.fomValidate=n}),onSubmit:e.validateCode},{default:(0,t.k6)(function(){return[(0,t.bF)(C,{class:"q-px-md q-py-lg",style:{width:"100%","max-width":"400px","background-color":"#fff"},flat:""},{default:(0,t.k6)(function(){return[(0,t.bF)(o,null,{default:(0,t.k6)(function(){return[(0,t.Lk)("div",a,[n[3]||(n[3]=(0,t.Lk)("h4",{class:"q-my-lg text-weight-bold"},"Validación de seguridad",-1)),(0,t.Lk)("p",s,"Por favor, introduzca el código de seguridad enviado a "+(0,r.v_)(e.correoSeguro)+".",1)])]}),_:1}),(0,t.bF)(o,null,{default:(0,t.k6)(function(){return[(0,t.Lk)("div",c,[(0,t.Lk)("div",u,[(0,t.Lk)("div",{class:"otp-wrapper",onClick:n[1]||(n[1]=function(){return e.focusInput&&e.focusInput.apply(e,arguments)})},[(0,t.Lk)("input",{class:"hidden-input",ref:"hiddenInput",type:"tel",inputmode:"numeric",maxlength:"6",onInput:n[0]||(n[0]=function(){return e.onInput&&e.onInput.apply(e,arguments)}),id:"validateCode"},null,544),(0,t.Lk)("div",l,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(e.length,function(n){return(0,t.uX)(),(0,t.CE)("span",{key:n,class:(0,r.C4)(["otp-box",{active:n===e.otp.length+1}])},(0,r.v_)(e.otp[n-1]||""),3)}),128))])])])])]}),_:1}),(0,t.bF)(o,null,{default:(0,t.k6)(function(){return[(0,t.Lk)("div",d,[(0,t.Lk)("div",f,[(0,t.bF)(w,{class:"full-width q-py-sm text-weight-medium",label:"Confirmar código",color:"primary",disable:!e.isCountdownActive,type:"submit"},null,8,["disable"])])])]}),_:1}),(0,t.bF)(o,null,{default:(0,t.k6)(function(){return[(0,t.Lk)("div",h,[(0,t.bF)(b,{icon:"timer",color:e.isCountdownActive?"primary":"negative","text-color":"white",outline:""},{default:(0,t.k6)(function(){return[(0,t.eW)((0,r.v_)(e.isCountdownActive?"Expira en "+e.countdown+" minutos":"Código expirado"),1)]}),_:1},8,["color"])])]}),_:1}),e.isCountdownActive?(0,t.Q3)("v-if",!0):((0,t.uX)(),(0,t.Wv)(o,{key:0},{default:(0,t.k6)(function(){return[(0,t.Lk)("div",m,[n[4]||(n[4]=(0,t.Lk)("div",{class:"col-xs-12 text-center"},[(0,t.Lk)("p",{class:"text-grey-7"},"¿No recibiste el código?")],-1)),(0,t.Lk)("div",p,[(0,t.bF)(w,{class:"full-width",flat:"",color:"primary",label:"Reenviar código",disable:e.isCountdownActive,onClick:e.resendCode},null,8,["disable","onClick"])])])]}),_:1})),(0,t.bF)(o,null,{default:(0,t.k6)(function(){return[(0,t.Lk)("div",g,[(0,t.Lk)("div",v,[(0,t.bF)(w,{class:"q-ml-none full-width",flat:"",dense:"","no-caps":"",color:"grey",icon:"arrow_back",label:"Volver al login",onClick:e.goToLogin,type:"submit"},null,8,["onClick"])])])]}),_:1})]}),_:1})]}),_:1},8,["modelValue","onSubmit"])])}var b=o(76080),C=o.n(b),A=o(45254),k=o.n(A),F=(o(30683),o(23513),o(515),o(52776),o(81813),o(7346),o(6123)),S=o(36153),L=o(69027),I=o(57008),y=o.n(I),$=(o(10239),o(70199),o(11777),o(906),o(60858),o(64702),o(53514),o(83972)),D=o(54885),x=o(81288),E=o(34262),M=o(9736),O=o(96303),q=o(2739),T=o(78357),N=o(42205),P=o(49646),U=o(76676),_=o(76458),G=o(97100),R=o(36980);function Q(){return z.apply(this,arguments)}function z(){return z=k()(C()().m(function e(){return C()().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,e.n=1,(0,L.dialog)({title:"Permisos",message:"¿Permitir que SieWeb envie notificaciones?",ok:"Permitir",cancel:"Rechazar"});case 1:return e.a(2,!0);case 2:return e.p=2,e.v,e.a(2,!1)}},e,null,[[0,2]])})),z.apply(this,arguments)}var V={setup:function(){var e=(0,$.fG)();return{v$:e}},components:{QIcon:E.A,QInput:M.A,QField:O.A,QForm:q.A,QDialog:N.A,formPersona:P.A,ServiciosLogin:T.A,registroExitoso:_.A,actualizarCorreo:G.A,terminosCondiciones:U.A,QBtn:F.Il},props:{estaller:{type:[String,Number],default:0}},mounted:function(){if("/login"!==this.$route.path){if("/login/taller"===this.$route.path)return;this.$router.push({name:"login"})}},data:function(){return{recuperacion:{name:"login.recuperacion"},nombrecolegio:window.location.hostname?window.location.hostname.split(".")[0]:"dominio",isMobile:x.isMobil,isPwd:!0,isLogin:!1,isGoogle:!1,isMicrosoft:!1,conLogin:!0,openModalTerminosYCondiciones:!1,openModalFormPersona:!1,openModalRegistroExitoso:!1,openModalActualizarCorreo:!1,mensajeExitoso:"",dataPostRegistro:{},idPersonaCorreo:null,siscodTalleres:30}},computed:y()(y()({},(0,R.aH)("login",{colname:function(e){return e.LOGIN.colname},username:function(e){return e.LOGIN.username},password:function(e){return e.LOGIN.password}})),{},{colnameField:{get:function(){return this.colname},set:function(e){this.updateField({form:"LOGIN",path:"colname",value:e})}},usernameField:{get:function(){return this.username},set:function(e){this.updateField({form:"LOGIN",path:"username",value:e})}},passwordField:{get:function(){return this.password},set:function(e){this.updateField({form:"LOGIN",path:"password",value:e})}},passlength:function(){return this.$store.state.usuario.$colegio&&this.$store.state.usuario.$colegio.passlength}}),methods:y()(y()({},(0,R.PY)("login",["updateField"])),{},{getDataColegio:function(){var e=this;return k()(C()().m(function n(){var o;return C()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,e.$http.get("api/HyoColegios/getDataColegio",{params:{params:{fields:["COLCOD"]}}});case 1:return o=n.v,n.a(2,o)}},n)}))()},aceptoTermCondiciones:function(){this.openModalTerminosYCondiciones=!1,this.openModalFormPersona=!0},closeModalFormPersona:function(){this.openModalFormPersona=!1},closeModalActualizarCorreo:function(){this.openModalActualizarCorreo=!1},getDataPostRegistro:function(e){this.dataPostRegistro=e,this.openModalFormPersona=!1,this.openModalRegistroExitoso=!0,this.mensajeExitoso=e.html+"<br><strong>Para mayor seguridad, esta información ha sido enviada a su correo electrónico.</strong><br><br>También puede iniciar sesión directamente con el botón a continuación:</br>"},iniciarSesionTalleres:function(e){var n=this;return k()(C()().m(function o(){return C()().w(function(o){while(1)switch(o.n){case 0:return n.usernameField=e.username,n.passwordField=e.password,o.n=1,n.$nextTick();case 1:return o.n=2,n.submit();case 2:return o.a(2)}},o)}))()},iniciarSesionFromInscripcionAdmision:function(e){var n=this;return k()(C()().m(function o(){return C()().w(function(o){while(1)switch(o.n){case 0:return n.usernameField=e.username,n.passwordField=e.password,o.n=1,n.$nextTick();case 1:return o.n=2,n.submit();case 2:return o.a(2)}},o)}))()},actualizacionCorreo:function(e){this.idPersonaCorreo=e,this.openModalFormPersona=!1,this.openModalActualizarCorreo=!0},iraTalleres:function(){var e=this;return k()(C()().m(function n(){return C()().w(function(n){while(1)switch(n.n){case 0:e.openModalTerminosYCondiciones=!0;case 1:return n.a(2)}},n)}))()},alertColegio:function(){(0,L.swal)("Información","Aquí debe colocar el nombre del colegio. Para mayor información ingresar a la plataforma web de su colegio.")},submit:function(e,n){var o=arguments,t=this;return k()(C()().m(function e(){var r,i,a,s,c,u,l,d,f,h;return C()().w(function(e){while(1)switch(e.p=e.n){case 0:if(r=o.length>2&&void 0!==o[2]?o[2]:{},i=t.$store||r.store,a=t.$router||r.router,n){e.n=3;break}if(t.isMobile||t.conLogin){e.n=1;break}if(-1!==["SIE","sie","SIEWEB","sieweb","demo","DEMO"].indexOf(t.username)){e.n=1;break}return e.a(2,(0,L.swal)("Advertencia","Solo puede ingresar con su cuenta de Microsoft").catch(function(){}));case 1:return e.n=2,t.$refs.form.validate();case 2:if(s=e.v,!0===s){e.n=3;break}return e.a(2,(0,L.swal)("Advertencia","Debe llenar todos los campos").catch(function(){}));case 3:e.p=3,c=!1,e.n=9;break;case 4:if(!x.isMobil){e.n=8;break}if(!n){e.n=5;break}c=!0,e.n=7;break;case 5:return e.n=6,Q();case 6:c=e.v;case 7:e.n=9;break;case 8:c=!1;case 9:return S.A.show(),e.n=10,i.dispatch("login/submit",y()({isNotification:c,forced:n},r));case 10:u=e.v,l=u.sistema,d="taller"===t.estaller,localStorage.setItem("esTaller",JSON.stringify({value:Boolean(d)})),l.INTERNO?a.push({name:l.MODULO}):x.isMobil||(window.location.href="".concat(window.location.origin,"/").concat(l.MODULO)),e.n=12;break;case 11:e.p=11,h=e.v,console.error("Error:",h),f="El usuario no existe",h&&h.custom&&(f=h.message),h&&h.error&&h.error.custom&&(f=h.error.message),(0,L.swal)("Advertencia",f).catch(function(){}),S.A.hide();case 12:return e.a(2)}},e,null,[[3,11]])}))()},onLogin:function(){var e=this;return k()(C()().m(function n(){var o,t,r,i,a,s,c;return C()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,o=e.$store,t=e.$router,n.n=1,o.dispatch("login/getInfo");case 1:if(r=n.v,!(r&&r["2fa"]||o.state.usuario.$colegio["2fa"])){n.n=11;break}return localStorage.setItem("has2fa",JSON.stringify({value:!0})),n.p=2,S.A.show(),n.n=3,o.dispatch("login/get2Fa",{dispatch:o.dispatch});case 3:if(i=n.v,!(i&&i.intentos&&i.intentos.bloqueado)){n.n=4;break}return(0,L.swal)("Error",i.intentos.message).catch(function(){}),S.A.hide(),n.a(2);case 4:if(!i||!i.usuarioBloqueado){n.n=5;break}return(0,L.swal)("Error",i.message).catch(function(){}),S.A.hide(),n.a(2);case 5:if(!i.res2fa||!i.res2fa.activar2fa){n.n=7;break}return i.tryLogin={username:e.username,password:e.password},i.cloud=!(null===o||void 0===o||null===(a=o.state)||void 0===a||null===(a=a.usuario)||void 0===a||null===(a=a.$colegio)||void 0===a||!a.cloud),localStorage.setItem("temp_need2FA",JSON.stringify(i)),n.n=6,t.replace({name:"login.2fa"});case 6:n.n=8;break;case 7:e.submit();case 8:S.A.hide(),n.n=10;break;case 9:n.p=9,s=n.v,console.error(s),S.A.hide();case 10:n.n=12;break;case 11:console.log(" NO tiene 2fa activo"),e.submit();case 12:n.n=14;break;case 13:n.p=13,c=n.v,console.log(c.message),e.submit();case 14:return n.a(2)}},n,null,[[2,9],[0,13]])}))()},onSign:function(e){this.submit({},!0,{email:e})},cerrarTerminos:function(){var e=this;return k()(C()().m(function n(){return C()().w(function(n){while(1)switch(n.n){case 0:e.openModalTerminosYCondiciones=!1;case 1:return n.a(2)}},n)}))()}}),created:function(){var e=this;return k()(C()().m(function n(){var o,t,r,i,a,s,c;return C()().w(function(n){while(1)switch(n.n){case 0:return"taller"===e.estaller&&e.iraTalleres(),n.n=1,e.$http.get("api/login/configLoginExterno");case 1:if(o=n.v,t=o.conLogin,r=o.disponible,i=o.google,a=o.microsoft,e.isLogin=r,e.isGoogle=i,e.isMicrosoft=a,e.conLogin=t,s=e.$route.query&&e.$route.query["sie-token"],"string"!==typeof s||""===s){n.n=2;break}return e.$router.replace({query:{}}),e.submit({},!0,{token:s}),n.a(2);case 2:if(D.A.has("SESSID_GROUP")&&e.submit({},!0),!e.$route.query.esAdmision){n.n=3;break}if(c=JSON.parse(e.$route.query.esAdmision),!c||!c.inscripcion){n.n=3;break}return c.credentials={username:atob(c.username),password:atob(c.password)},n.n=3,e.iniciarSesionFromInscripcionAdmision(c.credentials);case 3:return n.a(2)}},n)}))()}},B=o(80660),J=o(95051),Y={name:"TwoFactorAuth",components:{QChip:J.A,QForm:q.A,QCard:F.C$,QBtn:F.Il},data:function(){return{campoSelect:null,isCodeSent:!1,correoSeguro:"",device:{},length:6,values:[0,1,2,3,4,5],countdownSeconds:0,timer:null,intetosCodigoSeguro:0,isCountdownActive:!1,curretUSUCOD:"",$router:this.$router,fomValidate:null,need2FAData:{},otp:""}},computed:{countdown:function(){var e=Math.floor(this.countdownSeconds/60),n=this.countdownSeconds%60;return"".concat(e,":").concat(n<10?"0":"").concat(n)}},methods:{dataToUpperCase:function(){this.$store&&this.$store.state.login.LOGIN.username&&(this.curretUSUCOD=this.$store.state.login.LOGIN.username.toUpperCase())},focusInput:function(){this.$refs.hiddenInput.focus()},onInput:function(e){var n=e.target.value.replace(/\D/g,"").slice(0,6);this.otp=n,e.target.value=n},getCurrentEmail:function(){var e=this;return k()(C()().m(function n(){return C()().w(function(n){while(1)switch(n.n){case 0:if(!e.need2FAData||!e.need2FAData.correoUsuario){n.n=1;break}return e.correoSeguro=e.need2FAData.correoUsuario,n.a(2,!0);case 1:return e.goToLogin(),n.a(2,!1);case 2:return n.a(2)}},n)}))()},verificaCodigoGenerado:function(){if(this.need2FAData&&this.need2FAData.enviarCorreo&&this.need2FAData.enviarCorreo.ok){var e=this.need2FAData.intentos?this.need2FAData.intentos.message:"Codigo enviado";return this.intetosCodigoSeguro=this.need2FAData.intentos?this.need2FAData.intentos.data[0].intentos:0,{success:!0,message:e}}return{success:!1,message:"No se pudo enviar el código de seguridad"}},verificaCorreoEnviado:function(){var e="Se ha enviado un código de seguridad a: ".concat(this.correoSeguro,".");this.intetosCodigoSeguro>=3&&(e="".concat(e,"  Recuerde que tiene un máximo de 5 intentos.")),(0,L.swal)("Éxito",e)},enviarCorreoConfirmacion:function(){var e=this;return k()(C()().m(function n(){var o,t;return C()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,o={type:"correoConfirmacion",usucod:e.curretUSUCOD,correoDestino:e.correoSeguro},n.n=1,B.$http.post("api/UsuarioController/sendCorreo",{params:o});case 1:n.n=3;break;case 2:return n.p=2,t=n.v,console.error("Error al enviar código seguro:",t),n.a(2,{success:!1});case 3:return n.a(2)}},n,null,[[0,2]])}))()},iniciarCuentaRegresiva:function(){this.isCodeSent=!0,this.startCountdown()},verificaCodigoEnviado:function(){var e=this;return k()(C()().m(function n(){return C()().w(function(n){while(1)switch(n.n){case 0:S.A.show();try{e.getCurrentEmail(),e.verificaCodigoGenerado(),e.verificaCorreoEnviado(),e.iniciarCuentaRegresiva(),S.A.hide()}catch(e){console.error(e),(0,L.swal)("Error","No se pudo enviar el código de seguridad").catch(function(){}),S.A.hide()}case 1:return n.a(2)}},n)}))()},validarCodigo:function(){var e=this;return k()(C()().m(function n(){var o,t;return C()().w(function(n){while(1)switch(n.p=n.n){case 0:return o={usucod:e.curretUSUCOD,code:e.$refs.hiddenInput.value,email:e.correoSeguro},e.need2FAData.cloud&&(o.cloud=!0),n.p=1,n.a(2,B.$http.post("api/ControlLoginController/verify2FA",{params:o}));case 2:return n.p=2,t=n.v,console.error("Error al validar código seguro:",t),n.a(2,{success:!1})}},n,null,[[1,2]])}))()},validateCode:function(){var e=this;return k()(C()().m(function n(){var o,t,r,i;return C()().w(function(n){while(1)switch(n.p=n.n){case 0:if(o=e.$refs.hiddenInput.value,o.length===e.length){n.n=1;break}return n.a(2,(0,L.swal)("Advertencia","Por favor, complete todos los dígitos del código").catch(function(){}));case 1:return n.p=1,n.n=2,e.validarCodigo();case 2:t=n.v,!0===t.success?V.methods.submit({},!0,{store:e.$store,router:e.$router}):(r=t.message,(0,L.swal)("Error",r).catch(function(){})),n.n=4;break;case 3:return n.p=3,i=n.v,(0,L.swal)("Advertencia",i.message||"Codigo incorrecto").catch(function(){}),console.error("Error al validar código seguro:",i),n.a(2,{success:!1});case 4:return n.a(2)}},n,null,[[1,3]])}))()},resendCode:function(){var e=this;return k()(C()().m(function n(){var o,t,r,i;return C()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,e.intetosCodigoSeguro>=3&&(0,L.swal)("Advertencia","Recuerde que tiene un máximo de 5 intentos para validar su código de seguridad.").catch(function(){}),S.A.show(),e.clearInput(),o={pass:e.need2FAData.tryLogin.password,user:e.need2FAData.tryLogin.username,device:e.device.id,cloud:e.need2FAData.cloud},n.n=1,B.$http.post("api/ControlLoginController/login2FA",o);case 1:t=n.v,e.need2FAData=t,e.verificaCodigoEnviado(),e.isCodeSent=!0,e.startCountdown(),S.A.hide(),n.n=3;break;case 2:n.p=2,i=n.v,S.A.hide(),r=i.message||"No se pudo enviar el código",(0,L.swal)("Error",r).catch(function(){});case 3:return n.a(2)}},n,null,[[0,2]])}))()},clearInput:function(){this.$refs.hiddenInput.value="",this.otp=""},startCountdown:function(){var e=this,n=Date.now();this.countdownSeconds=300,this.isCountdownActive=!0,this._countdownTarget=n+1e3*this.countdownSeconds,clearInterval(this.timer),this.timer=setInterval(function(){var n=Date.now(),o=Math.max(0,Math.round((e._countdownTarget-n)/1e3));e.countdownSeconds=o,o<=0&&(clearInterval(e.timer),e.isCountdownActive=!1,e.countdownSeconds=0)},1e3)},goToLogin:function(){this.$router.replace({name:"login"})}},mounted:function(){this.device=(0,x.getDeviceInfo)(),this.need2FAData=JSON.parse(localStorage.getItem("temp_need2FA")||"{}"),this.need2FAData.cloud=!!this.need2FAData.cloud,this.dataToUpperCase(),this.verificaCodigoEnviado()},beforeDestroy:function(){clearInterval(this.timer),this.goToLogin()}},W=o(12807);const X=(0,W.A)(Y,[["render",w]]);var j=X}}]);