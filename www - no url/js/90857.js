"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[90857],{90857:function(e,t,n){n.r(t),n.d(t,{default:function(){return G}});var o=n(8445),i=n.n(o),a=n(61758),r=n(58790),l={class:"row q-pa-sm"},s={class:"col-xs-12 col-md-4"},c={class:"col-xs-12 col-md-8"},u={class:"col column"},d={key:0,class:"row q-px-sm"},f={class:"col-xs-12"},m={class:"row q-px-sm q-pt-sm"},g={class:"col-xs-12"},b={class:"row q-px-sm q-pt-sm"},p={class:"col-xs-12"};function h(e,t){var n=(0,a.g2)("q-toolbar-title"),o=(0,a.g2)("q-toolbar"),h=(0,a.g2)("q-select"),v=(0,a.g2)("q-spinner-oval"),A=(0,a.g2)("q-inner-loading"),S=(0,a.g2)("q-input"),I=(0,a.g2)("q-field"),k=(0,a.g2)("q-popup-edit"),O=(0,a.g2)("q-td"),C=(0,a.g2)("q-chip"),N=(0,a.g2)("q-table"),D=(0,a.g2)("sie-vacio"),T=(0,a.g2)("q-tooltip"),$=(0,a.g2)("q-fab-action"),M=(0,a.g2)("q-fab"),_=(0,a.g2)("q-page-sticky"),y=(0,a.g2)("q-tree"),F=(0,a.g2)("sie-modal"),R=(0,a.g2)("q-page");return(0,a.uX)(),(0,a.Wv)(R,{class:"bg-white"},{default:(0,a.k6)(function(){return[(0,a.bF)(o,{class:"shadow-2 z-fab",inverted:""},{default:(0,a.k6)(function(){return[(0,a.bF)(n,{class:"q-pa-none"},{default:(0,a.k6)(function(){return i()(t[5]||(t[5]=[(0,a.eW)("Creación de Ambitos",-1)]))}),_:1})]}),_:1}),(0,a.Lk)("div",l,[(0,a.Lk)("div",s,[(0,a.bF)(h,{class:"q-if-outlined",multiple:"",color:"secondary",modelValue:e.vmFiltro.instrucod,options:e.dataSelect.nivel,"float-label":e.$t("ngs.nivel"),onChange:e.seleccionaInstru,filter:""},null,8,["modelValue","options","float-label","onChange"])]),(0,a.Lk)("div",c,[(0,a.bF)(h,{class:"q-if-outlined",multiple:"",modelValue:e.vmFiltro.gradocod,options:e.grados,"float-label":e.$t("ngs.grado"),onChange:e.seleccionaGrado,filter:""},null,8,["modelValue","options","float-label","onChange"])])]),(0,a.Lk)("div",u,[(0,a.bF)(A,{visible:e.loadingDetalle},{default:(0,a.k6)(function(){return[(0,a.bF)(v,{size:"50px",color:"primary"})]}),_:1},8,["visible"]),e.dataAmbito.length>0?((0,a.uX)(),(0,a.CE)("div",d,[(0,a.Lk)("div",f,[(0,a.bF)(N,{"table-style":"height: 58vh",selection:e.configTblAmbito.tipoSeleccion,"row-key":"ID_AMBITO",color:"secondary",data:e.dataAmbito,columns:e.configTblAmbito.columnas,selected:e.configTblAmbito.registrosSeleccionados,"onUpdate:selected":t[0]||(t[0]=function(t){return e.configTblAmbito.registrosSeleccionados=t}),"visible-columns":e.configTblAmbito.columnasVisibles,pagination:e.configTblAmbito.paginacion,"onUpdate:pagination":t[1]||(t[1]=function(t){return e.configTblAmbito.paginacion=t})},{"body-cell-DESCRIPCION":(0,a.k6)(function(t){return[(0,a.bF)(O,{props:t},{default:(0,a.k6)(function(){return[(0,a.eW)((0,r.v_)(t.value),1),(0,a.bF)(k,{modelValue:t.row.DESCRIPCION,"onUpdate:modelValue":function(e){return t.row.DESCRIPCION=e},onSave:function(n){return e.actualizar(t.row)}},{default:(0,a.k6)(function(){return[(0,a.bF)(I,{count:100},{default:(0,a.k6)(function(){return[(0,a.bF)(S,{modelValue:t.row.DESCRIPCION,"onUpdate:modelValue":function(e){return t.row.DESCRIPCION=e},maxlength:"100"},null,8,["modelValue","onUpdate:modelValue"])]}),_:2},1024)]}),_:2},1032,["modelValue","onUpdate:modelValue","onSave"])]}),_:2},1032,["props"])]}),"body-cell-SALON":(0,a.k6)(function(e){return[(0,a.bF)(O,{props:e},{default:(0,a.k6)(function(){return[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.value.split(","),function(e,t){return(0,a.uX)(),(0,a.Wv)(C,{class:"q-mr-lg-sm",small:"",color:"secondary"},{default:(0,a.k6)(function(){return[(0,a.eW)((0,r.v_)(e),1)]}),_:2},1024)}),256))]}),_:2},1032,["props"])]}),_:1},8,["selection","data","columns","selected","visible-columns","pagination"])])])):((0,a.uX)(),(0,a.Wv)(D,{key:1,icon:"settings_applications"}))]),(0,a.bF)(_,{position:"bottom-right",offset:[20,20]},{default:(0,a.k6)(function(){return[(0,a.bF)(M,{icon:"more_vert",direction:"up",color:"secondary"},{default:(0,a.k6)(function(){return[e.sie.ruta.nivel>=2?((0,a.uX)(),(0,a.Wv)($,{key:0,color:"secondary",icon:"plus",onClick:e.modalAgregarAmbito},{default:(0,a.k6)(function(){return[(0,a.bF)(T,{anchor:"center left",self:"center right",offset:[5,0]},{default:(0,a.k6)(function(){return[(0,a.eW)((0,r.v_)(e.$t("botones.agregar")),1)]}),_:1})]}),_:1},8,["onClick"])):(0,a.Q3)("v-if",!0),e.sie.ruta.nivel>=3?((0,a.uX)(),(0,a.Wv)($,{key:1,color:"secondary",icon:"delete",onClick:e.eliminarAmbito},{default:(0,a.k6)(function(){return[(0,a.bF)(T,{anchor:"center left",self:"center right",offset:[5,0]},{default:(0,a.k6)(function(){return[(0,a.eW)((0,r.v_)(e.$t("botones.eliminar")),1)]}),_:1})]}),_:1},8,["onClick"])):(0,a.Q3)("v-if",!0)]}),_:1})]}),_:1}),(0,a.bF)(F,{class:"modal-agregar",modelValue:e.openModal.agregar,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.openModal.agregar=t}),title:"Agregar",header:!0,footer:e.sie.ruta.nivel>=2,ok:e.$t("botones.guardar"),loading:e.loadingModal,onSubmit:e.grabarAmbito},{default:(0,a.k6)(function(){return[(0,a.Lk)("div",m,[(0,a.Lk)("div",g,[(0,a.bF)(I,{error:e.v$.formAmbito.descripcion.$error,"error-label":e.$t("validaciones.requerido")},{default:(0,a.k6)(function(){return[(0,a.bF)(S,{class:"q-if-outlined",modelValue:e.formAmbito.descripcion,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.formAmbito.descripcion=t}),"float-label":e.$t("matricula.descripcion"),onBlur:e.v$.formAmbito.descripcion.$touch},null,8,["modelValue","float-label","onBlur"])]}),_:1},8,["error","error-label"])])]),(0,a.Lk)("div",b,[(0,a.Lk)("div",p,[(0,a.Lk)("p",null,(0,r.v_)(e.$t("validaciones.seleccioneSalon")),1),(0,a.bF)(y,{nodes:e.treeSalones,"tick-strategy":"leaf",color:"secondary",ticked:e.vmModal.salones,"onUpdate:ticked":t[3]||(t[3]=function(t){return e.vmModal.salones=t}),"node-key":"ID","label-key":"NAME","default-expand-all":""},null,8,["nodes","ticked"])])])]}),_:1},8,["modelValue","footer","ok","loading","onSubmit"])]}),_:1})}var v=n(99550),A=n.n(v),S=(n(71225),n(23825),n(10239),n(50310),n(5962),n(9240),n(83190),n(27153),n(66307),n(68017),n(24066),n(83972)),I=n(6123),k=n(52220),O=n(76080),C=n.n(O),N=n(45254),D=n.n(N),T=n(80660),$=n(99637),M={getSalones:function(e){return T.$http.get("api/HyoSalones/getPeriodoSalon",{params:{ano:e}})},getNiveles:function(){return T.$http.get("api/HyoInstrus/obtInstru").then(function(e){var t=e.json;return t}).catch(function(){return[]})},getGrados:function(){return T.$http.get("api/HyoGradoNivs/obtGrados").then(function(e){var t=e.json;return t}).catch(function(){return[]})},getSecciones:function(){return T.$http.get("api/HyoSalones/listaSalones").then(function(e){var t=e.json;return t}).catch(function(){return[]})},getListaAmbito:function(){var e=D()(C()().m(function e(){var t,n;return C()().w(function(e){while(1)switch(e.n){case 0:return e.n=1,T.$http.get("api/HyoAmbito/obtListar",{params:{soloGrupal:!0}});case 1:return t=e.v,n=t.json,e.a(2,n)}},e)}));function t(){return e.apply(this,arguments)}return t}(),defaultData:function(){return{ID_AMBITO:0,GRUPAL:0,descripcion:""}},getTreeSalones:function(){var e=D()(C()().m(function e(){var t,n,o;return C()().w(function(e){while(1)switch(e.n){case 0:return e.n=1,T.$http.get("api/HyoBanner/listaTreeDirigido");case 1:return t=e.v,n=t.json[0],o=[],(0,$["default"])(n,function(e){var t=[];(0,$["default"])(e.children,function(n){var o=[];(0,$["default"])(n.children,function(e){o.push({NAME:e.NAME,ID:e.NEMO,TIPO:"SALON",checked:!1,children:[]})}),t.push({NAME:n.NAME,ID:e.INSTRUCOD+n.GRADOCOD,TIPO:"GRADO",checked:!1,children:o})}),o.push({NAME:e.NAME,ID:e.INSTRUCOD,TIPO:"NIVEL",checked:!1,children:t})}),e.a(2,o)}},e)}));function t(){return e.apply(this,arguments)}return t}(),grabarAmbito:function(e,t){return T.$http.post("api/HyoAmbito/crearAmbito",{descripcion:e,salones:t})},actualizarAmbito:function(e,t){return T.$http.post("api/HyoAmbito/actualizarAmbito",{idAmbito:e,descripcion:t})},eliminarAmbito:function(e){return T.$http.post("api/HyoAmbito/eliminarAmbito",{idAmbito:e}).then(function(e){var t=e.json;return t}).catch(function(e){return e})}},_=n(30640),y=n(93616),F=n(57668),R=n(80340),E=n(13813),P=n(69027),q=n(82640),L=n(982),Q=n(33001),w={setup:function(){var e=(0,S.fG)();return{v$:e}},components:{QCard:I.C$,QPopover:I.VM,QSearch:I.Ks,QModalLayout:I.hT,QChip:I.wQ,QTree:k.A,QCheckbox:I.vZ,QPageSticky:I._U,QInnerLoading:I.SQ,QSpinnerOval:I.VA,QToggle:I.c5,QFab:I.l6,QFabAction:I.B$,QSelect:I.Si,QTr:I.qh,QTd:I.Ef,QPopupEdit:I.GT,sieModal:_.A,sieSelect:y.A,sieVacio:R.A,QPage:I.Tu,QToolbar:I.ZV,QToolbarTitle:I.r_,QTable:I.kH,QField:I.Om,QInput:I.ie,QTooltip:I.nC},data:function(){return{sie:(0,F["default"])(),vmFiltro:{ambito:[],instrucod:[],gradocod:[],seccioncod:null},dataSelect:{ambito:[],nivel:[],grado:[],seccion:[]},openModal:{agregar:!1},vmModal:{salones:[]},treeSalones:[],configTblAmbito:{},gradosTemp:[],loadingDetalle:!1,loadingModal:!1,formAmbito:M.defaultData(),salones:[]}},computed:{grados:function(){var e=this,t=this.gradosTemp;return this.vmFiltro["instrucod"].length>0?(t=t.filter(function(t){return e.vmFiltro["instrucod"].some(function(e){return t.INSTRUCOD===e})}),t=(0,E["default"])(t,function(e){return{label:e.GRADODES,value:e.INSTRUCOD+e.GRADOCOD}})):t=[],t},dataAmbito:function(){var e=this,t=this.dataSelect.ambito;return this.vmFiltro.gradocod.length>0?t=t.filter(function(t){return e.vmFiltro["gradocod"].some(function(e){return 0===t.SALON.indexOf(e)||t.SALON.indexOf(","+e)>0})}):this.vmFiltro.instrucod.length>0&&(t=t.filter(function(t){return e.vmFiltro["instrucod"].some(function(e){return 0===t.SALON.indexOf(e)||t.SALON.indexOf(","+e)>0})})),t}},methods:{loadSalones:function(){var e=this,t=(0,F["default"])().ano;M.getSalones(t).then(function(t){e.salones=t.cboSalones}).catch(function(){(0,L["default"])("No se pudo cargar los salones","warning")})},cargarAmbito:function(){return M.getListaAmbito().then(function(e){return e})},obtNGS:function(){var e=this;Promise.all([M.getNiveles(),M.getGrados(),M.getListaAmbito()]).then(function(t){var n=A()(t,3),o=n[0],i=n[1],a=n[2];e.dataSelect.nivel=(0,E["default"])(o,function(e){return{label:e.INSTRUDES,value:e.INSTRUCOD}}),e.gradosTemp=i,e.dataSelect.ambito=a})},seleccionaInstru:function(e){this.vmFiltro.instrucod=e},seleccionaGrado:function(e){this.vmFiltro.gradocod=e},modalAgregarAmbito:function(){var e=this;this.v$.formAmbito.$reset(),this.openModal.agregar=!0,M.getTreeSalones().then(function(t){e.treeSalones=t,e.vmModal.salones=[]}).catch(function(){(0,L["default"])("No se pudo cargar los salones","warning")})},grabarAmbito:function(){var e=this;if(this.v$.formAmbito.$touch(),!this.v$.formAmbito.$error)if(this.vmModal.salones.length>1){var t=[],n=[];(0,$["default"])(this.vmModal.salones,function(n){t.push((0,Q.filterArray)(n,{field:"NEMO",list:e.salones})[0])}),n=(0,Q.filterArray)(t[0].PERINUM,{field:"PERINUM",list:t}),t.length===n.length?(this.loadingModal=!0,M.grabarAmbito(this.formAmbito.descripcion,this.vmModal.salones).then(function(t){var n=t.json;return e.loadingModal=!1,1===n.estado?((0,L["default"])(e.$t("mensajes.m0064"),"success"),e.openModal.agregar=!1,!0):((0,L["default"])(e.$t("mensajes.e0006"),"error"),!1)}).catch(function(t){(0,L["default"])(e.$t("mensajes.e0069"),"error"),e.loadingModal=!1}).then(function(t){return!!t&&e.cargarAmbito()}).then(function(t){t&&(e.dataSelect.ambito=t)})):(0,L["default"])("Existen número de periodo distintos entre salones","warning")}else(0,P.alertModal)(this.$t("validaciones.seleccioneMasdeUnSalon"))},eliminarAmbito:function(){var e=this,t=this.configTblAmbito.registrosSeleccionados;t.length>0?(0,P.dialogDelete)().then(function(e){return e?M.eliminarAmbito(t[0].ID_AMBITO).then(function(e){return e}).catch(function(){return!1}):null}).then(function(t){if(null!==t)if(t){if(1===t.estado)return(0,L["default"])(e.$t("mensajes.m0006.ok"),"success"),e.cargarAmbito();(0,L["default"])(e.$t("mensajes."+t.error["message"]),"error")}else(0,L["default"])(e.$t("mensajes.m0006.mal"),"error")}).then(function(t){e.dataSelect.ambito=t}).catch(function(){return!1}):(0,P.alertModal)("Debe seleccionar un registro")},configurarTablaAmbito:function(){var e={};e.columnas=[{name:"DESCRIPCION",label:this.$t("ambito"),field:"DESCRIPCION",align:"left",sortable:!0},{name:"SALON",label:this.$t("salon"),field:"SALON",align:"left",sortable:!0},{name:"ID_AMBITO",label:"ID_AMBITO",field:"ID_AMBITO"},{name:"GRUPAL",label:"GRUPAL",field:"GRUPAL"},{name:"DESCRIPCION_ORI",label:"DESCRIPCION_ORI",field:"DESCRIPCION_ORI"}],e.columnasVisibles=["DESCRIPCION","SALON"],e.paginacion={page:1,rowsPerPage:500},e.registrosSeleccionados=[],e.tipoSeleccion="single",e.dataTipoSeleccion=[{label:"Individual",value:"single"},{label:"Multiple",value:"multiple"}],this.configTblAmbito=e},actualizar:function(e){var t=this;if(""===e.DESCRIPCION.trim())return(0,L["default"])(this.$t("validaciones.ingreseDescripcion"),"error"),e.DESCRIPCION=e.DESCRIPCION_ORI,!1;M.actualizarAmbito(e.ID_AMBITO,e.DESCRIPCION).then(function(e){var n=e.json;return 1===n.estado?((0,L["default"])(t.$t("mensajes.m0064"),"success"),!0):((0,L["default"])(t.$t("mensajes.e0006"),"error"),!1)}).catch(function(e){return(0,L["default"])(t.$t("mensajes.e0069"),"error"),!1})}},validations:{formAmbito:{descripcion:{required:q.mw}}},created:function(){this.obtNGS(),this.loadSalones(),this.configurarTablaAmbito()}},V=n(12807);const U=(0,V.A)(w,[["render",h]]);var G=U}}]);