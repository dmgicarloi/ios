"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[60491],{60491:function(e,t,a){a.r(t),a.d(t,{default:function(){return V}});var s=a(61758),o=a(58790),i={class:"column q-ma-md"},n={class:"row justify-center"},r={class:"row"},l={key:0,class:"row justify-center"},c={class:"row q-mx-xs"},d={key:1,class:"row col q-ma-md"},u={key:0,class:"col"},m={key:1,class:"col justify-center q-ml-xs"},f={class:"col q-ma-md"},p={class:"col q-ma-xs"};function h(e,t){var a=(0,s.g2)("sie-select"),h=(0,s.g2)("q-clock"),b=(0,s.g2)("q-input"),g=(0,s.g2)("q-icon"),v=(0,s.g2)("q-card"),A=(0,s.g2)("qr"),O=(0,s.g2)("q-list-header"),y=(0,s.g2)("sie-usuario"),E=(0,s.g2)("q-item-side"),k=(0,s.g2)("q-item-tile"),D=(0,s.g2)("q-item-main"),C=(0,s.g2)("q-item"),S=(0,s.g2)("q-list"),q=(0,s.g2)("sie-vacio"),L=(0,s.g2)("q-radio"),T=(0,s.g2)("sie-modal");return(0,s.uX)(),(0,s.CE)("div",i,[(0,s.Lk)("div",n,[(0,s.bF)(a,{class:"col",type:"outlined",noBottom:"",modelValue:e.taller,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.taller=t}),options:e.listaTalleres,label:"TALLEDES",val:"TALLECOD",placeholder:e.$t("taller"),onSelected:e.seleccionaTaller},null,8,["modelValue","options","placeholder","onSelected"]),(0,s.Lk)("div",r,[t[4]||(t[4]=(0,s.Lk)("b",{class:"q-py-md q-px-xs"},"Hora Actual:",-1)),(0,s.bF)(h,{class:"q-py-md"})])]),e.diaDidisp?((0,s.uX)(),(0,s.CE)("div",l,["id"===e.tipoLectura||!e.sinCamara&&"barras"!=e.tipoLectura?(0,s.Q3)("v-if",!0):((0,s.uX)(),(0,s.Wv)(b,{key:0,class:"q-if-outlined no-bottom",modelValue:e.usucod,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.usucod=t}),autofocus:!0,"stack-label":"qr"==e.tipoLectura?"Usuario":"DNI",onKeydown:e.registraPistola},null,8,["modelValue","stack-label","onKeydown"])),(0,s.bF)(v,{class:"column justify-center q-ma-xs",style:(0,o.Tr)({color:e.estadoObj.COLORHEXT}),color:e.estadoObj.COLORVUE,onClick:e.abrirModal},{default:(0,s.k6)(function(){return[(0,s.Lk)("div",c,[(0,s.bF)(g,{name:e.estadoObj.ICONO},null,8,["name"]),(0,s.Lk)("span",null,(0,o.v_)(e.estadoObj.ESTADODES),1)])]}),_:1},8,["style","color","onClick"])])):(0,s.Q3)("v-if",!0),e.diaDidisp?((0,s.uX)(),(0,s.CE)("div",d,[!e.sinCamara&&["qr","id"].indexOf(e.tipoLectura)>=0?((0,s.uX)(),(0,s.CE)("div",u,[["qr","id"].indexOf(e.tipoLectura)>=0?((0,s.uX)(),(0,s.Wv)(A,{key:0,onLeeQr:e.leerRegistro,cargaAnterior:e.cargaAnterior},null,8,["onLeeQr","cargaAnterior"])):(0,s.Q3)("v-if",!0)])):(0,s.Q3)("v-if",!0),e.dataAsistencia.USUCOD?((0,s.uX)(),(0,s.CE)("div",m,[(0,s.bF)(S,{class:"q-pt-none"},{default:(0,s.k6)(function(){return[(0,s.bF)(O,{class:"q-pa-none"},{default:(0,s.k6)(function(){return[(0,s.bF)(v,{class:"row justify-center q-pa-xs",color:e.dataAsistencia.COLORVUE,style:(0,o.Tr)({color:e.dataAsistencia.COLORHEXT})},{default:(0,s.k6)(function(){return[(0,s.bF)(g,{name:e.dataAsistencia.ICONO},null,8,["name"]),(0,s.Lk)("span",null,(0,o.v_)(e.dataAsistencia.ESTADODES),1)]}),_:1},8,["color","style"])]}),_:1}),(0,s.bF)(C,{multiline:""},{default:(0,s.k6)(function(){return[(0,s.bF)(E,null,{default:(0,s.k6)(function(){return[(0,s.bF)(y,{class:"sie-usuario-md",usucod:e.usucodAsis},null,8,["usucod"])]}),_:1}),(0,s.bF)(D,null,{default:(0,s.k6)(function(){return[(0,s.bF)(k,{class:"text-bold",label:""},{default:(0,s.k6)(function(){return[(0,s.eW)((0,o.v_)(e.dataAsistencia.USUNOM),1)]}),_:1}),(0,s.bF)(k,{class:"row",sublabel:""},{default:(0,s.k6)(function(){return[t[5]||(t[5]=(0,s.Lk)("b",{class:"q-mr-xs"},"Hora de Asistencia:",-1)),(0,s.Lk)("span",null,(0,o.v_)(e.date(e.dataAsistencia.FH_REGISTRO,"hh:mm a")),1)]}),_:1}),(0,s.bF)(k,{class:"row",sublabel:""},{default:(0,s.k6)(function(){return[t[6]||(t[6]=(0,s.Lk)("b",{class:"q-mr-xs"},"Registrado por:",-1)),(0,s.Lk)("span",null,(0,o.v_)(e.dataAsistencia.USUCODREG),1)]}),_:1})]}),_:1})]}),_:1})]}),_:1})])):(0,s.Q3)("v-if",!0)])):((0,s.uX)(),(0,s.Wv)(q,{key:2,class:"col",subtitle:"mensajes.e0079",icon:"person"})),(0,s.bF)(T,{class:"sie-modal-adjuntos",modelValue:e.modalEstados,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.modalEstados=t}),title:"Estado actual",onSubmit:e.grabarModal},{default:(0,s.k6)(function(){return[(0,s.Lk)("div",f,[t[7]||(t[7]=(0,s.Lk)("div",{class:"col"},[(0,s.Lk)("span",{class:"subtitle"},"Seleccione el estado con el que se marcaran las asistencias desde este momento")],-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.estados,function(a,o){return(0,s.uX)(),(0,s.CE)("div",p,[(0,s.bF)(L,{modelValue:e.preEstado,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.preEstado=t}),val:a.ESTADOCOD,label:a.ESTADODES,color:"secondary",onInput:function(t){return e.modificarEstado(o)}},null,8,["modelValue","val","label","onInput"])])}),256))])]}),_:1},8,["modelValue","onSubmit"])])}a(515),a(83190),a(27153);var b=a(6123),g=a(80660),v=a(57668),A=a(80340),O=a(69027),y=a(30640),E=a(93616),k=a(24974),D=a(65818),C=a(23527),S=a(8445),q=a.n(S),L={class:"v-quagga"};function T(e,t){return(0,s.uX)(),(0,s.CE)("div",L,q()(t[0]||(t[0]=[(0,s.Lk)("video",{class:"camara"},null,-1),(0,s.Lk)("canvas",{class:"captura"},null,-1)])))}var x={},j={emits:["detected"],props:{cargaAnterior:{type:Boolean,default:!1},readerTypes:{type:Array,default:function(){return["code_39_reader"]}},readerSize:{type:Object,default:function(){return{width:"1600px",height:"960px"}},validator:function(e){return"string"===typeof e.width&&"string"===typeof e.height}}},data:function(){return{}},methods:{onBar:function(){var e=this,t={inputStream:{type:"LiveStream",constraints:{width:{min:e.readerSize.width},height:{min:e.readerSize.height},facingMode:"environment",aspectRatio:{min:1,max:2}},target:e.$el},locator:{patchSize:"medium",halfSample:!0},numOfWorkers:4,frequency:10,decoder:{readers:e.readerTypes},locate:!0};x.init(t,function(t){t&&e.$emit("leeQr",null,!0),x.start(),x.onDetected(e.onDetected),x.onProcessed(e.onProcessed)})},onProcessed:function(e){var t=x.canvas.ctx.overlay,a=x.canvas.dom.overlay;if(e){if(e.boxes){t.clearRect(0,0,parseInt(a.getAttribute("width")),parseInt(a.getAttribute("height")));for(var s=0;s<e.boxes.length;s++)e.boxes[s]!==e.box&&x.ImageDebug.drawPath(e.boxes[s],{x:0,y:1},t,{color:"green",lineWidth:2})}e.box&&x.ImageDebug.drawPath(e.box,{x:0,y:1},t,{color:"#00F",lineWidth:2}),e.codeResult&&e.codeResult.code&&x.ImageDebug.drawPath(e.line,{x:"x",y:"y"},t,{color:"red",lineWidth:3})}},onDetected:function(e){this.$emit("detected",e.codeResult.code)}},mounted:function(){}},w=a(12807);const Q=(0,w.A)(j,[["render",T]]);var F=Q,U=a(18105),R=a(982),_={components:{QSelect:b.Si,sieUsuario:k.A,sieModal:y.A,barcode:F,qr:C.A,sieVacio:A.A,QToggle:b.c5,QCheckbox:b.vZ,QBtnToggle:b.QL,sieSelect:E.A,QRadio:b.$,QClock:D.A,QInput:b.ie,QCard:b.C$,QIcon:b.bP,QList:b.Mb,QListHeader:b.XR,QItem:b.H0,QItemSide:b.n1,QItemMain:b.mF,QItemTile:b.lp},data:function(){return{now:new Date,sie:(0,v["default"])(),tipoLectura:"qr",sinCamara:!1,camera:"off",usucod:"",modRegistro:0,estados:[],cargaAnterior:!1,detallePrevio:{},estadoObj:{},estado:null,preEstado:null,modalEstados:!1,taller:null,listaTalleres:[],diasDisp:[],diaDidisp:!1,dataAsistencia:{}}},methods:{date:U.Ay,leerRegistro:function(e,t,a){var s=this;if(g.$http.get("api/Pruebas/obtFechasTaller").then(function(e){var t=e.json;console.log(t)}),this.usucodRead=e,this.preGrabado=!1,e){var o={tallecod:this.taller,alucod:e};g.$http.get("api/HyoTalleal/obtAsistenciaAlumno",{params:o}).then(function(e){var t=e.json;t.length>0?s.obtAsistencia(o).then(function(e){e.length>0?(s.dataAsistencia=e[0],(0,R["default"])("El estudiante ".concat(e[0].USUNOM," ya registró su asistencia anteriormente"),"error")):s.registrarAsistencia(o)}):(0,O.dialogConfirm)({title:s.$t("aviso"),message:s.$t("mensajes.e0080"),cancel:!1})}),this.usucod=null}else this.sinCamara=t;this.cargaAnterior=!0,this.camera=a},registrarAsistencia:function(e){var t=this;e.estado=this.preEstado,g.$http.post("api/HyoTalleasis/registrarAsistencia",e).then(function(e){var a=e.json;Array.isArray(a)&&(0,R["default"])("Se registró correctamente la asistencia del estudiante ".concat(a[0].USUNOM)),t.dataAsistencia=a[0]})},obtAsistencia:function(e){return new Promise(function(t,a){g.$http.get("api/HyoTalleasis/cargarAsistencia",{params:e}).then(function(e){var a=e.json;t(a)})})},registraPistola:function(e){13===e.which&&this.leerRegistro(this.usucod)},abrirModal:function(){this.preEstado=this.estadoObj.ESTADOCOD,this.modalEstados=!0},modificarEstado:function(e){this.preEstadoObj=this.estados[e]},grabarModal:function(){this.estadoObj=this.preEstadoObj,this.estado=this.preEstadoObj.ESTADOCOD,this.modalEstados=!1},seleccionaTaller:function(e){this.diasDisp=e.diasDisp,e.diasDisp.indexOf((new Date).getDay())>=0&&(this.diaDidisp=!0)}},computed:{usucodAsis:function(){return Object.keys(this.dataAsistencia).length&&this.dataAsistencia.USUCOD}},created:function(){var e=this;g.$http.get("api/HyoHorasisEstado/listarHorasisEstado",{params:{momento:1}}).then(function(t){var a=t.json;e.estados=a,console.log(a[0].ESTADOCOD),e.estadoObj=a[0],e.estado=a[0].ESTADOCOD,e.preEstado=a[0].ESTADOCOD}),g.$http.get("api/HyoTalleres/obtTalleresUsuario").then(function(t){var a=t.json;e.listaTalleres=a})}};const I=(0,w.A)(_,[["render",h]]);var V=I}}]);