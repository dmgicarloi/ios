"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[52086],{52086:function(e,a,o){o.r(a),o.d(a,{default:function(){return ne}});var t=o(8445),i=o.n(t),n=o(61758),s=o(58790),l={ref:"audioOk",src:"statics/sound/ok.mp3"},r={ref:"audioInfo",src:"statics/sound/duplicate.mp3"},c={ref:"audioError",src:"statics/sound/error.mp3"},u={class:"row justify-end q-ma-xs"},d={key:0,class:"q-ma-sm"},f={class:"row"},m={class:"row q-my-xs"},A={class:"column q-ma-xs"},p={class:"row"},g={class:"row"},E={class:"row"},v={key:1,class:"q-ma-sm"},S={class:"row"},h={class:"row"},k={class:"row"},O={class:"row"},C={class:"row"},w={class:"row"},b={key:0,class:"column col q-ma-sm q-card"},L={class:"column justify-center text-center q-py-md",style:{"font-size":"x-large"}},D={key:0,class:"row justify-center"},R={class:"q-mb-lg-xs"},N={key:1,class:"row col justify-center"},T={class:"row justify-center"},y={key:0,class:"col"},I={key:1,class:"col q-ma-sm"};function U(e,a){var o=(0,n.g2)("q-spinner"),t=(0,n.g2)("q-inner-loading"),U=(0,n.g2)("q-btn"),M=(0,n.g2)("q-tooltip"),P=(0,n.g2)("q-icon"),q=(0,n.g2)("q-td"),F=(0,n.g2)("q-table"),$=(0,n.g2)("q-input"),V=(0,n.g2)("sie-select"),j=(0,n.g2)("sie-modal"),x=(0,n.g2)("q-select"),Q=(0,n.g2)("q-clock"),_=(0,n.g2)("registro"),X=(0,n.g2)("sie-vacio"),H=(0,n.g2)("q-page");return(0,n.uX)(),(0,n.Wv)(H,null,{default:(0,n.k6)(function(){return[(0,n.Lk)("audio",l,null,512),(0,n.Lk)("audio",r,null,512),(0,n.Lk)("audio",c,null,512),(0,n.bF)(t,{class:"crear-contenido-loading",visible:e.loading},{default:(0,n.k6)(function(){return[(0,n.bF)(o,{color:"primary",name:"dots",size:"40px"})]}),_:1},8,["visible"]),(0,n.bF)(j,{modelValue:e.modalRecojo,"onUpdate:modelValue":a[10]||(a[10]=function(a){return e.modalRecojo=a}),ok:!1},{footerMobile:(0,n.k6)(function(){return[e.newRegister?((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.bF)(U,{class:"q-mx-xs",dense:"",flat:"",round:"",icon:"close",onClick:a[0]||(a[0]=function(a){return e.newRegister=!1})}),(0,n.bF)(U,{dense:"",flat:"",round:"",onClick:e.agregarRegistro,icon:"save"},null,8,["onClick"])],64)):((0,n.uX)(),(0,n.Wv)(U,{key:0,flat:"",dense:"",round:"",icon:"save",onClick:e.saveAsignacion},null,8,["onClick"]))]}),footer:(0,n.k6)(function(){return[(0,n.Lk)("div",u,[e.newRegister?((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.bF)(U,{class:"q-mx-xs",dense:"",color:"primary",onClick:a[1]||(a[1]=function(a){return e.newRegister=!1})},{default:(0,n.k6)(function(){return i()(a[17]||(a[17]=[(0,n.eW)("Cancelar",-1)]))}),_:1}),(0,n.bF)(U,{dense:"",color:"primary",onClick:e.agregarRegistro},{default:(0,n.k6)(function(){return i()(a[18]||(a[18]=[(0,n.eW)("Agregar",-1)]))}),_:1},8,["onClick"])],64)):((0,n.uX)(),(0,n.Wv)(U,{key:0,dense:"",color:"primary",onClick:e.saveAsignacion},{default:(0,n.k6)(function(){return i()(a[16]||(a[16]=[(0,n.eW)("Grabar",-1)]))}),_:1},8,["onClick"]))])]}),default:(0,n.k6)(function(){return[e.newRegister?((0,n.uX)(),(0,n.CE)("div",v,[a[24]||(a[24]=(0,n.Lk)("div",{class:"row"},[(0,n.Lk)("div",{class:"col"},[(0,n.Lk)("span",{class:"text-bold"},"Registrar los datos de quien recogerá al(a) estudiante y luego dar clic en agregar")])],-1)),(0,n.Lk)("div",S,[(0,n.bF)($,{class:"q-if-outlined col",modelValue:e.infoNew.APEPAT,"onUpdate:modelValue":a[4]||(a[4]=function(a){return e.infoNew.APEPAT=a}),"float-label":"Apellido Paterno"},null,8,["modelValue"])]),(0,n.Lk)("div",h,[(0,n.bF)($,{class:"q-if-outlined col",modelValue:e.infoNew.APEMAT,"onUpdate:modelValue":a[5]||(a[5]=function(a){return e.infoNew.APEMAT=a}),"float-label":"Apellido Materno"},null,8,["modelValue"])]),(0,n.Lk)("div",k,[(0,n.bF)($,{class:"q-if-outlined col",modelValue:e.infoNew.NOMBRES,"onUpdate:modelValue":a[6]||(a[6]=function(a){return e.infoNew.NOMBRES=a}),"float-label":"Nombres"},null,8,["modelValue"])]),(0,n.Lk)("div",O,[(0,n.bF)($,{class:"q-if-outlined col",modelValue:e.infoNew.DNI,"onUpdate:modelValue":a[7]||(a[7]=function(a){return e.infoNew.DNI=a}),"float-label":"D. Identidad"},null,8,["modelValue"])]),(0,n.Lk)("div",C,[(0,n.bF)($,{class:"q-if-outlined col",modelValue:e.infoNew.TELREF,"onUpdate:modelValue":a[8]||(a[8]=function(a){return e.infoNew.TELREF=a}),"float-label":"Teléfono"},null,8,["modelValue"])]),(0,n.Lk)("div",w,[(0,n.bF)(V,{class:"col",options:e.parentescos,val:"SECUCOD",label:"SECUDES",placeholder:"Parentesco",type:"outlined",modelValue:e.infoNew.RELCOD,"onUpdate:modelValue":a[9]||(a[9]=function(a){return e.infoNew.RELCOD=a}),onSelected:e.seleccionarTipo},null,8,["options","modelValue","onSelected"])])])):((0,n.uX)(),(0,n.CE)("div",d,[(0,n.Lk)("div",f,[a[20]||(a[20]=(0,n.Lk)("div",{class:"col"},[(0,n.Lk)("span",{class:"text-bold"},"Seleccionar quien recogerá al(a) estudiante")],-1)),(0,n.Lk)("div",m,[(0,n.bF)(U,{dense:"",size:"sm",color:"secondary",onClick:a[2]||(a[2]=function(a){return e.newRegister=!0})},{default:(0,n.k6)(function(){return i()(a[19]||(a[19]=[(0,n.eW)("Otro",-1)]))}),_:1})])]),(0,n.bF)(F,{class:"q-card",style:{"min-height":"50vh"},columns:e.columns,data:e.infoFamiliares,selection:"single",selected:e.familiarSelect,"onUpdate:selected":a[3]||(a[3]=function(a){return e.familiarSelect=a}),"hide-bottom":"","row-key":"NUMITE"},{"body-cell-INFO":(0,n.k6)(function(e){return[(0,n.bF)(q,{props:e},{default:(0,n.k6)(function(){return[(0,n.bF)(P,{name:"info",size:"md"},{default:(0,n.k6)(function(){return[(0,n.bF)(M,null,{default:(0,n.k6)(function(){return[(0,n.Lk)("div",A,[(0,n.Lk)("div",p,[a[21]||(a[21]=(0,n.Lk)("div",{class:"text-bold"},"Parentesco : ",-1)),(0,n.Lk)("span",null,(0,s.v_)(e.row.RELDES),1)]),(0,n.Lk)("div",g,[a[22]||(a[22]=(0,n.Lk)("div",{class:"text-bold"},"Documento : ",-1)),(0,n.Lk)("span",null,(0,s.v_)(e.row.DNI),1)]),(0,n.Lk)("div",E,[a[23]||(a[23]=(0,n.Lk)("div",{class:"text-bold"},"Teléfono : ",-1)),(0,n.Lk)("span",null,(0,s.v_)(e.row.TELREF),1)])])]}),_:2},1024)]}),_:2},1024)]}),_:2},1032,["props"])]}),_:1},8,["columns","data","selected"])]))]}),_:1},8,["modelValue"]),e.loading?(0,n.Q3)("v-if",!0):((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[e.feriados?((0,n.uX)(),(0,n.Wv)(X,{key:1,class:"col column",title:"regAsistencia.m0002",subtitle:e.feriados.OBSER,icon:"person"},null,8,["subtitle"])):((0,n.uX)(),(0,n.CE)("div",b,[(0,n.Lk)("div",L,[e.permiteSalida?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[e.editar?((0,n.uX)(),(0,n.CE)("div",N,[(0,n.bF)(x,{class:"q-if-outlined",options:e.tipoDiferenciado,modelValue:e.tipoSelect,"onUpdate:modelValue":a[12]||(a[12]=function(a){return e.tipoSelect=a}),onInput:a[13]||(a[13]=function(a){return e.editar=!1})},null,8,["options","modelValue"]),(0,n.bF)(U,{class:"q-ml-sm",flat:"",dense:"",round:"",icon:"close",onClick:a[14]||(a[14]=function(a){return e.editar=!1})})])):((0,n.uX)(),(0,n.CE)("div",D,[(0,n.Lk)("div",R,(0,s.v_)(e.modoDiferenciado),1),e.isPermitido?((0,n.uX)(),(0,n.Wv)(U,{key:0,class:"q-ml-sm",flat:"",dense:"",round:"",icon:"edit",onClick:a[11]||(a[11]=function(a){return e.editar=!0})})):(0,n.Q3)("v-if",!0)]))],64)):(0,n.Q3)("v-if",!0),(0,n.bF)(Q)]),(0,n.Lk)("div",T,[e.ocultaText?(0,n.Q3)("v-if",!0):((0,n.uX)(),(0,n.Wv)($,{key:0,class:"no-bottom q-if-outlined txt-especial",modelValue:e.usucod,"onUpdate:modelValue":a[15]||(a[15]=function(a){return e.usucod=a}),autofocus:!0,"stack-label":"qr"==e.tipoLectura?"Usuario":"DNI",onKeydown:e.registraPistola},null,8,["modelValue","stack-label","onKeydown"]))]),(0,n.Lk)("div",{class:(0,s.C4)(["col",{row:!e.isLess,column:e.isLess}])},[!e.sinCamara&&["qr","id"].indexOf(e.tipoLectura)>=0?((0,n.uX)(),(0,n.CE)("div",y,[["qr","id"].indexOf(e.tipoLectura)>=0?((0,n.uX)(),(0,n.Wv)((0,n.$y)(e.qrVersion),{key:0,onLeeQr:e.leerRegistro,cargaAnterior:e.cargaAnterior},null,40,["onLeeQr","cargaAnterior"])):(0,n.Q3)("v-if",!0)])):(0,n.Q3)("v-if",!0),e.dataAsistencia.USUCOD?((0,n.uX)(),(0,n.CE)("div",I,[(0,n.bF)(_,{dataAsistencia:e.dataAsistencia,tipoSelect:e.tipoSelect,verFoto:e.verFoto},null,8,["dataAsistencia","tipoSelect","verFoto"])])):((0,n.uX)(),(0,n.Wv)(X,{key:2,class:"col column",subtitle:"mensajes.e0081",icon:"person"}))],2)]))],64))]}),_:1})}var M=o(57008),P=o.n(M),q=o(76080),F=o.n(q),$=o(45254),V=o.n($),j=(o(25751),o(50310),o(90095),o(515),o(83190),o(52776),o(84433),o(13715),o(6123)),x=o(30545),Q=o(80660),_=o(57668),X=o(80340),H=o(69027),B=o(30640),W=o(74874),z=o(93616),K=o(65818),G=o(41482),J=o(23527),Z=o(33530),Y=o(982),ee=o(81288),ae=o(24974),oe={components:{QSelect:j.Si,QInnerLoading:j.SQ,QSpinner:G.A,sieModal:B.A,qr:J.A,sieVacio:X.A,QToggle:j.c5,QCheckbox:j.vZ,QBtnToggle:j.QL,sieSelect:z.A,QRadio:j.$,QClock:K.A,registro:W.A,qrOld:Z.A,QTable:x.A,QTd:j.Ef,sieUsuario:ae.A,QPage:j.Tu,QBtn:j.Il,QIcon:j.bP,QTooltip:j.nC,QInput:j.ie},data:function(){return{now:new Date,sie:(0,_["default"])(),estiloEspecial:"0090"===(0,_["default"])().colcod,isPermitido:(0,_["default"])().ruta.nivel>2,verFoto:!1,tipoLectura:"qr",qrVersion:"qr",sinCamara:!1,cargaAnterior:!1,camera:"auto",usucod:"",modRegistro:0,dataAsistencia:{},dataAlumnos:{},dataSalones:{},feriados:{},estados:{},ocultaText:!1,tipoDiferenciado:[{label:"REGISTRAR INGRESO",value:0},{label:"REGISTRAR SALIDA",value:1}],tipoSelect:0,editar:!1,permiteSalida:!1,loading:!0,validarRecojo:!1,modalRecojo:!1,infoFamiliares:[],familiaresBase:{},columns:[{name:"APEPAT",label:this.$t("Paterno"),align:"left",field:"APEPAT"},{name:"APEMAT",label:this.$t("Materno"),align:"left",field:"APEMAT"},{name:"NOMBRES",label:this.$t("Nombres"),align:"left",field:"NOMBRES"},{name:"DNI",label:this.$t("Documento"),align:"left",field:"DNI"},{name:"RELDES",label:this.$t("Parentesco"),align:"left",field:"RELDES"},{name:"TELREF",label:this.$t("Télefono"),align:"left",field:"TELREF"}],familiarSelect:[],newRegister:!1,infoNew:{},parentescos:null,infoSave:{},dataRecojo:{}}},watch:{tipoSelect:function(e){this.$http.put("api/HyoControl/updateControl",{campo:"alumnoES",numero:e})}},methods:{saveAsignacion:function(){0===this.familiarSelect.length?(0,Y["default"])("Debe seleccionar un responsable","error"):this.saveAsistencia()},getRecojo:function(){var e=this;return V()(F()().m(function a(){var o;return F()().w(function(a){while(1)switch(a.n){case 0:return a.n=1,Q.$http.get("api/HyoAlumov/getMov",{params:{NUMITE:e.familiarSelect[0].NUMITE}});case 1:o=a.v,e.dataAsistencia.NOMRECOJO=o.NOMBRES+"  "+o.APEPAT+" "+o.APEPAT,e.dataAsistencia.PARRECOJO=o.RELDES;case 2:return a.a(2)}},a)}))()},saveAsistencia:function(){var e=this;return V()(F()().m(function a(){var o,t,i,n,s,l;return F()().w(function(a){while(1)switch(a.n){case 0:o=e.infoSave,t=o.alucod,i=o.usucod,n=e.dataAlumnos[i].NEMO,e.dataAsistencia=P()({},e.dataAlumnos[i]),s={alucod:t,nemo:n,bimecod:e.dataSalones[n].BIMECOD,tardanzagen:e.dataSalones[n].TARDANZAGEN,modo:"C"},e.validarRecojo&&1===e.tipoSelect&&e.dataAlumnos[i].TIPOSALIDA&&(s.NUMITE=e.familiarSelect[0].NUMITE),l=0===e.tipoSelect?"registraAsistencia":"registraSalida",Q.$http.get("api/HyoHorasis/".concat(l),{params:s}).then(function(){var a=V()(F()().m(function a(o){var t,s;return F()().w(function(a){while(1)switch(a.n){case 0:if(t=o.json,(0,Y["default"])(e.$t("regAsistencia."+t.mensaje)),s=[e.dataAsistencia.ALUCOD],0===e.tipoSelect&&Q.$http.get("api/HyoHorasis/enviarAlerta",{params:{alucods:s}}).then(function(e){e.json}),!e.validarRecojo||1!==e.tipoSelect||!e.dataAlumnos[i].TIPOSALIDA){a.n=1;break}return a.n=1,e.getRecojo();case 1:e.dataAsistencia=P()(P()(P()(P()({},e.dataAsistencia),t.data),e.estados[t.data.ESTADOCOD]),e.dataSalones[n]),e.$refs.audioOk.play(),e.modalRecojo=!1;case 2:return a.a(2)}},a)}));return function(e){return a.apply(this,arguments)}}()).catch(function(){var a=V()(F()().m(function a(o){var t;return F()().w(function(a){while(1)switch(a.n){case 0:if(t=o.error,"e0002"===t.message){a.n=4;break}if((0,Y["default"])(e.$t("regAsistencia."+t.message),"error"),e.$refs.audioOk.play(),"m0001"!==t.message&&"m0008"!==t.message){a.n=2;break}if(e.$refs.audioInfo.play(),!e.validarRecojo||1!==e.tipoSelect||!e.dataAlumnos[i].TIPOSALIDA){a.n=1;break}return e.familiarSelect=[{NUMITE:t.params.NUMITE}],a.n=1,e.getRecojo();case 1:e.dataAsistencia=P()(P()(P()(P()({},e.dataAsistencia),t.params),e.estados[t.params.ESTADOCOD]),e.dataSalones[n]),a.n=3;break;case 2:e.$refs.audioError.play();case 3:a.n=5;break;case 4:e.dataAsistencia={},(0,H.dialogConfirm)({title:e.$t("mensajes."+t.message),cancel:!1}),e.$refs.audioError.play();case 5:return a.a(2)}},a)}));return function(e){return a.apply(this,arguments)}}());case 1:return a.a(2)}},a)}))()},getInfoSalida:function(){var e=this;return V()(F()().m(function a(){var o;return F()().w(function(a){while(1)switch(a.n){case 0:o=e.infoSave.alucod,Q.$http.get("api/HyoHorasis/getSalida",{params:{alucod:o}}).then(function(a){0===Object.keys(a).length?(0,Y["default"])(e.$t("regAsistencia.m0007"),"error"):a["FH_SALIDA"]?(e.familiarSelect=[{NUMITE:null}],e.saveAsistencia()):(e.modalRecojo=!0,e.infoFamiliares=e.familiaresBase[o],e.infoFamiliares.sort(function(e,a){return e.APEPAT.localeCompare(a.APEPAT)}),e.familiarSelect=[],e.newRegister=!1,e.infoNew={ALUCOD:o,APEPAT:"",APEMAT:"",DNI:"",NOMBRES:"",RELCOD:null,TELREF:""},e.newRegister=!1)});case 1:return a.a(2)}},a)}))()},leerRegistro:function(e,a,o){var t;(this.dataAsistencia={},e)?(e.indexOf("|")>=0&&(e=e.split("|")[0]),e=e.toUpperCase(),this.dataAlumnos[e]?(t=this.dataAlumnos[e].ALUCOD,this.dataAlumnos[e].NEMO?this.dataSalones[this.dataAlumnos[e].NEMO].BIMECOD?this.validarRecojo&&1===this.tipoSelect&&this.dataAlumnos[e].TIPOSALIDA?(this.infoSave={alucod:t,usucod:e},this.getInfoSalida()):(this.infoSave={alucod:t,usucod:e},this.saveAsistencia()):((0,Y["default"])(this.$t("regAsistencia.m0006"),"error"),this.$refs.audioInfo.play()):((0,Y["default"])(this.$t("regAsistencia.m0005"),"error"),this.$refs.audioInfo.play())):((0,Y["default"])(this.$t("regAsistencia.m0004"),"error"),this.$refs.audioError.play())):this.sinCamara=a;this.cargaAnterior=!0,this.usucod=null},registraPistola:function(e){13===e.which&&this.leerRegistro(this.usucod)},seleccionarTipo:function(e){this.infoNew.RELCOD=e.SECUCOD,this.infoNew.RELDES=e.SECUDES},agregarRegistro:function(){var e=this;this.infoNew.APEPAT?this.infoNew.APEMAT?this.infoNew.NOMBRES?this.infoNew.DNI?this.infoNew.TELREF&&this.infoNew.TELREF?this.infoNew.RELCOD?Q.$http.post("api/HyoAlumnos/grabarActualizarAlu_mov",{datosMov:this.infoNew,retorno:!0}).then(function(a){var o=a.json;o.msg&&(e.infoNew.NUMITE=o.id,e.familiarSelect=[e.infoNew],e.saveAsistencia(),e.modalRecojo=!1)}):(0,Y["default"])("Debe Seleccionar el parentesco","error"):(0,Y["default"])("Debe ingresar el teléfono","error"):(0,Y["default"])("Debe ingresar el número de documento","error"):(0,Y["default"])("Debe ingresar es/los nombre(s)","error"):(0,Y["default"])("Debe ingresar el apellido materno","error"):(0,Y["default"])("debe ingresar el apellido paterno","error")}},computed:{isLess:function(){return(0,ee.isLess)()},modoDiferenciado:function(){return this.tipoDiferenciado[this.tipoSelect].label}},created:function(){var e=this;return V()(F()().m(function a(){var o,t,i,n,s,l;return F()().w(function(a){while(1)switch(a.n){case 0:return t=function(){var e=["0032"].indexOf((0,_["default"])().colcod)>=0?1:7,a=36e5,t=new Date,i=t.getHours(),n=(Math.floor(i/e)+1)*e,s=(n-i)*a;setTimeout(o,s)},o=function(){window.location.reload(!0)},Q.$http.get("api/HyoConfigurajustificaciones/getJustificaciones",{params:{agrupado:!0}}).then(function(a){e.verFoto=a.VER_FOTO}),window.onload=t(),e.loading=!0,a.n=1,Q.$http.get("api/HyoHorasis/validacionesIniciales");case 1:if(i=a.v,n=i.json,("0090"===e.sie.colcod||/Macintosh/i.test(navigator.userAgent))&&(e.qrVersion="qrOld"),e.dataAlumnos={},n.alumnos.forEach(function(a){e.dataAlumnos[a.ALUCOD]={ALUCOD:a.ALUCOD,NEMO:a.NEMO,USUCOD:a.USUCOD,NOMCOMP:a.NOMCOMP,TIPOSALIDA:"R"===a.TIPOSALIDA},e.dataAlumnos[a.USUCOD]={ALUCOD:a.ALUCOD,NEMO:a.NEMO,USUCOD:a.USUCOD,NOMCOMP:a.NOMCOMP,TIPOSALIDA:"R"===a.TIPOSALIDA},e.dataAlumnos[a.DOCIDENRO]={ALUCOD:a.ALUCOD,NEMO:a.NEMO,USUCOD:a.USUCOD,NOMCOMP:a.NOMCOMP,TIPOSALIDA:"R"===a.TIPOSALIDA}}),e.dataSalones=n.dataSalones,e.feriados=n.feriado,e.estados=n.estados,e.permiteSalida=n.isSalida,!n.isSalida){a.n=3;break}return a.n=2,Q.$http.get("api/HyoControl/obtCodigoActualPorCampo",{params:{campo:"alumnoES"}});case 2:s=a.v,e.tipoSelect=parseInt(s.json);case 3:return e.familiaresBase=n.aluMov,a.n=4,Q.$http.get("api/HyoConfigurajustificaciones/getJustificaciones",{params:{agrupado:!0}});case 4:l=a.v,e.validarRecojo=l["S_VALIDA_RECOJO"],e.ocultaText=l["OCULTA_TEXTO"],e.loading=!1,Q.$http.get("api/HyoTablaSe/datosSe",{params:{princod:"009"}}).then(function(a){var o=a.listar,t=o.sort(function(e,a){return e.SECUDES<a.SECUDES?-1:e.SECUDES>a.SECUDES?1:0});e.parentescos=t});case 5:return a.a(2)}},a)}))()}},te=o(12807);const ie=(0,te.A)(oe,[["render",U]]);var ne=ie}}]);