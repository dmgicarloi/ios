"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[77503],{77503:function(e,a,t){t.r(a),t.d(a,{default:function(){return ee}});t(71225),t(50310),t(5962),t(83190);var n=t(61758),o=t(58790),r={class:"row items-center no-wrap"},l={class:"col-auto"},i={class:"row q-ma-xs q-col-gutter-sm"},u={class:"col-xs-12 col-sm-4"},s={class:"col-xs-12 col-sm-4"},c={class:"col-xs-12 col-sm-4"},d={class:"col-xs-12"},m={class:"text-h6"},f={class:"row q-ma-xs q-col-gutter-sm"},C={class:"col-12 col-md-6"},A={class:"col-xs-6"},p={class:"col-xs-6"},h={class:"col-xs-6"},E={class:"col-12 col-md-3"},O={class:"col-12 col-md-3"},D={class:"col-12 col-md-3"},M={class:"col-12 col-md-3"};function I(e,a){var t=(0,n.g2)("q-btn"),I=(0,n.g2)("q-card-section"),F=(0,n.g2)("q-separator"),R=(0,n.g2)("q-select"),_=(0,n.g2)("sie-grid"),v=(0,n.g2)("footer-grid"),N=(0,n.g2)("q-date"),g=(0,n.g2)("q-popup-proxy"),b=(0,n.g2)("q-icon"),S=(0,n.g2)("q-input"),w=(0,n.g2)("sie-modal"),T=(0,n.g2)("q-card");return(0,n.uX)(),(0,n.Wv)(T,{class:"layout-v1 my-card",flat:"",bordered:""},{default:(0,n.k6)(function(){return[(0,n.bF)(I,null,{default:(0,n.k6)(function(){return[(0,n.Lk)("div",r,[a[20]||(a[20]=(0,n.Lk)("div",{class:"col"},[(0,n.Lk)("div",{class:"text-h6"},"Control de Caja")],-1)),(0,n.Lk)("div",l,[e.nivelAcceso>=3?((0,n.uX)(),(0,n.Wv)(t,{key:0,class:"q-mr-sm",icon:"add",color:"primary",label:"Agregar",size:"sm",onClick:e.openModal},null,8,["onClick"])):(0,n.Q3)("v-if",!0)])])]}),_:1}),(0,n.bF)(F),(0,n.bF)(I,null,{default:(0,n.k6)(function(){return[(0,n.Lk)("div",i,[(0,n.Lk)("div",u,[(0,n.bF)(R,{modelValue:e.filter.ID_CAJA,"onUpdate:modelValue":a[0]||(a[0]=function(a){return e.filter.ID_CAJA=a}),"option-value":"ID_CAJA","option-label":"NOMBRE",options:e.filterCajaCobranzas,label:"Caja",onInput:e.getCajas},null,8,["modelValue","options","onInput"])]),(0,n.Lk)("div",s,[(0,n.bF)(R,{modelValue:e.filter.ANIO,"onUpdate:modelValue":a[1]||(a[1]=function(a){return e.filter.ANIO=a}),label:"Año",options:e.anios,placeholder:"Seleccione Año","option-value":"value","option-label":"label",onInput:e.getCajas},null,8,["modelValue","options","onInput"])]),(0,n.Lk)("div",c,[(0,n.bF)(R,{modelValue:e.filter.MES,"onUpdate:modelValue":a[2]||(a[2]=function(a){return e.filter.MES=a}),label:"Mes",options:e.meses,placeholder:"Seleccione Mes","option-value":"value","option-label":"label",onInput:e.getCajas},null,8,["modelValue","options","onInput"])])])]}),_:1}),(0,n.bF)(F),(0,n.bF)(I,null,{default:(0,n.k6)(function(){return[(0,n.bF)(_,{class:"ag-theme-balham",columnDefs:e.columns,rowData:e.rows,frameworkComponents:e.frameworkComponents,onGridReady:e.onGridReady,rowSelection:"multiple",onRowSelected:e.rowSelected,defaultColDef:e.defaultColDef,floatingFilter:"true",enableCellTextSelection:!0,onFilterChanged:e.onFilterChanged,style:{height:"calc(100vh - 370px)",width:"100%"}},null,8,["columnDefs","rowData","frameworkComponents","onGridReady","onRowSelected","defaultColDef","onFilterChanged"]),(0,n.bF)(v,{modelValue:e.pagina,"onUpdate:modelValue":a[3]||(a[3]=function(a){return e.pagina=a}),max:e.pages,onLoad:e.getCajas,rows:e.contador},null,8,["modelValue","max","onLoad","rows"])]}),_:1}),(0,n.bF)(w,{modelValue:e.modal,"onUpdate:modelValue":a[19]||(a[19]=function(a){return e.modal=a}),ok:"Guardar",onSubmit:e.saveCaja},{default:(0,n.k6)(function(){return[(0,n.bF)(I,null,{default:(0,n.k6)(function(){return[(0,n.Lk)("div",d,[(0,n.Lk)("div",m,(0,o.v_)(e.titleModal),1)])]}),_:1}),(0,n.bF)(I,null,{default:(0,n.k6)(function(){return[(0,n.Lk)("div",f,[(0,n.Lk)("div",C,[(0,n.bF)(R,{modelValue:e.formData.ID_CAJA,"onUpdate:modelValue":a[4]||(a[4]=function(a){return e.formData.ID_CAJA=a}),"option-value":"ID_CAJA","option-label":"NOMBRE",options:e.cajaCobranzas,label:"Caja",onInput:a[5]||(a[5]=function(){}),rules:[e.required]},null,8,["modelValue","options","rules"])]),(0,n.Lk)("div",A,[(0,n.bF)(S,{"reverse-fill-mask":"",modelValue:e.formData.FECHA,"onUpdate:modelValue":a[8]||(a[8]=function(a){return e.formData.FECHA=a}),maxlength:"10",mask:"##/##/####",label:"Fecha",onInput:a[9]||(a[9]=function(){})},{append:(0,n.k6)(function(){return[(0,n.bF)(b,{class:"cursor-pointer",name:"date_range"},{default:(0,n.k6)(function(){return[(0,n.bF)(g,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:(0,n.k6)(function(){return[(0,n.bF)(N,{mask:"DD/MM/YYYY",modelValue:e.formData.FECHA,"onUpdate:modelValue":a[6]||(a[6]=function(a){return e.formData.FECHA=a}),onInput:a[7]||(a[7]=function(a){return e.handleDateInputFecha("qDateProxy")})},null,8,["modelValue"])]}),_:1},512)]}),_:1})]}),_:1},8,["modelValue"])]),(0,n.Lk)("div",p,[(0,n.bF)(S,{"reverse-fill-mask":"",modelValue:e.formData.FECHA_APERTURA,"onUpdate:modelValue":a[12]||(a[12]=function(a){return e.formData.FECHA_APERTURA=a}),maxlength:"10",mask:"##/##/#### ##:##:##",label:"Fecha Apertura"},{append:(0,n.k6)(function(){return[(0,n.bF)(b,{class:"cursor-pointer",name:"date_range"},{default:(0,n.k6)(function(){return[(0,n.bF)(g,{ref:"qDateProxy2","transition-show":"scale","transition-hide":"scale"},{default:(0,n.k6)(function(){return[(0,n.bF)(N,{mask:"DD/MM/YYYY hh:mm:ss",modelValue:e.formData.FECHA_APERTURA,"onUpdate:modelValue":a[10]||(a[10]=function(a){return e.formData.FECHA_APERTURA=a}),onInput:a[11]||(a[11]=function(a){return e.closeModalCalendar("qDateProxy2")})},null,8,["modelValue"])]}),_:1},512)]}),_:1})]}),_:1},8,["modelValue"])]),(0,n.Lk)("div",h,[(0,n.bF)(S,{"reverse-fill-mask":"",modelValue:e.formData.FECHA_CIERRE,"onUpdate:modelValue":a[15]||(a[15]=function(a){return e.formData.FECHA_CIERRE=a}),maxlength:"10",mask:"##/##/#### ##:##:##",label:"Fecha Cierre"},{append:(0,n.k6)(function(){return[(0,n.bF)(b,{class:"cursor-pointer",name:"date_range"},{default:(0,n.k6)(function(){return[(0,n.bF)(g,{ref:"qDateProxy3","transition-show":"scale","transition-hide":"scale"},{default:(0,n.k6)(function(){return[(0,n.bF)(N,{mask:"DD/MM/YYYY hh:mm:ss",modelValue:e.formData.FECHA_CIERRE,"onUpdate:modelValue":a[13]||(a[13]=function(a){return e.formData.FECHA_CIERRE=a}),onInput:a[14]||(a[14]=function(a){return e.handleDateInputFechaCierre("qDateProxy3")})},null,8,["modelValue"])]}),_:1},512)]}),_:1})]}),_:1},8,["modelValue"])]),(0,n.Lk)("div",E,[(0,n.bF)(S,{modelValue:e.formData.MONTO_INICIAL,"onUpdate:modelValue":a[16]||(a[16]=function(a){return e.formData.MONTO_INICIAL=a}),label:"Monto Inicial",type:"number",disable:!0},null,8,["modelValue"])]),(0,n.Lk)("div",O,[(0,n.bF)(S,{modelValue:e.formData.MONTO_INGRESOS,"onUpdate:modelValue":a[17]||(a[17]=function(a){return e.formData.MONTO_INGRESOS=a}),label:"Monto Ingresos",type:"number",disable:!0},null,8,["modelValue"])]),(0,n.Lk)("div",D,[(0,n.bF)(S,{modelValue:e.formData.MONTO_EGRESOS,"onUpdate:modelValue":a[18]||(a[18]=function(a){return e.formData.MONTO_EGRESOS=a}),label:"Monto Egresos",type:"number",disable:!0},null,8,["modelValue"])]),(0,n.Lk)("div",M,[(0,n.bF)(S,{modelValue:e.montoFinalCalculado,label:"Monto Final",type:"number",disable:!0},null,8,["modelValue"])])])]}),_:1})]}),_:1},8,["modelValue","onSubmit"])]}),_:1})}var F=t(57008),R=t.n(F),_=t(8445),v=t.n(_),N=t(76080),g=t.n(N),b=t(45254),S=t.n(b),w=t(91134),T=t.n(w),k=(t(30683),t(71587),t(52133),t(90095),t(6724),t(15547),t(66307),t(68017),t(13715),t(80660)),Y=t(57668),H=t(75053),j=t(88567),U=t(95718),V=t(53380),L=t(54489),y=t(64208),P=t(4437),x=t(95477),G=t(6123),q=t(78840),J=t(18105),z=t(41615),B={data:function(){return{columns:[],rows:[],config:{}}},methods:{setColumns:function(){var e=this;this.columns=[{name:"NOMBRE_CAJA",headerName:"Nombre caja",field:"NOMBRE_CAJA",width:120},{name:"USUCOD",headerName:"Usuario",field:"USUCOD",width:80},{headerName:"Fecha",field:"FECHA",valueFormatter:function(e){return e.value?(0,J.Ay)(e.value,"DD/MM/YYYY"):null},width:120,filter:"agDateColumnFilter",filterParams:{}},{headerName:"Fecha Apertura",field:"FECHA_APERTURA",valueFormatter:function(e){return e.value?(0,J.Ay)(e.value,"DD/MM/YYYY HH:mm"):null},width:120,filter:"agDateColumnFilter",filterParams:{}},{headerName:"Fecha Cierre",field:"FECHA_CIERRE",valueFormatter:function(e){return e.value?(0,J.Ay)(e.value,"DD/MM/YYYY HH:mm"):null},width:120,filter:"agDateColumnFilter",filterParams:{}},{name:"MONEDA",headerName:"",field:"MONEDA",width:15},{name:"MONTO_INICIAL",headerName:"Inicial",field:"MONTO_INICIAL",cellStyle:{textAlign:"right"},width:100},{name:"MONTO_FINAL",headerName:"Total",field:"MONTO_FINAL",cellStyle:{textAlign:"right"},width:100},{cellRenderer:actionButton,filter:!1,width:40,hide:this.nivelAcceso<z["default"].LECTURA_ESCRITURA,cellRendererParams:function(a){var t=a.data.ESTADO,n=0===t;return{icon:n?"lock_open":"lock",tooltip:n?"Cerrar Caja":"Abrir Caja",onClick:function(){return e.saveBloqueo(a.data)}}}},{cellRenderer:actionButton,filter:!1,hide:this.nivelAcceso<z["default"].LECTURA_ESCRITURA,cellRendererParams:{icon:"file_pdf",onClick:function(a){e.getReporte(a.data)}},width:40},{cellRenderer:actionButton,filter:!1,hide:this.nivelAcceso<z["default"].LECTURA_ESCRITURA,cellRendererParams:{icon:"edit",onClick:function(a){e.openModal(a.data,"edit")}},width:40}]}}},$=t(39893),Q=t(36408),W=t(27560),X={components:{QCard:j.A,QDate:P.A,QPopupProxy:x.A,QDatetime:G.T5,QCardSection:U.A,QSeparator:V.A,sieModal:H.A,QSelect:L.S,QInput:y.A,sieGrid:Q.A,footerGrid:W.A,QBtn:G.Il,QIcon:G.bP},mixins:[B],data:function(){return T()({contador:0,filterModel:"",api:null,rowData:[],sie:(0,Y["default"])(),nivelAcceso:(0,Y["default"])().ruta.nivel,modal:!1,modalType:"create",formData:{ID_CAJA:null,USUCOD:null,FECHA:null,FECHA_APERTURA:null,FECHA_CIERRE:null,MONTO_INICIAL:0,MONTO_INGRESOS:0,MONTO_EGRESOS:0,MONTO_FINAL:0},titleModal:"Control de Caja",cajaCobranzas:[],filterCajaCobranzas:[{ID_CAJA:null,NOMBRE:"Todas las Cajas"}],frameworkComponents:[],defaultColDef:{suppressHeaderMenuButton:!0,filter:!0,floatingFilterComponentParams:{suppressFilterButton:!0},resizable:!0,sortable:!0},filter:{},anios:[],meses:[],pagina:1,pages:1},"contador",0)},methods:{required:$.required,getAnios:function(){var e=this;return S()(g()().m(function a(){return g()().w(function(a){while(1)switch(a.n){case 0:return a.n=1,z["default"].API_ANIOS();case 1:e.anios=a.v,e.filter.ANIO=String(z["default"].CURRENT_YEAR);case 2:return a.a(2)}},a)}))()},getMeses:function(){var e=this;return S()(g()().m(function a(){return g()().w(function(a){while(1)switch(a.n){case 0:return e.filter.MES=z["default"].CURRENT_MONTH,a.n=1,z["default"].MESES();case 1:e.meses=a.v;case 2:return a.a(2)}},a)}))()},getCajaCobranza:function(){var e=this;return S()(g()().m(function a(){var t;return g()().w(function(a){while(1)switch(a.n){case 0:return a.n=1,k.$http.get("api/CajaCobranzaController/getCajaCobranza");case 1:t=a.v,e.cajaCobranzas=t,e.filterCajaCobranzas=[].concat(v()(e.filterCajaCobranzas),v()(t)),e.filter.ID_CAJA=null;case 2:return a.a(2)}},a)}))()},getInicialCaja:function(){var e=arguments,a=this;return S()(g()().m(function t(){var n,o;return g()().w(function(t){while(1)switch(t.n){case 0:return n=e.length>0&&void 0!==e[0]?e[0]:a.formData.FECHA,t.n=1,k.$http.get("api/cajaController/getInicialCaja",{params:{params:{FECHA:n}}});case 1:o=t.v,a.formData.MONTO_INICIAL=o.data[0].MONTOPAG||0,a.formData.MONTO_FINAL=0;case 2:return t.a(2)}},t)}))()},handleDateInputFecha:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.closeModalCalendar(e),this.getInicialCaja()},handleDateInputFechaCierre:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.closeModalCalendar(e),this.getMovimientoDeCaja()},getMovimientoDeCaja:function(){var e=arguments,a=this;return S()(g()().m(function t(){var n,o,r;return g()().w(function(t){while(1)switch(t.n){case 0:return n=e.length>0&&void 0!==e[0]?e[0]:a.formData.FECHA,t.n=1,k.$http.get("api/cajaController/getMovimientoDeCaja",{params:{params:{FECHA:n}}});case 1:o=t.v,r=o.data||[],r.forEach(function(e){e.MONTO&&"I"===e.TIPO.trim()?a.formData.MONTO_INGRESOS=e.MONTO||0:e.MONTO&&"E"===e.TIPO.trim()&&(a.formData.MONTO_EGRESOS=Math.abs(e.MONTO||0))});case 2:return t.a(2)}},t)}))()},closeModalCalendar:function(e){this.$refs[e].hide()},onFilterChanged:function(e){this.contador=Array.from({length:e.api.getDisplayedRowCount()}),this.filterModel=e.api.getFilterModel()},rowSelected:function(e){this.currentRow=e.data},getCajas:function(){var e=this;return S()(g()().m(function a(){var t,n,o;return g()().w(function(a){while(1)switch(a.p=a.n){case 0:return a.p=0,t={ID_CAJA:e.filter.ID_CAJA,ANIO:e.filter.ANIO,MES:e.filter.MES},a.n=1,k.$http.get("api/cajaController/getCajaMovimiento",{params:{params:t}});case 1:return n=a.v,e.rows=n.data,e.rows=n.data.map(function(e){return R()(R()({},e),{},{ESTADO:e.FECHA_CIERRE?1:0,MONEDA:"S/."})}),e.contador=v()(n.data),a.a(2,n.data);case 2:a.p=2,o=a.v,e.$alert(o.message,"error");case 3:return a.a(2)}},a,null,[[0,2]])}))()},onGridReady:function(e){this.api=e.api},openModal:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"create";this.modal=!0,this.modalType=a,"edit"===a?(this.titleModal="Editar Caja",this.formData={ID_CAJA:e.ID_CAJA,USUCOD:e.USUCOD,FECHA:(0,J.Ay)(e.FECHA,"DD/MM/YYYY"),MONTO_INICIAL:e.MONTO_INICIAL,MONTO_INGRESOS:e.MONTO_INGRESOS,MONTO_EGRESOS:e.MONTO_EGRESOS,MONTO_FINAL:e.MONTO_FINAL,FECHA_APERTURA:(0,J.Ay)(e.FECHA_APERTURA,"DD/MM/YYYY HH:mm:ss"),FECHA_CIERRE:(0,J.Ay)(e.FECHA_CIERRE,"DD/MM/YYYY HH:mm:ss")}):(this.titleModal="Registrar Caja",this.formData={ID_CAJA:null,USUCOD:this.sie.usucod,FECHA:(0,J.Ay)(new Date,"DD/MM/YYYY"),FECHA_APERTURA:(0,J.Ay)(new Date,"DD/MM/YYYY HH:mm:ss"),FECHA_CIERRE:null,MONTO_INICIAL:0,MONTO_INGRESOS:0,MONTO_EGRESOS:0,MONTO_FINAL:0},this.getInicialCaja()),this.formData.MONTO_FINAL=this.montoFinalCalculado},saveCaja:function(){var e=this;return S()(g()().m(function a(){var t;return g()().w(function(a){while(1)switch(a.p=a.n){case 0:if(a.p=0,"edit"!==e.modalType){a.n=2;break}return a.n=1,k.$http.post("api/cajaController/updateCajaMovimiento",{params:e.formData});case 1:a.n=3;break;case 2:return a.n=3,k.$http.post("api/cajaController/createCajaMovimiento",{params:e.formData});case 3:e.modal=!1,e.getCajas(),e.formData={},a.n=5;break;case 4:a.p=4,t=a.v,console.error("Error al guardar caja:",t),e.$alert(t.message,"error");case 5:return a.a(2)}},a,null,[[0,4]])}))()},saveBloqueo:function(e){var a=this;return S()(g()().m(function t(){return g()().w(function(t){while(1)switch(t.n){case 0:a.$confirm("¿Esta seguro de realizar este proceso?").onOk(S()(g()().m(function t(){var n;return g()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,e.CERRAR_CAJA=!e.FECHA_CIERRE,e.FECHA=(0,J.Ay)(e.FECHA,"DD/MM/YYYY"),e.FECHA_APERTURA=(0,J.Ay)(e.FECHA_APERTURA,"DD/MM/YYYY HH:mm:ss"),e.FECHA_CIERRE=(0,J.Ay)(e.FECHA_CIERRE,"DD/MM/YYYY HH:mm:ss"),a.getMovimientoDeCaja(e.FECHA),e.MONTO_INGRESOS=a.formData.MONTO_INGRESOS,e.MONTO_EGRESOS=a.formData.MONTO_INGRESOS,t.n=1,a.$http.post("api/cajaController/updateCajaMovimiento",{params:e});case 1:a.$alert("Proceso realizado correctamente","success"),a.getCajas(),t.n=3;break;case 2:t.p=2,n=t.v,console.error("Error al guardar bloqueo:",n),a.$alert(n.message,"error");case 3:return t.a(2)}},t,null,[[0,2]])})));case 1:return t.a(2)}},t)}))()},getReporte:function(e){return S()(g()().m(function a(){var t;return g()().w(function(a){while(1)switch(a.n){case 0:t=document.createElement("form"),document.body.appendChild(t),z["default"].FORMULARIO_REPORTES(t,{REPCOD:"004",fecha1:(0,J.Ay)(e.FECHA,"DD/MM/YYYY")});case 1:return a.a(2)}},a)}))()}},computed:{montoFinalCalculado:function(){var e=parseFloat(this.formData.MONTO_INICIAL)||0,a=parseFloat(this.formData.MONTO_INGRESOS)||0,t=parseFloat(this.formData.MONTO_EGRESOS)||0,n=(e+a-t).toFixed(2);return this.formData.MONTO_FINAL=n}},beforeMount:function(){var e=this;return S()(g()().m(function a(){return g()().w(function(a){while(1)switch(a.n){case 0:e.getCajaCobranza(),e.getAnios(),e.getMeses(),e.frameworkComponents={actionButton:q.A},e.getCajas(),e.setColumns();case 1:return a.a(2)}},a)}))()}},K=t(12807);const Z=(0,K.A)(X,[["render",I]]);var ee=Z}}]);