"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[56704],{56704:function(e,o,t){t.r(o),t.d(o,{default:function(){return Y}});var n=t(8445),a=t.n(n),s=(t(71225),t(50310),t(5962),t(83190),t(61758)),l=t(58790),r={ref:"audioOk",src:"statics/sound/ok.mp3"},i={ref:"audioInfo",src:"statics/sound/duplicate.mp3"},u={ref:"audioError",src:"statics/sound/error.mp3"},d={class:"row q-card q-ma-xs"},c={key:0,class:"row justify-end"};function f(e,o){var t=(0,s.g2)("header-btn"),n=(0,s.g2)("qr"),f=(0,s.g2)("sie-modal"),m=(0,s.g2)("prestamo"),p=(0,s.g2)("q-search"),b=(0,s.g2)("q-select"),h=(0,s.g2)("q-tooltip"),k=(0,s.g2)("q-btn"),T=(0,s.g2)("q-td"),g=(0,s.g2)("q-table"),v=(0,s.g2)("q-page");return(0,s.uX)(),(0,s.Wv)(v,{class:"column"},{default:(0,s.k6)(function(){return[(0,s.Lk)("audio",r,null,512),(0,s.Lk)("audio",i,null,512),(0,s.Lk)("audio",u,null,512),(0,s.bF)(t,{name:"Prestamo de Tablet",buttons:e.buttons},null,8,["buttons"]),(0,s.bF)(f,{modelValue:e.verEscaneo,"onUpdate:modelValue":o[0]||(o[0]=function(o){return e.verEscaneo=o})},{default:(0,s.k6)(function(){return[(0,s.bF)(n,{onLeeQr:e.leerRegistro},null,8,["onLeeQr"])]}),_:1},8,["modelValue"]),e.modalPrestamo?((0,s.uX)(),(0,s.Wv)(m,{key:0,onCloseModal:e.closeModalPrestamo,sie:e.sie,estado:e.modalPrestamo},null,8,["onCloseModal","sie","estado"])):(0,s.Q3)("v-if",!0),(0,s.Lk)("div",d,[(0,s.bF)(p,{class:"q-if-outlined col",modelValue:e.filter,"onUpdate:modelValue":o[1]||(o[1]=function(o){return e.filter=o})},null,8,["modelValue"]),(0,s.bF)(b,{class:"q-if-outlined",modelValue:e.estado,"onUpdate:modelValue":o[2]||(o[2]=function(o){return e.estado=o}),options:e.estados,"float-label":"Estado",onInput:e.filtrarData},null,8,["modelValue","options","onInput"]),(0,s.bF)(k,{class:"q-my-sm",flat:"",dense:"",round:"",icon:"camera",onClick:e.openScan},{default:(0,s.k6)(function(){return[(0,s.bF)(h,null,{default:(0,s.k6)(function(){return a()(o[3]||(o[3]=[(0,s.eW)("Escanear QR",-1)]))}),_:1})]}),_:1},8,["onClick"])]),(0,s.bF)(g,{class:"q-card q-ma-xs",columns:e.columns,data:e.infoPrestamos,filter:e.filter,style:{height:"60vh"}},{"body-cell-FH_INICIO":(0,s.k6)(function(o){return[(0,s.bF)(T,{props:o},{default:(0,s.k6)(function(){return[(0,s.Lk)("span",null,(0,l.v_)(e.date(o.row.FH_INICIO,"DD/MM/YYYY")),1)]}),_:2},1032,["props"])]}),"body-cell-FH_FIN":(0,s.k6)(function(o){return[(0,s.bF)(T,{props:o},{default:(0,s.k6)(function(){return[(0,s.Lk)("span",null,(0,l.v_)(e.date(o.row.FH_FIN,"DD/MM/YYYY")),1)]}),_:2},1032,["props"])]}),"body-cell-PRESTAMO_ESTADO":(0,s.k6)(function(o){return[(0,s.bF)(T,{props:o},{default:(0,s.k6)(function(){return[(0,s.Lk)("span",null,(0,l.v_)(e.estadosPrestamo[o.row.PRESTAMO_ESTADO]),1)]}),_:2},1032,["props"])]}),"body-cell-EDIT":(0,s.k6)(function(t){return[(0,s.bF)(T,{props:t},{default:(0,s.k6)(function(){return[2===t.row.PRESTAMO_ESTADO?((0,s.uX)(),(0,s.CE)("div",c,[(0,s.bF)(k,{flat:"",dense:"",round:"",icon:"assignment_return",onClick:function(o){return e.modifyPrestamo(t.row,1)}},{default:(0,s.k6)(function(){return[(0,s.bF)(h,null,{default:(0,s.k6)(function(){return a()(o[4]||(o[4]=[(0,s.eW)("Devolver",-1)]))}),_:1})]}),_:1},8,["onClick"]),(0,s.bF)(k,{flat:"",dense:"",round:"",icon:"close",onClick:function(o){return e.modifyPrestamo(t.row,3)}},{default:(0,s.k6)(function(){return[(0,s.bF)(h,null,{default:(0,s.k6)(function(){return a()(o[5]||(o[5]=[(0,s.eW)("Perdida",-1)]))}),_:1})]}),_:1},8,["onClick"]),(0,s.bF)(k,{flat:"",dense:"",round:"",icon:"block",onClick:function(o){return e.modifyPrestamo(t.row,4)}},{default:(0,s.k6)(function(){return[(0,s.bF)(h,null,{default:(0,s.k6)(function(){return a()(o[6]||(o[6]=[(0,s.eW)("Anular",-1)]))}),_:1})]}),_:1},8,["onClick"]),(0,s.bF)(k,{flat:"",dense:"",round:"",icon:"delete",onClick:function(o){return e.modifyPrestamo(t.row,5)}},{default:(0,s.k6)(function(){return[(0,s.bF)(h,null,{default:(0,s.k6)(function(){return a()(o[7]||(o[7]=[(0,s.eW)("Eliminar",-1)]))}),_:1})]}),_:1},8,["onClick"])])):(0,s.Q3)("v-if",!0)]}),_:2},1032,["props"])]}),_:1},8,["columns","data","filter"])]}),_:1})}t(10239),t(90095),t(44264),t(13715);var m=t(6123),p=t(23527),b=t(57668),h=t(30640),k={class:"column"},T={ref:"audioOk",src:"statics/sound/ok.mp3"},g={ref:"audioInfo",src:"statics/sound/duplicate.mp3"},v={ref:"audioError",src:"statics/sound/error.mp3"},A={class:"row justify-end q-ma-xs"},P={key:1,class:"q-ma-xs"},C={class:"q-ma-xs q-card q-table"},E={class:"q-tr"},I={class:"q-td"},_={class:"q-td"},D={class:"q-ml-xs"},O={class:"q-tr"},y={class:"q-td"};function S(e,o){var t=(0,s.g2)("q-btn"),n=(0,s.g2)("qr"),r=(0,s.g2)("sie-select"),i=(0,s.g2)("sie-modal");return(0,s.uX)(),(0,s.CE)("div",k,[(0,s.Lk)("audio",T,null,512),(0,s.Lk)("audio",g,null,512),(0,s.Lk)("audio",v,null,512),(0,s.bF)(i,{class:"mensaje-modal",modelValue:e.showModal,"onUpdate:modelValue":o[1]||(o[1]=function(o){return e.showModal=o}),title:"Prestar Tablet",ok:!1,css:{width:"50%"}},{footerMobile:(0,s.k6)(function(){return[(0,s.bF)(t,{flat:"",dense:"",round:"",icon:"save",onClick:e.grabarPrestamo,loading:e.cargando},null,8,["onClick","loading"])]}),footer:(0,s.k6)(function(){return[(0,s.Lk)("div",A,[(0,s.bF)(t,{class:"q-mx-xs",dense:"",color:"secondary",icon:"save",onClick:e.grabarPrestamo,loading:e.cargando},{default:(0,s.k6)(function(){return a()(o[2]||(o[2]=[(0,s.eW)("Grabar",-1)]))}),_:1},8,["onClick","loading"])])]}),default:(0,s.k6)(function(){return[e.showCamara?((0,s.uX)(),(0,s.Wv)(n,{key:0,class:"q-ma-xs",onLeeQr:e.leerRegistro},null,8,["onLeeQr"])):((0,s.uX)(),(0,s.CE)("div",P,[(0,s.Lk)("table",C,[(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.campos,function(o){return(0,s.uX)(),(0,s.CE)("tr",E,[(0,s.Lk)("td",I,[(0,s.Lk)("b",null,(0,l.v_)(o.DESCRIPCION),1)]),(0,s.Lk)("td",_,[(0,s.Lk)("span",D,(0,l.v_)(e.infoTablet["CAMPO"+o.ID_CARACTERISTICA]),1)])])}),256)),(0,s.Lk)("tr",O,[o[3]||(o[3]=(0,s.Lk)("td",{class:"q-td"},[(0,s.Lk)("b",null,"Usuario")],-1)),(0,s.Lk)("td",y,[(0,s.bF)(r,{modelValue:e.infoPrestamo.USUCOD,"onUpdate:modelValue":o[0]||(o[0]=function(o){return e.infoPrestamo.USUCOD=o}),type:"outlined",label:"USUNOM",val:"USUCOD",options:e.usuarios},null,8,["modelValue","options"])])])])])]))]}),_:1},8,["modelValue"])])}t(23825),t(515),t(27153),t(66307),t(24066);var F={class:"column"};function q(e,o){var t=(0,s.g2)("qr");return(0,s.uX)(),(0,s.CE)("div",F,[(0,s.bF)(t,{onLeeQr:e.leerRegistro},null,8,["onLeeQr"])])}var L={components:{qr:p.A},data:function(){return{}},methods:{leerRegistro:function(e,o){console.log(e,o)}}},M=t(12807);const R=(0,M.A)(L,[["render",q]]);var w=R,U=t(80660),Q=t(982),$=t(93616),V={emits:["closeModal"],components:{sieModal:h.A,lectura:w,qr:p.A,sieSelect:$.A,QBtn:m.Il},props:["sie","estado"],data:function(){return{modalPrestamo:!1,showModal:!1,showCamara:!1,infoTablet:{},infoPrestamo:{},campos:[],usuarios:[],cargando:!1,permiteGrabar:!1}},methods:{init:function(){var e=this;this.showModal=this.estado,this.showCamara=!0,Promise.all([U.$http.get("api/HyoUsuario/getUsuariosTablets")]).then(function(o){e.usuarios=o[0].json})},grabarPrestamo:function(){var e=this;this.infoPrestamo.USUCOD?U.$http.post("api/HyoTabletsprestamo/savePrestamo",{info:this.infoPrestamo}).then(function(o){var t=o.json;(0,Q["default"])(e.$t("mensajes."+t.msg),t.type),console.log(!t.type),t.type||(e.showModal=!1)}):(0,Q["default"])("Debe seleccionar un usuario","error")},leerRegistro:function(e,o){var t=this,n=e.split("|")[0];U.$http.get("api/HyoTablets/getTablets",{params:{ID_TABLET:n}}).then(function(e){var o=e.json;t.campos=o.heads,o.info.length>0?Object.keys(o.info[0]).length>0?1===o.info[0].ESTADO?(t.$refs.audioOk.play(),t.showCamara=!1,t.infoTablet=o.info[0],t.infoPrestamo={ID_TABLET:o.info[0].ID_TABLET,USUCOD:null},t.permiteGrabar=!0):(t.$refs.audioInfo.play(),(0,Q["default"])("La tablet seleccionada no se encuentra disponible para el prestamo","info")):t.$refs.audioInfo.play():t.$refs.audioError.play(),console.log(o)}),console.log(e,o,n)}},watch:{showModal:function(e){e||this.$emit("closeModal")}},mounted:function(){this.init()}};const B=(0,M.A)(V,[["render",S]]);var H=B,N=t(30545),j=t(18105),x=t(33001),W={components:{QTabs:m.uw,QTab:m.zu,QTabPane:m.dg,sieModal:h.A,prestamo:H,QTable:N.A,QTd:m.Ef,QSearch:m.Ks,QSelect:m.Si,qr:p.A,QPage:m.Tu,QBtn:m.Il,QTooltip:m.nC},data:function(){return{tabSelect:"info",sie:(0,b["default"])(),modalPrestamo:!1,infoPrestamos:[],verEscaneo:!1,filter:null,estadosPrestamo:{2:"Activo",1:"Devuelto",3:"Perdida",4:"Anulado"},estados:[{value:"T",label:"Todos"},{value:2,label:"Activo"},{value:1,label:"Devuelto"},{value:3,label:"Perdida"},{value:4,label:"Anulado"}],infoBase:[],estado:2,filtradoQR:!1,columns:[]}},methods:{date:j.Ay,openScan:function(){this.verEscaneo=!0},leerRegistro:function(e,o){var t=this,n=e.split("|")[0],a=[];this.infoBase.forEach(function(e){var o=0;(e.ID_TABLET.toString()!==n||"T"!==t.estado&&e.PRESTAMO_ESTADO!==t.estado)&&(o=1),0===o&&a.push(e)}),a.length>0?(this.infoPrestamos=a,this.filtradoQR=!0,this.verEscaneo=!1,a.length>0&&this.$refs.audioOk.play()):(this.filtradoQR=!0,this.$refs.audioInfo.play(),(0,Q["default"])("No hay informacion de prestamo para esta tablet","info"))},init:function(){var e=this,o=[{name:"USUARIO",label:this.$t("usuario.nombre"),align:"left",field:"USUARIO"},{name:"PRESTAMO_ESTADO",label:this.$t("estado"),align:"center",field:"PRESTAMO_ESTADO"},{name:"FH_INICIO",label:this.$t("inicio"),align:"center",field:"FH_INICIO"},{name:"FH_FIN",label:this.$t("fin"),align:"center",field:"FH_FIN"}];U.$http.get("api/HyoTabletsprestamo/getPrestamos").then(function(t){var n=t.json;n.heads.forEach(function(e){o.push({name:"CAMPO"+e.ID_CARACTERISTICA,label:e.DESCRIPCION,align:"left",field:"CAMPO"+e.ID_CARACTERISTICA})}),o.push({name:"EDIT",align:"right",field:"EDIT"}),e.infoBase=n.info,e.columns=o,e.filtrarData()})},filtrarData:function(){"T"!==this.estado?this.infoPrestamos=(0,x.filterArray)(this.estado,{field:"PRESTAMO_ESTADO",list:this.infoBase}):this.infoPrestamos=this.infoBase},closeModalPrestamo:function(){this.modalPrestamo=!1,this.init()},prestarTablet:function(){this.modalPrestamo=!0},modifyPrestamo:function(e,o){var t=this,n=e.ID_PRESTAMO,a=e.ID_TABLET;U.$http.post("api/HyoTabletsprestamo/modificarPrestamo",{info:{ID_PRESTAMO:n,ID_TABLET:a,PRESTAMO_ESTADO:o}}).then(function(e){var o=e.json;(0,Q["default"])(t.$t("mensajes."+o.msg),o.type),o.type||t.init()})}},computed:{buttons:function(){var e=[];return 3===this.sie.ruta.nivel&&e.push({label:"Agregar",icon:"add",click:this.prestarTablet}),e}},mounted:function(){this.init()}};const X=(0,M.A)(W,[["render",f]]);var Y=X}}]);