"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[25032],{25032:function(e,o,t){t.r(o),t.d(o,{default:function(){return Z}});var r=t(61758),a=t(58790),i={class:"column q-pa-sm almacen-asignacion-periodo"},n={class:"row column"},l={class:"row"},s={class:"col-xs-12"},c={class:"row"},u={class:"row q-pa-xs"},d={class:"col-12"},f={class:"row"},m={class:"col"},E={class:"row q-col-gutter-sm q-pa-md"},h={class:"col-xs-12"},A={class:"col-xs-12"},p={class:"col-xs-12 row justify-center"};function v(e,o){var t=(0,r.g2)("q-select"),v=(0,r.g2)("q-card-main"),C=(0,r.g2)("q-card"),g=(0,r.g2)("q-btn"),D=(0,r.g2)("q-card-title"),P=(0,r.g2)("date-time"),b=(0,r.g2)("q-toggle"),O=(0,r.g2)("sie-modal");return(0,r.uX)(),(0,r.CE)("div",i,[(0,r.Lk)("div",n,[(0,r.bF)(C,{class:"q-mb-xs"},{default:(0,r.k6)(function(){return[(0,r.bF)(v,null,{default:(0,r.k6)(function(){return[(0,r.Lk)("div",l,[(0,r.Lk)("div",s,[(0,r.bF)(t,{class:"q-if-outlined",onInput:e.filterData,modelValue:e.selectYear,"onUpdate:modelValue":o[0]||(o[0]=function(o){return e.selectYear=o}),options:e.years,"float-label":"Seleccionar año"},null,8,["onInput","modelValue","options"])])])]}),_:1})]}),_:1})]),(0,r.Lk)("div",c,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.months,function(o){return(0,r.uX)(),(0,r.CE)("div",{key:o.key,class:"col-xs-12 col-sm-6 col-md-4 pointer"},[(0,r.Lk)("div",u,[(0,r.Lk)("div",d,[(0,r.bF)(C,{onClick:function(t){return e.configurar(o)}},{default:(0,r.k6)(function(){return[(0,r.bF)(D,null,{default:(0,r.k6)(function(){return[(0,r.Lk)("div",f,[(0,r.Lk)("span",m,(0,a.v_)(o.label),1),(0,r.bF)(g,{size:"xs",color:o.ESTADO?"teal":"red-4"},{default:(0,r.k6)(function(){return[(0,r.eW)((0,a.v_)(o.ESTADO?"Abierto":"Cerrado"),1)]}),_:2},1032,["color"])])]}),_:2},1024)]}),_:2},1032,["onClick"])])])])}),128))]),(0,r.bF)(O,{css:{width:"40vw",height:"35vh"},title:"Periodo",modelValue:e.modalPeriodo,"onUpdate:modelValue":o[4]||(o[4]=function(o){return e.modalPeriodo=o}),onSubmit:e.ModificarPeriodo},{default:(0,r.k6)(function(){return[(0,r.Lk)("div",E,[(0,r.Lk)("div",h,[(0,r.bF)(P,{type:"date",modelValue:e.form.FECHA_APE,"onUpdate:modelValue":o[1]||(o[1]=function(o){return e.form.FECHA_APE=o}),label:"Fecha apertura"},null,8,["modelValue"])]),(0,r.Lk)("div",A,[(0,r.bF)(P,{type:"date",modelValue:e.form.FECHA_CIE,"onUpdate:modelValue":o[2]||(o[2]=function(o){return e.form.FECHA_CIE=o}),label:"Fecha cierre"},null,8,["modelValue"])]),(0,r.Lk)("div",p,[(0,r.bF)(b,{modelValue:e.form.ESTADO,"onUpdate:modelValue":o[3]||(o[3]=function(o){return e.form.ESTADO=o}),"true-value":1,"false-value":0,label:e.form.ESTADO?"Abierto":"Cerrado"},null,8,["modelValue","label"])])])]}),_:1},8,["modelValue","onSubmit"])])}var C=t(76080),g=t.n(C),D=t(45254),P=t.n(D),b=(t(30683),t(52133),t(50310),t(6724),t(48426),t(83190),t(6123)),O=t(71271),S=t(24729),F=t(43136),I=t(982),k=t(18105),_=t(30640),T={class:"bg-white"},w={class:"row items-center no-wrap q-pa-md"},H={class:"col"},y={class:"text-h6"},q={key:0,class:"q-card-subtitle"},M={class:"col-auto"},L={class:"row full-width"},Y={key:0,class:"q-separator q-separator--horizontal col-grow"};function Q(e,o){var t=(0,r.g2)("q-btn");return(0,r.uX)(),(0,r.CE)("div",T,[(0,r.Lk)("div",w,[(0,r.Lk)("div",H,[(0,r.Lk)("div",y,(0,a.v_)(e.titulo),1),e.subtitulo?((0,r.uX)(),(0,r.CE)("div",q,(0,a.v_)(e.subtitulo),1)):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",M,[(0,r.Lk)("div",L,[(0,r.RG)(e.$slots,"default",{},function(){return[e.showNewButton?((0,r.uX)(),(0,r.Wv)(t,{key:0,class:"q-ml-sm",icon:"add",label:"Nuevo",size:"sm",color:"primary",onClick:e.nuevo},null,8,["onClick"])):(0,r.Q3)("v-if",!0)]})])])]),e.withBorder?((0,r.uX)(),(0,r.CE)("hr",Y)):(0,r.Q3)("v-if",!0)])}t(11777);var R=t(57668),V={emits:["nuevo"],props:{titulo:{type:String,required:!0},subtitulo:{type:String},permiso:{type:Number,default:1},withBorder:{type:Boolean,default:!0},showNewButton:{type:Boolean,default:!0}},components:{sieInfo:R["default"],QBtn:b.Il},data:function(){return{acceso:(0,R["default"])().ruta.nivel>=2,btnLoader:!1}},methods:{nuevo:function(){this.$emit("nuevo")}}},$=t(12807);const x=(0,$.A)(V,[["render",Q]]);var N=x;function B(e,o){var t=(0,r.g2)("q-card");return(0,r.uX)(),(0,r.Wv)(t,{class:"q-ma-sm column col q-card--bordered no-shadow"},{default:(0,r.k6)(function(){return[(0,r.RG)(e.$slots,"default")]}),_:3})}var U={components:{QCard:b.C$}};const X=(0,$.A)(U,[["render",B]]);var j=X,z=t(30545),W=t(54267),G=t(49420),J={components:{QTable:z.A,QTr:b.qh,QTh:b.EJ,QTd:b.Ef,QSelect:b.Si,QChip:b.wQ,sieModal:_.A,siePage:j,pageHeader:N,QDatetime:b.T5,QToggle:b.c5,LocalStorage:O.A,Dialog:S.A,DateTime:G.A,QCard:b.C$,QCardMain:b.d1,QCardTitle:b.u0,QBtn:b.Il},data:function(){return{item:"",modalPeriodo:!1,months:[],monthsArr:[],years:[],selectYear:"",columns:[{name:"MESDES",label:"MES",align:"center",field:"MESDES"},{name:"FECHA_APE",label:"FEC. APERTURA",align:"center",field:"FECHA_APE"},{name:"FECHA_CIE",label:"FEC. CIERRE",align:"center",field:"FECHA_CIE"},{name:"ESTADO",label:"ESTADO",align:"center",field:"ESTADO"}],form:{MES:"",ANIO:"",FECHA_APE:null,FECHA_CIE:null,ESTADO:0}}},methods:{init:function(){this.getPeriodos()},getPeriodos:function(){var e=this,o={anio:this.selectYear};this.$http.get("api/HyoPeriodos/getPeriodosByYear",{params:o}).then(function(o){var t={};o.map(function(e){t[e.MES]=e}),e.monthsArr=(0,W.generarMeses)(),e.monthsArr.map(function(e){t[e.value2]&&Object.assign(e,t[e.value2])}),e.months=e.monthsArr})},openDialog:function(e,o){var t=this,r="A"===e?"Apertura":"Cierre";this.$q.dialog({title:"Fecha de ".concat(r),message:"Seleccione la Fecha de ".concat(r," del perioro"),prompt:{model:"",type:"date"},cancel:!0,color:"secondary"}).onOk(function(r){"A"===e?t.openPeriodo(o,r):"C"===e&&t.closePeriodo(o,r)}).onCancel(function(){t.getPeriodos()})},cleanForm:function(){this.form={MES:"",ANIO:"",FECHA_APE:null,FECHA_CIE:null,ESTADO:0}},openPeriodo:function(e,o){var t=this;this.form["MES"]=e.MESCOD,this.form["ANIO"]=this.selectYear,this.form["FECHA_CIE"]=null,this.form["FECHA_APE"]=o,this.form["ESTADO"]=!0,this.$http.post("api/HyoPeriodos/savePeriodo",{params:this.form}).then(function(e){(0,I["default"])(e.json.message)}).then(function(){t.getPeriodos(),t.cleanForm()}).catch(function(e){(0,I["default"])(e.error.message,"error")})},closePeriodo:function(e,o){var t=this,r={FECHA_CIE:o,ESTADO:!1};this.$http.put("api/HyoPeriodos/updatePeriodo",{idperiodo:e.IDPERIODO,data:r}).then(function(e){(0,I["default"])(e.json.message)}).then(function(){t.getPeriodos(),t.cleanForm()}).catch(function(e){(0,I["default"])(e.error.message,"error")})},config:function(e){var o=this;e.ESTADO?this.$http.get("api/HyoPeriodos/validarPeriodoAbierto").then(function(t){t.COUNT>0?((0,I["default"])("Existe un periodo abierto, debe cerrarlo antes de continuar","warning"),o.getPeriodos()):o.openDialog("A",e)}):this.openDialog("C",e)},ModificarPeriodo:function(){var e=this;return P()(g()().m(function o(){var t,r;return g()().w(function(o){while(1)switch(o.n){case 0:if(t=function(){var o={anio:parseInt(e.selectYear),mes:parseInt(e.form.MES),fecha_ape:(0,k.Ay)(e.form.FECHA_APE,"YYYY-MM-DD"),fecha_cie:(0,k.Ay)(e.form.FECHA_CIE,"YYYY-MM-DD"),estado:e.form.ESTADO};e.form.idperiodo&&(o.idperiodo=e.form.idperiodo),e.$http.post("api/HyoPeriodos/savePeriodo",{params:o}).then(function(o){var t=o.result;if(t.IDPERIODO){e.item.IDPERIODO=t.IDPERIODO,e.form.idperiodo=t.IDPERIODO;var r=O.A.getItem("params");e.form.ESTADO?r.idperiodo=t.IDPERIODO:delete r.idperiodo,O.A.set("params",r)}e.item.ESTADO=e.form.ESTADO,e.modalPeriodo=!1,(0,I["default"])("Registro actualizado correctamente.")})},e.form.FECHA_CIE||e.form.ESTADO){o.n=1;break}(0,I["default"])("Debe seleccionar fecha de cierre.","warning"),o.n=4;break;case 1:if(!e.form.FECHA_CIE||!e.form.ESTADO){o.n=3;break}return o.n=2,e.$confirmar("Realmente desea reaperturar este periodo?","info");case 2:r=o.v,r&&t(),o.n=4;break;case 3:t();case 4:return o.a(2)}},o)}))()},configurar:function(e){var o=this;this.item=e,delete this.form.idperiodo,this.form.FECHA_APE=new Date("".concat(this.selectYear,"/").concat(e.value,"/01")),this.form.FECHA_CIE=new Date(this.selectYear,e.value,0),this.form.MES=e.value,this.form.ESTADO=this.item.ESTADO,e.ESTADO?this.modalPeriodo=!0:this.$http.get("api/HyoPeriodos/validarPeriodoAbierto").then(function(e){e.COUNT>0?(0,I["default"])("Existe un periodo abierto. no puede ingresar aquí","warning"):o.modalPeriodo=!0})},filterData:function(){this.getPeriodos()},loadPeriodo:function(e,o,t){var r=this;return this.$http.get("api/HyoPeriodos/obtPeriodo",{params:{anio:o,mes:t}}).then(function(e){e.IDPERIODO?(r.form.idperiodo=e.IDPERIODO,r.form.MES=e.MES,r.form.ANIO=e.ANIO,r.form.FECHA_APE=e.FECHA_APE,r.form.FECHA_CIE=e.FECHA_CIE,r.form.ESTADO=e.ESTADO):(r.form.FECHA_CIE=null,r.form.ESTADO=0)})}},created:function(){var e=(new Date).getFullYear();this.years=(0,F.generarAnios)(4),this.selectYear=e,this.init()}};const K=(0,$.A)(J,[["render",v]]);var Z=K}}]);