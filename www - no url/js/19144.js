"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[19144],{19144:function(e,t,n){n.r(t),n.d(t,{default:function(){return W}});var o=n(61758),a={class:"row items-center no-wrap"},r={class:"row q-ma-xs q-col-gutter-sm"},c={class:"col-xs-12 col-sm-3"},l={class:"col-xs-12 col-sm-3"},s={class:"col-xs-12 col-sm-3"},i={class:"col-xs-12 col-sm-3"},u={class:"row q-ma-xs q-col-gutter-sm"},d={class:"col-xs-12 col-sm-3"},m={class:"col-xs-12 col-sm-3"},p={class:"col-xs-12 col-sm-3"},f={class:"col-xs-12 col-sm-3"},h={class:"row q-ma-xs q-col-gutter-sm"},g={class:"col-xs-12 col-sm-3"};function C(e,t){var n=(0,o.g2)("crearBotones"),C=(0,o.g2)("q-card-section"),E=(0,o.g2)("q-separator"),b=(0,o.g2)("q-select"),A=(0,o.g2)("q-date"),v=(0,o.g2)("q-popup-proxy"),D=(0,o.g2)("q-icon"),w=(0,o.g2)("q-input"),O=(0,o.g2)("q-btn"),S=(0,o.g2)("sie-grid"),R=(0,o.g2)("footer-grid"),T=(0,o.g2)("q-card");return(0,o.uX)(),(0,o.Wv)(T,{class:"layout-v1 my-card",flat:"",bordered:""},{default:(0,o.k6)(function(){return[(0,o.bF)(C,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",a,[t[13]||(t[13]=(0,o.Lk)("div",{class:"col"},[(0,o.Lk)("div",{class:"text-h6"},"Comprobantes Electrónicos")],-1)),(0,o.bF)(n,{title:"Opciones",buttons:e.botonesDropdown,nivelAcceso:e.nivelAcceso,opcion:e.nameComponente,dropdown:!0},null,8,["buttons","nivelAcceso","opcion"])])]}),_:1}),(0,o.bF)(E),(0,o.bF)(C,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",r,[(0,o.Lk)("div",c,[(0,o.bF)(b,{modelValue:e.seleccionaAnio,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.seleccionaAnio=t}),label:"Año",options:e.anios,placeholder:"Seleccione Año","option-value":"value","option-label":"label",onInput:e.asignarFechas},null,8,["modelValue","options","onInput"])]),(0,o.Lk)("div",l,[(0,o.bF)(b,{modelValue:e.selecionarMes,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.selecionarMes=t}),label:"Mes",options:e.meses,placeholder:"Seleccione Mes","option-value":"value","option-label":"label",onInput:e.asignarFechas},null,8,["modelValue","options","onInput"])]),(0,o.Lk)("div",s,[(0,o.bF)(w,{label:"Fecha Inicio",debounce:"500",maxlength:"10",format:"##/##/####",modelValue:e.fechaInicio,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.fechaInicio=t}),mask:"##/##/####",readonly:"",onInput:e.getDocumentoElectronicos},{append:(0,o.k6)(function(){return[(0,o.bF)(D,{class:"cursor-pointer",name:"date_range"},{default:(0,o.k6)(function(){return[(0,o.bF)(v,{ref:"qDateProxy1","transition-show":"scale","transition-hide":"scale"},{default:(0,o.k6)(function(){return[(0,o.bF)(A,{mask:"DD/MM/YYYY",modelValue:e.fechaInicio,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.fechaInicio=t}),onInput:t[3]||(t[3]=function(t){return e.closeModalFecha("qDateProxy1")})},null,8,["modelValue"])]}),_:1},512)]}),_:1})]}),_:1},8,["modelValue","onInput"])]),(0,o.Lk)("div",i,[(0,o.bF)(w,{label:"Fecha Fin",debounce:"500",maxlength:"10",format:"##/##/####",modelValue:e.fechaFin,"onUpdate:modelValue":t[7]||(t[7]=function(t){return e.fechaFin=t}),mask:"##/##/####",readonly:"",onInput:e.getDocumentoElectronicos},{append:(0,o.k6)(function(){return[(0,o.bF)(D,{class:"cursor-pointer",name:"date_range"},{default:(0,o.k6)(function(){return[(0,o.bF)(v,{ref:"qDateProxy2","transition-show":"scale","transition-hide":"scale"},{default:(0,o.k6)(function(){return[(0,o.bF)(A,{mask:"DD/MM/YYYY",modelValue:e.fechaFin,"onUpdate:modelValue":t[5]||(t[5]=function(t){return e.fechaFin=t}),onInput:t[6]||(t[6]=function(t){return e.closeModalFecha("qDateProxy2")})},null,8,["modelValue"])]}),_:1},512)]}),_:1})]}),_:1},8,["modelValue","onInput"])])]),(0,o.Lk)("div",u,[(0,o.Lk)("div",d,[(0,o.bF)(b,{modelValue:e.selectTalon,"onUpdate:modelValue":t[8]||(t[8]=function(t){return e.selectTalon=t}),label:"Serie Electrónica",options:e.talonarios,placeholder:"Talonario","option-value":"value","option-label":"label",onInput:e.getDocumentoElectronicos},null,8,["modelValue","options","onInput"])]),(0,o.Lk)("div",m,[(0,o.bF)(b,{label:"Tipo de Comprobante",placeholder:"Tipo de Comprobante","option-label":"COMPROBANTE","option-value":"CODSUNAT",options:e.comprobantesPago,modelValue:e.selectComprobante,"onUpdate:modelValue":t[9]||(t[9]=function(t){return e.selectComprobante=t}),onInput:e.getDocumentoElectronicos},null,8,["options","modelValue","onInput"])]),(0,o.Lk)("div",p,[(0,o.bF)(b,{label:"Punto de Venta",options:e.puntosVenta,"option-label":"label","option-value":"value",modelValue:e.puntoDeVenta,"onUpdate:modelValue":t[10]||(t[10]=function(t){return e.puntoDeVenta=t}),onInput:e.getDocumentoElectronicos},null,8,["options","modelValue","onInput"])]),(0,o.Lk)("div",f,[(0,o.bF)(b,{label:"Estado de Correo",options:e.dataCorreo,"option-label":"label","option-value":"value",modelValue:e.estadoCorreo,"onUpdate:modelValue":t[11]||(t[11]=function(t){return e.estadoCorreo=t}),onInput:e.getDocumentoElectronicos},null,8,["options","modelValue","onInput"])])]),(0,o.Lk)("div",h,[(0,o.Lk)("div",g,[e.dowload?((0,o.uX)(),(0,o.Wv)(O,{key:0,class:"q-mb-xs",label:e.nameButton,icon:"file_download",color:"primary",size:"sm",onClick:e.descargarZip},null,8,["label","onClick"])):(0,o.Q3)("v-if",!0)])]),(0,o.Lk)("div",null,[(0,o.bF)(S,{class:"fix-table-global ag-theme-balham",style:{width:"100%",height:"calc(100vh - 340px)"},columnDefs:e.columnDefs,rowData:e.rowData,rowSelection:"multiple",frameworkComponents:e.frameworkComponents,componentFromFramework:e.componentFromFramework,defaultColDef:e.defaultColDef,floatingFilter:!0,enableCellTextSelection:!0,onGridReady:e.onGridReady,onFilterChanged:e.onFilterChanged},null,8,["columnDefs","rowData","frameworkComponents","componentFromFramework","defaultColDef","onGridReady","onFilterChanged"]),(0,o.bF)(R,{modelValue:e.pagina,"onUpdate:modelValue":t[12]||(t[12]=function(t){return e.pagina=t}),max:e.pages,rows:e.contador,onLoad:e.getDocumentoElectronicos},null,8,["modelValue","max","rows","onLoad"])])]}),_:1})]}),_:1})}var E=n(41562),b=n.n(E),A=n(57008),v=n.n(A),D=n(8445),w=n.n(D),O=n(76080),S=n.n(O),R=n(45254),T=n.n(R),N=(n(34634),n(30683),n(71587),n(39866),n(23825),n(52133),n(10239),n(56285),n(50310),n(6724),n(11777),n(32408),n(515),n(83190),n(27153),n(40048),n(52776),n(88390),n(66307),n(81813),n(24066),n(88567)),k=n(95718),I=n(95051),M=n(53380),F=n(64208),U=n(12143),_=n(18105),$=n(95477),L=n(80660),V=n(6123),P=n(36408),x=n(78840),y=n(26319),q=n(54267),G=n(56945),Y=n(42037),B=n(27560),X=n(54489),H=n(75053),z=n(41615),Q=n(64303),j=n(6557),Z={props:["lessHeight","cp"],components:{sieModal:H.A,QChip:I.A,QDate:U.A,QPopupProxy:$.A,QCard:N.A,QCardSection:k.A,QSelect:X.S,QOptionGroup:V.EX,QSeparator:M.A,sieGrid:P.A,QInput:F.A,footerGrid:B.A,QBtnDropdown:V.B4,crearBotones:Q.A,parseStringToDate:y.parseStringToDate,QIcon:V.bP,QBtn:V.Il},mixins:[G.A],data:function(){return{columnDefs:[],rowData:[],frameworkComponents:{},pagina:1,pages:1,api:null,botones:[],resumenElectronicos:{name:"",ruta:""},nivelAcceso:3,nameComponente:"PanelElectronico",fechaInicio:"",fechaFin:"",selecionarMes:z["default"].CURRENT_MONTH,seleccionaAnio:String(z["default"].CURRENT_YEAR),talonarios:[],selectTalon:z["default"].TODOS,anios:[],meses:[],selectComprobante:z["default"].TODOS,comprobantesPago:[],botonesDropdown:[],rows:0,puntosVenta:[],puntoDeVenta:z["default"].TODOS,dataCorreo:[{label:"Todos",value:z["default"].TODOS},{label:"(0) Sin enviar",value:z["default"].ESTADOS_CORREOS.SIN_ENVIAR},{label:"(1) Enviado",value:z["default"].ESTADOS_CORREOS.ENVIADO},{label:"(2) Error de correo",value:z["default"].ESTADOS_CORREOS.ERROR_CORREO},{label:"(3) Error interno",value:z["default"].ESTADOS_CORREOS.ERROR_INTERNO},{label:"(4) Sin Correo",value:z["default"].ESTADOS_CORREOS.SIN_CORREO}],estadoCorreo:z["default"].TODOS,dowload:!1,carpeta:"",nameButton:"",nombre:"",rowDataInitial:[],filterNumero:"",componentFromFramework:[],defaultColDef:{suppressHeaderMenuButton:!0,filter:!0,floatingFilterComponentParams:{suppressFilterButton:!0},resizable:!0,sortable:!0,suppressDragLeaveHidesColumns:!0},contador:[],filterModel:[]}},methods:{onFilterChanged:function(e){this.contador=Array.from({length:e.api.getDisplayedRowCount()}),this.filterModel=e.api.getFilterModel()},restoreFilterState:function(){this.filterModel&&this.api.setFilterModel(this.filterModel)},getTipoComprobantes:function(){var e=this;return T()(S()().m(function t(){var n;return S()().w(function(t){while(1)switch(t.n){case 0:return t.n=1,L.$http.get("api/talonarioController/getTipoComprobante",{params:{parametros:{electronico:!0}}});case 1:n=t.v,n.unshift({COMPROBANTE:"Todos",CODSUNAT:z["default"].TODOS}),e.comprobantesPago=n;case 2:return t.a(2)}},t)}))()},asignarFechas:function(){var e=this;return T()(S()().m(function t(){var n;return S()().w(function(t){while(1)switch(t.n){case 0:if(!e.seleccionaAnio||!e.selecionarMes){t.n=1;break}return n=new Date(e.seleccionaAnio,e.selecionarMes,0).getDate(),e.fechaInicio="01/".concat(e.selecionarMes,"/").concat(e.seleccionaAnio),e.fechaFin="".concat(n,"/").concat(e.selecionarMes,"/").concat(e.seleccionaAnio),t.n=1,e.getDocumentoElectronicos();case 1:return t.a(2)}},t)}))()},filtros:function(){var e=this;return T()(S()().m(function t(){var n,o,a;return S()().w(function(t){while(1)switch(t.n){case 0:return n={NUMTAL:e.selectTalon,CODSUNAT:e.selectComprobante,ID_CAJA:e.puntoDeVenta,CORREO:e.estadoCorreo,NOMBRE:e.nombre,NUMERO:e.filterNumero},o=w()(e.rowDataInitial),t.n=1,(0,j.A)({keys:n,data:o,flatTodos:!0});case 1:a=t.v,e.rowData=a,e.contador=a,e.$nextTick(function(){e.restoreFilterState()});case 2:return t.a(2)}},t)}))()},getDocumentoElectronicos:function(){var e=this;return T()(S()().m(function t(){var n,o,a;return S()().w(function(t){while(1)switch(t.n){case 0:return n={anocob:e.seleccionaAnio,talonario:e.selectTalon&&e.selectTalon!==z["default"].TODOS?e.selectTalon:z["default"].LIKE_TODOS,consunat:e.selectComprobante&&e.selectComprobante!==z["default"].TODOS?e.selectComprobante:z["default"].LIKE_TODOS,mescob:e.selecionarMes,fechaInicio:(0,q.convertToYMD)(e.fechaInicio),fechaFin:(0,q.convertToYMD)(e.fechaFin),puntoVenta:e.puntoDeVenta!==z["default"].TODOS?e.puntoDeVenta:z["default"].LIKE_TODOS,correo:e.estadoCorreo,nombre:e.nombre},e.$q.loading.show(),t.n=1,L.$http.get("api/ComprobanteElectronicoController/getComprobantesElectronicosPanel",{params:{parametros:n}});case 1:for(o=t.v,a=0;a<o.length;a++)o[a].FECEMIDES=(0,y.parseStringToDate)(o[a].FECEMI);e.rowData=o,e.$q.loading.hide(),e.rowDataInitial=w()(e.rowData),e.filtros();case 2:return t.a(2)}},t)}))()},crearBotones:function(){this.botonesDropdown=[{icon:"file_excel",click:this.generarExcel,label:"Exportar Excel",minAcceso:z["default"].LECTURA_ESCRITURA},{icon:"file_find",click:this.consultarSunat,label:"Consultar Sunat",minAcceso:z["default"].LECTURA_ESCRITURA},{icon:"sync",click:this.reenviar,label:"Reenviar a Sunat",minAcceso:z["default"].LECTURA_ESCRITURA},{icon:"f_zip",click:this.comprimirComprobantes,label:"Comprimir Comprobantes",minAcceso:z["default"].LECTURA_ESCRITURA},{icon:"email",click:this.enviarCorreo,label:"Enviar Correo",minAcceso:z["default"].LECTURA_ESCRITURA},{icon:"file_check",click:this.recuperarCdr,label:"Recuperar CDR",minAcceso:z["default"].LECTURA_ESCRITURA},{icon:"file_xml",click:this.construirXml,label:"Construir Xml",minAcceso:z["default"].LECTURA_ESCRITURA},{icon:"delete_forever",click:this.eleminarXml,label:"Eliminar Xml",minAcceso:z["default"].LECTURA_ESCRITURA},{icon:"file_pdf",click:this.reporteEnvioCorreo,label:"Error de Correos",minAcceso:z["default"].LECTURA_ESCRITURA},{icon:"email_secure",click:this.actualizarEnvioDeAlerta,label:"No Envía Alerta",minAcceso:z["default"].LECTURA_ESCRITURA}]},formatoFecha:function(e){var t=e.split("T")[0].split("-");return"".concat(t.at(-1),"/").concat(t.at(1),"/").concat(t.at(0))},formatoFechaHora:function(e){var t=this.formatoFecha(e),n=e.split("T")[1].replace(".000Z","");return"".concat(t," ").concat(n)},generarExcel:function(){var e=this;return T()(S()().m(function t(){var n,o,a,r;return S()().w(function(t){while(1)switch(t.n){case 0:return n=["ANUPAG","ESTADO","CORREO","FILE_DOC","ID_PERFIL","ID_CAJA","FECEMIDES","NUMTAL","NUMPAG"],o=w()(e.rowData).map(function(t){for(var o=0,a=n;o<a.length;o++){var r=a[o];delete t[r]}return v()(v()({},t),{},{FECEMI:t.FECEMI?e.formatoFecha(t.FECEMI):"",FECHA_ENVIO:t.FECHA_ENVIO?(0,_.Ay)(t.FECHA_ENVIO,"DD/MM/YYYY HH:mm:ss"):""})}),t.n=1,L.$http.post("api/TesoreriaServiciosController/postExportarExcel",{datos:{data:o,filename:"reporte_electronicos"}});case 1:a=t.v,r='{"name":"'.concat(a.ruta,'","ruta":"').concat(a.ruta,'","tipo":"xlsx"}'),z["default"].DESCARGAR_ARCHIVO(r),e.$alert("Archivo Excportado Satisfactoriamente","success");case 2:return t.a(2)}},t)}))()},actualizarEnvioDeAlerta:function(){var e=this,t=this.api.getSelectedRows();if(0===t.length)return this.$alert("No selecciono ningún registro","warning");this.$confirm("¿Seguro de bloquear el envío de alerta de los (".concat(t.length,")comprobantes?")).onOk(T()(S()().m(function n(){var o,a,r,c,l,s,i,u;return S()().w(function(n){while(1)switch(n.p=n.n){case 0:n.p=0,e.$q.loading.show(),o=[],a=b()(t);try{for(a.s();!(r=a.n()).done;)c=r.value,l={FLAG_ALERT:z["default"].NO_ENVIA_ALERTA,NUMTAL:c.NUMTAL,NUMPAG:c.NUMPAG},o.push(L.$http.put("api/ComprobanteElectronicoController/putComprobanteElectronico",{datos:l}))}catch(e){a.e(e)}finally{a.f()}return n.n=1,Promise.allSettled(o);case 1:if(s=n.v,i=Object.groupBy(s,function(e){return e.status}),i.rejected){n.n=2;break}return n.a(2,e.$alert("(".concat(Object.keys(i.fulfilled).length,")Comprobantes Electronicos Actualizados Satisfactoriamente"),"success"));case 2:if(i.fulfilled){n.n=3;break}return n.a(2,e.$alert("(".concat(Object.keys(i.rejected).length,")Comprobantes Electronicos No Actualizados"),"warning"));case 3:return n.a(2,e.$alert("(".concat(Object.keys(i.fulfilled).length,")Comprobantes Electronicos Actualizados Satisfactoriamente. \n                                   (").concat(Object.keys(i.rejected).length,")Comprobantes Electronicos No Actualizados Satisfactoriamente."),"success"));case 4:n.p=4,u=n.v,e.$alert(u.error?u.error.message:u.message);case 5:return n.p=5,e.$q.loading.hide(),e.getDocumentoElectronicos(),n.f(5);case 6:return n.a(2)}},n,null,[[0,4,5,6]])})))},reporteEnvioCorreo:function(){var e=z["default"].ESTADOS_CORREOS.ERROR_CORREO,t="".concat(origin,"/webservice/reporte-tesoreria/reporte-correos-enviados?anio=").concat(this.seleccionaAnio,"&mes=").concat(this.selecionarMes,"&fechaini=").concat(this.fechaInicio,"&fechafin=").concat(this.fechaFin,"&talon=").concat(this.selectTalon,"&codsunat=").concat(this.selectComprobante,"&estadoCorreo=").concat(e);window.open(t,"_blank")},closeModalFecha:function(e){this.$refs[e].hide(),this.getDocumentoElectronicos()},getTalonarios:function(){var e=this;return T()(S()().m(function t(){var n;return S()().w(function(t){while(1)switch(t.n){case 0:return t.n=1,L.$http.get("api/talonarioController/getTalon",{params:{parametros:{electronico:"S"}}});case 1:n=t.v,n.map(function(t){var n="".concat(t.NUMTAL," | ").concat(t.SERIE," | ").concat(t.NUMERO," | ").concat(t.TALDES);e.talonarios.push({value:t.NUMTAL,label:n})}),e.talonarios.unshift({label:"Todos",value:z["default"].TODOS});case 2:return t.a(2)}},t)}))()},getAnios:function(){var e=this;return T()(S()().m(function t(){return S()().w(function(t){while(1)switch(t.n){case 0:return t.n=1,z["default"].API_ANIOS();case 1:e.anios=t.v;case 2:return t.a(2)}},t)}))()},getMeses:function(){var e=this;return T()(S()().m(function t(){return S()().w(function(t){while(1)switch(t.n){case 0:return t.n=1,z["default"].MESES();case 1:e.meses=t.v;case 2:return t.a(2)}},t)}))()},eleminarXml:function(){var e=this,t=this.api.getSelectedRows();if(0===t.length)return this.$alert("No se seleccionó ningún registro","warning");this.$confirm("¿Esta seguro de eliminar los comprobantes electrónicos?","info").onOk(T()(S()().m(function n(){var o,a,r,c,l,s,i,u,d,m,p;return S()().w(function(n){while(1)switch(n.p=n.n){case 0:o={correctamente:[],errores:[]},e.$q.loading.show(),a=b()(t),n.p=1,a.s();case 2:if((r=a.n()).done){n.n=7;break}return c=r.value,n.p=3,n.n=4,L.$http.delete("api/PagoController/deleteXml",{params:{comprobante:{numtal:c.NUMTAL,numpag:c.NUMPAG}}});case 4:l=n.v,o.correctamente.push(l),n.n=6;break;case 5:n.p=5,m=n.v,o.errores.push(m);case 6:n.n=2;break;case 7:n.n=9;break;case 8:n.p=8,p=n.v,a.e(p);case 9:return n.p=9,a.f(),n.f(9);case 10:s="",i="",o.correctamente.length>0&&(s+="(".concat(o.correctamente.length,") Documentos Eliminados Satisfactoriamente."),i="success"),o.errores.length>0&&(s+="(".concat(o.errores.length,") Documentos no eliminados")),0===o.correctamente.length&&(i="warning",1===o.errores.length&&(u=w()(o.errores),d=u[0],s=d.error.message)),e.$alert(s,i),e.$q.loading.hide(),e.getDocumentoElectronicos();case 11:return n.a(2)}},n,null,[[3,5],[1,8,9,10]])})))},recuperarCdr:function(){var e=this,t=this.api.getSelectedRows();if(0===t.length)return this.$alert("No seleccionó ningún registro","warning");this.$confirm("¿Desea recuperar el CDR de la Factura seleccionada?","info").onOk(T()(S()().m(function n(){var o,a,r,c,l,s,i,u,d,m,p,f;return S()().w(function(n){while(1)switch(n.p=n.n){case 0:o={correctamente:[],errores:[]},e.$q.loading.show(),a=b()(t),n.p=1,a.s();case 2:if((r=a.n()).done){n.n=7;break}if(c=r.value,c.CODSUNAT===z["default"].CODSUNAT.FACTURA){n.n=3;break}return e.$q.loading.hide(),n.a(2,e.$alert("Solo se puede recuperar CDR de FACTURA","warning"));case 3:return n.p=3,l={ruc:c.RUC_EMISOR,codsunat:c.CODSUNAT,serie_documento:c.SERIE,numero_documento:c.NUMERO},n.n=4,L.$http.get("api/ComprobanteElectronicoController/getCdrFactura",{params:{params:l}});case 4:s=n.v,o.correctamente.push(s),n.n=6;break;case 5:n.p=5,p=n.v,o.errores.push(p);case 6:n.n=2;break;case 7:n.n=9;break;case 8:n.p=8,f=n.v,a.e(f);case 9:return n.p=9,a.f(),n.f(9);case 10:i="",u="",o.correctamente.length>0&&(i+="(".concat(o.correctamente.length,") CDR's Recuperados"),u="success"),o.errores.length>0&&(i+="(".concat(o.errores.length,") CDR's no encontrados")),0===o.correctamente.length&&(u="warning",1===o.errores.length&&(d=w()(o.errores),m=d[0],i=m.error.message)),e.$alert(i,u),e.$q.loading.hide(),e.getDocumentoElectronicos();case 11:return n.a(2)}},n,null,[[3,5],[1,8,9,10]])})))},construirXml:function(){var e=this,t=this.api.getSelectedRows();if(0===t.length)return this.$alert("No seleccionó ningún registro","warning");this.$confirm("¿Esta seguro de generar los XML?","info").onOk(T()(S()().m(function n(){var o,a,r,c,l,s,i,u,d,m,p;return S()().w(function(n){while(1)switch(n.p=n.n){case 0:o={correctamente:[],errores:[]},e.$q.loading.show(),a=b()(t),n.p=1,a.s();case 2:if((r=a.n()).done){n.n=9;break}if(c=r.value,n.p=3,Number(c.FILE_DOC)!==Number(z["default"].XML_NO_GENERADO)){n.n=5;break}return n.n=4,L.$http.get("api/PagoController/getCorregirComprobanteElectronico",{params:{parametros:{numtal:c.NUMTAL,numpag:c.NUMPAG}}});case 4:l=n.v,o.correctamente.push(l),n.n=6;break;case 5:o.errores.push({error:{message:"El documento ya tiene generado su XML"}});case 6:n.n=8;break;case 7:n.p=7,m=n.v,o.errores.push(m);case 8:n.n=2;break;case 9:n.n=11;break;case 10:n.p=10,p=n.v,a.e(p);case 11:return n.p=11,a.f(),n.f(11);case 12:s="",i="",o.correctamente.length>0&&(s+="(".concat(o.correctamente.length,") Documentos Generados Satisfactoriamente."),i="success"),o.errores.length>0&&(s+="(".concat(o.errores.length,") Documentos no generados")),0===o.correctamente.length&&(i="warning",1===o.errores.length&&(u=w()(o.errores),d=u[0],s=d.error.message)),e.$alert(s,i),e.$q.loading.hide(),e.getDocumentoElectronicos();case 13:return n.a(2)}},n,null,[[3,7],[1,10,11,12]])})))},enviarCorreo:function(){var e=this,t=this.api.getSelectedRows();if(0===t.length)return this.$alert("No seleccionó ningún registro","warning");this.$confirm("¿Esta seguro de enviar los correos?","info").onOk(T()(S()().m(function n(){var o,a,r,c,l,s,i,u,d,m,p,f,h;return S()().w(function(n){while(1)switch(n.p=n.n){case 0:n.p=0,o={correctamente:[],errores:[]},e.$q.loading.show(),a=b()(t),n.p=1,a.s();case 2:if((r=a.n()).done){n.n=7;break}return c=r.value,n.p=3,l={NUMTAL:c.NUMTAL,NUMPAG:c.NUMPAG,ID_PERSONA:c.ID_PERSONA,ID_PERFIL:c.ID_PERFIL},n.n=4,L.$http.post("api/EnvioAlertaController/postEnviarComprobanteElectronico",{params:l});case 4:s=n.v,o.correctamente.push(s),n.n=6;break;case 5:n.p=5,p=n.v,o.errores.push(p);case 6:n.n=2;break;case 7:n.n=9;break;case 8:n.p=8,f=n.v,a.e(f);case 9:return n.p=9,a.f(),n.f(9);case 10:i="",u="",o.correctamente.length>0&&(i+="(".concat(o.correctamente.length,") Correos Enviados Satisfactoriamente."),u="success"),o.errores.length>0&&(i+="(".concat(o.errores.length,") Correos no enviados")),0===o.correctamente.length&&(u="warning",1===o.errores.length&&(d=w()(o.errores),m=d[0],i=m.error.message)),e.$alert(i,u),e.$q.loading.hide(),e.getDocumentoElectronicos(),n.n=12;break;case 11:n.p=11,h=n.v,e.$alert(h.error.message);case 12:return n.a(2)}},n,null,[[3,5],[1,8,9,10],[0,11]])})))},comprimirComprobantes:function(){var e=this;return T()(S()().m(function t(){var n,o,a;return S()().w(function(t){while(1)switch(t.n){case 0:if(n=e.api.getSelectedRows(),e.puntoDeVenta!==z["default"].TODOS){t.n=1;break}return t.a(2,e.$alert("Debe elegir el punto de venta","warning"));case 1:if(0!==n.length){t.n=2;break}return t.a(2,e.$alert("No seleccionó ningún registro","warning"));case 2:return o="".concat(e.seleccionaAnio,"-").concat(e.selecionarMes),t.n=3,L.$http.post("api/ComprobanteElectronicoController/postVerificarCarpetarZip",{parametros:{carpeta:o}});case 3:a=t.v,e.$confirm("¿Esta seguro de descargar los (".concat(n.length,") comprobantes electrónicos?"),"info").onOk(T()(S()().m(function t(){var r,c,l,s,i,u,d,m;return S()().w(function(t){while(1)switch(t.p=t.n){case 0:r={correctamente:[],errores:[]},e.$q.loading.show(),c=b()(n),t.p=1,c.s();case 2:if((l=c.n()).done){t.n=7;break}return s=l.value,t.p=3,t.n=4,L.$http.get("api/PagoController/getCorregirComprobanteElectronico",{params:{parametros:{numtal:s.NUMTAL,numpag:s.NUMPAG,carpeta:{nombre:o}}}});case 4:i=t.v,r.correctamente.push(i),t.n=6;break;case 5:t.p=5,d=t.v,r.errores.push(d);case 6:t.n=2;break;case 7:t.n=9;break;case 8:t.p=8,m=t.v,c.e(m);case 9:return t.p=9,c.f(),t.f(9);case 10:return t.n=11,L.$http.post("api/ComprobanteElectronicoController/postDescargarZip",{parametros:{ruta:a,nombreArchivo:o}});case 11:u=t.v,e.resumenElectronicos.name=a,e.resumenElectronicos.ruta=u,e.carpeta=o,e.nameButton="Descargar Zip "+a,e.$alert("Comprobantes comprimidos Satisfactoriamente","success"),e.dowload=!0,e.$q.loading.hide();case 12:return t.a(2)}},t,null,[[3,5],[1,8,9,10]])})));case 4:return t.a(2)}},t)}))()},descargarZip:function(){var e=this;return T()(S()().m(function t(){var n;return S()().w(function(t){while(1)switch(t.n){case 0:return n='{"name":"'.concat(e.resumenElectronicos.name,'.zip","ruta":"').concat(e.resumenElectronicos.ruta,'","tipo":"zip"}'),t.n=1,z["default"].DESCARGAR_ARCHIVO(n);case 1:e.$alert("Archivo Descargado Satisfactoriamente","success");case 2:return t.a(2)}},t)}))()},reenviar:function(){var e=this;return T()(S()().m(function t(){var n;return S()().w(function(t){while(1)switch(t.n){case 0:if(n=e.api.getSelectedRows(),0!==n.length){t.n=1;break}return t.a(2,e.$alert("No seleccionó ningún registro","warning"));case 1:e.$confirm("¿Esta seguro de reenviar los (".concat(n.length,") comprobantes a SUNAT?"),"info").onOk(T()(S()().m(function t(){var o,a,r,c,l,s,i,u,d,m,p;return S()().w(function(t){while(1)switch(t.p=t.n){case 0:o={correctamente:[],errores:[]},e.$q.loading.show(),a=b()(n),t.p=1,a.s();case 2:if((r=a.n()).done){t.n=9;break}if(c=r.value,!(c.CODSUNAT===z["default"].CODSUNAT.FACTURA||[z["default"].CODSUNAT.NOTA_CREDITO,z["default"].CODSUNAT.NOTA_DEBITO].includes(c.CODSUNAT)&&c.CODSUNAT_REF===z["default"].CODSUNAT.FACTURA)){t.n=7;break}return t.p=3,t.n=4,L.$http.get("api/PagoController/getReenviarDocumento",{params:{datos:{numtal:c.NUMTAL,numpag:c.NUMPAG,reenvio:!0}}});case 4:l=t.v,o.correctamente.push(l),t.n=6;break;case 5:t.p=5,m=t.v,o.errores.push(m);case 6:t.n=8;break;case 7:o.errores.push({error:{message:"Solo se puede reenviar Facturas y Notas de Crédito con referencia de Facturas"}});case 8:t.n=2;break;case 9:t.n=11;break;case 10:t.p=10,p=t.v,a.e(p);case 11:return t.p=11,a.f(),t.f(11);case 12:s="",i="",o.correctamente.length>0&&(s+="(".concat(o.correctamente.length,") Documentos Reenviados Satisfactoriamente "),i="success"),o.errores.length>0&&(s+="(".concat(o.errores.length,") Documentos no reenviados")),0===o.correctamente.length&&(i="warning",1===o.errores.length&&(u=w()(o.errores),d=u[0],s=d.error.message)),e.$alert(s,i),e.$q.loading.hide(),e.getDocumentoElectronicos();case 13:return t.a(2)}},t,null,[[3,5],[1,10,11,12]])})));case 2:return t.a(2)}},t)}))()},validarEstado:function(e){if(e.data.ESTADO&&2===Number(e.data.ESTADO))return{backgroundColor:"#FDD4CB",color:"#000"}},consultarSunat:function(){var e=this;return T()(S()().m(function t(){var n,o,a,r;return S()().w(function(t){while(1)switch(t.n){case 0:n=e.api.getSelectedRows(),0===n.length?e.$alert("No ha seleccionado ningún comprobante.","warning"):(o={},a="",r="",e.$confirm("¿Esta seguro de consultar el estado de los (".concat(n.length,") comprobantes en SUNAT?"),"info").onOk(T()(S()().m(function t(){var c;return S()().w(function(t){while(1)switch(t.n){case 0:e.$q.loading.show(),c=0;case 1:if(!(c<n.length)){t.n=3;break}return o={CODSUNAT:n[c].CODSUNAT,SERIE:n[c].SERIE,NUMPAG:n[c].NUMPAG,MONTO:n[c].MONTO,FECEMI:n[c].FECEMI,NUMTAL:n[c].NUMTAL},t.n=2,L.$http.get("api/ComprobanteElectronicoController/getStatusComprobanteSunat",{params:{params:o}}).then(function(e){1===n.length?(a=e.message,r="info"):(a="Se consultaron (".concat(n.length,") comprobantes en SUNAT"),r="info")});case 2:c++,t.n=1;break;case 3:return e.$alert(a,r),e.$q.loading.hide(),t.n=4,e.getDocumentoElectronicos();case 4:return t.a(2)}},t)}))));case 1:return t.a(2)}},t)}))()},onGridReady:function(e){this.api=e.api},columns:function(){this.frameworkComponents={actionButton:x.A},this.columnDefs=[{headerName:"Nro. Documento",field:"NRO_DOCUMENTO",pinned:"left",width:150,sortable:!0,cellStyle:this.validarEstado},{headerName:"F. Emisión",field:"FECEMIDES",width:120,valueFormatter:function(e){return e.value?(0,_.Ay)(e.value,"DD/MM/YYYY"):null},resizable:!1,filter:"agDateColumnFilter",filterParams:{},cellStyle:this.validarEstado},{headerName:"Apellidos y Nombres / Razon Social",field:"NOMBRE",width:300,sortable:!0,cellStyle:this.validarEstado},{headerName:"",field:"MONSIG",width:40,cellClass:"text-right",filter:!1,cellStyle:this.validarEstado},{headerName:"Importe",field:"MONTO",valueFormatter:Y.toFixed,decimales:2,cellClass:"text-right",width:80,sortable:!0,cellStyle:this.validarEstado},{headerName:"Est. Documento",field:"ANUPAGDES",sortable:!0,width:120,cellStyle:this.validarEstado},{headerName:"Est. SUNAT",field:"ESTADO_SUNAT",sortable:!0,width:120,cellStyle:this.validarEstado},{cellRenderer:x.A,headerName:"PDF",width:50,cellRendererParams:{icon:"file_pdf",title:"pdf",onClick:this.generarPdf},sortable:!0,filter:!1,cellClass:"text-center",cellStyle:this.validarEstado},{cellRenderer:x.A,headerName:"XML",width:50,cellRendererParams:{icon:"file_xml",title:"Descargar XML",onClick:this.generarXml,onHide:function(e){return Number(e.FILE_DOC)===Number(z["default"].XML_NO_GENERADO)}},sortable:!0,filter:!1,cellClass:"text-center",cellStyle:this.validarEstado},{cellRenderer:x.A,headerName:"CDR",width:50,cellRendererParams:{icon:"file_check",title:"Descargar CDR",onClick:this.generarCdr},sortable:!0,filter:!1,cellClass:"text-center",cellStyle:this.validarEstado},{headerName:"Est. Correo",width:120,sortable:!0,field:"CORREO_ENVIADO",cellStyle:this.validarEstado},{headerName:"Fecha Envio",field:"FECHA_ENVIO",valueFormatter:function(e){return(0,_.Ay)(e.value,"DD/MM/YYYY HH:mm:ss")},filter:!1,width:150,cellStyle:this.validarEstado},{headerName:"Informado en SUNAT",width:150,field:"HABIDO_SUNAT",sortable:!0,cellClass:"text-center",cellStyle:this.validarEstado}],this.rowData=[]},generarPdf:function(e){z["default"].IMPRIMIR_COMPROBANTE(origin,e.data.NUMTAL,e.data.NUMPAG)},generarXml:function(e){var t=this;return T()(S()().m(function n(){var o;return S()().w(function(n){while(1)switch(n.n){case 0:return e.data.TIPODOCUMENTO="XML",n.n=1,L.$http.get("api/PagoController/getDocumentoElectronico",{params:{datos:e.data}});case 1:return o=n.v,n.n=2,z["default"].DESCARGAR_ARCHIVO(o.paramsDescarga);case 2:t.$alert("Archivo XML generado satisfactoriamente","success");case 3:return n.a(2)}},n)}))()},generarCdr:function(e){var t=this;return T()(S()().m(function n(){var o,a;return S()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,e.data.TIPODOCUMENTO="CDR",n.n=1,L.$http.get("api/PagoController/getDocumentoElectronico",{params:{datos:e.data}});case 1:return o=n.v,n.n=2,z["default"].DESCARGAR_ARCHIVO(o.paramsDescarga);case 2:t.$alert("Archivo CDR generado satisfactoriamente","success"),n.n=4;break;case 3:n.p=3,a=n.v,t.$alert(a.error.message,"warning");case 4:return n.a(2)}},n,null,[[0,3]])}))()},getPuntosDeVenta:function(){var e=this;return T()(S()().m(function t(){var n;return S()().w(function(t){while(1)switch(t.n){case 0:return t.n=1,L.$http.get("api/CajaCobranzaController/getCajaCobranza",{params:{parametros:{response:"punto_venta"}}});case 1:n=t.v,e.puntosVenta=n.map(function(e){return{value:e.ID_CAJA,label:"".concat(e.LOCAL,"|").concat(e.CAJA)}}),e.puntosVenta.unshift({label:"Todos",value:z["default"].TODOS});case 2:return t.a(2)}},t)}))()}},mounted:function(){return T()(S()().m(function e(){return S()().w(function(e){while(1)switch(e.n){case 0:return e.a(2)}},e)}))()},created:function(){},beforeMount:function(){this.getPuntosDeVenta(),this.columns(),this.crearBotones(),this.getAnios(),this.getMeses(),this.getTalonarios(),this.getDocumentoElectronicos(),this.getTipoComprobantes(),this.asignarFechas()}},J=n(12807);const K=(0,J.A)(Z,[["render",C]]);var W=K}}]);