"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[26894],{26894:function(e,t,a){a.r(t),a.d(t,{default:function(){return W}});var n=a(61758),o=a(58790),l={class:"q-pa-sm"};function i(e,t){var a=(0,n.g2)("q-search"),i=(0,n.g2)("q-td"),r=(0,n.g2)("q-tr"),u=(0,n.g2)("q-table"),s=(0,n.g2)("asignar-permiso"),d=(0,n.g2)("q-page");return(0,n.uX)(),(0,n.Wv)(d,{class:"permisoConducta bg-white"},{default:(0,n.k6)(function(){return[(0,n.Lk)("div",l,[(0,n.bF)(u,{"table-style":"height: 80vh",pagination:e.usuarioPag,"onUpdate:pagination":t[1]||(t[1]=function(t){return e.usuarioPag=t}),data:e.usuarios,columns:e.usuarioCol,"row-key":"name",color:"secondary",filter:e.tipcod,loading:e.usuarioLoad},{"top-right":(0,n.k6)(function(o){return[(0,n.bF)(a,{class:"q-if-outlined","hide-underline":"",modelValue:e.tipcod,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.tipcod=t})},null,8,["modelValue"])]}),body:(0,n.k6)(function(t){return[(0,n.bF)(r,{class:"cursor-pointer",props:t,onClick:function(a){return e.openModal(t.row)}},{default:(0,n.k6)(function(){return[(0,n.bF)(i,{key:"USUCOD",props:t},{default:(0,n.k6)(function(){return[(0,n.eW)((0,o.v_)(t.row.USUCOD),1)]}),_:2},1032,["props"]),(0,n.bF)(i,{key:"USUNOM",props:t},{default:(0,n.k6)(function(){return[(0,n.eW)((0,o.v_)(t.row.USUNOM),1)]}),_:2},1032,["props"]),(0,n.bF)(i,{key:"TIPNOM",props:t},{default:(0,n.k6)(function(){return[(0,n.eW)((0,o.v_)(t.row.TIPNOM),1)]}),_:2},1032,["props"])]}),_:2},1032,["props","onClick"])]}),_:1},8,["pagination","data","columns","filter","loading"])]),(0,n.bF)(s,{usunom:e.usunom,modelValue:e.modal,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.modal=t}),ref:"asigPerCond"},null,8,["usunom","modelValue"])]}),_:1})}var r=a(6123),u=a(80660),s=a(93616),d=a(30640),c=a(57668),f=a(6583),m=a(81288),p=a(8445),g=a.n(p),b=(a(56285),{class:"row q-px-sm q-pt-sm"}),h={class:"col-md-6 col-xs-6"},S={class:"col-md-6 col-xs-6"},v={class:"row q-px-sm q-pt-sm"},O={class:"col-md-6 col-xs-12 q-pr-md-xs"},P={class:"col-md-6 col-xs-12 q-pl-md-xs q-pt-sm-none q-pt-xs-sm"},T={class:"col"},k={class:"q-ml-sm"};function _(e,t){var a=(0,n.g2)("q-select"),l=(0,n.g2)("q-tooltip"),i=(0,n.g2)("q-btn"),r=(0,n.g2)("q-card"),u=(0,n.g2)("q-search"),s=(0,n.g2)("q-table"),d=(0,n.g2)("q-checkbox"),c=(0,n.g2)("q-th"),f=(0,n.g2)("q-tr"),m=(0,n.g2)("q-td"),p=(0,n.g2)("q-popup-edit"),_=(0,n.g2)("q-tablecomp"),U=(0,n.g2)("sie-modal");return(0,n.uX)(),(0,n.Wv)(U,{class:"modal-permiso-conducta",modelValue:e.modal,"onUpdate:modelValue":t[9]||(t[9]=function(t){return e.modal=t}),title:e.usuarionombre+": Asignar permiso",header:!0,ok:e.$t("botones.guardar"),footer:e.sie.ruta.nivel>=2,onSubmit:e.grabar},{default:(0,n.k6)(function(){return[(0,n.Lk)("div",b,[(0,n.Lk)("div",h,[(0,n.bF)(a,{class:"q-if-outlined",modelValue:e.nivel,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.nivel=t}),options:e.niveles,multiple:"","float-label":e.$t("ngs.nivel"),filter:""},null,8,["modelValue","options","float-label"])]),(0,n.Lk)("div",S,[(0,n.bF)(a,{class:"q-if-outlined",modelValue:e.grado,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.grado=t}),options:e.grados,multiple:"","float-label":e.$t("ngs.grado"),filter:""},null,8,["modelValue","options","float-label"])])]),(0,n.Lk)("div",v,[(0,n.Lk)("div",O,[(0,n.bF)(r,{class:"row full width items items-center q-px-sm q-py-xs"},{default:(0,n.k6)(function(){return[t[11]||(t[11]=(0,n.Lk)("div",{class:"col"},[(0,n.Lk)("span",{class:"text-bold q-body-1"},"Listado de salones")],-1)),(0,n.Lk)("div",null,[(0,n.bF)(i,{onClick:e.add,round:"",color:"secondary",icon:"chevron_double_right",dense:"",flat:""},{default:(0,n.k6)(function(){return[(0,n.bF)(l,{anchor:"top middle",self:"bottom middle"},{default:(0,n.k6)(function(){return g()(t[10]||(t[10]=[(0,n.eW)("Añadir",-1)]))}),_:1})]}),_:1},8,["onClick"])])]}),_:1}),(0,n.bF)(s,{"table-style":e.isLess?"height:60vh":"height: 40vh",selection:e.dataSelection,"row-key":"__index",color:"secondary",data:e.data,columns:e.dataCol,selected:e.dataSelected,"onUpdate:selected":t[3]||(t[3]=function(t){return e.dataSelected=t}),pagination:e.dataPag,"onUpdate:pagination":t[4]||(t[4]=function(t){return e.dataPag=t}),filter:e.dataFilter,loading:e.dataLoad},{"top-left":(0,n.k6)(function(a){return[(0,n.bF)(u,{class:"q-if-outlined","hide-underline":"",modelValue:e.dataFilter,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.dataFilter=t})},null,8,["modelValue"])]}),_:1},8,["table-style","selection","data","columns","selected","pagination","filter","loading"])]),(0,n.Lk)("div",P,[(0,n.bF)(r,{class:"row full width items items-center q-px-sm q-py-xs"},{default:(0,n.k6)(function(){return[t[13]||(t[13]=(0,n.Lk)("div",{class:"col"},[(0,n.Lk)("span",{class:"text-bold q-body-1"},"Salones seleccionados")],-1)),(0,n.Lk)("div",T,[(0,n.bF)(a,{class:"q-if-outlined q-mx-sm no-margin",modelValue:e.permisoAll,"onUpdate:modelValue":t[5]||(t[5]=function(t){return e.permisoAll=t}),options:e.permisos,"float-label":"Permiso",onInput:e.cambiarPermisoTodos},null,8,["modelValue","options","onInput"])]),(0,n.Lk)("div",k,[(0,n.bF)(i,{onClick:e.remove,round:"",color:"secondary",icon:"chevron_double_left",dense:"",flat:""},{default:(0,n.k6)(function(){return[(0,n.bF)(l,{anchor:"top middle",self:"bottom middle"},{default:(0,n.k6)(function(){return g()(t[12]||(t[12]=[(0,n.eW)("Quitar",-1)]))}),_:1})]}),_:1},8,["onClick"])])]}),_:1}),(0,n.bF)(_,{style:(0,o.Tr)(e.isLess?"height: 73vh":"height: 53vh"),selection:e.listaSelection,"row-key":"__index",color:"secondary",data:e.lista,columns:e.listaCol,selected:e.listaSelected,"onUpdate:selected":t[7]||(t[7]=function(t){return e.listaSelected=t}),pagination:e.listaPag,"onUpdate:pagination":t[8]||(t[8]=function(t){return e.listaPag=t}),filter:e.listaFilter,loading:e.listaLoad},{"top-left":(0,n.k6)(function(a){return[(0,n.bF)(u,{class:"q-if-outlined","hide-underline":"",modelValue:e.listaFilter,"onUpdate:modelValue":t[6]||(t[6]=function(t){return e.listaFilter=t})},null,8,["modelValue"])]}),header:(0,n.k6)(function(t){return[(0,n.bF)(f,null,{default:(0,n.k6)(function(){return[(0,n.bF)(c,null,{default:(0,n.k6)(function(){return[t.multipleSelect?((0,n.uX)(),(0,n.Wv)(d,{key:0,modelValue:t.selected,"onUpdate:modelValue":function(e){return t.selected=e},"indeterminate-value":"some",onInput:e.seleccionarTodo,color:"secondary"},null,8,["modelValue","onUpdate:modelValue","onInput"])):(0,n.Q3)("v-if",!0)]}),_:2},1024),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.cols,function(e){return(0,n.uX)(),(0,n.Wv)(c,{key:e.name,props:t},{default:(0,n.k6)(function(){return[(0,n.eW)((0,o.v_)(e.label),1)]}),_:2},1032,["props"])}),128))]}),_:2},1024)]}),body:(0,n.k6)(function(t){return[(0,n.bF)(f,{props:t,class:(0,o.C4)(t.row.TIPO_PERMISO<3?"bg-amber-1":"")},{default:(0,n.k6)(function(){return[(0,n.bF)(m,null,{default:(0,n.k6)(function(){return[(0,n.bF)(d,{modelValue:t.selected,"onUpdate:modelValue":function(e){return t.selected=e},color:"secondary",disable:t.row.TIPO_PERMISO<3},null,8,["modelValue","onUpdate:modelValue","disable"])]}),_:2},1024),(0,n.bF)(m,{key:"NGS",props:t},{default:(0,n.k6)(function(){return[(0,n.eW)((0,o.v_)(t.row.NGS),1)]}),_:2},1032,["props"]),(0,n.bF)(m,{key:"NEMODES",props:t},{default:(0,n.k6)(function(){return[(0,n.eW)((0,o.v_)(t.row.NEMODES),1)]}),_:2},1032,["props"]),(0,n.bF)(m,{key:"PERMISO",props:t},{default:(0,n.k6)(function(){return[(0,n.eW)((0,o.v_)(e.getPermiso(t.row.PERMISO)),1),(0,n.bF)(p,{modelValue:t.row.PERMISO,"onUpdate:modelValue":function(e){return t.row.PERMISO=e}},{default:(0,n.k6)(function(){return[(0,n.bF)(a,{modelValue:t.row.PERMISO,"onUpdate:modelValue":function(e){return t.row.PERMISO=e},options:e.permisos,onInput:function(a){return e.cambiarPermiso(t.row.__index,t.row.PERMISO)}},null,8,["modelValue","onUpdate:modelValue","options","onInput"])]}),_:2},1032,["modelValue","onUpdate:modelValue"])]}),_:2},1032,["props"])]}),_:2},1032,["props","class"])]}),_:1},8,["style","selection","data","columns","selected","pagination","filter","loading"])])])]}),_:1},8,["modelValue","title","ok","footer","onSubmit"])}var U=a(76080),C=a.n(U),I=a(45254),V=a.n(I),N=(a(71225),a(74260),a(39866),a(52133),a(10239),a(89571),a(50310),a(5962),a(32203),a(6724),a(9240),a(83190),a(62692),a(30545)),q=a(982),E=a(99637),M=a(47035),y=a(27738),L={getListaSalonesAnio:function(){var e=V()(C()().m(function e(t){var a,n,o;return C()().w(function(e){while(1)switch(e.n){case 0:return a={},t&&(a.params={ano:t}),e.n=1,u.$http.get("api/HyoConductaSalon/getListaSalonesAnioCond",a);case 1:return n=e.v,o=n.json,e.a(2,o)}},e)}));function t(t){return e.apply(this,arguments)}return t}()},w=a(13813),F=a(33001),D=a(78786),A={emits:["update:modelValue","input","update:usunom"],components:{QTable:r.kH,QTh:r.EJ,QTr:r.qh,QTd:r.Ef,QTableColumns:r.$s,QPopupEdit:r.GT,QCheckbox:r.vZ,QPageSticky:r._U,QToolbar:r.ZV,QSelect:r.Si,QTablecomp:N.A,sieSelect:s.A,sieModal:d.A,QCard:r.C$,QBtn:r.Il,QTooltip:r.nC,QSearch:r.Ks},props:{usunom:{type:String,default:""},modelValue:{type:Boolean,default:!1}},data:function(){return{sie:(0,c["default"])(),usucod:"",cursos:[],curso:[],niveles:[],nivel:[],gradosTemp:[],grado:[],dataTemp:[],dataCol:[{name:"NGS",label:"NGS",field:"NGS",align:"left",sortable:!0,sort:!0},{name:"NEMODES",label:this.$t("salon"),field:"NEMODES",align:"left",sortable:!0}],dataPag:{page:1,rowsPerPage:200},dataSelection:"multiple",dataSelected:[],dataFilter:"",dataLoad:!0,permisos:[{label:"Solo lectura",value:0},{label:"Periodo cerrado",value:5},{label:"Periodo abierto",value:4}],listaTemp:[],listaCol:[{name:"NGS",label:"NGS",field:"NGS",align:"left",sortable:!0,sort:!0},{name:"NEMODES",label:this.$t("salon"),field:"CURSONOM",align:"left",sortable:!0},{name:"PERMISO",label:"Permiso",field:"PERMISO",align:"center",sortable:!1}],listaPag:{page:1,rowsPerPage:200},listaSelection:"multiple",listaSelected:[],listaFilter:"",listaLoad:!0,permisoAll:null}},computed:{modal:{get:function(){return this.modelValue},set:function(e){this.$emit("update:modelValue",e),this.$emit("input",e)}},usuarionombre:{get:function(){return this.usunom},set:function(e){this.$emit("update:usunom",e)}},data:function(){var e=this,t=this.dataTemp;return this.nivel.length>0&&(t=t.filter(function(t){return e.nivel.some(function(e){return t.NGS.indexOf(e)>=0})})),this.grado.length>0&&(t=t.filter(function(t){return e.grado.some(function(e){return t.NGS.indexOf(e)>=0})})),t},lista:function(){var e=this.listaTemp;return e},grados:function(){var e=this,t=this.gradosTemp;return this.nivel.length>0?(t=t.filter(function(t){return e.nivel.some(function(e){return t.INSTRUCOD===e})}),t=(0,w["default"])(t,function(e){return{label:e.GRADODES,value:e.INSTRUCOD+e.GRADOCOD}}),this.grado=(0,w["default"])(t,function(e){return e.value})):(t=[],this.grado=[]),t},isLess:function(){return(0,m.isLess)()}},methods:{getPermiso:function(e){var t=[{label:"Solo lectura",value:0},{label:"Periodo cerrado",value:5},{label:"Periodo abierto",value:4}],a=(0,F.filterArray)(e,{field:"value",list:t})[0];return a.label},loadData:function(e){var t=this;return V()(C()().m(function a(){var n,o,l,i,r,s,d;return C()().w(function(a){while(1)switch(a.n){case 0:return t.usucod=e,t.dataLoad=!0,t.listaLoad=!0,t.dataTemp=[],t.listaTemp=[],t.dataSelected=[],t.listaSelected=[],t.permisoAll=null,a.n=1,L.getListaSalonesAnio();case 1:return i=a.v,a.n=2,y.A.getNiveles();case 2:return r=a.v,a.n=3,y.A.getGrados();case 3:return s=a.v,a.n=4,u.$http.get("api/HyoConductaPermiso/getUsuariosPerCond",{params:{usucod:e}});case 4:d=a.v,n={listarSalones:i,obtInstru:r,obtGrados:s,getUsuariosPerCond:d},t.dataTemp=n.listarSalones,t.niveles=(0,w["default"])(n.obtInstru,function(e){return{label:e.INSTRUDES,value:e.INSTRUCOD}}),t.gradosTemp=n.obtGrados,o=(0,M["default"])((0,f["default"])(n.getUsuariosPerCond),"asc","TIPO_PERMISO"),l=[],(0,E["default"])(o,function(e){(1===e.TIPO_PERMISO||(0,D["default"])(l,e.ID_CONDUCTA_SALON,{key:"ID_CONDUCTA_SALON"})<0)&&l.push(e),t.dataTemp=t.dataTemp.filter(function(t){return t.ID_CONDUCTA_SALON!==e.ID_CONDUCTA_SALON})}),t.listaTemp=(0,M["default"])(l,"desc","TIPO_PERMISO"),t.dataLoad=!1,t.listaLoad=!1;case 5:return a.a(2)}},a)}))()},seleccionarTodos:function(e,t,a){return e.find(function(e){return"T"===e})?a.find(function(e){return"T"===e})?(e.splice(e.indexOf("T"),1),a=e):a=t.map(function(e){return e.value}):a=a.find(function(e){return"T"===e})?[]:e.length===t.length-1?t.map(function(e){return e.value}):e,a},cambiarPermiso:function(e,t){var a=g()(this.listaTemp);a[e].PERMISO=t,this.listaTemp=a},cambiarPermisoTodos:function(e){var t=this;(0,E["default"])(this.listaSelected,function(a){t.listaTemp[a["__index"]].PERMISO=e})},add:function(){var e=this,t=g()(this.dataTemp),a=g()(this.dataSelected);t=t.filter(function(e){return!a.includes(e)}),this.dataTemp=t,a.length>0?((0,E["default"])(a,function(t){t.PERMISO=0,t.TIPO_PERMISO=3,e.listaTemp.unshift(t)}),this.dataSelected=[]):(0,q["default"])("Debe seleccionar al menos un elemento a añadir","warning")},remove:function(){var e=this,t=g()(this.listaTemp),a=g()(this.listaSelected);t=t.filter(function(e){return!a.includes(e)}),this.listaTemp=t,a.length>0?((0,E["default"])(a,function(t){delete t["PERMISO"],e.dataTemp.push(t)}),this.dataTemp=(0,M["default"])(this.dataTemp,"asc","NGS"),this.listaSelected=[]):(0,q["default"])("Debe seleccionar al menos un elemento a quitar","warning")},seleccionarTodo:function(){var e=this.listaSelected;e=(0,F.filterArray)(3,{field:"TIPO_PERMISO",list:e}),this.listaSelected=e},grabar:function(){var e=this,t=[];(0,E["default"])(this.listaTemp,function(a){3===a.TIPO_PERMISO&&t.push({ID_CONDUCTA_SALON:a.ID_CONDUCTA_SALON,USUCOD:e.usucod,PERMISO:a.PERMISO})}),u.$http.post("api/HyoConductaPermiso/grabarConductaPermiso",{parametros:t,USUCOD:this.usucod}).then(function(e){(0,q["default"])("Grabado correctamente","success")}).catch(function(e){(0,q["default"])("No se pudo guardar","warning")})}}},R=a(12807);const Q=(0,R.A)(A,[["render",_]]);var x=Q,G={components:{QTable:r.kH,QTh:r.EJ,QTr:r.qh,QTd:r.Ef,QTableColumns:r.$s,QPopupEdit:r.GT,QToolbar:r.ZV,QSelect:r.Si,sieSelect:s.A,sieModal:d.A,asignarPermiso:x,QPage:r.Tu,QSearch:r.Ks},data:function(){return{sie:(0,c["default"])(),usunom:"",usuarios:[],usuarioCol:[{name:"USUCOD",label:this.$t("codigo"),field:"USUCOD",align:"left",sortable:!1},{name:"USUNOM",label:this.$t("usuario.nombre"),field:"USUNOM",align:"left",sortable:!0},{name:"TIPNOM",label:this.$t("seguridad.perfil"),field:"TIPNOM",align:"center",sortable:!0}],usuarioPag:{page:1,rowsPerPage:250},usuarioLoad:!1,tipcod:"",modal:!1}},computed:{isLess:function(){return(0,m.isLess)()}},methods:{init:function(){var e=this;u.$http.get("api/HyoUsuario/obtenerUsuarios").then(function(t){e.usuarios=(0,f["default"])(t)})},openModal:function(e){this.modal=!0,this.usunom=e.USUNOM,this.$refs.asigPerCond.loadData(e.USUCOD)}},created:function(){this.init()}};const $=(0,R.A)(G,[["render",i]]);var W=$}}]);