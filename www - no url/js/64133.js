"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[64133],{64133:function(e,t,n){n.r(t),n.d(t,{default:function(){return O}});n(56285);var a=n(61758),i=n(58790),s={class:"grupo bg-white"},r={key:0,class:"row"},o={class:"col"},l={key:1,class:"cutText",style:{display:"block"}},u={key:0,class:"row"},c={class:"col"},d={key:0,class:"row q-pt-sm q-pr-sm"},p={class:"col"},f={class:"row"},m={class:"col"};function b(e,t){var n=(0,a.g2)("q-btn"),b=(0,a.g2)("q-toolbar"),g=(0,a.g2)("q-item-tile"),h=(0,a.g2)("q-item-main"),k=(0,a.g2)("q-item-side"),D=(0,a.g2)("q-item"),v=(0,a.g2)("q-tab"),y=(0,a.g2)("destinatarios"),U=(0,a.g2)("q-td"),w=(0,a.g2)("q-search"),C=(0,a.g2)("q-table"),F=(0,a.g2)("q-tab-pane"),j=(0,a.g2)("q-toggle"),G=(0,a.g2)("q-tr"),M=(0,a.g2)("q-tabs");return(0,a.uX)(),(0,a.CE)("div",s,[e.isGreater?(0,a.Q3)("v-if",!0):((0,a.uX)(),(0,a.Wv)(b,{key:0,class:"q-toolbar-menu fixed-top",style:{width:"calc(100% - 50px)",left:"50px"},color:"primary"},{default:(0,a.k6)(function(){return[t[10]||(t[10]=(0,a.Lk)("div",{class:"col row"},null,-1)),(0,a.bF)(n,{icon:"backburger",dense:"",round:"",flat:"",onClick:e.openMenu},null,8,["onClick"])]}),_:1})),(0,a.bF)(D,{style:{"padding-top":"20px","border-bottom":"1px solid #CCC"}},{default:(0,a.k6)(function(){return[(0,a.bF)(h,null,{default:(0,a.k6)(function(){return[(0,a.bF)(g,{label:""},{default:(0,a.k6)(function(){return[(0,a.eW)((0,i.v_)(e.grupo),1)]}),_:1}),(0,a.bF)(g,{sublabel:""},{default:(0,a.k6)(function(){return[(0,a.eW)((0,i.v_)("null"==e.descripcion?"":e.descripcion),1)]}),_:1})]}),_:1}),(0,a.bF)(k,{right:""},{default:(0,a.k6)(function(){return[(0,a.bF)(n,{class:"no-shadow",size:(e.isGreater,"sm"),label:"Enviar mensaje al grupo",color:"primary",onClick:e.enviarGrupo,outline:""},null,8,["size","onClick"])]}),_:1})]}),_:1}),3===e.idTypeGroup?((0,a.uX)(),(0,a.Wv)(M,{key:1,inverted:""},{title:(0,a.k6)(function(){return[(0,a.bF)(v,{default:"",name:"tab-1",label:"Destinatarios"}),(0,a.bF)(v,{name:"tab-2",label:"Perfiles"}),(0,a.bF)(v,{name:"tab-3",label:"Usuarios"})]}),default:(0,a.k6)(function(){return[(0,a.bF)(F,{name:"tab-1"},{default:(0,a.k6)(function(){return[e.acceso?((0,a.uX)(),(0,a.CE)("div",r,[(0,a.Lk)("div",o,[((0,a.uX)(),(0,a.Wv)(y,{key:e.id,chips:!1,ref:"getDestinatarios",loadDestinatarios:e.data,perfiles:e.perfiles,title:"Para"},{extra:(0,a.k6)(function(){return[(0,a.bF)(n,{color:"primary",onClick:e.deleteDestinatarios,label:"Eliminar destinatarios"},null,8,["onClick"])]}),_:1},8,["loadDestinatarios","perfiles"]))])])):(0,a.Q3)("v-if",!0),(0,a.bF)(C,{class:(0,i.C4)(["table-sie","bg-white"]),data:e.data,columns:e.columnsDestinatarios,selection:e.selectionDest,selected:e.selectedDest[e.id],"onUpdate:selected":t[1]||(t[1]=function(t){return e.selectedDest[e.id]=t}),pagination:e.pagination,"onUpdate:pagination":t[2]||(t[2]=function(t){return e.pagination=t}),"row-key":"USUNOM",style:{"max-height":"74vh"},filter:e.filterDest},{"body-cell-DELETE":(0,a.k6)(function(t){return[e.acceso?((0,a.uX)(),(0,a.Wv)(U,{key:0,props:t},{default:(0,a.k6)(function(){return[(0,a.bF)(n,{flat:"",dense:"",icon:"delete",color:"faded",onClick:function(n){return e.deleteDestinatario(t.row)}},null,8,["onClick"])]}),_:2},1032,["props"])):(0,a.Q3)("v-if",!0)]}),"top-right":(0,a.k6)(function(n){return[(0,a.bF)(w,{modelValue:e.filterDest,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.filterDest=t}),"hide-underline":""},null,8,["modelValue"])]}),_:1},8,["data","columns","selection","selected","pagination","filter"])]}),_:1}),(0,a.bF)(F,{name:"tab-2",disabled:!e.acceso},{default:(0,a.k6)(function(){return[(0,a.bF)(C,{class:"table-sie bg-white",pagination:e.pagination,"onUpdate:pagination":t[3]||(t[3]=function(t){return e.pagination=t}),data:e.listProfile,columns:e.columnsProfiles,"row-key":"name"},{body:(0,a.k6)(function(t){return[(0,a.bF)(G,{class:"cursor-pointer",props:t},{default:(0,a.k6)(function(){return[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.cols,function(n){return(0,a.uX)(),(0,a.Wv)(U,{key:n.name,data:n.label},{default:(0,a.k6)(function(){return["state"===n.name?((0,a.uX)(),(0,a.Wv)(j,{key:0,modelValue:t.row.state,"onUpdate:modelValue":function(e){return t.row.state=e},onInput:function(n){return e.changeState(t.row)}},null,8,["modelValue","onUpdate:modelValue","onInput"])):((0,a.uX)(),(0,a.CE)("span",l,(0,i.v_)(n.value),1))]}),_:2},1032,["data"])}),128))]}),_:2},1032,["props"])]}),_:1},8,["pagination","data","columns"])]}),_:1},8,["disabled"]),(0,a.bF)(F,{name:"tab-3"},{default:(0,a.k6)(function(){return[e.acceso?((0,a.uX)(),(0,a.CE)("div",u,[(0,a.Lk)("div",c,[((0,a.uX)(),(0,a.Wv)(y,{key:e.id,chips:!1,ref:"getDestinatarios",loadDestinatarios:e.users,perfiles:e.perfiles,title:"Para",typeSave:"user"},{extra:(0,a.k6)(function(){return[(0,a.bF)(n,{color:"primary",onClick:e.deleteUsuarios,label:"Eliminar usuarios"},null,8,["onClick"])]}),_:1},8,["loadDestinatarios","perfiles"]))])])):(0,a.Q3)("v-if",!0),(0,a.bF)(C,{class:(0,i.C4)(["table-sie","bg-white"]),data:e.users,columns:e.columnsDestinatarios,selection:e.selectionDest,selected:e.selectedDest[e.id],"onUpdate:selected":t[5]||(t[5]=function(t){return e.selectedDest[e.id]=t}),pagination:e.pagination,"onUpdate:pagination":t[6]||(t[6]=function(t){return e.pagination=t}),"row-key":"USUNOM",style:{"max-height":"74vh"},filter:e.filterProfile},{"body-cell-DELETE":(0,a.k6)(function(t){return[(0,a.bF)(U,{props:t},{default:(0,a.k6)(function(){return[(0,a.bF)(n,{flat:"",dense:"",icon:"delete",color:"faded",onClick:function(n){return e.deleteUser(t.row)}},null,8,["onClick"])]}),_:2},1032,["props"])]}),"top-right":(0,a.k6)(function(n){return[(0,a.bF)(w,{modelValue:e.filterProfile,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.filterProfile=t}),"hide-underline":""},null,8,["modelValue"])]}),_:1},8,["data","columns","selection","selected","pagination","filter"])]}),_:1})]}),_:1})):((0,a.uX)(),(0,a.CE)(a.FK,{key:2},[e.acceso?((0,a.uX)(),(0,a.CE)("div",d,[(0,a.Lk)("div",p,[((0,a.uX)(),(0,a.Wv)(y,{key:e.id,chips:!1,ref:"getDestinatarios",loadDestinatarios:e.data,perfiles:e.perfiles,title:"Para"},{extra:(0,a.k6)(function(){return[(0,a.bF)(n,{color:"primary",onClick:e.deleteDestinatarios,label:"Eliminar destinatarios"},null,8,["onClick"])]}),_:1},8,["loadDestinatarios","perfiles"]))])])):(0,a.Q3)("v-if",!0),(0,a.Lk)("div",f,[(0,a.Lk)("div",m,[(0,a.bF)(C,{data:e.data,columns:e.columnsDestinatarios,selection:e.selectionDest,selected:e.selectedDest[e.id],"onUpdate:selected":t[8]||(t[8]=function(t){return e.selectedDest[e.id]=t}),pagination:e.pagination,"onUpdate:pagination":t[9]||(t[9]=function(t){return e.pagination=t}),"row-key":"USUNOM",style:{"max-height":"74vh"},filter:e.filterDest},{"body-cell-DELETE":(0,a.k6)(function(t){return[e.acceso?((0,a.uX)(),(0,a.Wv)(U,{key:0,props:t},{default:(0,a.k6)(function(){return[(0,a.bF)(n,{flat:"",dense:"",icon:"delete",color:"faded",onClick:function(n){return e.deleteDestinatario(t.row)}},null,8,["onClick"])]}),_:2},1032,["props"])):(0,a.Q3)("v-if",!0)]}),"top-right":(0,a.k6)(function(n){return[(0,a.bF)(w,{modelValue:e.filterDest,"onUpdate:modelValue":t[7]||(t[7]=function(t){return e.filterDest=t}),"hide-underline":""},null,8,["modelValue"])]}),_:1},8,["data","columns","selection","selected","pagination","filter"])])])],64))])}var g=n(57008),h=n.n(g),k=n(76080),D=n.n(k),v=n(45254),y=n.n(v),U=(n(52133),n(10239),n(89571),n(50310),n(6724),n(70199),n(83190),n(48086)),w=n(80660),C=n(6123),F=n(982),j=n(36980),G=n(99637),M=n(81288),P=n(30545),E=n(57668),T={props:["id","idTypeGroup","grupo","descripcion","usuario"],components:{destinatarios:U.A,QTable:P.A,QTr:C.qh,QTd:C.Ef,QTabs:C.uw,QTab:C.zu,QTabPane:C.dg,QToggle:C.c5,QToolbar:C.ZV,QBtn:C.Il,QItem:C.H0,QItemMain:C.mF,QItemTile:C.lp,QItemSide:C.n1,QSearch:C.Ks},data:function(){return{perfiles:[],data:[],users:[],pagination:{page:1,rowsPerPage:10},selectionDest:"multiple",selectedDest:{},columnsDestinatarios:[{name:"USUNOM",label:"Destinatarios",align:"left",field:"USUNOM",sortable:!0}],filterDest:"",columnsProfiles:[{name:"TIPNOM",label:"Perfil",align:"left",field:"TIPNOM",sortable:!0},{name:"state",label:"Estado",field:"state",align:"left"}],filterProfile:"",listProfile:[],listSelected:[],i:1}},methods:{openMenu:function(){this.$store.commit("menu/setOpenMenu",!this.openM)},deleteDestinatario:function(e){var t=this;w.$http.delete("api/HyoMsjGrupoDestinatario/eliminarDestinatario",{params:{idGrupo:this.id,usucod:e.USUCOD}}).then(function(n){var a=n.json;if("e"!==a.split("")[0]){var i=t.data.indexOf(e);t.data.splice(i,1),t.$refs.getDestinatarios.dropDestinatario(e),(0,F["default"])(t.$t("mensajes.".concat(a)))}else(0,F["default"])(t.$t("mensajes.".concat(a)),"warning")})},deleteUser:function(e){var t=this;w.$http.delete("api/HyoMsjGrupoUsuario/eliminarUsuario",{params:{idGrupo:this.id,usucod:e.USUCOD}}).then(function(n){var a=n.json;if("e"!==a.split("")[0]){var i=t.users.indexOf(e);t.users.splice(i,1),t.$refs.getDestinatarios.dropDestinatario(e),(0,F["default"])(t.$t("mensajes.".concat(a)))}else(0,F["default"])(t.$t("mensajes.".concat(a)),"warning")})},loadListaDestinatarios:function(){var e=this;return y()(D()().m(function t(){return D()().w(function(t){while(1)switch(t.n){case 0:return e.data=[],e.users=[],e.i=1,t.n=1,w.$http.get("api/HyoMsjGrupoDestinatario/obtListaDestinatarios",{params:{idGrupo:e.id}}).then(function(t){var n=t.json;e.data=n,e.users=n});case 1:e.columnsDestinatarios=[{name:"USUNOM",label:"Destinatarios",align:"left",field:"USUNOM",sortable:!0}],(0===e.data.length||e.acceso&&1===e.i)&&(e.columnsDestinatarios.push({name:"DELETE",label:"Eliminar",align:"center"}),e.i++),3===e.idTypeGroup&&(w.$http.get("api/HyoMsjGrupoPerfil/obtListaPerfiles",{params:{idGrupo:e.id}}).then(function(t){var n=t.json,a=[];(0,G["default"])(n,function(e,t){a[t]=e.TIPCOD}),e.listSelected=a}),w.$http.get("api/HyoTipUsuAcc/obtListaPerfiles").then(function(t){var n=t.json;(0,G["default"])(n,function(t){-1===e.listSelected.indexOf(t.TIPCODAC)?t.state=!1:t.state=!0}),e.listProfile=n}),w.$http.get("api/HyoMsjGrupoUsuario/obtListaUsuarios",{params:{idGrupo:e.id}}).then(function(t){var n=t.json;e.users=n}));case 2:return t.a(2)}},t)}))()},changeState:function(e){var t=this;w.$http.post("api/HyoMsjGrupoPerfil/cambiarEstadoPerfil",{idGrupo:this.id,mostrar:e.state,tipcod:e.TIPCODAC}).then(function(n){var a=n.json;"e"!==a.split("")[0]?(0,F["default"])(t.$t("mensajes.".concat(a))):((0,F["default"])(t.$t("mensajes.".concat(a)),"warning"),e.state=!e.state)}).catch(function(t){e.state=!e.state})},enviarGrupo:function(){this.$router.push({name:"intranet.mensajeria.redactar",params:{folder:1,type:3},query:{send:JSON.stringify(this.data)}})},deleteDestinatarios:function(){var e=this;return y()(D()().m(function t(){var n,a,i,s;return D()().w(function(t){while(1)switch(t.p=t.n){case 0:if(0!==e.selectedDest[e.id].length){t.n=1;break}return(0,F["default"])("No ha seleccionado ningún destinatario","warning"),t.a(2,!1);case 1:return t.p=1,n=e.selectedDest[e.id].map(function(e){return e.USUCOD}),t.n=2,w.$http.post("api/HyoMsjGrupoDestinatario/delMultipleDestinatario",{idGrupo:e.id,usucods:n});case 2:return a=t.v,t.n=3,w.$http.get("api/HyoMsjGrupoDestinatario/obtListaDestinatarios",{params:{idGrupo:e.id}});case 3:i=t.v,s=i.json,e.data=s,e.users=s,e.selectedDest[e.id]=[],(0,F["default"])(e.$t("mensajes."+a),"success"),t.n=5;break;case 4:t.p=4,t.v;case 5:return t.a(2)}},t,null,[[1,4]])}))()},deleteUsuarios:function(){var e=this;return y()(D()().m(function t(){var n,a,i,s;return D()().w(function(t){while(1)switch(t.p=t.n){case 0:if(0!==e.selectedDest[e.id].length){t.n=1;break}return(0,F["default"])("No ha seleccionado ningún usuario","warning"),t.a(2,!1);case 1:return t.p=1,n=e.selectedDest[e.id].map(function(e){return e.USUCOD}),t.n=2,w.$http.post("api/HyoMsjGrupoUsuario/deleteMultipleUsuario",{idGrupo:e.id,usucods:n});case 2:if(a=t.v,3!==e.idTypeGroup){t.n=4;break}return t.n=3,w.$http.get("api/HyoMsjGrupoUsuario/obtListaUsuarios",{params:{idGrupo:e.id}});case 3:i=t.v,s=i.json,e.users=s;case 4:e.selectedDest[e.id]=[],(0,F["default"])(e.$t("mensajes."+a),"success"),t.n=6;break;case 5:t.p=5,t.v;case 6:return t.a(2)}},t,null,[[1,5]])}))()}},computed:h()(h()({},(0,j.aH)("menu",["myMenu","openM"])),{},{isGreater:function(){return(0,M.isGreater)()},acceso:function(){return(0,E["default"])().usucod===this.usuario}}),created:function(){var e=this;w.$http.get("api/HyoTipUsuAcc/obtListaPerfiles").then(function(t){var n=t.json;e.perfiles=n}),this.loadListaDestinatarios()},watch:{id:function(){this.loadListaDestinatarios()}}},_=n(12807);const $=(0,_.A)(T,[["render",b]]);var O=$}}]);