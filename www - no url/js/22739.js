"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[22739],{22739:function(e,t,n){n.r(t),n.d(t,{default:function(){return K}});var a=n(61758);function o(e,t){var n=(0,a.g2)("q-page");return(0,a.uX)(),(0,a.Wv)(n,null,{default:(0,a.k6)(function(){return[((0,a.uX)(),(0,a.Wv)((0,a.$y)(e.tabSelect),{class:"q-ma-xs",onCambiar:e.cambiarEstado,dataBase:e.dataBase},null,40,["onCambiar","dataBase"]))]}),_:1})}var l=n(6123),r={class:"column"},i={class:"q-ma-sm"},c={class:"q-mt-sm q-card q-pa-sm"},s={class:"row col q-col-gutter-sm"};function u(e,t){var n=(0,a.g2)("header-btn"),o=(0,a.g2)("sie-pdf"),l=(0,a.g2)("sie-modal"),u=(0,a.g2)("q-select"),d=(0,a.g2)("q-input"),p=(0,a.g2)("q-toggle"),f=(0,a.g2)("sie-table");return(0,a.uX)(),(0,a.CE)("div",r,[(0,a.bF)(n,{name:"Listado de solicitudes",buttons:e.buttons},null,8,["buttons"]),e.infoPrint?((0,a.uX)(),(0,a.Wv)(l,{key:0,modelValue:e.modalPrint,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.modalPrint=t}),title:"Detalle de "+e.infoPrint.ID},{default:(0,a.k6)(function(){return[(0,a.bF)(o,{class:"col",src:e.url(e.infoPrint),style:{"min-height":"60vh","min-width":"50vw"}},null,8,["src"])]}),_:1},8,["modelValue","title"])):(0,a.Q3)("v-if",!0),(0,a.bF)(l,{modelValue:e.modalAceptar,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.modalAceptar=t}),title:"Aceptar Solicitud de soporte",onSubmit:e.saveAceptacion},{default:(0,a.k6)(function(){return[(0,a.Lk)("div",i,[t[7]||(t[7]=(0,a.Lk)("div",{class:"row col"},[(0,a.Lk)("div",{class:"col text-bold q-xy-md"},"Seleccione al personal encargado de atender esta solicitud")],-1)),(0,a.bF)(u,{modelValue:e.datosInsert.ID_PERSONA,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.datosInsert.ID_PERSONA=t}),options:e.personal,"option-value":"ID_PERSONA","option-label":"NOMBRE",label:"Pesona a atender"},null,8,["modelValue","options"])])]}),_:1},8,["modelValue","onSubmit"]),(0,a.Lk)("div",c,[(0,a.Lk)("div",s,[(0,a.bF)(u,{class:"col",modelValue:e.tipoSolicitud,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.tipoSolicitud=t}),options:e.tipos,label:"Tipo de solicitud","option-value":"ID","option-label":"DESCRIPCION",onInput:e.cargaInicial},null,8,["modelValue","options","onInput"]),(0,a.bF)(d,{class:"col",modelValue:e.fec_ini,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.fec_ini=t}),type:"date",label:"Desde",onInput:e.cargaInicial},null,8,["modelValue","onInput"]),(0,a.bF)(d,{class:"col",modelValue:e.fec_fin,"onUpdate:modelValue":t[5]||(t[5]=function(t){return e.fec_fin=t}),type:"date",label:"Hasta",onInput:e.cargaInicial},null,8,["modelValue","onInput"]),e.showTodos?((0,a.uX)(),(0,a.Wv)(p,{key:0,modelValue:e.verTodos,"onUpdate:modelValue":t[6]||(t[6]=function(t){return e.verTodos=t}),label:"Ver Todos",onInput:e.cargaInicial},null,8,["modelValue","onInput"])):(0,a.Q3)("v-if",!0)]),(0,a.bF)(f,{class:"q-mt-xs",dense:"",flat:"",bordered:"","wrap-cells":"",css:"height: calc(100vh - 200px)","show-search":!0,context:this,columns:e.columns,data:e.solicitudes,config:e.config,"show-refresh":!0,onRefresh:e.cargaInicial},null,8,["columns","data","config","onRefresh"])])])}var d=n(8445),p=n.n(d),f=n(76080),m=n.n(f),I=n(45254),v=n.n(I),b=(n(30683),n(10239),n(50310),n(90095),n(83190),n(44264),n(2369),n(13715),n(57668)),g=n(18105),S=n(9736),h=n(55973),T=n(16648),C=n(33777),D=n(84603),O={emits:["cambiar"],components:{QInput:S.A,QSelect:T.A,QToggle:h.A,SieTable:C.A,siePdf:D.A},data:function(){return{tipoSolicitud:null,generaConstancia:{1:0,2:0},tipos:[],fec_ini:(0,g.Ay)(new Date,"YYYY-MM-DD"),fec_fin:(0,g.Ay)((new Date).setMonth((new Date).getMonth()+1),"YYYY-MM-DD"),showTodos:3===(0,b["default"])().ruta.nivel,verTodos:!1,solicitudes:[],personal:[],modalAceptar:!1,personaSelect:null,datosInsert:{},columns:[{name:"ID",label:"Id Solicitud",align:"center",field:"ID"}],modalPrint:!1,infoPrint:{},config:{flat:!0,round:!0,color:"primary",ID:{renderHtml:function(e){var t=e.ID.toString().padStart(8,"0");return"<span>".concat(t,"</span>")}},ID_FINAL:{renderHtml:function(e){var t=e.ID_FINAL?e.ID_FINAL.toString().padStart(8,"0"):"";return"<span>".concat(t,"</span>")}},ESTADODES:{renderHtml:function(e,t,n,a){return n.background({text:e.ESTADODES,textColor:e.COLOR,color:e.FONDO})}},DESCRIPCION:{renderHtml:function(e,t,n,a){return n.background({text:e.DESCRIPCION,textColor:e.TEXTOTIPO,color:e.COLORTIPO})}},FH_REGISTRO:{edit:!1,component:"datetime"},FH_EJECUCION:{edit:!1,component:"datetime"},ACCIONES:{component:"button",icon:["check as aceptar","close as rechazar","print as imprimir","cogs as manual"],permisos:{aceptar:"===3",borrar:"===3"},flat:!0,round:!0,validate:{rechazar:function(e){return 1===e.ESTADO},aceptar:function(e){return 1===e.ESTADO},manual:function(e){return 1===e.ID_SOLICITUD_TIPO&&1===e.ESTADO},imprimir:function(e){return 1===this.generaConstancia[e.ID_SOLICITUD_TIPO]}},aceptar:function(e){var t=this;return v()(m()().m(function n(){return m()().w(function(n){while(1)switch(n.n){case 0:t.aceptarSolicitud(e);case 1:return n.a(2)}},n)}))()},manual:function(e){var t=this;return v()(m()().m(function n(){return m()().w(function(n){while(1)switch(n.n){case 0:console.log(e),t.$emit("cambiar","transferencia",e);case 1:return n.a(2)}},n)}))()},rechazar:function(e){var t=this;return v()(m()().m(function n(){var a,o;return m()().w(function(n){while(1)switch(n.p=n.n){case 0:return a={params:{ESTADO:0},id:e.ID},n.n=1,t.$confirmar("¿Está seguro de rechazar esta solicitud?");case 1:if(o=n.v,n.p=2,!o){n.n=4;break}return n.n=3,t.$http.post("api/afSolicitudController/updateAfSolicitud",a);case 3:t.$notify("Rechazado Correctamente"),t.cargaInicial();case 4:n.n=6;break;case 5:n.p=5,n.v;case 6:console.log({params:a});case 7:return n.a(2)}},n,null,[[2,5]])}))()},imprimir:function(e){var t=this;return v()(m()().m(function n(){return m()().w(function(n){while(1)switch(n.n){case 0:t.modalPrint=!0,t.infoPrint=e;case 1:return n.a(2)}},n)}))()}}}}},methods:{url:function(e){return(0,b["default"])().api+"/AfSolicitudController/getConstancia"+"?ID=".concat(e.ID,"&ID_SOLICITUD_TIPO=").concat(e.ID_SOLICITUD_TIPO,"&token2=").concat((0,b["default"])().token,"&access_token=").concat((0,b["default"])().token)},nuevaSolicitud:function(){this.$emit("cambiar","registro")},saveAceptacion:function(){var e=this;return v()(m()().m(function t(){return m()().w(function(t){while(1)switch(t.n){case 0:e.datosInsert.ID_PERSONA?e.registrarAceptacion():e.$notify("Debe seleccionar un encargado","error");case 1:return t.a(2)}},t)}))()},registrarAceptacion:function(){var e=this;return v()(m()().m(function t(){return m()().w(function(t){while(1)switch(t.n){case 0:return t.n=1,e.$http.post("api/AfSolicitudController/aprobarSolicitud",{params:e.datosInsert});case 1:e.$notify("Registrado Correctamente"),e.cargaInicial(),e.modalAceptar=!1;case 2:return t.a(2)}},t)}))()},aceptarSolicitud:function(e){var t=this;return v()(m()().m(function n(){var a;return m()().w(function(n){while(1)switch(n.p=n.n){case 0:if(n.p=0,t.datosInsert=e,1!==e.ID_SOLICITUD_TIPO){n.n=2;break}return n.n=1,t.$confirmar("¿Está seguro de realizar este proceso? será irreversible");case 1:a=n.v,a&&t.registrarAceptacion(),n.n=3;break;case 2:t.datosInsert.ID_PERSONA=null,t.modalAceptar=!0;case 3:n.n=5;break;case 4:n.p=4,n.v;case 5:return n.a(2)}},n,null,[[0,4]])}))()},cargaInicial:function(){var e=this;return v()(m()().m(function t(){var n;return m()().w(function(t){while(1)switch(t.n){case 0:return n={ID_SOLICITUD_TIPO:e.tipoSolicitud,verTodos:e.verTodos,fec_ini:e.fec_ini,fec_fin:e.fec_fin},t.n=1,e.$http.get("api/AfSolicitudController/getAfSolicitud",{params:{params:n}});case 1:e.solicitudes=t.v;case 2:return t.a(2)}},t)}))()}},computed:{buttons:function(){var e=[];return(0,b["default"])().ruta.nivel>=2&&e.push({label:"Nuevo",icon:"add",click:this.nuevaSolicitud}),e}},mounted:function(){var e=this;return v()(m()().m(function t(){var n;return m()().w(function(t){while(1)switch(t.n){case 0:return t.n=1,e.$http.get("api/AfPlantillaController/getAfPlantilla");case 1:return n=t.v,n.forEach(function(t){e.generaConstancia[t.ID_TIPO]=t.ESTADO}),t.n=2,e.$http.get("api/afSolicitudController/getSolicitudTipo");case 2:return e.tipos=t.v,e.cargaInicial(),(0,b["default"])().ruta.nivel>2&&(e.columns=[].concat(p()(e.columns),[{name:"TIPNOM",label:"Solicitante",align:"left",field:"TIPNOM"},{name:"USUNOM",label:"Nombre",align:"left",field:"USUNOM"}])),e.columns=[].concat(p()(e.columns),[{name:"DESCRIPCION",label:"Tipo de Solicitud",align:"center",field:"DESCRIPCION"},{name:"ID_FINAL",label:"Id Atención",align:"center",field:"ID_FINAL"},{name:"FH_REGISTRO",label:"F. Registro",align:"center",field:"FH_REGISTRO"},{name:"FH_EJECUCION",label:"F. Ejecucion",align:"center",field:"FH_EJECUCION"},{name:"ESTADODES",label:"Estado",align:"center",field:"ESTADODES"},{name:"ACCIONES",align:"center",field:"ACCIONES"}]),t.n=3,e.$http.get("api/personaController/getPersonaPorPerfil",{params:{params:{id_perfil:8,estado:1}}});case 3:e.personal=t.v;case 4:return t.a(2)}},t)}))()}},A=n(12807);const _=(0,A.A)(O,[["render",u]]);var w=_,E=n(58790),k={class:"col column justify-center items-center"},F={class:"q-ma-sm"},P={class:"q-ma-sm"},V={class:"column row-md q-gutter-sm"},N={key:0,class:"q-ma-sm"},$={class:"column row-md q-gutter-sm"},R={key:1,class:"q-ma-sm"},q={class:"column row-md q-gutter-sm"},y={key:2,class:"q-ma-sm"},L={class:"q-ma-sm"},U={key:3,class:"q-ma-sm"},H={class:"q-ma-sm"},M={class:"row q-gutter-sm"};function Y(e,t){var n=(0,a.g2)("q-toolbar"),o=(0,a.g2)("q-input"),l=(0,a.g2)("q-select"),r=(0,a.g2)("q-field"),i=(0,a.g2)("sie-table"),c=(0,a.g2)("q-btn");return(0,a.uX)(),(0,a.CE)("div",k,[(0,a.Lk)("div",{class:"q-card",style:(0,E.Tr)({width:e.ancho,height:e.alto})},[(0,a.bF)(n,{class:"row justify-center"},{default:(0,a.k6)(function(){return p()(t[8]||(t[8]=[(0,a.Lk)("span",{class:"text-bold"},"Formulario de solicitud",-1)]))}),_:1}),(0,a.Lk)("div",F,[(0,a.Lk)("div",P,[(0,a.Lk)("div",V,[(0,a.bF)(o,{class:"col",modelValue:e.nombre,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.nombre=t}),disable:"",label:"Nombre",readonly:""},null,8,["modelValue"]),(0,a.bF)(l,{class:"col",modelValue:e.tipoSolicitud,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.tipoSolicitud=t}),options:e.tipos,label:"Solicitud","option-value":"ID","option-label":"DESCRIPCION",onInput:e.seleccionarTipo},null,8,["modelValue","options","onInput"])])]),2===e.tipoSolicitud?((0,a.uX)(),(0,a.CE)("div",N,[(0,a.Lk)("div",$,[(0,a.bF)(l,{class:"col",modelValue:e.soporteTipo,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.soporteTipo=t}),options:e.tiposSoporte,label:"Tipo de Soporte","option-value":"ID_SOPORTE_TIPO","option-label":"DESCRIPCION"},null,8,["modelValue","options"]),(0,a.bF)(l,{class:"col",modelValue:e.soporteSubTipo,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.soporteSubTipo=t}),options:e.subTipos[e.soporteTipo],label:"Subtipo de Soporte","option-value":"ID_SOPORTE_SUBTIPO","option-label":"DESCRIPCION"},null,8,["modelValue","options"])])])):(0,a.Q3)("v-if",!0),1===e.tipoSolicitud?((0,a.uX)(),(0,a.CE)("div",R,[(0,a.Lk)("div",q,[(0,a.bF)(o,{class:"col",modelValue:e.fecIni,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.fecIni=t}),type:"date",label:"Fecha de Inicio","input-style":"text-align: center;"},null,8,["modelValue"]),(0,a.bF)(o,{class:"col",modelValue:e.fecFin,"onUpdate:modelValue":t[5]||(t[5]=function(t){return e.fecFin=t}),type:"date",label:"Fecha de Fin","input-style":"text-align: center;"},null,8,["modelValue"])])])):(0,a.Q3)("v-if",!0),1===e.tipoSolicitud?((0,a.uX)(),(0,a.CE)("div",y,[(0,a.bF)(r,{class:"row q-gutter-sm col",error:e.v$.catalogosSelect.$error,"error-label":e.$t("validaciones.requerido")},{default:(0,a.k6)(function(){return[(0,a.bF)(l,{class:"col",modelValue:e.v$.catalogosSelect.$model,"onUpdate:modelValue":t[6]||(t[6]=function(t){return e.v$.catalogosSelect.$model=t}),label:"Catalogo",options:e.catalogos,"option-value":"ID_CATALOGO","option-label":"DESCRIPCION","use-chips":"",multiple:"",color:"secondary",placeholder:"Seleccione uno o mas catalogos"},null,8,["modelValue","options"])]}),_:1},8,["error","error-label"])])):(0,a.Q3)("v-if",!0),(0,a.Lk)("div",L,[(0,a.bF)(r,{class:"row q-gutter-sm col",error:e.v$.mensaje.$error,"error-label":e.$t("validaciones.requerido")},{default:(0,a.k6)(function(){return[(0,a.bF)(o,{class:"col",modelValue:e.v$.mensaje.$model,"onUpdate:modelValue":t[7]||(t[7]=function(t){return e.v$.mensaje.$model=t}),type:"textarea",label:"Mensaje",placeholder:"Ingrese una descripción de la solicitud"},null,8,["modelValue"])]}),_:1},8,["error","error-label"])]),2===e.tipoSolicitud&&0===e.objTipos[e.soporteTipo]?((0,a.uX)(),(0,a.CE)("div",U,[(0,a.bF)(i,{dense:"",flat:"",bordered:"","wrap-cells":"",css:"height: calc(30vh)","show-search":!1,columns:e.columns,data:e.activos,selection:"multiple",config:e.config,ref:"tablaActicos","check-all-position":"right","load-selection":e.load},null,8,["columns","data","config","load-selection"])])):(0,a.Q3)("v-if",!0)]),(0,a.bF)(n,{class:"row justify-end",inverted:""},{default:(0,a.k6)(function(){return[(0,a.Lk)("div",H,[(0,a.Lk)("div",M,[(0,a.bF)(c,{color:"primary",onClick:e.volver},{default:(0,a.k6)(function(){return p()(t[9]||(t[9]=[(0,a.eW)("Cancelar",-1)]))}),_:1},8,["onClick"]),(0,a.bF)(c,{color:"primary",onClick:e.grabar},{default:(0,a.k6)(function(){return p()(t[10]||(t[10]=[(0,a.eW)("Grabar",-1)]))}),_:1},8,["onClick"])])])]}),_:1})],4)])}n(23825),n(52133),n(6724),n(24066);var j=n(83972),Q=n(81288),x=n(82640),X=n(78131),G={setup:function(){var e=(0,j.fG)();return{v$:e}},emits:["cambiar"],components:{QInput:S.A,QSelect:T.A,sieTable:C.A,QToolbar:l.ZV,QField:l.Om,QBtn:l.Il},data:function(){return{sie:(0,b["default"])(),tipoSolicitud:1,generaConstancia:{1:0,2:0},tipos:[],nombre:(0,b["default"])().nombre,fecIni:(0,g.Ay)(new Date,"YYYY-MM-DD"),fecFin:(0,g.Ay)(new Date((new Date).getFullYear(),11,31),"YYYY-MM-DD"),mensaje:null,catalogos:[],catalogosSelect:[],activos:[],transferencia:null,load:{key:"ID_ACTIVO",values:[]},tiposSoporte:[],subTipos:{},objTipos:{},soporteTipo:null,soporteSubTipo:null,columns:[{name:"DESCRIPCION",label:"Activo",align:"left",field:"DESCRIPCION"},{name:"ID_ACTIVO_TXT",label:"Id",align:"left",field:"ID_ACTIVO_TXT"},{name:"FH_TRANSFERENCIA_I",label:"F. Inicio",align:"center",field:"FH_TRANSFERENCIA_I"},{name:"FH_FIN",label:"F. Fin",align:"center",field:"FH_FIN"}],config:{flat:!0,round:!0,color:"primary",FH_TRANSFERENCIA_I:{component:"date"},FH_FIN:{component:"date"}}}},methods:{volver:function(){this.$emit("cambiar","listado")},buscarTransferencia:function(e){var t=this;return v()(m()().m(function n(){return m()().w(function(n){while(1)switch(n.n){case 0:if(13!==e.which){n.n=2;break}return t.load.values=[],n.n=1,t.$http.get("api/AfTransferenciaController/getDetalle",{params:{id:t.transferencia}});case 1:t.activos=n.v,t.activos.length>0&&(t.load.values=t.activos.map(function(e){var t=e.ID_ACTIVO;return t}));case 2:return n.a(2)}},n)}))()},grabar:function(){var e=this;return v()(m()().m(function t(){var n,a,o,l,r,i;return m()().w(function(t){while(1)switch(t.p=t.n){case 0:if(t.p=0,e.v$.$touch(),e.v$.$invalid){t.n=6;break}n=e.catalogosSelect.map(function(e){return e}),a={ID_SOLICITUD_TIPO:e.tipoSolicitud,MENSAJE:e.mensaje},i=e.tipoSolicitud,t.n=1===i?1:2===i?2:3;break;case 1:return a.CATALOGOS=n,a.F_INICIO=e.fecIni,a.F_FIN=e.fecFin,t.a(3,3);case 2:return a.ID_SOPORTE_TIPO=e.soporteTipo,a.ID_SOPORTE_SUBTIPO=e.soporteSubTipo,0===e.objTipos[e.soporteTipo]&&(a.ACTIVOS=e.$refs.tablaActicos.rowsSelected().map(function(e){var t=e.ID_ACTIVO;return t})),t.a(3,3);case 3:return t.n=4,e.$confirmar("¿Está seguro de registrar esta solicitud?");case 4:if(o=t.v,!o){t.n=6;break}return t.n=5,e.$http.post("api/AfSolicitudController/addAfSolicitud",{data:a});case 5:l=t.v,e.$notify("Se registró la solicitud"),1===e.generaConstancia[e.tipoSolicitud]&&(r=(0,b["default"])().api+"/AfSolicitudController/getConstancia"+"?ID=".concat(l,"&ID_SOLICITUD_TIPO=").concat(e.tipoSolicitud,"&token2=").concat((0,b["default"])().token,"&access_token=").concat((0,b["default"])().token),(0,X["default"])(r,"data.pdf   ",!0)),e.volver();case 6:t.n=8;break;case 7:t.p=7,t.v;case 8:return t.a(2)}},t,null,[[0,7]])}))()},seleccionarTipo:function(){var e=this;return v()(m()().m(function t(){return m()().w(function(t){while(1)switch(t.n){case 0:if(1===e.tipoSolicitud){t.n=2;break}return e.load.values=[],t.n=1,e.$http.get("api/AfTransferenciaController/getDetalle");case 1:e.activos=t.v,e.activos.length>0&&(e.load.values=e.activos.map(function(e){var t=e.ID_ACTIVO;return t}));case 2:return t.a(2)}},t)}))()}},computed:{buttons:function(){var e=[];return e.push({label:"Volver",icon:"arrow_left",click:this.volver}),(0,b["default"])().ruta.nivel>=2&&e.push({label:"Grabar",icon:"save",click:this.grabar}),e},isGreater:function(){return(0,Q.isGreater)()},ancho:function(){return(0,Q.isGreater)()?"50vw":"100vw"},alto:function(){return(0,Q.isGreater)()?"":"100vh"}},mounted:function(){var e=this;return v()(m()().m(function t(){var n,a,o,l,r;return m()().w(function(t){while(1)switch(t.n){case 0:return t.n=1,e.$http.get("api/afSolicitudController/getSolicitudTipo");case 1:return e.tipos=t.v,t.n=2,e.$http.get("api/AfCatalogoController/getAfCatalogo",{params:{parametros:{soloActivos:!0}}});case 2:return e.catalogos=t.v,t.n=3,e.$http.get("api/AfPlantillaController/getAfPlantilla");case 3:return n=t.v,n.forEach(function(t){e.generaConstancia[t.ID]=t.ESTADO}),t.n=4,e.$http.get("api/afSoporteTipoController/getAfSoporteTipo");case 4:a=t.v,o=a.tipos,l=a.subTipos,r=a.objTipos,e.tiposSoporte=o,e.subTipos=l,e.objTipos=r;case 5:return t.a(2)}},t)}))()},validations:function(){var e=this,t=function(){return 2===e.tipoSolicitud||e.catalogosSelect.length>0},n={catalogosSelect:{valCatalogos:t},mensaje:{required:x.mw}};return n},watch:{soporteTipo:function(){this.soporteSubTipo=null}}};const B=(0,A.A)(G,[["render",Y]]);var z=B,W=n(66594),J={components:{registro:z,listado:w,transferencia:W.A,QPage:l.Tu},data:function(){return{tabSelect:"listado",dataBase:[]}},methods:{cambiarEstado:function(e,t){console.log("XD"),this.tabSelect=e,this.dataBase=t}}};const Z=(0,A.A)(J,[["render",o]]);var K=Z}}]);