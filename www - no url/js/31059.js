"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[31059],{31059:function(e,t,n){n.r(t),n.d(t,{default:function(){return ae}});var a=n(8445),o=n.n(a),r=n(61758),i=n(29104),s={class:"row"},l={class:"col"},c={class:"row q-col-gutter-sm q-pa-sm"},u={key:0,class:"col-xs-12"},d={class:"row full-height q-pt-sm"},f={class:"col column items-center justify-start"},p={class:"col-xs-12 col-md-3"},m={class:"col-xs-12 col-md-6"},h={class:"col-xs-12 col-md-3"},g={class:"col-xs-12 col-sm-12 col-md-3"},v={class:"col-xs-12 col-sm-12 col-md-4"},I={class:"col-xs-12 col-sm-6 col-md-3 col-lg-2"},b={class:"col-xs-12 col-sm-6 col-md-4 col-lg-2"},O={class:"row q-gutter-xs"},E={class:"col"},F={key:0},R={class:"row sie-flat"},C={class:"col-xs-12"};function w(e,t){var n=this,a=(0,r.g2)("header-btn"),w=(0,r.g2)("q-separator"),P=(0,r.g2)("q-img"),S=(0,r.g2)("autocomplete"),A=(0,r.g2)("q-input"),k=(0,r.g2)("q-date"),D=(0,r.g2)("q-popup-proxy"),N=(0,r.g2)("q-icon"),x=(0,r.g2)("q-tooltip"),V=(0,r.g2)("q-btn"),_=(0,r.g2)("q-card-section"),T=(0,r.g2)("sie-table"),M=(0,r.g2)("q-card"),L=(0,r.g2)("box-imagen"),y=(0,r.g2)("modal-alertas"),q=(0,r.g2)("q-page");return(0,r.uX)(),(0,r.Wv)(q,{class:"movimiento-operaciones q-pa-sm sie-flat"},{default:(0,r.k6)(function(){return[(0,r.bF)(M,{flat:""},{default:(0,r.k6)(function(){return[(0,r.bF)(a,{name:"Reservados",buttons:e.headerButtons},null,8,["buttons"]),(0,r.bF)(w),(0,r.bF)(_,null,{default:(0,r.k6)(function(){return[(0,r.Lk)("div",s,[(0,r.Lk)("div",l,[(0,r.Lk)("div",c,[e.getWidth<=699?((0,r.uX)(),(0,r.CE)("div",u,[(0,r.Lk)("div",d,[(0,r.Lk)("div",f,[(0,r.bF)(P,{class:"foto-alumno",src:e.rutaFoto,width:"100px",height:"100px"},{error:(0,r.k6)(function(){return[(0,r.bF)(P,{class:"foto-alumno",src:e.rutaFotoDefault,width:"100px",height:"100px"},null,8,["src"])]}),_:1},8,["src"])])])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",p,[(0,r.bF)(S,{class:"q-ma-none",modelValue:e.solicitante,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.solicitante=t}),data:e.listaSolicitantes,label:"Codigo / Nombre",keys:e.llaveSolicitante,onSelected:e.asignaSolicitante},null,8,["modelValue","data","keys","onSelected"])]),(0,r.Lk)("div",m,[(0,r.bF)(A,{modelValue:e.nombre,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.nombre=t}),label:"Nombre",readonly:""},null,8,["modelValue"])]),(0,r.Lk)("div",h,[(0,r.bF)(A,{modelValue:e.ngs,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.ngs=t}),label:"NGS",readonly:""},null,8,["modelValue"])]),(0,r.Lk)("div",g,[(0,r.bF)(A,{modelValue:e.nroIngreso,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.nroIngreso=t}),label:"Nro Ingreso",ref:"refNumingreso",onKeyup:(0,i.jR)(e.asignaNroIngreso,["enter"])},null,8,["modelValue","onKeyup"])]),(0,r.Lk)("div",v,[(0,r.bF)(S,{class:"q-ma-none",modelValue:e.titulo,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.titulo=t}),data:e.listaTitulos,label:"Titulos",keys:e.llaveTitulo,onSelected:e.asignaTitulo,style:{"margin-left":"2px"}},null,8,["modelValue","data","keys","onSelected"])]),(0,r.Lk)("div",I,[(0,r.bF)(A,{label:"Desde",debounce:"500",maxlength:"10",format:"##/##/####",modelValue:e.fechaInicio,"onUpdate:modelValue":t[7]||(t[7]=function(t){return e.fechaInicio=t}),mask:"##/##/####",readonly:""},{append:(0,r.k6)(function(){return[(0,r.bF)(N,{class:"cursor-pointer",name:"date_range"},{default:(0,r.k6)(function(){return[(0,r.bF)(D,{ref:"fechaInicio","transition-show":"scale","transition-hide":"scale"},{default:(0,r.k6)(function(){return[(0,r.bF)(k,{mask:"DD/MM/YYYY",modelValue:e.fechaInicio,"onUpdate:modelValue":t[5]||(t[5]=function(t){return e.fechaInicio=t}),onInput:t[6]||(t[6]=function(t){return e.ingresarFecha("fechaInicio")})},null,8,["modelValue"])]}),_:1},512)]}),_:1})]}),_:1},8,["modelValue"])]),(0,r.Lk)("div",b,[(0,r.Lk)("div",O,[(0,r.Lk)("div",E,[(0,r.bF)(A,{label:"Hasta",debounce:"500",maxlength:"10",format:"##/##/####",modelValue:e.fechaFin,"onUpdate:modelValue":t[10]||(t[10]=function(t){return e.fechaFin=t}),mask:"##/##/####",readonly:""},{append:(0,r.k6)(function(){return[(0,r.bF)(N,{class:"cursor-pointer",name:"date_range"},{default:(0,r.k6)(function(){return[(0,r.bF)(D,{ref:"fechaFin","transition-show":"scale","transition-hide":"scale"},{default:(0,r.k6)(function(){return[(0,r.bF)(k,{mask:"DD/MM/YYYY",modelValue:e.fechaFin,"onUpdate:modelValue":t[8]||(t[8]=function(t){return e.fechaFin=t}),onInput:t[9]||(t[9]=function(t){return e.ingresarFecha("fechaFin")})},null,8,["modelValue"])]}),_:1},512)]}),_:1})]}),_:1},8,["modelValue"])]),(0,r.bF)(V,{icon:"broom",color:"primary",dense:"",onClick:t[11]||(t[11]=function(t){return e.limpiar()})},{default:(0,r.k6)(function(){return[(0,r.bF)(x,null,{default:(0,r.k6)(function(){return o()(t[14]||(t[14]=[(0,r.eW)("Limpiar",-1)]))}),_:1})]}),_:1})])])])]),e.getWidth>=700?((0,r.uX)(),(0,r.CE)("div",F,[(0,r.bF)(P,{class:"foto-alumno",src:e.rutaFoto,width:"76px",height:"76px",onClick:e.openBoxImagen},{error:(0,r.k6)(function(){return[(0,r.bF)(P,{class:"foto-alumno",src:e.rutaFotoDefault,width:"80px",height:"80px"},null,8,["src"])]}),_:1},8,["src","onClick"])])):(0,r.Q3)("v-if",!0)])]}),_:1}),(0,r.bF)(_,null,{default:(0,r.k6)(function(){return[(0,r.Lk)("div",R,[(0,r.Lk)("div",C,[(0,r.bF)(T,{ref:"reservados","show-search":!1,columns:e.fields,data:e.listaReservados,selection:"multiple",context:n,config:e.config,css:{height:"calc(72vh - 45px)"}},null,8,["columns","data","config"])])])]}),_:1})]}),_:1}),e.openModalImagen?((0,r.uX)(),(0,r.Wv)(L,{key:0,modelValue:e.openModalImagen,"onUpdate:modelValue":t[12]||(t[12]=function(t){return e.openModalImagen=t}),urlImage:e.urlImagenBox,urlImageDefault:e.rutaFotoDefault,titulo:e.nombre},null,8,["modelValue","urlImage","urlImageDefault","titulo"])):(0,r.Q3)("v-if",!0),e.openModalAlertas?((0,r.uX)(),(0,r.Wv)(y,{key:1,modelValue:e.openModalAlertas,"onUpdate:modelValue":t[13]||(t[13]=function(t){return e.openModalAlertas=t}),operacion:e.OPERACION_RESERVA,alertasOperaciones:e.alertasOperaciones,configDB:e.configBD},null,8,["modelValue","operacion","alertasOperaciones","configDB"])):(0,r.Q3)("v-if",!0)]}),_:1})}var P=n(76080),S=n.n(P),A=n(45254),k=n.n(A),D=(n(71225),n(77507),n(52133),n(50310),n(5962),n(6724),n(83190),n(6123)),N=n(88567),x=n(95718),V=n(53380),_=n(16648),T=n(982),M=n(57668),L=n(30640),y=n(93616),q=n(78840),$=n(95477),U=n(26319),B=(0,U.date)(new Date).date,Q=function(e){var t=(0,U.date)(new Date(e),"YYYY/MM/DD").date;return t<B},Y={data:function(){return{config:{FECRES:{component:"date",edit:!1},FECPREI:{tooltip:function(e){return Q(e.FECPREI)?"Expiró":""},renderHtml:function(e,t,n,a){if(this.fechasRecojoVencidas=!1,e.FECPREI){var o=(0,U.date)(e.FECPREI,"YYYY/MM/DD").datePeru;return Q(e.FECPREI)?(this.fechasRecojoVencidas=!0,n.background({color:"transparent",textColor:"red",text:o,style:{fontWeight:"bold"}})):t("span",{},o)}}},FECPREF:{component:"date",edit:!1},EDITAR:{component:"button",icon:["edit as editar"],tooltip:{editar:"Editar"},flat:!0,dense:!0}},fields:[{name:"NUMINGRESO",label:"Nro Ingreso",field:"NUMINGRESO",align:"left",order:!0},{name:"NOMCOMP",label:"Nombre de Solicitante",field:"NOMCOMP",align:"left",wrap:!0,order:!0},{name:"NGS_CARGO",label:"NGS / Cargo",field:"NGS_CARGO",align:"left",order:!0},{name:"PARTE",label:"Cod. Clasif",field:"PARTE",align:"left",wrap:!0,order:!0},{name:"TITULO",label:"Título",field:"TITULO",align:"left",order:!0},{name:"FECRES",label:"Fecha Reserva",field:"FECRES",align:"center",order:!0},{name:"FECPREI",label:"Fecha Prestamo",field:"FECPREI",align:"center",order:!0},{name:"FECPREF",label:"Fecha Retorno",field:"FECPREF",align:"center",order:!0}]}}},j=n(3042),G=n(4437),X=n(9736),W=n(57343),H=n(2819),K=n(53399),z=n(21103),J=n(98361),Z=n(90007),ee={mixins:[Y],components:{QCard:N.A,QCardSection:x.A,QSeparator:V.A,sieSelect:y.A,notify:T["default"],QSelect:_.A,sieModal:L.A,actionButton:q.A,QPopupProxy:$.A,autocomplete:j.A,QDate:G.A,QInput:X.A,QImg:K.A,boxImagen:J.A,modalAlertas:Z.A,QPage:D.Tu,QIcon:D.bP,QBtn:D.Il,QTooltip:D.nC},data:function(){var e=this;return{sie:(0,M["default"])(),headerButtons:[{icon:"email",permiso:">1",label:"Enviar alerta",click:function(){e.openEnvioAlerta()}},{icon:"print",permiso:">1",label:"Imprimir",click:function(){(0,H.exportFilePhp)({},"biblioteca/movimientos-prestamos/relacion-reserva")},tooltip:"Relacion de Reservas"},{icon:"book",permiso:">2",label:"Prestar",click:function(){var t=k()(S()().m(function t(){return S()().w(function(t){while(1)switch(t.n){case 0:e.prestamoMultiple();case 1:return t.a(2)}},t)}));function n(){return t.apply(this,arguments)}return n}(),tooltip:"Prestar Reserva"},{icon:"block",permiso:">2",label:"Anular",click:function(){var t=k()(S()().m(function t(){return S()().w(function(t){while(1)switch(t.n){case 0:e.anularReserva();case 1:return t.a(2)}},t)}));function n(){return t.apply(this,arguments)}return n}(),tooltip:"Anular Reserva"}],llaveSolicitante:["TEXT"],llaveTitulo:["TITULO","NUMINGRESO"],listaSolicitantes:[],listaTitulos:[],listaReservados:[],personaSelected:{},dataSolicitante:{},idPersona:null,solicitante:null,codigoFoto:"",titulo:null,fechaInicio:null,fechaFin:null,nombre:null,ngs:null,nroIngreso:null,modalDatosPago:null,monto:null,observaciones:null,fechaPago:null,sexo:"M",rutaFotoDefault:null,rutaFoto:null,idRegistro:null,tipcod:null,OPERACION_RESERVA:null,OPERACION_ANULACION:null,openModalImagen:!1,openModalAlertas:!1,alertasOperaciones:[],urlImagenBox:"",configBD:{},fechasRecojoVencidas:!1}},computed:{getWidth:function(){return z.A.width}},methods:{openBoxImagen:function(){this.urlImagenBox=this.codigoFoto?this.rutaFoto:this.rutaFotoDefault,this.openModalImagen=!0},getlistaSolcitantes:function(){var e=this;return k()(S()().m(function t(){return S()().w(function(t){while(1)switch(t.n){case 0:return t.n=1,e.$http.get("api/OperacionesController/getPersonasBiblioteca");case 1:e.listaSolicitantes=t.v;case 2:return t.a(2)}},t)}))()},getlistaTitulos:function(){var e=this;return k()(S()().m(function t(){var n;return S()().w(function(t){while(1)switch(t.n){case 0:return n={columnas:["titulo"],joins:[],distinct:!0,order:{sidx:"titulo",sord:"asc"}},t.n=1,e.$http.get("api/MantenimientosController/getTitulos",{params:{parametros:n}});case 1:e.listaTitulos=t.v;case 2:return t.a(2)}},t)}))()},getConstantesBiblioteca:function(){var e=this;return k()(S()().m(function t(){var n;return S()().w(function(t){while(1)switch(t.n){case 0:return t.n=1,e.$http.get("api/OperacionesController/getConstantesBib");case 1:n=t.v,e.OPERACION_RESERVA=n.OPERACION_RESERVA,e.OPERACION_ANULACION=n.OPERACION_ANULACION;case 2:return t.a(2)}},t)}))()},getListaReservas:function(e){var t=this;return k()(S()().m(function n(){var a;return S()().w(function(n){while(1)switch(n.n){case 0:return a=e||{},a.oper=t.OPERACION_RESERVA,n.n=1,t.$http.get("api/OperacionesController/getOperaciones",{params:{parametros:a}});case 1:t.listaReservados=n.v;case 2:return n.a(2)}},n)}))()},cargarImagen:function(){var e=this;return k()(S()().m(function t(){return S()().w(function(t){while(1)switch(t.n){case 0:e.rutaFotoDefault=(0,W.getImageDefault)(e.sie,e.sexo),e.rutaFoto=(0,W.imgEstudiante)(e.sie,e.solicitante);case 1:return t.a(2)}},t)}))()},openEnvioAlerta:function(){if(this.alertasOperaciones=this.$refs.reservados.rowsSelected(["IDOPERADET"]),0===this.alertasOperaciones.length)return this.$notify("Aviso- Debe seleccionar los registros a enviar la alerta","info"),!1;this.openModalAlertas=!0},prestamoMultiple:function(){var e=this;return k()(S()().m(function t(){var n,a,o,r,i,s,l,c,u;return S()().w(function(t){while(1)switch(t.p=t.n){case 0:if(t.p=0,n=e.$refs.reservados.rowsSelected(["IDOPERADET","NOMCOMP","EXISTCOD","FICHACOD","SOLCOD","ID_PERSONA","ID_PERFIL","NGS_CARGO"]),0!==n){t.n=1;break}return e.$notify("Aviso- Debe seleccionar ejemplares para continuar con la operación.","info"),t.a(2,!1);case 1:return a=n.map(function(t){var n=e.listaSolicitantes.filter(function(e){return e.ID_PERSONA===t.ID_PERSONA});return n.length>0&&(t["TIPCOD"]=n[0].TIPCOD),t}),o="¿Está seguro de prestar las reservas seleccionadas?",e.fechasRecojoVencidas&&(o="<b>".concat(o,"</b> <br><br>De haber fechas expiradas los préstamos se generarán con la fecha actual")),t.n=2,e.$confirmar(o,"info",!0);case 2:if(r=t.v,!r){t.n=4;break}return i={ejemplares:a},t.n=3,e.$http.post("api/OperacionesController/prestamoMultiple",{data:i});case 3:s=t.v,l=s.message,c=s.data,e.$alert(l,c.type||"success",!0),"success"===c.type&&e.busquedaPorFiltro();case 4:return t.a(2,!0);case 5:return t.p=5,u=t.v,e.$notify(u.message,"warning"),t.a(2,!1)}},t,null,[[0,5]])}))()},anularReserva:function(){var e=this;return k()(S()().m(function t(){var n,a,o,r,i,s,l,c;return S()().w(function(t){while(1)switch(t.p=t.n){case 0:if(n=e.$refs.reservados.rowsSelected(["IDOPERADET","TITULO","EXISTCOD"]),0!==n.length){t.n=1;break}return e.$notify("Aviso- Debe seleccionar ejemplares para continuar con la operación.","info"),t.a(2,!1);case 1:return t.p=1,a="¿Está seguro de anular las reservas seccionadas?",t.n=2,e.$confirmar(a,"warning",!0);case 2:if(o=t.v,!o){t.n=4;break}return r={ejemplares:n,operacion:e.OPERACION_ANULACION},t.n=3,e.$http.post("api/OperacionesController/devolucionPrestamos",{data:r});case 3:i=t.v,s=i.message,l=i.data,e.$alert(s,l.type||"success",!0),"success"===l.type&&(e.numingreso="",e.busquedaPorFiltro());case 4:return t.a(2,!0);case 5:return t.p=5,c=t.v,e.$notify(c.message,"warning"),t.a(2,!1)}},t,null,[[1,5]])}))()},busquedaPorFiltro:function(){var e={id_persona:this.idPersona?this.idPersona:null,desde:this.fechaInicio?(this.fechaInicio||"").split("/").reverse().join("/"):null,hasta:this.fechaFin?(this.fechaFin||"").split("/").reverse().join("/"):null,numingreso:this.nroIngreso?this.nroIngreso:null,titulo:this.titulo?this.titulo:null,oper:this.OPERACION_RESERVA};this.getListaReservas(e)},asignaNroIngreso:function(){return!(!this.nroIngreso&&!this.solicitante)&&(this.solicitante&&this.nroIngreso?this.registrarReserva():void this.busquedaPorFiltro())},registrarReserva:function(){var e=this;return k()(S()().m(function t(){var n,a,o,r,i;return S()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,n={solcod:e.personaSelected.SOLCOD,id_persona:e.personaSelected.ID_PERSONA,id_perfil:e.personaSelected.ID_PERFIL,nomcomp:e.nombre,numingreso:e.nroIngreso,tiposolicita:e.personaSelected.TIPO_SOLICITA,descriptor:e.ngs,fecpref:e.dataSolicitante.retorno,permitidos:e.dataSolicitante.permitidos,cantPrestamos:e.dataSolicitante.cant_prestamos},t.n=1,e.$http.post("api/OperacionesController/registrarReserva",{data:n});case 1:return a=t.v,o=a.message,r=a.data,e.$notify(o,r.type||"success"),"success"===r.type&&(e.nroIngreso="",e.dataSolicitante.cant_prestamos++,e.busquedaPorFiltro()),t.a(2,!0);case 2:return t.p=2,i=t.v,e.nroIngreso="",e.$alert(e.$errorMessage(i),"warning",!0),t.a(2,!1)}},t,null,[[0,2]])}))()},asignaSolicitante:function(e){var t=this;return k()(S()().m(function n(){return S()().w(function(n){while(1)switch(n.n){case 0:t.personaSelected=e,t.nombre=e.NOMCOMP,t.tipcod=e.TIPCOD,t.sexo=e.SEXO,t.ngs=e.DESCRIPTOR||"--",t.solicitante=e.SOLCOD,t.codigoFoto=1===e.ID_PERFIL?e.SOLCOD:"",t.idPersona=e.ID_PERSONA,t.$refs.refNumingreso.$el.focus(),t.cargarImagen(e),t.getEvaluacionSolicitante(e),t.busquedaPorFiltro();case 1:return n.a(2)}},n)}))()},getEvaluacionSolicitante:function(e){var t=this;return k()(S()().m(function n(){var a;return S()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,a={solcod:e.SOLCOD,tipcod:e.TIPCOD,nomcomp:e.NOMCOMP},n.n=1,t.$http.get("api/OperacionesController/getEvaluacionSolicitante",{params:{parametros:a}});case 1:t.dataSolicitante=n.v,t.dataSolicitante.bloqueado&&t.$alert(t.dataSolicitante.bloqueado,"info",!0),n.n=3;break;case 2:return n.p=2,n.v,n.a(2,[]);case 3:return n.a(2)}},n,null,[[0,2]])}))()},asignaTitulo:function(e){this.titulo=e.TITULO,this.busquedaPorFiltro()},ingresarFecha:function(e){this.$refs[e].hide(),this.busquedaPorFiltro()},limpiar:function(){this.dataSolicitante={},this.personaSelected={},this.solicitante="",this.codigoFoto="",this.nombre="",this.ngs="",this.titulo="",this.sexo="M",this.idPersona="",this.fechaInicio="",this.fechaFin="",this.nroIngreso="",this.busquedaPorFiltro(),this.cargarImagen()},cargarDatosPrincipales:function(){var e=this;return k()(S()().m(function t(){return S()().w(function(t){while(1)switch(t.n){case 0:return t.n=1,e.getlistaSolcitantes();case 1:return t.n=2,e.getlistaTitulos();case 2:e.cargarImagen();case 3:return t.a(2)}},t)}))()},getConfigOperaciones:function(){var e=this;return k()(S()().m(function t(){return S()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,t.n=1,e.$http.get("api/OperacionesController/getConfigOperaciones",{params:{parametros:{}}});case 1:e.configBD=t.v,t.n=3;break;case 2:return t.p=2,t.v,t.a(2,[]);case 3:return t.a(2)}},t,null,[[0,2]])}))()}},mounted:function(){var e=this;return k()(S()().m(function t(){return S()().w(function(t){while(1)switch(t.n){case 0:return t.n=1,e.getConstantesBiblioteca();case 1:return t.n=2,e.getConfigOperaciones();case 2:return t.n=3,e.getListaReservas();case 3:return t.a(2)}},t)}))()},created:function(){var e=this;return k()(S()().m(function t(){return S()().w(function(t){while(1)switch(t.n){case 0:e.cargarDatosPrincipales();case 1:return t.a(2)}},t)}))()}},te=n(12807);const ne=(0,te.A)(ee,[["render",w]]);var ae=ne}}]);