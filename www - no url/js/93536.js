"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[93536],{93536:function(e,t,a){a.r(t),a.d(t,{default:function(){return j}});var o=a(61758);function n(e,t){var a=(0,o.g2)("importar"),n=(0,o.g2)("q-page");return(0,o.uX)(),(0,o.Wv)(n,{class:"col"},{default:(0,o.k6)(function(){return[(0,o.bF)(a,{class:"q-card q-ma-xs",sieInfo:e.info},null,8,["sieInfo"])]}),_:1})}var s=a(6123),i=a(8445),l=a.n(i),r=a(58790),u={class:"q-ma-xs"},c={class:"column"},d={class:"col"},f={class:"row"},p={class:"column justify-center q-mx-sm"},m={class:"column justify-center q-mx-xs"},g={class:"column justify-center"},A={class:"q-table q-table-horizontal-separator q-card"},h={class:"row justify-start"},C={key:0},O={key:0},D={key:2,class:"text-negative",style:{"font-size":"12px"}},E={key:0,class:"column col items-center justify-center"},b={class:"row justify-between q-table-bottom row items-center q-table-nodata"},v={class:"row justify-start"},S={class:"row justify-end"},N={class:"text-bold"},k={key:1,class:"row col"};function T(e,t){var a=(0,o.g2)("q-item-tile"),n=(0,o.g2)("q-item-main"),s=(0,o.g2)("q-item"),i=(0,o.g2)("q-item-separator"),T=(0,o.g2)("q-list"),L=(0,o.g2)("q-scroll-area"),I=(0,o.g2)("sie-modal"),R=(0,o.g2)("sie-upload"),y=(0,o.g2)("q-toolbar-title"),F=(0,o.g2)("q-select"),M=(0,o.g2)("q-btn"),U=(0,o.g2)("q-toolbar"),q=(0,o.g2)("q-checkbox"),_=(0,o.g2)("sie-vacio"),H=(0,o.g2)("q-spinner"),w=(0,o.g2)("q-inner-loading"),Q=(0,o.g2)("q-icon");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.bF)(I,{modelValue:e.modalErrores,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.modalErrores=t}),title:"Información Adicional",footer:!1},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",u,[(0,o.Lk)("div",c,[t[7]||(t[7]=(0,o.Lk)("span",{class:"text-bold"},"No se pudieron importar todos los registros",-1)),(0,o.Lk)("span",null,"Los siguientes registros ya tienen "+(0,r.v_)("I"===e.modo?"Entrada":"Salida")+" registrada",1)]),(0,o.bF)(L,{class:"col q-card",style:{height:"80vh"}},{default:(0,o.k6)(function(){return[(0,o.bF)(T,null,{default:(0,o.k6)(function(){return[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.erroresCarga,function(e){return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bF)(s,null,{default:(0,o.k6)(function(){return[(0,o.bF)(n,null,{default:(0,o.k6)(function(){return[(0,o.bF)(a,{label:""},{default:(0,o.k6)(function(){return[(0,o.eW)((0,r.v_)(e.NOMCOMP),1)]}),_:2},1024),(0,o.bF)(a,{class:"row justify-between",sublabel:""},{default:(0,o.k6)(function(){return[(0,o.Lk)("span",null,(0,r.v_)(e.FECHA),1),(0,o.Lk)("span",null," ("+(0,r.v_)(e.NEMODES)+")",1)]}),_:2},1024)]}),_:2},1024)]}),_:2},1024),(0,o.bF)(i)],64)}),256))]}),_:1})]}),_:1})])]}),_:1},8,["modelValue"]),(0,o.bF)(I,{modelValue:e.modalSubir,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.modalSubir=t}),title:"Subir Documento",onSubmit:e.uploadFile},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",d,[(0,o.bF)(R,{onUpload:e.addFile,icon:"file",title:e.$t("subirArchivos"),allow:["txt","xls","xlsx","csv"],modelValue:e.fileupd,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.fileupd=t})},null,8,["onUpload","title","modelValue"])])]}),_:1},8,["modelValue","onSubmit"]),(0,o.bF)(U,{inverted:""},{default:(0,o.k6)(function(){return[(0,o.bF)(y,null,{default:(0,o.k6)(function(){return l()(t[8]||(t[8]=[(0,o.Lk)("span",{class:"text-bold q-title text-primary q-my-xs",style:{"font-size":"20px"}},"Importación de Asistencia",-1)]))}),_:1}),(0,o.Lk)("div",f,[e.listTipos.length>1?((0,o.uX)(),(0,o.Wv)(F,{key:0,class:"q-if-outlined",options:e.listTipos,modelValue:e.modo,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.modo=t})},null,8,["options","modelValue"])):(0,o.Q3)("v-if",!0),(0,o.Lk)("div",p,[e.erroresCarga.length>0?((0,o.uX)(),(0,o.Wv)(M,{key:0,icon:"warning",flat:"",dense:"",round:"",onClick:e.openError,color:"negative"},null,8,["onClick"])):(0,o.Q3)("v-if",!0)]),(0,o.Lk)("div",m,[(0,o.bF)(M,{dense:"",inline:"",icon:"import_export",color:"primary",onClick:e.openModal,loading:e.importando,disable:e.cargando||e.bloqImp},{default:(0,o.k6)(function(){return l()(t[9]||(t[9]=[(0,o.eW)("Importar",-1)]))}),_:1},8,["onClick","loading","disable"])]),(0,o.Lk)("div",g,[e.asistSelect.length>0?((0,o.uX)(),(0,o.Wv)(M,{key:0,dense:"",inline:"",icon:"save",color:"primary",onClick:e.saveData,loading:e.cargando,disable:e.importando},{default:(0,o.k6)(function(){return l()(t[10]||(t[10]=[(0,o.eW)("Grabar",-1)]))}),_:1},8,["onClick","loading","disable"])):(0,o.Q3)("v-if",!0)])])]}),_:1}),(0,o.bF)(L,{class:"col q-card column",style:{height:"80vh"}},{default:(0,o.k6)(function(){return[(0,o.Lk)("table",A,[(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,[(0,o.Lk)("div",h,[(0,o.bF)(q,{modelValue:e.selectAll,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.selectAll=t}),color:"secondary",onClick:t[5]||(t[5]=function(t){return e.marcarTodo(e.selectAll)})},null,8,["modelValue"])])]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.columns,function(e){return(0,o.uX)(),(0,o.CE)("th",null,(0,r.v_)(e.label),1)}),256))])]),e.infoCarga.length>0?((0,o.uX)(),(0,o.CE)("tbody",C,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.infoCarga,function(a){return(0,o.uX)(),(0,o.CE)("tr",{key:a.key,class:(0,r.C4)({"alumno-vigente":a.LOCK})},[(0,o.Lk)("td",null,[(0,o.bF)(q,{modelValue:e.asistSelect,"onUpdate:modelValue":t[6]||(t[6]=function(t){return e.asistSelect=t}),val:a,color:"secondary",disable:a.LOCK},null,8,["modelValue","val","disable"])]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.columns,function(t){return(0,o.uX)(),(0,o.CE)("td",null,[(0,o.Lk)("div",{class:(0,r.C4)(["column",{"justify-center":"NOMCOMP"!==t.field}])},["ESTADO"!==t.field?((0,o.uX)(),(0,o.CE)("span",{key:0,class:(0,r.C4)({"text-center":"center"===t.align})},(0,r.v_)(a[t.field]),3)):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[e.estados[a[t.field]]?((0,o.uX)(),(0,o.CE)("span",O,(0,r.v_)(e.estados[a[t.field]].ESTADODES),1)):(0,o.Q3)("v-if",!0)],64)),a.LOCK&&"NOMCOMP"===t.field?((0,o.uX)(),(0,o.CE)("span",D," (No tiene registro de entrada)")):(0,o.Q3)("v-if",!0)],2)])}),256))],2)}),128))])):(0,o.Q3)("v-if",!0)]),0===e.infoCarga.length?((0,o.uX)(),(0,o.CE)("div",E,[(0,o.bF)(_,{subtitle:"Debe importar un archivo",icon:"person",style:{height:"70vh"}})])):(0,o.Q3)("v-if",!0),(0,o.bF)(w,{visible:e.importando||e.cargando,style:{height:"80vh"}},{default:(0,o.k6)(function(){return[(0,o.bF)(H,{style:{color:"#c2c2c2"},size:"50px"})]}),_:1},8,["visible"])]}),_:1}),(0,o.Lk)("div",b,[e.infoCarga.length>0?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("div",v,[(0,o.Lk)("span",null,(0,r.v_)(e.asistSelect.length)+" Registros seleccionados",1)]),(0,o.Lk)("div",S,[t[11]||(t[11]=(0,o.Lk)("span",null,"Total: ",-1)),(0,o.Lk)("div",N,(0,r.v_)(e.infoCarga.length),1)])],64)):((0,o.uX)(),(0,o.CE)("div",k,[(0,o.bF)(Q,{name:"warning"}),t[12]||(t[12]=(0,o.Lk)("span",null,"No hay registros disponibles",-1))]))])])}var L=a(57008),I=a.n(L),R=(a(23825),a(10239),a(56285),a(50310),a(90095),a(515),a(83190),a(27153),a(66307),a(13715),a(24066),a(96122)),y=a(30545),F=a(80660),M=(a(982),a(81288)),U=a(59089),q=a(33950),_=a(30640),H=a(80340),w=a(69027),Q={props:["sieInfo"],components:{QDatetime:s.T5,QRadio:s.$,QToggle:s.c5,QSelect:s.Si,date:s.p6,QCheckbox:s.vZ,QChip:s.wQ,QToolbar:s.ZV,sieUpload:U.A,sieModal:_.A,QTable:y.A,QTd:s.Ef,QScrollArea:R.A,sieVacio:H.A,QSpinner:s.$f,QInnerLoading:s.SQ,QList:s.Mb,QItem:s.H0,QItemMain:s.mF,QItemTile:s.lp,QItemSeparator:s.CL,QToolbarTitle:s.r_,QBtn:s.Il,QIcon:s.bP},data:function(){return{cargando:!1,modo:"I",fileupd:{},modalSubir:!1,dataAlumnos:{},dataSalones:{},feriados:{},estados:{},dataTurnos:[],infoCarga:[],asistSelect:[],erroresCarga:[],modalErrores:!1,importando:!1,listDisponibles:0,arrNoImport:[],bloqImp:!1,arrPreCarga:[],automProcess:["0045"].indexOf(this.sieInfo.colcod)>=0,selectAll:!1,importarFaltas:!1}},methods:{openModal:function(){this.modalSubir=!0,this.fileupd={}},openError:function(){this.modalErrores=!0},procesarData:function(){var e=this;F.$http.post("api/HyoHorasis/importarAsistencia",{file:this.fileupd.name,tipo:this.modo,data:this.arrPreCarga}).then(function(t){var a=t.json;a.info.forEach(function(t){if(t.ALUCOD&&e.dataAlumnos[t.ALUCOD])if(t=I()(I()(I()({},t),e.dataAlumnos[t.ALUCOD]),e.dataSalones[e.dataAlumnos[t.ALUCOD].NEMO]),["0045"].indexOf(e.sieInfo.colcod)>=0)if(a.asist[t["ALUCOD"]+t["FECHA"]]||"I"===e.modo)if(a.asist[t["ALUCOD"]+t["FECHA"]]&&t.key===a.asist[t["ALUCOD"]+t["FECHA"]].ind)e.erroresCarga.push(t);else{if("I"!==e.modo)t["ESTADO"]=null;else{t.ESTADO="P",t.TARDANZAGEN=new Date(t.TARDANZAGEN);var o=new Date(t.REGISTRO),n=new Date(t.REGISTRO).getDate(),s=new Date(t.REGISTRO).getMonth(),i=new Date(t.REGISTRO).getFullYear(),l=t.TARDANZAGEN.getMinutes()+1;t.TARDANZAGEN.setYear(i),t.TARDANZAGEN.setMonth(s),t.TARDANZAGEN.setDate(n),t.TARDANZAGEN.setMinutes(l),t.TARDANZAGEN.setSeconds(0),new Date(t.TARDANZAGEN)<o.setSeconds(0)&&(t.ESTADO="R")}var r=a.asist[t["ALUCOD"]+t["FECHA"]]||{ID_CONTROL:null},u=r.ID_CONTROL;t["ID_CONTROL"]=u,e.infoCarga.push(t),e.asistSelect.push(t),e.listDisponibles++}else t.LOCK=!0,t["ESTADO"]=null,e.infoCarga.push(t),e.arrNoImport.push(I()(I()({},t),{TIPO:e.modo}));else if("I"===e.modo){if(t.ESTADO="P",!e.importarFaltas||t.HORA){t.TARDANZAGEN=new Date(t.TARDANZAGEN);var c=new Date(t.REGISTRO),d=new Date(t.REGISTRO).getDate(),f=new Date(t.REGISTRO).getMonth(),p=new Date(t.REGISTRO).getFullYear(),m=t.TARDANZAGEN.getMinutes()+1;t.TARDANZAGEN.setYear(p),t.TARDANZAGEN.setMonth(f),t.TARDANZAGEN.setDate(d),t.TARDANZAGEN.setMinutes(m),t.TARDANZAGEN.setSeconds(0),new Date(t.TARDANZAGEN)<c.setSeconds(0)&&(t.ESTADO="R")}else e.importarFaltas&&!t.HORA&&(t.ESTADO="F");if(a.asist[t["ALUCOD"]+t["FECHA"]]){var g=a.asist[t["ALUCOD"]+t["FECHA"]].ID_CONTROL;t["ID_CONTROL"]=g,e.erroresCarga.push(t)}else e.asistSelect.push(t),e.listDisponibles++,e.infoCarga.push(t)}else if(a.asist[t["ALUCOD"]+t["FECHA"]]){var A=a.asist[t["ALUCOD"]+t["FECHA"]],h=A.ID_CONTROL,C=A.ESTADO,O=A.FH_SALIDA;t["ID_CONTROL"]=h,t["ESTADO"]=C,O?e.erroresCarga.push(t):(e.asistSelect.push(t),e.listDisponibles++,e.infoCarga.push(t))}else t.LOCK=!0,t["ESTADO"]=null,e.infoCarga.push(t);console.log(e.infoCarga)}),e.erroresCarga.length>0&&e.$q.notify({position:(0,M.isGreater)()?"top-right":"bottom",message:"Algunos registros no serán procesados",type:"warning",actions:[{label:"Ver Detalle",handler:function(){return e.openError()}}]}),e.importando=!1,e.automProcess&&e.asistSelect.length>0&&e.saveData()}).catch(function(t){e.importando=!1})},uploadFile:function(){this.importando=!0,Object.keys(this.fileupd).length>0&&(this.modalSubir=!1,this.infoCarga=[],this.asistSelect=[],this.erroresCarga=[],this.listDisponibles=0,this.procesarData())},addFile:function(e){var t=this;(0,q.Upload)({url:"api/HyoArchivo/tmp/upload",file:e[0]}).then(function(e){t.fileupd=e}).catch(function(){})},saveData:function(){var e=this;this.cargando=!0,(0,w.dialogConfirm)({message:"¿Está seguro de realizar este proceso?"}).then(function(t){if(t){var a=[],o=150,n=[],s=e.modo;e.asistSelect.forEach(function(e,t){n.push(e),t%o===0&&0!==t&&(a.push(F.$http.post("api/HyoHorasis/registrarAsistenciaImport",{data:n,tipo:s})),n=[])}),a.push(F.$http.post("api/HyoHorasis/registrarAsistenciaImport",{data:n,tipo:s})),Promise.all(a).then(function(t){var a="m0001";t.forEach(function(o,n){var s=o.json;if(s&&"m0001"!==s&&(a=s),n+1===t.length){if("m0001"===a?(e.infoCarga=[],e.asistSelect=[],e.erroresCarga=[],e.$q.dialog({message:e.$t("mensajes.m0001"),color:"secondary"})):e.$q.dialog({message:e.$t("mensajes.e0006"),color:"secondary"}),e.arrNoImport.length>0){var i=[];e.arrNoImport.forEach(function(e){e||i.push(e)}),i.length>0?F.$http.post("api/HyoHorasisimporte/agregarRegistros",{data:i}).then(function(t){"m0001"===t.json&&e.cargaAnterior()}):e.cargaAnterior()}e.cargando=!1}})})}else e.cargando=!1})},marcarTodo:function(e){var t=this;this.asistSelect=[],this.infoCarga.forEach(function(a){e&&!a.LOCK&&t.asistSelect.push(a)})},cargaAnterior:function(){var e=this;this.arrPreCarga=[],this.fileupd={},F.$http.get("api/HyoHorasisimporte/cargarRegistro",{params:{estado:0,tipo:this.modo}}).then(function(t){var a=t.json;a.length>0?(e.bloqImp=!0,e.arrPreCarga=l()(a),e.procesarData()):e.bloqImp=!1})}},watch:{modo:function(){this.asistSelect=[],this.infoCarga=[],this.erroresCarga=[],this.listDisponibles=0,this.cargaAnterior()},asistSelect:function(e){e.length>0?this.listDisponibles===e.length?this.selectAll=!0:this.selectAll=null:this.selectAll=!1}},computed:{listTipos:function(){return["0045"].indexOf(this.sieInfo.colcod)>=0?[{label:"Ingreso",value:"I"},{label:"Salida",value:"S"}]:[]},columns:function(){var e=[{name:"NOMCOMP",label:this.$t("estudiante"),align:"left",field:"NOMCOMP"},{name:"NEMODES",label:this.$t("aula"),align:"left",field:"NEMODES"},{name:"FECHA",label:this.$t("fecha"),align:"center",field:"FECHA"},{name:"ESTADO",label:this.$t("estado"),align:"left",field:"ESTADO"},{name:"HORA",label:"I"===this.modo?"Ingreso":"Salida",align:"left",field:"HORA"}];return["0045"].indexOf(this.sieInfo.colcod)>=0&&e.push({name:"MODO",label:"Modo",align:"center",field:"MODO"}),e}},mounted:function(){var e=this;this.cargaAnterior(),F.$http.get("api/HyoConfigurajustificaciones/getJustificaciones",{params:{agrupado:!0}}).then(function(t){e.importarFaltas=t.A_IMPORTAR_FALTAS}),F.$http.get("api/HyoHorasis/validacionesIniciales",{params:{sortNomcomp:!0}}).then(function(t){var a=t.json;e.alumnos=a.alumnos,e.dataAlumnos={},a.alumnos.forEach(function(t){e.dataAlumnos[t.ALUCOD]={ALUCOD:t.ALUCOD,NEMO:t.NEMO,USUCOD:t.USUCOD,NOMCOMP:t.NOMCOMP},e.dataAlumnos[t.USUCOD]={ALUCOD:t.ALUCOD,NEMO:t.NEMO,USUCOD:t.USUCOD,NOMCOMP:t.NOMCOMP},e.dataAlumnos[t.DOCIDENRO]={ALUCOD:t.ALUCOD,NEMO:t.NEMO,USUCOD:t.USUCOD,NOMCOMP:t.NOMCOMP}}),e.dataSalones=a.dataSalones,e.feriados=a.feriado,e.estados=a.estados})}},G=a(12807);const x=(0,G.A)(Q,[["render",T]]);var P=x,V=a(57668),X={components:{importar:P,QPage:s.Tu},data:function(){return{info:(0,V["default"])()}},methods:{}};const Z=(0,G.A)(X,[["render",n]]);var j=Z}}]);