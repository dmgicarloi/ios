"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[21829],{21829:function(e,a,n){n.r(a),n.d(a,{default:function(){return O}});var o=n(8445),t=n.n(o),i=n(61758),r=n(58790),s={class:"row"},c={class:"col-xs-12"},l={class:"col-12"},u={class:"row gutter-xs q-pt-sm q-pb-xs"},d={class:"col-12"},f={class:"row q-mt-xs"},h={class:"col"};function p(e,a){var n=(0,i.g2)("sie-select"),o=(0,i.g2)("q-date"),p=(0,i.g2)("q-popup-proxy"),g=(0,i.g2)("q-btn"),D=(0,i.g2)("q-table"),m=(0,i.g2)("q-tooltip"),b=(0,i.g2)("q-page-sticky"),v=(0,i.g2)("q-page");return(0,i.uX)(),(0,i.Wv)(v,{class:"q-pa-sm bg-white"},{default:(0,i.k6)(function(){return[(0,i.Lk)("div",s,[(0,i.Lk)("div",c,[(0,i.bF)(n,{modelValue:e.selectProfesor,"onUpdate:modelValue":a[0]||(a[0]=function(a){return e.selectProfesor=a}),type:"outlined",options:e.profesores,label:"USUNOM",val:"USUCOD",onInput:e.cambiarDocente,"no-bottom":""},null,8,["modelValue","options","onInput"])]),(0,i.Lk)("div",l,[(0,i.Lk)("div",u,[(0,i.Lk)("div",d,[a[6]||(a[6]=(0,i.Lk)("span",null,[(0,i.Lk)("b",null,"De semana")],-1)),(0,i.bF)(g,{flat:"",icon:"date_range",color:"primary"},{default:(0,i.k6)(function(){return[(0,i.bF)(p,{"transition-show":"scale",ref:"qDateProxy1","transition-hide":"scale"},{default:(0,i.k6)(function(){return[(0,i.bF)(o,{modelValue:e.date,"onUpdate:modelValue":a[1]||(a[1]=function(a){return e.date=a}),onInput:a[2]||(a[2]=function(a){return e.fechas("qDateProxy1")}),mask:"DD/MM/YYYY",options:e.optionsDate},null,8,["modelValue","options"])]}),_:1},512)]}),_:1}),(0,i.Lk)("span",null,(0,r.v_)(e.textFecha1),1),(0,i.Lk)("span",null,[a[5]||(a[5]=(0,i.Lk)("b",null,"Para semana",-1)),(0,i.Lk)("span",null,(0,r.v_)(e.textFecha2),1)])])]),(0,i.Lk)("div",f,[(0,i.Lk)("div",h,[(0,i.bF)(D,{color:"primary",selection:"multiple",selected:e.contenidos,"onUpdate:selected":a[3]||(a[3]=function(a){return e.contenidos=a}),"rows-per-page-options":[0],pagination:e.pagination,"onUpdate:pagination":a[4]||(a[4]=function(a){return e.pagination=a}),virtualScroll:"",style:{height:"calc(100vh - 160px)"},data:e.tableData,columns:e.columns,"row-key":"ID_CONTENIDO",label:"Contenido Recurrente"},null,8,["selected","pagination","data","columns"])])])])]),(0,i.bF)(b,{expand:"",position:"bottom-right",offset:[20,20]},{default:(0,i.k6)(function(){return[(0,i.bF)(g,{fab:"",round:"",color:"secondary",icon:"settings",onClick:e.guardarRecurrencia},{default:(0,i.k6)(function(){return[(0,i.bF)(m,null,{default:(0,i.k6)(function(){return t()(a[7]||(a[7]=[(0,i.eW)("Procesar",-1)]))}),_:1})]}),_:1},8,["onClick"])]}),_:1})]}),_:1})}n(30683),n(77507),n(52133),n(10239),n(50310),n(6724),n(83190);var g=n(93616),D=n(80660),m=n(6123),b=n(88275),v=n(982),w=n(10213),k=n(50425),A=n(18105),C=n(9736),y=n(95477),M=n(4437),E=n(3112),I=n(95655),P=n(81288),N={components:{sieSelect:g.A,QTable:k.A,QTh:m.EJ,QTr:m.qh,QTd:m.Ef,QTableColumns:m.$s,sieSalones:b.Ay,QInput:C.A,QPopupProxy:y.A,QDate:M.A,QCheckbox:E.A,QPageSticky:m._U,QTooltip:m.nC,QPage:m.Tu,QBtn:m.Il},data:function(){return{date:(0,A.Ay)(new Date,"DD/MM/YYYY"),arrDate:[],saveFechas:[],rangoFecha1:[],rangoFecha2:[],profesores:[],selectProfesor:"%",item:"",contenidos:[],optionsDate:[],columns:[{name:"USUNOM",required:!0,label:"Usuario",align:"left",field:"USUNOM",sortable:!0},{name:"REPLICA",label:"Replicado",align:"left",sortable:!0,field:"REPLICA"},{name:"DIASEMANA",label:"Día",align:"left",sortable:!0,field:"DIASEMANA"},{name:"FH_ENTREGA",label:"Publicación",align:"left",sortable:!0,field:"FH_ENTREGA"},{name:"CURSONOM",label:"Curso",align:"left",field:"CURSONOM"},{name:"DESCRIPCION",label:"Tipo",align:"left",field:"DESCRIPCION"},{name:"TITULO",label:"Título",align:"left",sortable:!0,field:"TITULO"}],tableData:[],pagination:{rowsPerPage:0}}},computed:{textFecha1:function(){var e=this.validateFechas(),a=e.fecha,n=e.fechaTo;return this.rangoFecha1=[a,n],"del ".concat((0,A.Ay)(a,"DD MMMM")||""," al ").concat((0,A.Ay)(n,"DD MMMM")||"")},textFecha2:function(){var e=this.validateFechas(),a=e.fecha,n=e.fechaTo;return"del ".concat((0,A.Ay)((0,A.Xd)(a,{days:7}),"DD MMMM")," al ").concat((0,A.Ay)((0,A.Xd)(n,{days:7}),"DD MMMM"))}},methods:{diaSemana:function(e){var a=null;switch(e){case 0:a="Domingo";break;case 1:a="Lunes";break;case 2:a="Martes";break;case 3:a="Miercoles";break;case 4:a="Jueves";break;case 5:a="Viernes";break;default:a="Sábado";break}return a},guardarRecurrencia:function(){if(window.currentSieCloud=!1,delete window.localStorage._apiGoogle,delete window.localStorage._apiOneDrive,this.contenidos.length<1)return(0,v["default"])("No se ha seleccionado registros.","warning"),!1;this.validarCredecinales()},validateFechas:function(){var e={fecha:new Date,fechaTo:new Date},a=this.saveFechas.map(function(e){return new Date(e.split("/").reverse().join("/"))}),n=a[0]||e.fecha,o=a[1]||e.fechaTo;return this.min=(0,A.zj)(n,{days:7}),this.max=(0,A.Xd)(o,{days:7}),{fecha:n,fechaTo:o}},fechas:function(e){if(this.arrDate.push(this.date),2===this.arrDate.length){this.saveFechas=t()(this.arrDate);var a=this.validateFechas(),n=a.fecha,o=a.fechaTo;this.rangoFecha1=[n,o],this.contenidoPorSemana(),this.arrDate=[],this.$refs[e].hide()}},cambiarDocente:function(){this.contenidoPorSemana()},usuariosPorPerfil:function(){var e=this;D.$http.get("api/HyoUsuario/obtUsuariosporPerfil",{params:{tipcod:"006",validarUsuario:!0}}).then(function(a){var n=a.json;e.profesores=n})},contenidoPorSemana:function(){var e=this;D.$http.get("api/HyoContenido/getContenidoPorDiaSemana",{params:{usucod:this.selectProfesor,rangoFechas:this.rangoFecha1}}).then(function(a){var n=a.json;n.map(function(a){a.REPLICA=0===a.REPLICA?"No":"Si",a.DIASEMANA=e.diaSemana(a.DIASEMANA),a.FH_ENTREGA=(0,A.Ay)(a.FH_ENTREGA,"DD/MM/YYYY")}),e.contenidos=[],e.tableData=n})},conectarGoogle:function(){delete window.localStorage._apiGoogle,D.$http.get("api/HyoGoogle/getUrl").then(function(e){var a=e.json;"string"===typeof a?(0,I["default"])(a,"_system",500,500):(0,v["default"])(a.message,"warning")}).catch(function(e){var a=e.error;(0,v["default"])(a.message,"warning")})},conectarMicrosoft:function(){delete window.localStorage._apiOneDrive,D.$http.get("api/HyoOneDriveApi/obtUrl").then(function(e){var a=e.json;"string"===typeof a?(0,I["default"])(a,"_system",500,500):(0,v["default"])("Este usuario ya ha sido vinculado.","warning")}).catch(function(){(0,v["default"])("Este usuario ya ha sido vinculado.","warning")})},validarCredecinales:function(){var e=this;D.$http.get("api/HyoContenido/validarCredeneciales",{params:{usucod:this.selectProfesor,rangoFechas:this.rangoFecha1}}).then(function(a){var n=a.json,o=!0;n.map(function(a){if(0===a.CREDENCIALES)switch(o=!1,a.ID_API){case 1:e.conectarGoogle();break;case 2:e.conectarMicrosoft();break}}),o&&(0,w.confirm)("¿Desea agregar contenido recurrente para los elementos seleccionados?","info").onOk(function(){var a=[];e.contenidos.map(function(e){"No"===e.REPLICA&&a.push(e.ID_CONTENIDO)}),a.length<1?(0,v["default"])("Los contenidos seleccionados ya han sido replicados.","info"):D.$http.post("api/HyoContenido/clonarConferencias",{data:a}).then(function(a){var n=a.json;n.success.length>0&&n.failed.length>0?(e.updateContenidoReplicado(n.failed),(0,v["default"])("Algunos contenidos no han sido posible replicar.","warning")):n.failed.length>0?(0,v["default"])("No ha sido posible replicar los contenidos.","warning"):n.success.length>0&&(e.updateContenidoReplicado(n.failed),(0,v["default"])("Los contenidos seleccionado han sido replicado.","success"))}).catch(function(){(0,v["default"])("Ha ocurrido un problema de conexión.","warning")})})})},updateContenidoReplicado:function(e){var a=function(){var a={};return e.map(function(e){a[e.ID_CONTENIDO]=e.ID_CONTENIDO}),a},n=t()(this.tableData),o=a();n.map(function(e){e.ID_CONTENIDO!==o[e.ID_CONTENIDO]&&(e.REPLICA="Si")}),this.tableData=n},calcularDiasAMostrar:function(e){for(var a=parseInt((0,A.Ay)(e,"E")),n=(0,A.zj)(e,{days:a-1}),o=[],t=0;t<a;t++)o.push((0,A.Ay)((0,A.Xd)(n,{days:t}),"YYYY/MM/DD"));return o}},created:function(){this.usuariosPorPerfil(),this.contenidoPorSemana(),this.optionsDate=this.calcularDiasAMostrar(new Date)},beforeCreate:function(){window.callback&&window.removeEventListener("storage",window.callback.cb)},mounted:function(){var e=this;(0,P.watchAuth2)(["_apiGoogle","_apiOneDrive"],function(a,n){switch(n){case"_apiGoogle":D.$http.post("api/HyoGoogle/conectar",{codigo:a}).then(function(a){var n=a.json;e.validarCredecinales(),(0,v["default"])(n.message,"success")}).catch(function(e){(0,v["default"])(e.error.msg,"warning")});break;case"_apiOneDrive":D.$http.post("api/HyoOneDriveApi/guardarCodigo",{codigo:a}).then(function(){e.validarCredecinales(),(0,v["default"])("El usuario ha sido vinculado.","success")}).catch(function(){(0,v["default"])("Ha ocurrido un problema al tratar de divuncular este usuario","warning")});break}})},unmounted:function(){window.callback&&window.removeEventListener("storage",window.callback.cb)}},S=n(12807);const F=(0,S.A)(N,[["render",p]]);var O=F}}]);