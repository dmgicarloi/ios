"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[36884],{36884:function(e,o,t){t.r(o),t.d(o,{default:function(){return Q}});var n=t(61758),a={class:"row q-ma-xs q-col-gutter-sm"},r={class:"col-xs-6"},i={class:"col-xs-6"},s={class:"col-xs-12"};function l(e,o){var t=(0,n.g2)("q-page-header"),l=(0,n.g2)("tesoreriaLoading"),d=(0,n.g2)("q-separator"),c=(0,n.g2)("q-option-group"),u=(0,n.g2)("q-checkbox"),p=(0,n.g2)("sie-grid"),g=(0,n.g2)("footer-grid"),m=(0,n.g2)("q-card-section"),h=(0,n.g2)("q-card");return(0,n.uX)(),(0,n.Wv)(h,{class:"layout-v1 my-card",flat:"",bordered:""},{default:(0,n.k6)(function(){return[(0,n.bF)(t,{title:e.pageHeader.title,tabs:e.pageHeader.tabs,useTab:"",onActionTab:e.actionTab,componente:e.pageHeader.componente,nivelAcceso:e.pageHeader.nivelAcceso,botones:e.pageHeader.botones},null,8,["title","tabs","onActionTab","componente","nivelAcceso","botones"]),(0,n.bF)(l,{modelValue:e.loading.show,total:e.loading.total,procesados:e.loading.procesados,label:"Procesando"},null,8,["modelValue","total","procesados"]),(0,n.bF)(d),(0,n.bF)(m,null,{default:(0,n.k6)(function(){return[(0,n.Lk)("div",a,[(0,n.Lk)("div",r,[(0,n.bF)(c,{color:"primary",type:"radio",modelValue:e.tip_cod.selectTipoCod,"onUpdate:modelValue":o[0]||(o[0]=function(o){return e.tip_cod.selectTipoCod=o}),options:e.tipo,onInput:e.getAlumnosTipoCodigo,inline:""},null,8,["modelValue","options","onInput"])]),(0,n.Lk)("div",i,[(0,n.bF)(u,{modelValue:e.models.cambiarUsuario,"onUpdate:modelValue":o[1]||(o[1]=function(o){return e.models.cambiarUsuario=o}),label:"Incluir Usuario y Dependecias"},null,8,["modelValue"])]),(0,n.Lk)("div",s,[(0,n.bF)(p,{class:"ag-theme-balham",columnDefs:e.grid.columns,rowData:e.grid.rowData,onGridReady:e.onGridReady,style:{height:"calc(100vh - 320px)",width:"100%"},defaultColDef:e.grid.defaultColDef,floatingFilter:"",enableCellTextSelection:!0,rowSelection:"multiple",onFilterChanged:e.onFilterChanged,rowIdField:"ALUCOD"},null,8,["columnDefs","rowData","onGridReady","defaultColDef","onFilterChanged"]),(0,n.bF)(g,{modelValue:e.grid.pagina,"onUpdate:modelValue":o[2]||(o[2]=function(o){return e.grid.pagina=o}),max:e.grid.pages,rows:e.grid.contador,onLoad:e.getAlumnosTipoCodigo},null,8,["modelValue","max","rows","onLoad"])])])]}),_:1})]}),_:1})}var d=t(99550),c=t.n(d),u=t(76080),p=t.n(u),g=t(45254),m=t.n(g),h=(t(30683),t(71225),t(71587),t(23825),t(77507),t(52133),t(10239),t(50310),t(5962),t(6724),t(92802),t(11777),t(56567),t(83190),t(27153),t(40048),t(52776),t(84433),t(66307),t(24066),t(88567)),f=t(95718),C=t(53380),b=t(54489),A=t(64208),w=t(3112),v=t(12143),D=t(95477),O=t(80660),T=t(6123),N=t(62006),U=t(36408),x=t(27560),_=t(75053),y=t(41615),S=t(33950),E=t(59089),F=t(64303),L=t(78840),I=t(17915),R=t(2652),k={components:{actionButton:L.A,QDate:v.A,QPopupProxy:D.A,QCard:h.A,QCardSection:f.A,QSelect:b.S,QOptionGroup:T.EX,QSeparator:C.A,sieGrid:U.A,QInput:A.A,footerGrid:x.A,sieModal:_.A,QCheckbox:w.A,Upload:S["default"],sieUpload:E.A,QDownloadFile:N.A,crearBotones:F.A,tesoreriaLoading:I.A,QPageHeader:R.A},data:function(){return{pageHeader:{botones:[],tabs:[{name:"index",label:"Alumnos"}],tabActive:"index",title:"Cambiar código de Alumno",componente:"corregircodigo",nivelAcceso:3},grid:{rowData:[],columns:[],api:null,params:null,frameworkComponents:{},pagina:1,pages:1,contador:0,defaultColDef:{suppressHeaderMenuButton:!0,filter:!0,floatingFilterComponentParams:{suppressFilterButton:!0},resizable:!0,sortable:!0}},loading:{show:!1,total:0,procesados:0},models:{cambiarUsuario:!0},tipo:[{label:"DNI",value:1},{label:"Código de banco",value:2}],tip_cod:{NEW_COD:"",OLD_COD:"",selectTipoCod:1,FLAT_USUARIO:1}}},beforeMount:function(){var e=this;return m()(p()().m(function o(){var t;return p()().w(function(o){while(1)switch(o.n){case 0:return o.n=1,y["default"].VERIFICAR_USUARIO_ADMINISTRADOR();case 1:t=o.v,t||e.$router.push({name:"tesoreria.home"}),e.crearBotones(),e.getColumns(),e.getAlumnosTipoCodigo();case 2:return o.a(2)}},o)}))()},methods:{actionTab:function(){},onFilterChanged:function(e){this.grid.contador=Array.from({length:e.api.getDisplayedRowCount()})},procesar:function(){var e=this,o=this.grid.api.getSelectedRows();if(0===o.length)return this.$alert("No seleccionó ningún registro","warning");this.$confirm("¿Esta seguro de ejecutar el proceso?").onOk(m()(p()().m(function t(){return p()().w(function(t){while(1)switch(t.n){case 0:return e.loading.procesados=0,e.loading.total=o.length,e.loading.show=!0,t.n=1,e.cambiarAlucod();case 1:e.loading.show=!1;case 2:return t.a(2)}},t)})))},obtenerAlumnosParaCorregir:function(){var e=this;return m()(p()().m(function o(){var t;return p()().w(function(o){while(1)switch(o.n){case 0:return o.n=1,O.$http.get("api/personaController/getAlumnosCambiarCodigo",{params:{params:{validarDni:!0}}});case 1:t=o.v,e.grid.rowData=t,e.grid.contador=t.length;case 2:return o.a(2)}},o)}))()},crearBotones:function(){this.pageHeader.botones=[{label:"Procesar",icon:"settings",click:this.procesar,minAcceso:y["default"].ACCESO_ESCRITURA}]},onGridReady:function(e){this.grid.params=e,this.grid.api=e.api},getColumns:function(){var e=[{headerName:"Código",field:"ALUCOD",width:80},{headerName:"Nombres",field:"NOMBRES",width:325},{headerName:"Nro. Doc",field:"DOCUMENTO",width:100},{headerName:"Nivel",field:"NIVELDES",width:125},{headerName:"Grado",field:"GRADODES",width:125},{headerName:"Sección",field:"SECCIONDES",width:175},{headerName:"Estado",field:"ESTADODES",width:100},{headerName:"C. bancario",field:"ALUCODANT",width:150,hide:!1}];this.grid.columns=e},getAlumnosTipoCodigo:function(){var e=this;return m()(p()().m(function o(){var t;return p()().w(function(o){while(1)switch(o.n){case 0:return o.n=1,O.$http.get("api/personaController/getAlumnosPorTipoCodigo",{params:{params:{modo:e.tip_cod.selectTipoCod}}});case 1:t=o.v,e.grid.rowData=t,e.grid.contador=t.length;case 2:return o.a(2)}},o)}))()},seleccionarTipCod:function(e){return 1===Number(this.tip_cod.selectTipoCod)&&(this.tip_cod["NEW_COD"]=e.DOCUMENTO,this.tip_cod["OLD_COD"]=e.ALUCOD),2===Number(this.tip_cod.selectTipoCod)&&(this.tip_cod["NEW_COD"]=e.ALUCODANT,this.tip_cod["OLD_COD"]=e.ALUCOD),this.tip_cod},cambiarAlucod:function(){var e=this;return m()(p()().m(function o(){var t,n,a,r,i,s;return p()().w(function(o){while(1)switch(o.p=o.n){case 0:return t=e.grid.api.getSelectedRows(),o.p=1,n=t.map(function(o){if(1===Number(e.tip_cod.selectTipoCod)&&!/^[0-9]{8}$/.test(o.DOCUMENTO))return Promise.reject({message:"DNI inválido."});if(2===Number(e.tip_cod.selectTipoCod)&&!/^[0-9]{4,8}$/.test(o.ALUCODANT))return Promise.reject({message:"Código bancario inválido."});o.cambiarUsuario=e.models.cambiarUsuario;var t=O.$http.post("api/personaController/postCambiarAlucod",{params:e.seleccionarTipCod(o)});return O.$http.post("api/personaController/postCambiarImgAlumno",{params:e.seleccionarTipCod(o)}),t}),o.n=2,Promise.allSettled(n);case 2:a=o.v,e.getAlumnosTipoCodigo(),r=a.filter(function(e){return"fulfilled"===e.status}),i=a.filter(function(e){return"rejected"===e.status}),e.$alert(e.messageProcesar(r,i),"".concat(i.length===t.length?"error":i.length>0?"warning":"success"),!0),o.n=4;break;case 3:o.p=3,s=o.v,e.$alert(s.message,"warning");case 4:return o.a(2)}},o,null,[[1,3]])}))()},messageProcesar:function(e,o){var t=e.length<2?"":"s",n=o.length<2?"":"s",a=Object.entries(o.reduce(function(e,o){var t=o.reason.message||o.reason||"Error desconocido";return e[t]||(e[t]=0),e[t]++,e},{})).map(function(e){var o=c()(e,2),t=o[0],n=o[1];return'<p style="margin-top:5px">⚠️ <strong>('.concat(n,")</strong> ").concat(t,"</p>")}).join(""),r='\n        <div style="font-family: Arial; font-size: 14px; line-height: 1.5;">\n          <p style="font-weight: bold; font-size: 16px; margin-bottom: 10px;">\n            Proceso Finalizado\n          </p>\n      ';return e.length>0&&(r+='\n        <div style="padding: 8px; border-left: 4px solid #69f0ae; margin-bottom= 8px">\n          <p style="margin:0;">\n            <strong>✅ ('.concat(e.length,")</strong> Alumno").concat(t," procesado").concat(t," satisfactoriamente. \n          </p>\n        </div>\n        ")),o.length>0&&(r+='\n          <div style="padding: 8px; border-left: 4px solid #ff5252; margin-bottom= 8px">\n            <p style="margin:0;">\n              <strong>❌ ('.concat(o.length,")</strong> Alumno").concat(n,' no pudieron procesarse.  \n            </p>\n            <div style="margin-left: 20px; margin-top: 10px">\n              ').concat(a,"\n            </div>\n          </div>\n        ")),r+="</div>",r}}},P=t(12807);const V=(0,P.A)(k,[["render",l]]);var Q=V}}]);