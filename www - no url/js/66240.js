(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[66240],{17866:function(){},66240:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return ee}});var o=t(61758),a=t(58790),s={ref:"audioOk",src:"statics/sound/ok.mp3"},i={ref:"audioInfo",src:"statics/sound/duplicate.mp3"},r={ref:"audioError",src:"statics/sound/error.mp3"},l={class:"row justify-center"},u={class:"q-card col q-pa-sm q-ma-xs"},c={class:"row justify-around q-col-gutter-sm"},d={class:"column"},f={class:"row"},m={class:"row"},A={key:0,class:"col col"},g={key:0,class:"col q-ma-sm"},O={class:"row"},p={class:"column col"},C={class:"row justify-center"},v={class:"text-bold"},b={class:"row q-col-guter-sm"},h={class:"row col"},k={key:0,class:"text-bold"},E={key:1,class:"col q-pa-md"};function L(e,n){var t=this,L=(0,o.g2)("q-icon"),S=(0,o.g2)("q-btn"),D=(0,o.g2)("q-bar"),I=(0,o.g2)("q-card-section"),w=(0,o.g2)("q-card-actions"),_=(0,o.g2)("q-card"),q=(0,o.g2)("q-dialog"),M=(0,o.g2)("q-clock"),U=(0,o.g2)("header-btn"),F=(0,o.g2)("q-input"),y=(0,o.g2)("q-item-label"),R=(0,o.g2)("q-item-section"),N=(0,o.g2)("q-item"),T=(0,o.g2)("sie-table"),x=(0,o.g2)("q-list"),P=(0,o.g2)("sie-vacio"),Q=(0,o.g2)("q-page"),H=(0,o.gN)("ripple");return(0,o.uX)(),(0,o.Wv)(Q,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("audio",s,null,512),(0,o.Lk)("audio",i,null,512),(0,o.Lk)("audio",r,null,512),(0,o.bF)(q,{modelValue:e.modalResult,"onUpdate:modelValue":n[2]||(n[2]=function(n){return e.modalResult=n}),"transition-show":"flip-down","transition-hide":"flip-up"},{default:(0,o.k6)(function(){return[(0,o.bF)(_,null,{default:(0,o.k6)(function(){return[(0,o.bF)(D,{class:"bg-primary text-white"},{default:(0,o.k6)(function(){return[(0,o.bF)(L,{name:"sieweb",size:"18px"}),n[4]||(n[4]=(0,o.Lk)("span",{class:"q-mx-sm col"},"Sistema Integrado Escolar SieWeb",-1)),(0,o.bF)(S,{flat:"",dense:"",round:"",icon:"close",onClick:n[0]||(n[0]=function(n){return e.modalResult=!1})})]}),_:1}),(0,o.bF)(I,null,{default:(0,o.k6)(function(){return["success"===e.estado?((0,o.uX)(),(0,o.Wv)(L,{key:0,name:"check_circle",size:"45px",color:"green-7"})):((0,o.uX)(),(0,o.Wv)(L,{key:1,name:"error",size:"45px",color:"amber"})),(0,o.Lk)("span",null,(0,a.v_)(e.msg),1)]}),_:1}),(0,o.bF)(w,{align:"right"},{default:(0,o.k6)(function(){return[(0,o.bF)(S,{color:"secondary",onClick:n[1]||(n[1]=function(n){return e.modalResult=!1}),autofocus:""},{default:(0,o.k6)(function(){return[(0,o.eW)("Ok("+(0,a.v_)(e.timerCountAlumno)+")",1)]}),_:1})]}),_:1})]}),_:1})]}),_:1},8,["modelValue"]),e.loading?(0,o.Q3)("v-if",!0):((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[e.feriados?((0,o.uX)(),(0,o.Wv)(P,{key:1,class:"col column",title:"regAsistencia.m0002",subtitle:e.feriados.OBSER,icon:"person"},null,8,["subtitle"])):((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.bF)(U,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",l,[(0,o.bF)(M)])]}),_:1}),(0,o.Lk)("div",u,[(0,o.Lk)("div",c,[(0,o.Lk)("div",{class:(0,a.C4)(["column col-5",{row:!e.isLess,column:e.isLess}])},[(0,o.Lk)("div",d,[(0,o.Lk)("div",f,[(0,o.bF)(F,{class:"col txt-especial",modelValue:e.usucod,"onUpdate:modelValue":n[3]||(n[3]=function(n){return e.usucod=n}),autofocus:!0,label:"qr"==e.tipoLectura?"Usuario":"DNI",onKeydown:e.registraPistola},null,8,["modelValue","label","onKeydown"])]),(0,o.Lk)("div",m,[!e.sinCamara&&["qr","id"].indexOf(e.tipoLectura)>=0?((0,o.uX)(),(0,o.CE)("div",A,[["qr","id"].indexOf(e.tipoLectura)>=0?((0,o.uX)(),(0,o.Wv)((0,o.$y)(e.qrVersion),{key:0,onLeeQr:e.leerRegistro,cargaAnterior:e.cargaAnterior},null,40,["onLeeQr","cargaAnterior"])):(0,o.Q3)("v-if",!0)])):(0,o.Q3)("v-if",!0)])])],2),e.infoAsistencia.length>0&&e.infoAsistencia[0].USUCOD?((0,o.uX)(),(0,o.CE)("div",g,[(0,o.bF)(x,{class:"rounded-borders",dense:"",bordered:"",padding:""},{default:(0,o.k6)(function(){return[(0,o.bo)(((0,o.uX)(),(0,o.Wv)(N,null,{default:(0,o.k6)(function(){return[(0,o.bF)(R,null,{default:(0,o.k6)(function(){return[(0,o.bF)(y,{class:"text-bold"},{default:(0,o.k6)(function(){return[(0,o.eW)((0,a.v_)(e.dataAlumnos[e.infoAsistencia[0].ALUCOD].NOMCOMP),1)]}),_:1}),(0,o.bF)(y,{caption:""},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",O,[n[5]||(n[5]=(0,o.Lk)("div",{class:"text-bold"},"Aula: ",-1)),(0,o.Lk)("span",null,(0,a.v_)(e.dataSalones[e.infoAsistencia[0].NEMO].NEMODES),1)])]}),_:1})]}),_:1}),(0,o.bF)(R,{class:"sublabel-turno",style:{"font-size":"10px"},side:"",top:""},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",p,[(0,o.Lk)("div",C,[(0,o.Lk)("div",v,"Turno"+(0,a.v_)(e.turnos.length>1?"s":""),1)]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.turnos,function(n){return(0,o.uX)(),(0,o.CE)("div",b,[(0,o.Lk)("div",h,[e.turnos.length>1?((0,o.uX)(),(0,o.CE)("div",k,(0,a.v_)(n.DESCRIPCION)+": ",1)):(0,o.Q3)("v-if",!0),(0,o.Lk)("span",null,(0,a.v_)(e.date(n.HORA_TARDANZA,"HH:mm")),1)])])}),256))])]}),_:1})]}),_:1})),[[H]]),(0,o.bo)(((0,o.uX)(),(0,o.Wv)(N,null,{default:(0,o.k6)(function(){return[(0,o.bF)(T,{context:t,dense:"",flat:"",bordered:"","wrap-cells":"",menu:!1,css:"width: 100%;padding-top: 0","show-search":!1,columns:e.columns,data:e.infoAsistencia,"hide-bottom":!0,config:e.config},null,8,["columns","data","config"])]}),_:1})),[[H]])]}),_:1})])):((0,o.uX)(),(0,o.CE)("div",E,[(0,o.bF)(P,{class:"col column",subtitle:"mensajes.e0081",icon:"person"})]))])])],64))],64))]}),_:1})}var S=t(76080),D=t.n(S),I=t(45254),w=t.n(I),_=(t(10239),t(50310),t(90095),t(83190),t(52776),t(84433),t(13715),t(6123)),q=t(23527),M=t(33530),U=t(81288),F=t(57668),y=t(65818),R=t(9736),N=t(80340),T=t(18105);function x(e,n){return null}var P=t(17866),Q=t.n(P),H=t(12807);const X=(0,H.A)(Q(),[["render",x]]);var $=X,V=t(65673),W=t(82327),j=t(88865),K=t(66824),z=t(42205),B=t(41126),G=t(20456),Y=t(33777),J={components:{qr:q.A,qrOld:M.A,QClock:y.A,QInput:R.A,sieVacio:N.A,registro:$,QList:V.A,QItem:W.A,QItemSection:j.A,QItemLabel:K.A,QDialog:z.A,SieTable:Y.A,QBar:B.A,QCardActions:G.A,QPage:_.Tu,QCard:_.C$,QIcon:_.bP,QBtn:_.Il},data:function(){return{timerEnabled:!1,timerCountAlumno:0,loading:!1,dataAlumnos:{},dataSalones:[],feriados:[],estados:[],msg:"Asistencia a turno 1 registrada correctamente",estado:"success",validarRecojo:!1,usucod:null,tipoLectura:"qr",qrVersion:"qr",sinCamara:!1,cargaAnterior:!1,boton:"Ok",camera:"auto",dataAsistencia:{},infoSave:{},infoAsistencia:[],turnos:[],columns:[],minutos:5,modalResult:!1,config:{FECHA:{component:"date",edit:!1},FH_INGRESO:{component:"datetime",edit:!1},FH_SALIDA:{component:"datetime",edit:!1},ESTADO:{renderHtml:function(e,n,t,o){return t.background({text:this.estados[e.ESTADO].ESTADODES,textColor:"white",color:this.estados[e.ESTADO].COLORVUE})}}}}},methods:{date:function(e,n){return(0,T.Ay)(e,n)},openModal:function(){this.timerEnabled=!0,this.modalResult=!0},pause:function(){this.timerEnabled=!1},registraPistola:function(e){13===e.which&&this.leerRegistro(this.usucod)},cerrarModal:function(){this.modalResult=!1,this.timerEnabled=!1,this.timerCountAlumno=0},saveAsistencia:function(){var e=this;return w()(D()().m(function n(){var t,o,a,s,i,r,l;return D()().w(function(n){while(1)switch(n.n){case 0:return e.infoAsistencia=[],e.infoSave.nemo=e.dataAlumnos[e.infoSave.usucod].NEMO,e.infoSave.fecha=(0,T.Ay)(new Date,"YYYY-MM-DD"),t=e.infoSave,n.n=1,e.$http.get("api/AsistenciaTotalController/getAsistenciaTotal",{params:{parametros:t}});case 1:o=n.v,a=o.msg,s=o.registros,i=o.estado,r=o.turnos,l=o.A_REGISTRA_SALIDA,e.msg=a,e.estado=i,e.icono="error"===i?"error":"check_circle",e.infoAsistencia=s,e.turnos=r,e.openModal(),e.columns=[{name:"FECHA",label:"Fecha",field:"FECHA",align:"center"},{name:"ESTADO",label:"Estado",field:"ESTADO",align:"center"},{name:"FH_INGRESO",label:"Ingreso",field:"FH_INGRESO",align:"center"}],l&&e.columns.push({name:"FH_SALIDA",label:"Salida",field:"FH_SALIDA",align:"center"}),r.length>1&&e.columns.unshift({name:"DESCTURNO",label:"Turno",field:"DESCTURNO",align:"center",sortable:!0}),setTimeout(function(){e.infoAsistencia=[]},7e3);case 2:return n.a(2)}},n)}))()},leerRegistro:function(e,n,t){var o=this;return w()(D()().m(function t(){var a;return D()().w(function(t){while(1)switch(t.n){case 0:o.dataAsistencia={},e?(e.indexOf("|")>=0&&(e=e.split("|")[0]),e=e.toUpperCase(),o.dataAlumnos[e]?(a=o.dataAlumnos[e].ALUCOD,o.dataAlumnos[e].NEMO?o.dataSalones[o.dataAlumnos[e].NEMO].BIMECOD?(o.infoSave={alucod:a,usucod:e},o.saveAsistencia()):(o.$notify(o.$t("regAsistencia.m0006"),"error"),o.$refs.audioInfo.play()):(o.$notify(o.$t("regAsistencia.m0005"),"error"),o.$refs.audioInfo.play())):(o.$notify(o.$t("regAsistencia.m0004"),"error"),o.$refs.audioError.play())):o.sinCamara=n,o.cargaAnterior=!0,o.usucod=null;case 1:return t.a(2)}},t)}))()}},computed:{isLess:function(){return(0,U.isLess)()}},created:function(){var e=this;return w()(D()().m(function n(){var t,o,a,s,i,r;return D()().w(function(n){while(1)switch(n.n){case 0:return o=function(){console.log((0,F["default"])());var e=["0032"].indexOf((0,F["default"])().colcod)>=0?1:7,n=36e5,o=new Date,a=o.getHours(),s=(Math.floor(a/e)+1)*e,i=(s-a)*n;setTimeout(t,i)},t=function(){window.location.reload(!0)},window.onload=o(),e.loading=!0,n.n=1,e.$http.get("api/HyoConfigurajustificaciones/getJustificaciones",{params:{agrupado:!0}});case 1:return a=n.v,n.n=2,e.$http.get("api/HyoHorasis/validacionesIniciales");case 2:return s=n.v,i=s.json,("0090"===(0,F["default"])().colcod||/Macintosh/i.test(navigator.userAgent))&&(e.qrVersion="qrOld"),n.n=3,e.$http.get("api/HyoControl/obtCodigoActualPorCampo",{params:{campo:"tmarcacion"}});case 3:r=n.v,e.minutos=parseInt(r.json),e.dataAlumnos={},i.alumnos.forEach(function(n){e.dataAlumnos[n.ALUCOD]={ALUCOD:n.ALUCOD,NEMO:n.NEMO,USUCOD:n.USUCOD,NOMCOMP:n.NOMCOMP,TIPOSALIDA:"R"===n.TIPOSALIDA},e.dataAlumnos[n.USUCOD]={ALUCOD:n.ALUCOD,NEMO:n.NEMO,USUCOD:n.USUCOD,NOMCOMP:n.NOMCOMP,TIPOSALIDA:"R"===n.TIPOSALIDA},e.dataAlumnos[n.DOCIDENRO]={ALUCOD:n.ALUCOD,NEMO:n.NEMO,USUCOD:n.USUCOD,NOMCOMP:n.NOMCOMP,TIPOSALIDA:"R"===n.TIPOSALIDA}}),e.dataSalones=i.dataSalones,e.feriados=i.feriado,e.estados=i.estados,e.validarRecojo=a["S_VALIDA_RECOJO"],e.loading=!1;case 4:return n.a(2)}},n)}))()},watch:{timerEnabled:function(e){e&&(this.timerCountAlumno=this.minutos)},timerCountAlumno:{handler:function(e){var n=this;e>0&&this.timerEnabled&&setTimeout(function(){n.timerCountAlumno--},1e3),0===e&&(this.modalResult=!1,this.timerEnabled=!1)}}}};const Z=(0,H.A)(J,[["render",L]]);var ee=Z}}]);