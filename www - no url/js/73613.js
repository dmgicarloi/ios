"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[73613],{73613:function(e,l,a){a.r(l),a.d(l,{default:function(){return L}});var t=a(8445),o=a.n(t),n=(a(39866),a(61758)),i=a(29104),u={class:"row q-col-gutter-md"},r={class:"col-xs-6 col-md-3"},d={class:"col-xs-6 col-md-3"},c={class:"col-xs-6 col-md-3"},s={class:"col-xs-6 col-md-3"},f={class:"col-6 row"},m={class:"col-xs-6 col-md-3 q-pa-xs"},b={class:"col-xs-6 col-md-3 q-pa-xs"},p={class:"col-xs-6 col-md-3 q-pa-xs"},h={class:"col-xs-6 col-md-3 q-pa-xs"},v={class:"col-xs-12 col-md-6"};function A(e,l){var a=(0,n.g2)("q-card-section"),t=(0,n.g2)("q-select"),A=(0,n.g2)("q-input"),D=(0,n.g2)("q-datetime"),g=(0,n.g2)("q-field"),I=(0,n.g2)("q-btn"),F=(0,n.g2)("q-card-actions"),T=(0,n.g2)("q-card"),k=(0,n.g2)("q-form"),U=(0,n.g2)("q-table"),_=(0,n.g2)("q-page");return(0,n.uX)(),(0,n.Wv)(_,null,{default:(0,n.k6)(function(){return[["SIE","SIEWEB"].includes(e.sie.usucod)?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[(0,n.bF)(k,{onSubmit:(0,i.D$)(e.searchAudit,["prevent"])},{default:(0,n.k6)(function(){return[(0,n.bF)(T,null,{default:(0,n.k6)(function(){return[(0,n.bF)(a,null,{default:(0,n.k6)(function(){return o()(l[10]||(l[10]=[(0,n.Lk)("h2",{class:"text-center"},"Auditoría",-1)]))}),_:1}),(0,n.bF)(a,null,{default:(0,n.k6)(function(){return[(0,n.Lk)("div",u,[(0,n.Lk)("div",r,[(0,n.bF)(t,{class:"q-if-outlined",modelValue:e.tipo,"onUpdate:modelValue":l[0]||(l[0]=function(l){return e.tipo=l}),disable:"",label:"Base de datos",placeholder:"Seleccione",options:e.tipoAuditoriaOptions,outlined:"",dense:!0},null,8,["modelValue","options"])]),(0,n.Lk)("div",d,[(0,n.bF)(t,{class:"q-if-outlined",modelValue:e.audit.table,"onUpdate:modelValue":l[1]||(l[1]=function(l){return e.audit.table=l}),label:"Tabla",placeholder:"Tabla",options:e.tableOptions,"option-value":"value","option-label":"option",outlined:"",dense:!0},null,8,["modelValue","options"])]),(0,n.Lk)("div",c,[(0,n.bF)(A,{class:"q-if-outlined",modelValue:e.audit.usucod,"onUpdate:modelValue":l[2]||(l[2]=function(l){return e.audit.usucod=l}),label:"USUCOD",placeholder:"USUCOD",dense:!0},null,8,["modelValue"])]),(0,n.Lk)("div",s,[(0,n.bF)(A,{class:"q-if-outlined",modelValue:e.audit.query,"onUpdate:modelValue":l[3]||(l[3]=function(l){return e.audit.query=l}),label:"Consulta",placeholder:"Consulta",dense:!0},null,8,["modelValue"])]),(0,n.Lk)("div",f,[(0,n.Lk)("div",m,[(0,n.bF)(g,{class:"col",icon:"calendar"},{default:(0,n.k6)(function(){return[(0,n.bF)(D,{class:"q-if-outlined col q-if-outlined",modelValue:e.audit.fechaInicio,"onUpdate:modelValue":l[4]||(l[4]=function(l){return e.audit.fechaInicio=l}),format:"DD/MM/YYYY","float-label":"Fecha de Inicio"},null,8,["modelValue"])]}),_:1})]),(0,n.Lk)("div",b,[(0,n.bF)(g,{class:"col",icon:"calendar"},{default:(0,n.k6)(function(){return[(0,n.bF)(D,{class:"q-if-outlined col q-if-outlined",modelValue:e.audit.fechaFin,"onUpdate:modelValue":l[5]||(l[5]=function(l){return e.audit.fechaFin=l}),format:"DD/MM/YYYY","float-label":"Fecha de Fin"},null,8,["modelValue"])]}),_:1})]),(0,n.Lk)("div",p,[(0,n.bF)(g,{class:"col",icon:"watch_later"},{default:(0,n.k6)(function(){return[(0,n.bF)(D,{class:"q-if-outlined col",modelValue:e.audit.horaInicio,"onUpdate:modelValue":l[6]||(l[6]=function(l){return e.audit.horaInicio=l}),error:!1,type:"time",format:"hh:mm A","float-label":"Hora de Inicio"},null,8,["modelValue"])]}),_:1})]),(0,n.Lk)("div",h,[(0,n.bF)(g,{class:"col",icon:"watch_later"},{default:(0,n.k6)(function(){return[(0,n.bF)(D,{class:"q-if-outlined col",modelValue:e.audit.horaFin,"onUpdate:modelValue":l[7]||(l[7]=function(l){return e.audit.horaFin=l}),error:!1,type:"time",format:"hh:mm A","float-label":"Hora de Fin"},null,8,["modelValue"])]}),_:1})])]),(0,n.Lk)("div",v,[(0,n.bF)(t,{class:"q-if-outlined",modelValue:e.audit.method,"onUpdate:modelValue":l[8]||(l[8]=function(l){return e.audit.method=l}),label:"Método",placeholder:"Método",options:e.methodOptions,outlined:"",dense:""},null,8,["modelValue","options"])])])]}),_:1}),(0,n.bF)(F,{class:"row justify-center"},{default:(0,n.k6)(function(){return[(0,n.bF)(I,{label:"Buscar",type:"submit",icon:"search",color:"primary",unelevated:""}),(0,n.bF)(I,{label:"Exportar",icon:"file_download",color:"primary",unelevated:"",onClick:e.exportAudit},null,8,["onClick"]),(0,n.bF)(I,{label:"Limpiar",icon:"clear",color:"primary",unelevated:"",onClick:l[9]||(l[9]=function(l){return e.audit={}})})]}),_:1})]}),_:1})]}),_:1},8,["onSubmit"]),(0,n.bF)(T,null,{default:(0,n.k6)(function(){return[(0,n.bF)(a,null,{default:(0,n.k6)(function(){return[(0,n.bF)(U,{data:e.auditoriaData,columns:e.columns,"row-key":"id",style:{"min-height":"calc(55vh - 2px)"},flat:"",bordered:"",dense:""},null,8,["data","columns"])]}),_:1})]}),_:1})],64)):(0,n.Q3)("v-if",!0)]}),_:1})}var D=a(76080),g=a.n(D),I=a(45254),F=a.n(I),T=(a(30683),a(52133),a(50310),a(30317),a(6724),a(70199),a(83190),a(49089),a(6123)),k=a(24729),U=a(2819),_=a(4437),q=a(95477),V=a(9736),C=a(23564),y=a(16648),E=a(34262),x=a(57668),O=a(2739),w={components:{QDatetime:T.T5,Dialog:k.A,QInput:V.A,QForm:O.A,QDate:_.A,QTime:C.A,QIcon:E.A,QTable:T.kH,QSelect:y.S,QPopupProxy:q.A,QPage:T.Tu,QCard:T.C$,QField:T.Om,QCardActions:T.zZ,QBtn:T.Il},data:function(){return{tipo:"produccion",sie:(0,x["default"])(),audit:{horaInicio:"",horaFin:"",fechaInicio:"",fechaFin:"",table:"",usucod:"",method:"",query:""},tipoAuditoriaOptions:[{label:"Produccion",value:"produccion"},{label:"Backup",value:"backup"}],tableOptions:[{label:"ID",value:"id"},{label:"ID Value",value:"id_value"},{label:"Method",value:"method"},{label:"Query",value:"query"},{label:"Date Audit",value:"date_audit"},{label:"Table Audit",value:"table_audit"},{label:"Time Audit",value:"time_audit"},{label:"Type Audit",value:"type_audit"},{label:"API",value:"api"},{label:"IP",value:"ip"},{label:"Origin",value:"origin"},{label:"USUCOD",value:"usucod"},{label:"ID Acceso",value:"id_acceso"}],methodOptions:[{label:"Insert",value:"insert"},{label:"Update",value:"update"},{label:"Delete",value:"delete"},{label:"Update or Insert",value:"update or insert"},{label:"Merge",value:"merge"}],auditoriaData:[],columns:[{name:"USUCOD",label:"Usuario",align:"left",field:"USUCOD"},{name:"DATE_AUDIT",label:"Fecha",align:"left",field:"DATE_AUDIT"},{name:"ID_ACCESO",label:"Id WAcceso",align:"left",field:"ID_ACCESO"},{name:"IP",label:"Ip",align:"left",field:"IP"},{name:"API",label:"Api",align:"left",field:"API"},{name:"METHOD",label:"Metodo",align:"left",field:"METHOD"},{name:"TABLE_AUDIT",label:"Tabla",align:"left",field:"TABLE_AUDIT"},{name:"QUERY",label:"Consulta",align:"left",field:"QUERY"},{name:"TYPE_AUDIT",label:"Tipo",align:"left",field:"TYPE_AUDIT"},{name:"TIME_AUDIT",label:"Tiempo",align:"left",field:"TIME_AUDIT"}]}},methods:{formatDateTime:function(e){console.log("Formato de fecha y hora:",e);var l={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0};return new Date(e).toLocaleString("es-ES",l)},searchAudit:function(){var e=this;return F()(g()().m(function l(){var a,t;return g()().w(function(l){while(1)switch(l.n){case 0:if(e.audit.usucod=e.audit.usucod?e.audit.usucod.toUpperCase():"",a=Object.values(e.audit).every(function(e){return!e}),!a){l.n=1;break}return e.$confirmar("Debe elegir almenos un criterio de busqueda","warning"),l.a(2);case 1:return l.n=2,e.$http.get("api/AuditoriaController/getBuscar",{params:{params:e.audit}});case 2:t=l.v,e.auditoriaData=t.map(function(l){return l.DATE_AUDIT=e.formatDateTime(l.DATE_AUDIT),l});case 3:return l.a(2)}},l)}))()},exportAudit:function(){var e="".concat(this.sie.host,"/api/AuditoriaController/exportar?params=").concat(JSON.stringify(this.audit));(0,U.open)({action:e})},formatDate:function(e){return new Date(e).toLocaleDateString()},getCellClass:function(e){return"error"===e.TYPE_AUDIT?"cell-error":""}},mounted:function(){var e=this;return F()(g()().m(function l(){var a,t;return g()().w(function(l){while(1)switch(l.n){case 0:return l.n=1,e.$http("api/AuditoriaController/getTables");case 1:a=l.v,t=a.tablas,e.tableOptions=t;case 2:return l.a(2)}},l)}))()}},Q=a(12807);const S=(0,Q.A)(w,[["render",A]]);var L=S}}]);