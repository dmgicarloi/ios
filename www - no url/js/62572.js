"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[62572],{62572:function(o,e,t){t.r(e),t.d(e,{default:function(){return L}});var n=t(8445),r=t.n(n),i=(t(71225),t(56285),t(50310),t(5962),t(83190),t(61758)),a=t(58790),s={class:"row q-pa-sm"},c={class:"col-xs-12 col-md-12 sie-select-general"},l={key:0,class:"row q-pa-sm contenido"},u={class:"col-xl-4 col-lg-4 col-sm-6 col-xs-12"},d={class:"col-10"},f={class:"col-xl-8 col-lg-8 col-sm-6 col-xs-12 colvisor"},p={class:"row"},m={class:"col-xs-12"};function w(o,e){var t=(0,i.g2)("q-toolbar-title"),n=(0,i.g2)("q-toolbar"),w=(0,i.g2)("sie-select"),h=(0,i.g2)("q-search"),g=(0,i.g2)("q-td"),D=(0,i.g2)("q-btn"),A=(0,i.g2)("q-tr"),O=(0,i.g2)("q-table"),_=(0,i.g2)("sie-visor"),v=(0,i.g2)("sie-upload"),T=(0,i.g2)("sie-modal"),R=(0,i.g2)("q-page");return(0,i.uX)(),(0,i.Wv)(R,{class:"bg-white"},{default:(0,i.k6)(function(){return[(0,i.bF)(n,{class:"shadow-2 z-fab",inverted:""},{default:(0,i.k6)(function(){return[(0,i.bF)(t,{class:"q-pa-none"},{default:(0,i.k6)(function(){return r()(e[5]||(e[5]=[(0,i.eW)("Documentos de AdmisiÃ³n",-1)]))}),_:1})]}),_:1}),(0,i.Lk)("div",s,[(0,i.Lk)("div",c,[(0,i.bF)(w,{class:"col",type:"outlined",modelValue:o.hijosel,"onUpdate:modelValue":e[0]||(e[0]=function(e){return o.hijosel=e}),options:o.hijos,label:"LABEL_POSTULANTE",val:"ID_ADM_FICHA",placeholder:o.$t("postulante"),onInput:e[1]||(e[1]=function(e){return o.getDocumentos(!0)})},null,8,["modelValue","options","placeholder"])])]),o.hijosel>0?((0,i.uX)(),(0,i.CE)("div",l,[(0,i.Lk)("div",u,[(0,i.bF)(O,{data:o.dataDetalle,columns:o.conf.columns,selection:o.conf.selection,pagination:o.conf.pagination,selected:o.conf.selected,"onUpdate:selected":e[3]||(e[3]=function(e){return o.conf.selected=e}),"row-key":"USUARIO",color:"secondary",filter:o.conf.filter},{top:(0,i.k6)(function(t){return[(0,i.Lk)("div",d,[(0,i.bF)(h,{class:"q-if-outlined","hide-underline":"",modelValue:o.conf.filter,"onUpdate:modelValue":e[2]||(e[2]=function(e){return o.conf.filter=e})},null,8,["modelValue"])])]}),body:(0,i.k6)(function(e){return[(0,i.bF)(A,{class:(0,a.C4)(["cursor-pointer",e.row.__index==o.currentRow.row.__index?"tr-select":""]),props:e,onClick:function(t){return o.getCurrentRow(e.row)}},{default:(0,i.k6)(function(){return[(0,i.bF)(g,{key:"TITULO",props:e,class:(0,a.C4)(e.row.ID?"":"labeldirigido")},{default:(0,i.k6)(function(){return[(0,i.eW)((0,a.v_)(e.row.TITULO),1)]}),_:2},1032,["props","class"]),(0,i.bF)(g,{key:"ACTIONS",props:e,class:(0,a.C4)(e.row.ID?"":"labeldirigido")},{default:(0,i.k6)(function(){return[["C","D"].indexOf(e.row.ACCION)>=0&&!e.row.ID_DOCUMENTO_CARGADO?((0,i.uX)(),(0,i.Wv)(D,{key:0,dense:"",flat:"",round:"",icon:"upload",onClick:function(t){return o.upload(e.row)}},null,8,["onClick"])):(0,i.Q3)("v-if",!0),e.row.ID_DOCUMENTO_CARGADO?((0,i.uX)(),(0,i.Wv)(D,{key:1,dense:"",flat:"",round:"",icon:"delete",onClick:function(t){return o.del(e.row)}},null,8,["onClick"])):(0,i.Q3)("v-if",!0)]}),_:2},1032,["props","class"])]}),_:2},1032,["class","props","onClick"])]}),_:1},8,["data","columns","selection","pagination","selected","filter"])]),(0,i.Lk)("div",f,[o.docpreview.url?((0,i.uX)(),(0,i.Wv)(_,{key:0,class:"sie-view visor",src:o.docpreview.url,name:o.docpreview.name,css:{"visor-custom":!o.isGreater}},null,8,["src","name","css"])):(0,i.Q3)("v-if",!0)])])):(0,i.Q3)("v-if",!0),(0,i.bF)(T,{class:"plantilla-comentario-modal",modelValue:o.modal.open,"onUpdate:modelValue":e[4]||(e[4]=function(e){return o.modal.open=e}),title:o.modal.title,ok:o.$t("botones.guardar"),footer:!1},{default:(0,i.k6)(function(){return[(0,i.Lk)("div",p,[(0,i.Lk)("div",m,[(0,i.bF)(v,{onUpload:o.addFile,icon:"file",title:o.modal.subtitle,allow:["pdf","doc","docx","jpg"]},null,8,["onUpload","title"])])])]}),_:1},8,["modelValue","title","ok"])]}),_:1})}t(10239),t(90095),t(70199),t(515),t(7346),t(13715);var h=t(83972),g=t(6123),D=t(80660),A=t(93616),O=t(30640),_=(t(3927),t(982)),v=t(69027),T=(t(13813),{getUsuarioAdmisionFamcod:function(o){return D.$http.get("api/HyoAdmusuarios/getUsuarioAdmisionFamcod",{params:{famcod:o}})},getHijos:function(o){return D.$http.get("api/HyoAdmfichas/obtDatosFichas",{params:{id:o,traerEstado:"S",noTokenUsucod:!0}})},getDocumentos:function(o,e){return D.$http.get("api/HyoAdmdocumentospos/listarDocumentos",{params:{id_adm_usuario:o,id_adm_ficha:e,ordenarPorFamilia:!0}})},grabar:function(o){return D.$http.post("api/HyoAdmdocumentospos/grabarDocumento",{datos:o})},del:function(o){return D.$http.get("api/HyoAdmdocumentospos/eliminaDocumento",{params:{parametros:o}})}}),R=t(57668),C=(t(66469),t(56089)),b=t(9054),I=t(8901),U=t(59089),k=t(33950),E=t(81288),N={setup:function(){var o=(0,h.fG)();return{v$:o}},components:{QFab:g.l6,QFabAction:g.B$,QTable:g.kH,QTh:g.EJ,QTr:g.qh,QTd:g.Ef,QToggle:g.c5,QPopupEdit:g.GT,QSelect:g.Si,QPageSticky:g._U,sieSelect:A.A,sieModal:O.A,QIframe:C.A,SieVisor:b.A,SieView:I.A,sieUpload:U.A,QPage:g.Tu,QToolbar:g.ZV,QToolbarTitle:g.r_,QSearch:g.Ks,QBtn:g.Il},data:function(){return{acceso:(0,R["default"])().ruta.nivel>=2,currentRow:{old:{},row:{}},conf:{data:[],columns:[{name:"TITULO",label:"Documento",field:"TITULO",align:"left"},{name:"ACTIONS",label:"",align:"center"}],pagination:{page:1,rowsPerPage:200},filter:"",selection:"none",selected:[]},vmFiltro:{gradocod:[],curso:[]},baseurl:(0,R["default"])().url,famcod:(0,R["default"])().famcod,hijos:[],usuario:0,hijosel:0,docpreview:{name:"",url:""},modal:{open:!1,title:"Subir archivo",subtitle:"Seleccione el archivo a subir (se aceptan formatos pdf, doc, docx y jpg)"}}},computed:{dataDetalle:function(){var o=this.conf.data;return this.loadingDetalle=!1,o},isGreater:function(){return(0,E.isGreater)("sm")}},methods:{start:function(){var o=this;T.getUsuarioAdmisionFamcod(this.famcod).then(function(e){e.json.length>0&&(o.usuario=e.json[0].ID_ADM_USUARIO,T.getHijos(o.usuario).then(function(e){o.hijos=o.prepareCombo(e.json)}))})},prepareCombo:function(o){var e=[];return o.forEach(function(o){o.ESTADO_POSTULANTE&&["C"].indexOf(o.ESTADO_POSTULANTE)>=0&&(o.LABEL_POSTULANTE=o.NOMBRES_COMPLETO+" ("+o.ANOADM+" "+o.INSTRUDES+" "+o.GRADODES+")",e.push(o))}),e},prepareTable:function(o){var e=[],t=!1,n=!1;return o.forEach(function(o){"F"!=o.DIRIGIDO||t||(e.push({TITULO:"Familiar"}),t=!0),"P"!=o.DIRIGIDO||n||(e.push({TITULO:"Postulante"}),n=!0),e.push(o)}),e},getCurrentRow:function(o){o.ID&&(o.select=1,this.currentRow={row:o,old:JSON.parse(JSON.stringify(o))},this.preview())},setCurrentRow:function(){if(this.conf.data.length>0){var o=this.conf.data[1];o.__index=1,o.select=1,this.currentRow.row=this.currentRow.old=o}else this.currentRow={old:{},row:{}}},replaceCurrentRow:function(){this.currentRow.row.select&&this.conf.data[this.currentRow.row.__index]&&(this.currentRow.row=this.currentRow.old=this.conf.data[this.currentRow.row.__index])},getDocumentos:function(o){var e=this;T.getDocumentos(this.usuario,this.hijosel).then(function(t){e.conf.data=e.prepareTable(t.json),o?(e.setCurrentRow(),e.preview()):(e.replaceCurrentRow(),e.preview())})},upload:function(o){this.modal.open=!0},preview:function(){["B","D"].indexOf(this.currentRow.row.ACCION)>=0||"C"==this.currentRow.row.ACCION&&this.currentRow.row.ID_DOCUMENTO_CARGADO?this.currentRow.row.ID_DOCUMENTO_CARGADO?this.docpreview={name:this.currentRow.row.TITULO,url:this.baseurl+"/postula/documentos/"+this.currentRow.row.ANOADM+"/"+this.currentRow.row.ID_DOCUMENTO_CARGADO+"."+this.currentRow.row.EXT_DOCUMENTO_CARGADO}:this.docpreview={name:this.currentRow.row.TITULO,url:this.baseurl+"/postula/documentos/"+this.currentRow.row.ANOADM+"/"+this.currentRow.row.URL}:this.docpreview={name:"",url:""}},addFile:function(o){var e=this;(0,v.confirmar)(this.$t("mensajes.m0131"),function(){return(0,k.Upload)({url:"api/HyoArchivo/tmp/upload",file:o[0]}).then(function(o){var t={ano_adm:e.currentRow.row.ANOADM,id_documento:e.currentRow.row.ID,id_registro_pertenece:e.currentRow.row.ID_REGISTRO_PERTENECE,id_adm_usuario:e.usuario,tipo_registro:e.currentRow.row.DIRIGIDO,nombreTemporal:o.name,extension:o.name.split(".").pop()};return T.grabar(t)}).catch(function(){(0,_["default"])("No se pudo subir el archivo","warning")})}).then(function(o){"success"===o.json.icono?((0,_["default"])(e.$t("mensajes."+o.json.mensaje),"success"),e.getDocumentos(),e.modal.open=!1):(0,_["default"])(e.$t("mensajes."+o.json.mensaje),"warning")}).catch(function(){(0,_["default"])("No se registraron cambios","warning")})},del:function(o){var e=this;(0,v.confirmar)(this.$t("mensajes.m0006.confirmacion"),function(){var o={id:e.currentRow.row.ID_DOCUMENTO_CARGADO,ano_adm:e.currentRow.row.ANOADM,extension:e.currentRow.row.EXT_DOCUMENTO_CARGADO};return T.del(o)}).then(function(o){"success"===o.json.icono?((0,_["default"])(o.json.msg,"success"),e.getDocumentos()):(0,_["default"])(o.json.msg,"warning")}).catch(function(){(0,_["default"])("No se pudo eliminar","warning")})}},watch:{},validations:{},created:function(){this.start()}},j=t(12807);const S=(0,j.A)(N,[["render",w]]);var L=S}}]);