"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[24931],{24931:function(e,i,o){o.r(i),o.d(i,{default:function(){return y}});var t=o(8445),s=o.n(t),r=o(61758),n={class:"row q-pa-sm"},a={class:"col-12"},l={class:"row q-my-md row custom-filters"},u={key:0,class:"col-md-4 col-xs-12"},c={class:"col-md col-xs-12"},d={class:"col-md col-xs-12"},p={class:"col-md col-xs-12"},f={class:"row"},m={class:"col-md col-xs-10 q-pr-sm"},v={class:"col-md-auto col-xs-2 flex items-center justify-center"};function g(e,i){var o=this,t=(0,r.g2)("q-tooltip"),g=(0,r.g2)("q-btn"),O=(0,r.g2)("header-btn"),b=(0,r.g2)("autocomplete"),h=(0,r.g2)("q-select"),U=(0,r.g2)("q-datetime"),D=(0,r.g2)("sie-table"),S=(0,r.g2)("q-card"),I=(0,r.g2)("q-page");return(0,r.uX)(),(0,r.Wv)(I,{class:"q-pa-sm"},{default:(0,r.k6)(function(){return[(0,r.bF)(O,{class:"q-mb-sm",name:"Historial de Dispositivos ",icon:"devices"},{beforeText:(0,r.k6)(function(){return[(0,r.bF)(g,{icon:"arrow_back",flat:"",round:"",size:"md",color:"primary",onClick:i[0]||(i[0]=function(i){return e.$router.go(-1)})},{default:(0,r.k6)(function(){return[(0,r.bF)(t,null,{default:(0,r.k6)(function(){return s()(i[5]||(i[5]=[(0,r.eW)("Volver",-1)]))}),_:1})]}),_:1})]}),_:1}),(0,r.bF)(S,null,{default:(0,r.k6)(function(){return[(0,r.Lk)("div",n,[(0,r.Lk)("div",a,[(0,r.Lk)("div",l,[e.esAdmin?((0,r.uX)(),(0,r.CE)("div",u,[(0,r.bF)(b,{modelValue:e.currentUsunom,"onUpdate:modelValue":i[1]||(i[1]=function(i){return e.currentUsunom=i}),label:"Usuarios*",data:e.usuariosOpt,keys:e.keysComplete,onSelected:e.usuarioSeleccionado},null,8,["modelValue","data","keys","onSelected"])])):(0,r.Q3)("v-if",!0),(0,r.Lk)("div",c,[(0,r.bF)(h,{modelValue:e.filtroTipoOrigen,"onUpdate:modelValue":i[2]||(i[2]=function(i){return e.filtroTipoOrigen=i}),options:e.estadosOrigen,label:"Origen",onInput:e.cargarDispositivos},null,8,["modelValue","options","onInput"])]),(0,r.Lk)("div",d,[(0,r.bF)(h,{modelValue:e.filtroEstado,"onUpdate:modelValue":i[3]||(i[3]=function(i){return e.filtroEstado=i}),options:e.estados,label:"Dispositivo Seguro",onInput:e.cargarDispositivos},null,8,["modelValue","options","onInput"])]),(0,r.Lk)("div",p,[(0,r.Lk)("div",f,[(0,r.Lk)("div",m,[(0,r.bF)(U,{modelValue:e.filtroFecha,"onUpdate:modelValue":i[4]||(i[4]=function(i){return e.filtroFecha=i}),label:"Fecha de Registro","hide-bottom-space":"",onInput:e.cargarDispositivos},null,8,["modelValue","onInput"])]),(0,r.Lk)("div",v,[(0,r.bF)(g,{icon:"broom",unelevated:"",style:{height:"90%"},color:"primary",size:"sm",onClick:e.limpiarFiltros},{default:(0,r.k6)(function(){return[(0,r.bF)(t,null,{default:(0,r.k6)(function(){return s()(i[6]||(i[6]=[(0,r.eW)("Limpiar filtros",-1)]))}),_:1})]}),_:1},8,["onClick"])])])])]),(0,r.Lk)("div",null,[(0,r.bF)(D,{dense:"",flat:"",bordered:"","wrap-cells":"","show-search":!1,css:"min-height: 70dvh",context:o,columns:e.fields,data:e.rows,config:e.config},null,8,["columns","data","config"])])])])]}),_:1})]}),_:1})}var O=o(76080),b=o.n(O),h=o(91134),U=o.n(h),D=o(45254),S=o.n(D),I=(o(10239),o(9736)),k=o(6123),C=o(11654),E=o(80660),w=o(33777),A={data:function(){return{config:{FECHA_CREACION:{component:"datetime",edit:!1},ULTIMA_CONEXION:{component:"datetime",edit:!1},SEGURO:{renderHtml:function(e,i,o,t){return this.esDispositivoActual&&this.esDispositivoActual(e)?(t["$$background"]="#bfffc1",t["$$textColor"]="#2E7D32"):(t["$$background"]="white",t["$$textColor"]="black"),o.checkbox({trueValue:1,value:e.SEGURO})},renderAction:function(e,i){var o=this;e.SEGURO=1===e.SEGURO?0:1,e.SEGURO?this.$confirm("¿Marcar este dispositivo como seguro?","success").onOk(function(){o.updateField(e,"SEGURO",e.SEGURO)}):this.$confirm("¿Dejar de confiar en este dispositivo?","warning").onOk(function(){o.updateField(e,"SEGURO",e.SEGURO)})}},OPCIONES:{component:"button",icon:["delete"],delete:function(e){this.eliminarDispositivo(e)},tooltip:{delete:"Eliminar Dispositivo"},flat:!0,round:!0,color:"primary"}},fields:[{name:"SEGURO",label:"Dispositivo Seguro",field:"SEGURO",align:"center",sortable:!0},{name:"USUCOD",label:"Usuario",field:"USUCOD",align:"center",sortable:!0},{name:"USUNOM",label:"Nombre",field:"USUNOM",align:"center",sortable:!0},{name:"TIPO_ORIGEN",label:"Tipo Origen",field:"TIPO_ORIGEN",align:"center",sortable:!0},{name:"PLATAFORMA",label:"Plataforma",field:"PLATAFORMA",align:"center",sortable:!0},{name:"NOMBRE_DISPOSITIVO",label:"Descripción del dispositivo",field:"NOMBRE_DISPOSITIVO",align:"center",sortable:!0},{name:"FECHA_CREACION",label:"Fecha Registrada",field:"FECHA_CREACION",align:"center",sortable:!0},{name:"ULTIMA_CONEXION",label:"Última Conexión",field:"ULTIMA_CONEXION",align:"center",sortable:!0},{name:"OPCIONES",label:"OPCIONES",align:"center",sortable:!0}],rows:[]}}},F=o(50304),T=o(3112),_=o(16648),N=o(3042),R=o(57668),$=o(81288),V={components:{QInput:I.A,QBtn:C.A,QCard:k.C$,SieTable:w.A,QSelect:_.A,QDatetime:F.A,QCheckbox:T.A,autocomplete:N.A,QPage:k.Tu,QTooltip:k.nC},mixins:[A],data:function(){return{rows:[],permiso:(0,R["default"])().ruta.nivel,esAdmin:(0,R["default"])().esAdministrador,modalEditarDispositivo:!1,idDispositivo:null,estados:[{label:"Todos",value:"%"},{label:"Sí",value:1},{label:"No",value:0}],usuariosOpt:[],keysComplete:["USUCOD","USUNOM"],estadosOrigen:[{label:"Navegador",value:"Desktop"},{label:"Celular",value:"Mobile"},{label:"Todos",value:"%"}],currentUsunom:"",currentUsucod:"",filtroTipoOrigen:"%",filtroEstado:"%",filtroFecha:"",form:{nombreDispositivo:"",dispositivoSeguro:null,dispositivoNombre:""},datosUsuario:(0,R["default"])()}},methods:{updateField:function(e,i,o){var t=arguments,s=this;return S()(b()().m(function r(){var n,a;return b()().w(function(r){while(1)switch(r.p=r.n){case 0:return t.length>3&&void 0!==t[3]?t[3]:{},e[i]=o,n=U()({},i,o),r.p=1,r.n=2,E.$http.post("api/UsuarioDispositivoController/updateUsuarioDispositivo",{data:n,id_dispositivo:e.ID_DISPOSITIVO,usucod:e.USUCOD});case 2:return r.n=3,s.cargarDispositivos();case 3:s.$notify("Dispositivo actualizado","success"),r.n=5;break;case 4:r.p=4,a=r.v,s.$notify(a.message||"Error al actualizar dispositivo","warning");case 5:return r.a(2)}},r,null,[[1,4]])}))()},editarDispositivo:function(e){this.idDispositivo=e.ID_DISPOSITIVO,this.modalEditarDispositivo=!0},eliminarDispositivo:function(e){var i=this;return S()(b()().m(function o(){var t,s,r;return b()().w(function(o){while(1)switch(o.p=o.n){case 0:return o.n=1,i.$confirmar("¿Está seguro de eliminar el dispositivo?","delete");case 1:if(t=o.v,t){o.n=2;break}return o.a(2);case 2:return o.p=2,o.n=3,E.$http.delete("api/UsuarioDispositivoController/deleteUsuarioDispositivo",{params:{id_dispositivo:e.ID_DISPOSITIVO,usucod:e.USUCOD}});case 3:i.cargarDispositivos(),i.$notify("Dispositivo eliminado","success"),o.n=5;break;case 4:o.p=4,r=o.v,s=r.error,i.$notify(s.message,"warning");case 5:return o.a(2)}},o,null,[[2,4]])}))()},limpiarFiltros:function(){this.currentUsunom="",this.filtroTipoOrigen="%",this.filtroEstado="%",this.filtroFecha="",this.cargarDispositivos()},usuarioSeleccionado:function(e){var i=this;return S()(b()().m(function o(){return b()().w(function(o){while(1)switch(o.n){case 0:e&&(i.currentUsunom=e.USUNOM,i.currentUsucod=e.USUCOD),i.cargarDispositivos();case 1:return o.a(2)}},o)}))()},getUsuarios:function(){var e=this;return S()(b()().m(function i(){return b()().w(function(i){while(1)switch(i.n){case 0:return i.n=1,E.$http.get("api/UsuarioController/getUsuariosSeguridad",{params:{activos:"todos"}});case 1:e.usuariosOpt=i.v;case 2:return i.a(2)}},i)}))()},cargarDispositivos:function(){var e=this;return S()(b()().m(function i(){var o,t,s;return b()().w(function(i){while(1)switch(i.p=i.n){case 0:return o={usucod:e.currentUsucod,tipo:e.filtroTipoOrigen,seguro:e.filtroEstado,fecha_creacion:e.filtroFecha},e.esAdmin||(o.usucod=e.datosUsuario.usucod),i.p=1,i.n=2,E.$http.get("api/UsuarioDispositivoController/getUsuarioDispositivo",{params:{params:o}});case 2:t=i.v,e.rows=t,i.n=4;break;case 3:i.p=3,s=i.v,console.log("Error al cargar dispositivos:",s);case 4:return i.a(2)}},i,null,[[1,3]])}))()},esDispositivoActual:function(e){var i=(0,$.getDeviceInfo)();return e.ID_DISPOSITIVO===i.id}},mounted:function(){(0,R["default"])().profcod||this.$router.push("/login"),this.getUsuarios(),this.cargarDispositivos()}},L=o(12807);const x=(0,L.A)(V,[["render",g]]);var y=x}}]);