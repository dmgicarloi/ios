"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[63672],{63672:function(a,e,r){r.r(e),r.d(e,{default:function(){return ca}});var s=r(61758),o=r(58790),t=r(29104),n={ref:"audioOk",src:"statics/sound/ok.mp3"},i={ref:"audioInfo",src:"statics/sound/duplicate.mp3"},l={ref:"audioError",src:"statics/sound/error.mp3"},c={key:0,class:"column col"},u={class:"col q-card q-ma-sm"},d={class:"row"},m={class:"col text-center q-py-md",style:{"font-size":"x-large"}},p={class:"q-mb-lg-xs"},f={class:"row"},g={class:"col q-ma-sm"},v={class:"row justify-center"},A={class:"col col-6"},h={key:0,class:"col"},k={class:"col q-ma-sm"},O={key:0,class:"cardPase"},P={class:"col col-12 textEstado"},E={class:"col col-12"},R={class:"col col-12"},S={class:"col col-12"},b={class:"col col-12"},C={key:0,class:"col col-12 asistencia"},L={class:"row"},w={class:"row"},D={class:"row"},I={class:"col-12"},y={class:"q-ma-sm"},_={class:"col-12"},T={class:"q-ma-sm"},N={key:0,class:"row bg-white q-col-gutter-sm"},$={class:"col-12"},U={class:"row"},F={class:"col-xs-12 col-sm-6 offset-sm-3"},M={class:"row q-py-sm"},j={class:"col"},q={class:"col-xs-12 col-sm-6 offset-sm-3"},x={class:"row q-pa-xs q-col-gutter-xs"},G={class:"col-3"};function H(a,e){var r=this,H=(0,s.g2)("q-clock"),V=(0,s.g2)("q-input"),Q=(0,s.g2)("qr"),X=(0,s.g2)("sie-vacio"),B=(0,s.g2)("sie-table"),Y=(0,s.g2)("q-btn"),z=(0,s.g2)("q-page");return(0,s.uX)(),(0,s.Wv)(z,null,{default:(0,s.k6)(function(){return[(0,s.Lk)("audio",n,null,512),(0,s.Lk)("audio",i,null,512),(0,s.Lk)("audio",l,null,512),a.feriados?((0,s.uX)(),(0,s.Wv)(X,{key:1,class:"col column",title:a.feriados.OBSER?"regAsistencia.m0002":"",subtitle:a.feriados.OBSER,icon:"person"},null,8,["title","subtitle"])):((0,s.uX)(),(0,s.CE)("div",c,[(0,s.Lk)("div",u,[(0,s.Lk)("div",d,[(0,s.Lk)("div",m,[(0,s.Lk)("div",p,(0,o.v_)(a.titulo),1),(0,s.bF)(H)])]),(0,s.Lk)("div",f,[(0,s.Lk)("div",g,[(0,s.Lk)("div",v,[(0,s.Lk)("div",A,[(0,s.bF)(V,{class:"no-bottom q-if-outlined txt-especial",modelValue:a.usucod,"onUpdate:modelValue":e[0]||(e[0]=function(e){return a.usucod=e}),autofocus:!0,label:"Usuario",onKeydown:a.registraPistola},null,8,["modelValue","onKeydown"])])]),a.sinCamara?(0,s.Q3)("v-if",!0):((0,s.uX)(),(0,s.CE)("div",h,[(0,s.bF)(Q,{onLeeQr:a.leerRegistro,cargaAnterior:a.cargaAnterior},null,8,["onLeeQr","cargaAnterior"])]))]),(0,s.Lk)("div",k,[a.card.mostrar?((0,s.uX)(),(0,s.CE)("div",O,[(0,s.Lk)("div",{class:(0,o.C4)(["row q-card estadoPase",a.card.claseCss])},[(0,s.Lk)("div",P,[(0,s.Lk)("span",null,(0,o.v_)(a.card.textEstado),1)]),(0,s.Lk)("div",E,[(0,s.Lk)("b",null,(0,o.v_)(a.card.infoPersona.nombre),1)]),(0,s.Lk)("div",R,[(0,s.Lk)("span",null,(0,o.v_)(a.card.infoPersona.salon),1)]),(0,s.bo)((0,s.Lk)("div",S,[(0,s.Lk)("span",null,"Fecha Ingreso: "+(0,o.v_)(a.date(a.card.fechaControl,"hh:mm a")),1)],512),[[t.aG,a.card.fechaControl]]),(0,s.bo)((0,s.Lk)("div",b,[(0,s.Lk)("span",null,"Fecha Salida: "+(0,o.v_)(a.date(a.card.fechaSalida,"hh:mm a")),1)],512),[[t.aG,a.card.fechaSalida]]),a.card.estadoPase&&a.dataAsistencia.FECREG?((0,s.uX)(),(0,s.CE)("div",C,[e[6]||(e[6]=(0,s.Lk)("div",{class:"row justify-center"},[(0,s.Lk)("b",null,"ASISTENCIA")],-1)),(0,s.Lk)("div",L,[e[4]||(e[4]=(0,s.Lk)("b",null,"Estado:",-1)),(0,s.Lk)("span",null,(0,o.v_)(a.dataAsistencia.ESTADODES),1)]),(0,s.Lk)("div",w,[e[5]||(e[5]=(0,s.Lk)("b",null,"Fecha:",-1)),(0,s.Lk)("span",null,(0,o.v_)(a.date(a.dataAsistencia.FECREG,"DD/MM/YYYY hh:mm a")),1)])])):(0,s.Q3)("v-if",!0)],2)])):((0,s.uX)(),(0,s.Wv)(X,{key:1,class:"col column",icon:"person"}))])]),(0,s.bo)((0,s.Lk)("div",D,[(0,s.Lk)("div",I,[(0,s.Lk)("div",y,[(0,s.Lk)("b",null,(0,o.v_)(a.card.infoRecojo.tipo_salida),1)])]),(0,s.bo)((0,s.Lk)("div",_,[(0,s.Lk)("div",T,[(0,s.bF)(B,{data:a.card.infoRecojo.personas_autorizadas,columns:a.columns,config:a.configTabla,context:r,css:{height:"30vh"}},null,8,["data","columns","config"])])],512),[[t.aG,a.card.infoRecojo.personas_autorizadas.length>0]])],512),[[t.aG,a.card.mostrar]]),a.regTemperatura&&a.showControlTemperatura?((0,s.uX)(),(0,s.CE)("div",N,[(0,s.Lk)("div",$,[(0,s.Lk)("div",U,[(0,s.Lk)("div",F,[(0,s.Lk)("div",M,[(0,s.Lk)("div",j,[(0,s.bF)(V,{modelValue:a.form.temperatura,"onUpdate:modelValue":e[1]||(e[1]=function(e){return a.form.temperatura=e}),label:"Temperatura",type:"number",ref:"input",onClick:a.selected,onKeyup:e[2]||(e[2]=(0,t.jR)(function(e){return a.saveTemperatura()},["enter"]))},null,8,["modelValue","onClick"])]),(0,s.bF)(Y,{class:"bg-primary text-white",label:"Guardar","no-caps":"",flat:"",onClick:e[3]||(e[3]=function(e){return a.saveTemperatura()})})])]),(0,s.Lk)("div",q,[(0,s.Lk)("div",x,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(a.temperaturas,function(e){return(0,s.uX)(),(0,s.CE)("div",G,[(0,s.bF)(Y,{class:"full-width bg-primary text-white",label:e,flat:"",onClick:function(r){return a.setTemperatura(e)}},null,8,["label","onClick"])])}),256))])])])])])):(0,s.Q3)("v-if",!0)])]))]}),_:1})}var V=r(57008),Q=r.n(V),X=r(76080),B=r.n(X),Y=r(45254),z=r.n(Y),K=(r(10239),r(50310),r(90095),r(15547),r(83190),r(27153),r(13715),r(6123)),W=r(80660),J=r(80340),Z=r(69027),aa=r(65818),ea=r(23527),ra=r(18105),sa=r(982),oa=r(9736),ta=r(81288),na={props:{tipoRegistro:{required:!1,default:"ingreso",type:String,validator:function(a){return-1!==["ingreso","salida"].indexOf(a)}}},computed:{titulo:function(){return"ingreso"===this.tipoRegistro?"REGISTRAR INGRESO":"salida"===this.tipoRegistro?"REGISTRAR SALIDA":void 0}},components:{qr:ea.A,sieVacio:J.A,QClock:aa.A,QInput:oa.A,QPage:K.Tu,QBtn:K.Il},data:function(){return{configTabla:{relcod:{renderHtml:function(a,e){var r=this.parentescos.hasOwnProperty(a.relcod)?this.parentescos[a.relcod]:"";return e("span",{},r)}}},columns:[{name:"relcod",label:"Parentesco",field:"relcod",align:"left"},{name:"nombre",label:"Nombre",field:"nombre",align:"left"},{name:"dni",label:"Dni",field:"dni",align:"center"},{name:"tel",label:"Teléfono",field:"tel",align:"center"}],regTemperatura:!0,mostrarDatosRecojo:!1,omitirRegistroPersonal:!1,isProcesoVerano:!1,showControlTemperatura:!1,now:new Date,tipoLectura:"qr",sinCamara:!1,cargaAnterior:!1,camera:"auto",usucod:"",dataAsistencia:{},dataPersona:{},dataSalones:{},feriados:{},estados:{},card:{},dataAlumnoPases:{},datosMovilidad:{},parentescos:{},tiposRecojo:{},registrarAsistencia:!1,form:{temperatura:0},temperaturas:[],currentUser:{}}},methods:{date:ra.Ay,setCard:function(a,e,r,s,o,t){var n,i,l,c,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d={tipo_salida:"",personas_autorizadas:[]};if(a)n=0,l="",i="estInicio",c=null;else if("ingreso"===this.tipoRegistro)n=1,1===r?e?(i="estYaIngresante",l="YA INGRESÓ"):(i="estIngresa",l="INGRESA"):0===r?(i="estNoIngresa",l="NO INGRESA"):null===r&&(i="estSinRegistro",l="SIN REGISTRO");else if("salida"===this.tipoRegistro&&(n=1,l="",1===r?e?(i="estYaIngresante",l="YA SALIÓ"):i="estIngresa":0===r?i="estNoIngresa":null===r&&(i="estSinRegistro",l="SIN REGISTRO"),o.esAlumno&&this.datosMovilidad.hasOwnProperty(o.ALUCOD))){var m=this.datosMovilidad[o.ALUCOD];d={tipo_salida:this.tiposRecojo.hasOwnProperty(m.ts)?this.tiposRecojo[m.ts]:"",personas_autorizadas:m.per_aut}}t=t||{},this.card={mostrar:n,claseCss:i,textEstado:l,fechaAsistencia:c,fechaControl:s,fechaSalida:u,infoRecojo:d,estadoPase:r,infoPersona:{nombre:o.NOMCOMP,salon:t.NEMODES}}},proccessQR:function(a){var e=this;return z()(B()().m(function r(){var s,o,t,n,i,l,c;return B()().w(function(r){while(1)switch(r.n){case 0:if(e.showControlTemperatura=!1,e.setCard(!0,0,null,null,{},{}),e.dataAsistencia={},e.dataPersona[a]){r.n=1;break}return(0,sa["default"])("El usuario(a) no se encuentra registrado(a) en el sistema","error"),e.$refs.audioError.play(),r.a(2,Promise.resolve(1));case 1:if(!e.omitirRegistroPersonal||e.dataPersona[a].esAlumno){r.n=2;break}return(0,sa["default"])(e.$t("regAsistencia.noAsistenciaPersonal"),"error"),e.$refs.audioError.play(),r.a(2,Promise.resolve(1));case 2:if(!e.dataPersona[a].esAlumno||e.isProcesoVerano){r.n=3;break}if(e.dataPersona[a].NEMO){r.n=3;break}return(0,sa["default"])(e.$t("regAsistencia.m0005"),"error"),e.$refs.audioError.play(),r.a(2,Promise.resolve(1));case 3:if(s=e.dataPersona[a],o=s.ID_PERSONA,t=s.NEMO,e.currentUser=s,!s.esAlumno||!e.registrarAsistencia){r.n=4;break}if(e.dataSalones[t].BIMECOD){r.n=4;break}return(0,sa["default"])(e.$t("regAsistencia.m0006"),"error"),e.$refs.audioError.play(),r.a(2,Promise.resolve(1));case 4:if(e.dataAlumnoPases.hasOwnProperty(o)){r.n=5;break}return r.n=5,e.cargarPases();case 5:if(n=null,i=null,l=null,c=null,!e.dataAlumnoPases.hasOwnProperty(o)){r.n=7;break}if(n=e.dataAlumnoPases[o].ESTADO_PASE,i=e.dataAlumnoPases[o].FH_AST_CONTROL,l=e.dataAlumnoPases[o].FH_PASE,c=e.dataAlumnoPases[o].FH_AST_SALIDA,i){r.n=7;break}return r.n=6,e.cargarPases();case 6:i=e.dataAlumnoPases[o].FH_AST_CONTROL,c=e.dataAlumnoPases[o].FH_AST_SALIDA;case 7:if(1===n){r.n=8;break}return e.$refs.audioError.play(),e.setCard(!1,0,n,i,s,e.dataSalones[t]),r.a(2,Promise.resolve(1));case 8:if("ingreso"!==e.tipoRegistro){r.n=10;break}return r.n=9,e.grabarEntrada(n,i,s,l);case 9:r.n=11;break;case 10:if("salida"!==e.tipoRegistro){r.n=11;break}return r.n=11,e.grabarSalida(n,i,s,c);case 11:return r.a(2)}},r)}))()},grabarSalida:function(a,e,r,s){var o=this;return z()(B()().m(function t(){var n,i,l,c;return B()().w(function(t){while(1)switch(t.p=t.n){case 0:if(o.showControlTemperatura=!1,n=r.NEMO,i=r.ID_PERSONA,!e){t.n=5;break}if(!s){t.n=1;break}return(0,sa["default"])("El ".concat(r.esAlumno?"alumno":"docente"," ya registró su salida"),"error"),o.setCard(!1,1,a,e,r,o.dataSalones[n],s),o.$refs.audioError.play(),t.a(2,Promise.resolve(1));case 1:return t.p=1,l=o.dataAlumnoPases[i].ID_FRM_USUARIO,t.n=2,W.$http.post("api/FichaSintomatologica/guardarSalidaPase",{idFrmUsuario:l});case 2:c=t.v,o.dataAlumnoPases[i].FH_AST_SALIDA=c,o.setCard(!1,0,a,e,r,o.dataSalones[n],c),(0,sa["default"])("Se registró la salida"),o.$refs.audioOk.play(),t.n=4;break;case 3:t.p=3,t.v,(0,sa["default"])("Ocurrió un error","error"),o.$refs.audioError.play();case 4:return t.a(2,Promise.resolve(1));case 5:return(0,sa["default"])("El ".concat(r.esAlumno?"alumno":"docente"," no ha registrado su entrada"),"error"),o.setCard(!1,0,null,null,r,o.dataSalones[n]),o.$refs.audioError.play(),t.a(2,Promise.resolve(1));case 6:return t.a(2)}},t,null,[[1,3]])}))()},grabarEntrada:function(a,e,r,s){var o=this;return z()(B()().m(function t(){var n,i,l,c,u,d,m,p,f,g;return B()().w(function(t){while(1)switch(t.p=t.n){case 0:if(n=r.NEMO,i=r.ALUCOD,l=r.ID_PERSONA,!e){t.n=1;break}return(0,sa["default"])("El ".concat(r.esAlumno?"alumno":"docente"," ya realizó el control de pase"),"error"),o.setCard(!1,1,a,e,r,o.dataSalones[n]),o.$refs.audioError.play(),t.a(2,Promise.resolve(1));case 1:if(!o.registrarAsistencia||!r.esAlumno){t.n=5;break}return c={alucod:i,nemo:n,bimecod:o.dataSalones[n].BIMECOD,tardanzagen:s},t.p=2,t.n=3,W.$http.get("api/HyoHorasis/registraAsistenciaBrae",{params:c});case 3:u=t.v,d=u.json,(0,sa["default"])(o.$t("regAsistencia."+d.mensaje)),o.dataAsistencia=Q()(Q()(Q()({},d.data),o.estados[d.data.ESTADOCOD]),o.dataSalones[n]),o.$refs.audioOk.play(),t.n=5;break;case 4:t.p=4,g=t.v,m=g.error,"e0002"!==m.message?((0,sa["default"])(o.$t("regAsistencia."+m.message),"error"),o.dataAsistencia=Q()(Q()({},m.params),o.estados[m.params.ESTADOCOD]),o.$refs.audioOk.play(),"m0001"===m.message?o.$refs.audioInfo.play():o.$refs.audioError.play()):(o.dataAsistencia={},(0,Z.dialogConfirm)({title:o.$t("mensajes."+m.message),cancel:!1}),o.$refs.audioError.play());case 5:return t.p=5,p=o.dataAlumnoPases[l].ID_FRM_USUARIO,t.n=6,W.$http.post("api/FichaSintomatologica/guardarPaseControl",{idFrmUsuario:p});case 6:f=t.v,o.dataAlumnoPases[l].FH_AST_CONTROL=f,o.setCard(!1,0,a,f,r,o.dataSalones[n]),(0,sa["default"])("Se registró el control de pase"),o.showControlTemperatura=!0,t.n=8;break;case 7:t.p=7,t.v,(0,sa["default"])("Ocurrió un error","error"),o.$refs.audioError.play();case 8:return t.a(2)}},t,null,[[5,7],[2,4]])}))()},leerRegistro:function(a,e){var r=this;return z()(B()().m(function s(){return B()().w(function(s){while(1)switch(s.n){case 0:if(!a){s.n=2;break}return a.indexOf("|")>=0&&(a=a.split("|")[0]),s.n=1,r.proccessQR(a.toUpperCase());case 1:s.n=3;break;case 2:r.sinCamara=e;case 3:r.cargaAnterior=!0,r.usucod=null;case 4:return s.a(2)}},s)}))()},registraPistola:function(a){13===a.which&&this.leerRegistro(this.usucod)},cargarPases:function(){var a=arguments,e=this;return z()(B()().m(function r(){var s,o,t,n,i,l,c;return B()().w(function(r){while(1)switch(r.p=r.n){case 0:return s=a.length>0&&void 0!==a[0]&&a[0],r.p=1,r.n=2,W.$http.get("api/FichaSintomatologica/getPasesAlumnos");case 2:o=r.v,t=o.data,n=o.regAsist,i=o.isProcesoVerano,l=o.regTemperatura,c=o.mostrarDatosRecojo,t.forEach(function(a){e.dataAlumnoPases[a.ID_PERSONA]=a}),s&&(e.mostrarDatosRecojo=c&&"salida"===e.tipoRegistro,e.regTemperatura=l&&"ingreso"===e.tipoRegistro,e.registrarAsistencia=n,e.isProcesoVerano=i),r.n=4;break;case 3:r.p=3,r.v;case 4:return r.a(2)}},r,null,[[1,3]])}))()},setTemperatura:function(a){this.form.temperatura=a},selected:function(){this.$refs.input.$el&&this.$refs.input.$el.querySelector("input").select()},saveTemperatura:function(){var a=this;return z()(B()().m(function e(){var r;return B()().w(function(e){while(1)switch(e.p=e.n){case 0:if(!(a.form.temperatura<1)){e.n=1;break}return a.$notify("Debe ingresar una temperatura","warning"),e.a(2);case 1:return r={id_persona:a.currentUser.ID_PERSONA,temperatura:a.form.temperatura,opcion_registro:1},e.p=2,e.n=3,a.$http.post("api/CovidTemperatura/createCovidTemperatura",{params:r});case 3:return e.n=4,e.v;case 4:a.showControlTemperatura=!1,a.$notify("Temperatura agregada.","success"),a.form.temperatura=0,e.n=6;break;case 5:e.p=5,e.v,a.$notify("Ha ocurrido un problema de conexión, vuelve a intenarlo más tarde.","warning");case 6:return e.a(2)}},e,null,[[2,5]])}))()},init:function(){var a=this;return z()(B()().m(function e(){var r,s,o,t,n,i,l,c,u,d,m,p,f,g,v,A,h,k;return B()().w(function(e){while(1)switch(e.n){case 0:return a.showControlTemperatura=!1,a.setCard(!0,0,null,null,{},{}),e.n=1,a.cargarPases(!0);case 1:if(!a.isProcesoVerano){e.n=3;break}return e.n=2,W.$http.get("api/HyoHorasis/listarPersonas");case 2:o=e.v,t=o.json,r=t.alumnos,s=t.docentes,a.feriados=null,e.n=5;break;case 3:return e.n=4,W.$http.get("api/HyoHorasis/validacionesIniciales",{params:{withDocente:!0}});case 4:n=e.v,i=n.json,l=i.dataSalones,c=i.feriado,u=i.estados,r=i.alumnos,s=i.docentes,a.dataSalones=l,a.feriados=c,a.estados=u;case 5:if(!a.mostrarDatosRecojo){e.n=7;break}return d=a.isProcesoVerano?0:1,e.n=6,W.$http.get("api/HyoAlumnos/datosRecojo",{params:{solomatriculados:d}});case 6:m=e.v,p=m.json,a.datosMovilidad=p.data,a.tiposRecojo=p.tiposRecojo,a.parentescos=p.parentescos;case 7:return e.n=8,(0,ta.constantes)(["AP_REGISTRO_BRAE"]);case 8:for(f=e.v,a.omitirRegistroPersonal=!!f.AP_REGISTRO_BRAE,g={},r.forEach(function(e){var r=a.isProcesoVerano?null:e.NEMO,s={ALUCOD:e.ALUCOD,NEMO:r,USUCOD:e.USUCOD,NOMCOMP:e.NOMCOMP,ID_PERSONA:e.ID_PERSONA,esAlumno:!0};g[e.ALUCOD]=s,g[e.USUCOD]=s,e.DOCIDENRO&&(g[e.DOCIDENRO]=s)}),s.forEach(function(a){var e={ALUCOD:null,NEMO:null,USUCOD:a.USUCOD,NOMCOMP:a.NOMCOMP,ID_PERSONA:a.ID_PERSONA,esAlumno:!1};g[a.PROFCOD]=e,g[a.USUCOD]=e,a.DOCIDENRO&&(g[a.DOCIDENRO]=e)}),a.dataPersona=g,v=36,A=v+41,h=v,a.temperaturas.push(v.toFixed(1)),k=v;k<=A;k++)h+=.1,a.temperaturas.push(h.toFixed(1));case 9:return e.a(2)}},e)}))()}},created:function(){this.init()},watch:{tipoRegistro:function(){this.init()}}},ia=r(12807);const la=(0,ia.A)(na,[["render",H]]);var ca=la}}]);