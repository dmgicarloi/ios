"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[91053],{91053:function(e,r,a){a.r(r),a.d(r,{default:function(){return L}});a(39866);var n=a(61758),t={class:"row q-col-gutter-sm"},c={class:"col-xs-12"},o={class:"row q-col-gutter-sm q-pa-sm"},u={class:"col-xs-12 sie-flat"},l={class:"row q-pa-sm q-col-gutter-sm"},i={class:"col-xs-12 col-sm-6"},s={class:"col-xs-12 col-sm-3"},m={class:"col-xs-12 col-sm-3"},d={class:"col-xs-12"},f={class:"col-xs-12"},p={class:"col-xs-12"};function b(e,r){var a=this,b=(0,n.g2)("header-btn"),M=(0,n.g2)("sie-table"),C=(0,n.g2)("q-card-section"),R=(0,n.g2)("q-card"),h=(0,n.g2)("q-form"),A=(0,n.g2)("sie-modal"),g=(0,n.g2)("q-input"),v=(0,n.g2)("q-checkbox"),w=(0,n.g2)("sie-editor"),S=(0,n.g2)("q-page");return(0,n.uX)(),(0,n.Wv)(S,{class:"biblioteca-mantenimiento-marc21 q-pa-sm sie-flat"},{default:(0,n.k6)(function(){return[(0,n.bF)(R,{flat:"",bordered:""},{default:(0,n.k6)(function(){return[(0,n.bF)(b,{name:"Mantenimiento MARC 21",auto:!1,buttons:e.buttons},null,8,["buttons"]),(0,n.bF)(C,null,{default:(0,n.k6)(function(){return[(0,n.Lk)("div",t,[(0,n.Lk)("div",c,[(0,n.bF)(M,{ref:"tbmarc21",columns:e.fields,data:e.rows,selection:"single",config:e.config,context:a,"save-cells":"",onRowSelected:e.selectedMarc,css:{height:"calc(100vh - 165px)"}},null,8,["columns","data","config","onRowSelected"])])])]}),_:1})]}),_:1}),(0,n.bF)(A,{modelValue:e.openModalSubCampos,"onUpdate:modelValue":r[0]||(r[0]=function(r){return e.openModalSubCampos=r}),title:"Agregar subcampos Marc 21",footer:!1},{default:(0,n.k6)(function(){return[(0,n.bF)(h,null,{default:(0,n.k6)(function(){return[(0,n.bF)(b,{name:"",auto:!1,buttons:e.buttonsSubCampo},null,8,["buttons"]),(0,n.Lk)("div",o,[(0,n.Lk)("div",u,[(0,n.bF)(M,{ref:"subcampo",columns:e.fieldsSubCampo,data:e.rowsSubCampo,selection:"single",config:e.configSubCampo,context:a,onRowSelected:e.selectedSubMarc,css:{minHeight:"300px"}},null,8,["columns","data","config","onRowSelected"])])])]}),_:1})]}),_:1},8,["modelValue"]),(0,n.bF)(A,{modelValue:e.openModalMarc21,"onUpdate:modelValue":r[8]||(r[8]=function(r){return e.openModalMarc21=r}),title:"Agregar Marc 21",css:{width:"667px"},onSubmit:e.guardarMarc},{default:(0,n.k6)(function(){return[(0,n.bF)(h,{ref:"marc21"},{default:(0,n.k6)(function(){return[(0,n.Lk)("div",l,[(0,n.Lk)("div",i,[["createSubCampo","updateSubCampo"].indexOf(e.action)>=0?((0,n.uX)(),(0,n.Wv)(g,{key:0,modelValue:e.form.marccod,"onUpdate:modelValue":r[1]||(r[1]=function(r){return e.form.marccod=r}),maxlength:"4",label:"Etiqueta",rules:[e.required,e.max4Caracteres,e.validateEtiquetaSubCampo]},null,8,["modelValue","rules"])):((0,n.uX)(),(0,n.Wv)(g,{key:1,modelValue:e.form.marccod,"onUpdate:modelValue":r[2]||(r[2]=function(r){return e.form.marccod=r}),maxlength:"4",readonly:["updateSubCampo","update"].includes(e.action),label:"Etiqueta",rules:[e.required,e.max3Caracteres]},null,8,["modelValue","readonly","rules"]))]),(0,n.Lk)("div",s,[(0,n.bF)(v,{modelValue:e.form.marcrep,"onUpdate:modelValue":r[3]||(r[3]=function(r){return e.form.marcrep=r}),label:"Repetible","true-value":1,"false-value":0},null,8,["modelValue"])]),(0,n.Lk)("div",m,[(0,n.bF)(v,{modelValue:e.form.marcreq,"onUpdate:modelValue":r[4]||(r[4]=function(r){return e.form.marcreq=r}),label:"Requerido","true-value":1,"false-value":0},null,8,["modelValue"])]),(0,n.Lk)("div",d,[(0,n.bF)(g,{modelValue:e.form.marcnom,"onUpdate:modelValue":r[5]||(r[5]=function(r){return e.form.marcnom=r}),label:"Nombre de etiqueta"},null,8,["modelValue"])]),(0,n.Lk)("div",f,[(0,n.bF)(g,{modelValue:e.form.marceti,"onUpdate:modelValue":r[6]||(r[6]=function(r){return e.form.marceti=r}),label:"Nombre para OPAC"},null,8,["modelValue"])]),(0,n.Lk)("div",p,[(0,n.bF)(w,{modelValue:e.form.marcdes,"onUpdate:modelValue":r[7]||(r[7]=function(r){return e.form.marcdes=r})},null,8,["modelValue"])])])]}),_:1},512)]}),_:1},8,["modelValue","onSubmit"])]}),_:1})}var M=a(57008),C=a.n(M),R=a(76080),h=a.n(R),A=a(45254),g=a.n(A),v=(a(89571),a(76921),a(13600),a(52776),a(37406),a(84433),a(44264),a(6123)),w={data:function(){return{config:{MARCREP:{renderHtml:function(e,r){return r("span",{},1===e.MARCREP?"R":"NR")}},MARCREQ:{renderHtml:function(e,r){return r("span",{},1===e.MARCREQ?"Si":"No")}},SUBFIELD:{component:"button",icon:["format_list_bulleted as definir"],definir:function(e,r){var a=this;return g()(h()().m(function n(){return h()().w(function(n){while(1)switch(n.n){case 0:return a.currentMarc21=r,a.openModalSubCampos=!0,n.n=1,a.getMarc({marccodref:e.MARCCOD});case 1:a.rowsSubCampo=n.v;case 2:return n.a(2)}},n)}))()},tooltip:{definir:"Definir"},dense:!0,flat:!0},ORDEN:{component:"input",type:"number",autoFocus:!0,autoSelect:!0,input:function(e){var r=this;return g()(h()().m(function a(){var n;return h()().w(function(a){while(1)switch(a.p=a.n){case 0:return a.p=0,n={marccod:e.MARCCOD,id:e.MARCCOD,orden:e.ORDEN},a.n=1,r.$http.put("api/HyoBmMarc/updateMarc",{params:n});case 1:return a.a(2,!0);case 2:return a.p=2,a.v,a.a(2,!1)}},a,null,[[0,2]])}))()}},ACTION:{component:"button",icon:["edit","delete"],delete:function(e,r){var a=this;return g()(h()().m(function e(){return h()().w(function(e){while(1)switch(e.n){case 0:return e.n=1,a.deleteMarc21(r,"nivel1");case 1:return e.a(2)}},e)}))()},edit:function(e,r){var a=this;return g()(h()().m(function n(){return h()().w(function(n){while(1)switch(n.n){case 0:a.currentMarc21=r,a.action="update",a.form.marccod=e.MARCCOD,a.form.marcrep=e.MARCREP,a.form.marcreq=e.MARCREQ,a.form.marcnom=e.MARCNOM,a.form.marceti=e.MARCETI,a.form.marcdes=e.MARCDES,a.openModalMarc21=!0;case 1:return n.a(2)}},n)}))()},tooltip:{delete:"Eliminar",edit:"Editar"},permisos:{edit:">1",delete:"===3"},flat:!0,dense:!0}},rows:[],fields:[{name:"MARCCOD",label:"Etiqueta",field:"MARCCOD",align:"center",sortable:!0},{name:"MARCNOM",label:"Nombre",field:"MARCNOM",align:"left",sortable:!0},{name:"MARCREP",label:"Repetible",field:"MARCREP",align:"center",sortable:!0},{name:"MARCREQ",label:"Requerido",field:"MARCREQ",align:"center",sortable:!0},{name:"SUBFIELD",label:"Subcampo",field:"SUBFIELD",align:"center"},{name:"ACTION",label:"Acciones",field:"ACTION",align:"center",width:80}]}}},S={data:function(){return{configSubCampo:{MARCREP:{renderHtml:function(e,r){return r("span",{},1===e.MARCREP?"R":"NR")}},MARCREQ:{renderHtml:function(e,r){return r("span",{},1===e.MARCREQ?"Si":"No")}},ACTION:{component:"button",icon:["edit","delete"],delete:function(e,r){var a=this;return g()(h()().m(function e(){return h()().w(function(e){while(1)switch(e.n){case 0:return e.n=1,a.deleteMarc21(r);case 1:return e.a(2)}},e)}))()},edit:function(e,r){var a=this;return g()(h()().m(function n(){return h()().w(function(n){while(1)switch(n.n){case 0:a.currentSubMarc21=r,a.action="updateSubCampo",a.form.marccod=e.MARCCOD,a.form.marcrep=e.MARCREP,a.form.marcreq=e.MARCREQ,a.form.marcnom=e.MARCNOM,a.form.marceti=e.MARCETI,a.form.marcdes=e.MARCDES,a.openModalMarc21=!0;case 1:return n.a(2)}},n)}))()},tooltip:{delete:"Eliminar",edit:"Editar"},flat:!0,dense:!0}},rowsSubCampo:[],fieldsSubCampo:[{name:"MARCCOD",label:"Etiqueta",field:"MARCCOD",align:"center",sortable:!0},{name:"MARCNOM",label:"Nombre",field:"MARCNOM",align:"left",sortable:!0},{name:"MARCREP",label:"Repetible",field:"MARCREP",align:"center",sortable:!0},{name:"MARCREQ",label:"Requerido",field:"MARCREQ",align:"center",sortable:!0},{name:"ACTION",label:"Acciones",field:"ACTION",align:"center",width:80}]}}},E=a(9736),k=a(3112),O=a(2739),q=a(57668),x=a(6083),V=a(88567),D=a(95718),N=a(39893),F={mixins:[w,S],components:{QInput:E.A,QCheckbox:k.A,QForm:O.A,sieEditor:x.A,QCard:V.A,QCardSection:D.A,QPage:v.Tu},data:function(){var e=this;return{sie:(0,q["default"])(),buttons:[{label:"Agregar",icon:"plus",click:function(){e.openMarc("nivel1")},permiso:">1"}],buttonsSubCampo:[{label:"Agregar",icon:"plus",click:function(){e.openMarc("nivel2")}}],action:"create",openModalSubCampos:!1,openModalMarc21:!1,currentMarc21:null,currentSubMarc21:{},form:{marccod:"",marcrep:0,marcreq:0,marcnom:"",marceti:"",marcdes:""}}},methods:{clear:function(){this.form.marccod="",this.form.marcrep=0,this.form.marcreq=0,this.form.marcnom="",this.form.marceti="",this.form.marcdes=""},required:function(e){return!!e||"Campo requerido"},validateEtiquetaSubCampo:function(e){var r=new RegExp("^".concat(this.currentMarc21.MARCCOD,"[aA-zZ0-9]{1}"),"g");return!!r.test(e)||"Etqiueta debe empezar por ".concat(this.currentMarc21.MARCCOD," y terminar con una letra o número")},max4Caracteres:function(e){return(0,N.maxCaracteres)(e,4)},max3Caracteres:function(e){return(0,N.maxCaracteres)(e,3)},deleteMarc21:function(e){var r=arguments,a=this;return g()(h()().m(function n(){var t,c,o;return h()().w(function(n){while(1)switch(n.p=n.n){case 0:return t=r.length>1&&void 0!==r[1]?r[1]:1,n.p=1,n.n=2,a.$confirmar("¿Estás seguro de eliminar el registro?","delete");case 2:if(c=n.v,!c){n.n=4;break}return n.n=3,a.$http.delete("api/HyoBmMarc/deleteMarc",{params:{marccod:e.MARCCOD}});case 3:"nivel1"===t?a.rows.splice(a.rows.indexOf(e),1):a.rowsSubCampo.splice(a.rowsSubCampo.indexOf(e),1);case 4:n.n=6;break;case 5:n.p=5,o=n.v,a.$notify(o.message,"warning");case 6:return n.a(2)}},n,null,[[1,5]])}))()},guardarMarc:function(){var e=this;return g()(h()().m(function r(){var a,n,t,c,o,u,l,i,s,m,d;return h()().w(function(r){while(1)switch(r.p=r.n){case 0:return r.n=1,e.$refs.marc21.validate();case 1:if(a=r.v,a){r.n=2;break}return r.a(2);case 2:if(r.p=2,n=C()({},e.form),"create"!==e.action){r.n=4;break}return n.marccodref=null,delete n.id,r.n=3,e.$http.post("api/HyoBmMarc/createMarc",{params:n});case 3:t=r.v,c=t.item,e.rows.unshift(c),r.n=10;break;case 4:if("createSubCampo"!==e.action){r.n=6;break}return n.marccodref=e.currentMarc21.MARCCOD,delete n.id,r.n=5,e.$http.post("api/HyoBmMarc/createMarc",{params:n});case 5:o=r.v,u=o.item,e.rowsSubCampo.unshift(u),r.n=10;break;case 6:if("update"!==e.action){r.n=8;break}return n.marccodref=n.marccod,n.id=n.marccod,r.n=7,e.$http.put("api/HyoBmMarc/updateMarc",{params:n});case 7:l=r.v,i=l.item,e.$refs.tbmarc21.updateRow(e.rows[e.rows.indexOf(e.currentMarc21)],i),r.n=10;break;case 8:if("updateSubCampo"!==e.action){r.n=10;break}return n.id=n.marccod,n.marccodref=e.currentMarc21.MARCCOD,r.n=9,e.$http.put("api/HyoBmMarc/updateMarc",{params:n});case 9:s=r.v,m=s.item,e.$refs.tbmarc21.updateRow(e.rowsSubCampo[e.rowsSubCampo.indexOf(e.currentSubMarc21)],m);case 10:e.openModalMarc21=!1,e.$notify("Datos grabados correctamente","success"),r.n=12;break;case 11:r.p=11,d=r.v,e.$notify(d.message,"warning");case 12:return r.a(2)}},r,null,[[2,11]])}))()},selectedMarc:function(e,r){this.currentMarc21=r},selectedSubMarc:function(e,r){this.currentSubMarc21=r},openMarc:function(){var e=arguments,r=this;return g()(h()().m(function a(){var n;return h()().w(function(a){while(1)switch(a.n){case 0:n=e.length>0&&void 0!==e[0]?e[0]:"nivel1",r.clear(),"nivel1"===n?r.action="create":(r.action="createSubCampo",r.form.marccod=r.currentMarc21.MARCCOD),r.openModalMarc21=!0;case 1:return a.a(2)}},a)}))()},getMarc:function(e){var r=this;return g()(h()().m(function a(){var n,t,c,o,u;return h()().w(function(a){while(1)switch(a.n){case 0:return n=e.marccod,t=void 0===n?null:n,c=e.marccodref,o=void 0===c?null:c,u={},t&&(u["marccod"]=t),o&&(u["marccodref"]=o),a.a(2,r.$http.get("api/HyoBmMarc/getMarc",{params:u}))}},a)}))()}},created:function(){var e=this;return g()(h()().m(function r(){return h()().w(function(r){while(1)switch(r.n){case 0:return r.n=1,e.getMarc({});case 1:e.rows=r.v;case 2:return r.a(2)}},r)}))()}},y=a(12807);const Q=(0,y.A)(F,[["render",b]]);var L=Q}}]);