"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[23183],{23183:function(e,o,a){a.r(o),a.d(o,{default:function(){return Se}});var t=a(61758),n=a(58790),s={ref:"audioOk",src:"statics/sound/ok.mp3"},i={ref:"audioInfo",src:"statics/sound/duplicate.mp3"},r={ref:"audioError",src:"statics/sound/error.mp3"},l={class:"row justify-around q-ma-xs q-card"},u={class:"col row justify-center"},c={class:"col row justify-end"},d={class:"column"},f={key:0,class:"row col"},p={key:0,class:"row"},m={class:"column justify-center"},A={key:1,class:"row"},h={class:"row q-pa-xs q-mb-sm col",style:{border:"1px solid black !important","border-radius":"3px"}},S={style:{"font-size":"0.8rem"}},v={class:"column justify-center"},E={key:1,class:"row col"},g={key:0,class:"row"},C={class:"column justify-center"},k={key:1,class:"row"},b={class:"row q-pa-xs q-mb-sm col",style:{border:"1px solid black !important","border-radius":"3px"}},O={style:{"font-size":"0.8rem"}},P={class:"column justify-center"},y={class:"column q-ma-xs"},D={class:"row"},L={class:"col q-card"},T={class:"row justify-center"},I={class:"column"},_={key:1,class:"col q-card"},F={class:"row"},M={class:"sublabel-turno"},N={class:"row"},U={class:"sublabel-turno"},$={class:"row"},q={class:"sublabel-turno"},H={class:"q-px-xs"},j={key:0},R={key:1},x={key:0},Q={key:1};function w(e,o){var a=(0,t.g2)("q-clock"),w=(0,t.g2)("q-select"),X=(0,t.g2)("q-btn"),Y=(0,t.g2)("q-popover"),G=(0,t.g2)("q-input"),V=(0,t.g2)("qr"),z=(0,t.g2)("q-toolbar-title"),W=(0,t.g2)("q-toolbar"),B=(0,t.g2)("sie-usuario"),K=(0,t.g2)("q-item-side"),Z=(0,t.g2)("q-item-main"),J=(0,t.g2)("q-item"),ee=(0,t.g2)("q-icon"),oe=(0,t.g2)("q-list"),ae=(0,t.g2)("q-page");return(0,t.uX)(),(0,t.Wv)(ae,{class:"asistencia-centralizada q-ma-sm"},{default:(0,t.k6)(function(){return[(0,t.Lk)("audio",s,null,512),(0,t.Lk)("audio",i,null,512),(0,t.Lk)("audio",r,null,512),(0,t.Lk)("div",l,[o[7]||(o[7]=(0,t.Lk)("div",{class:"col"},null,-1)),(0,t.Lk)("div",u,[(0,t.bF)(a,{style:{"font-size":"x-large"}})]),(0,t.Lk)("div",c,[e.permiteSalidaEstudiante||e.permiteSalidaPersonal?((0,t.uX)(),(0,t.Wv)(X,{key:0,icon:"cog",flat:"",dense:"",round:""},{default:(0,t.k6)(function(){return[(0,t.bF)(Y,null,{default:(0,t.k6)(function(){return[(0,t.Lk)("div",d,[e.permiteSalidaEstudiante?((0,t.uX)(),(0,t.CE)("div",f,[e.editarEstudiante?((0,t.uX)(),(0,t.CE)("div",p,[(0,t.bF)(w,{class:"q-if-outlined",options:e.tipoDiferenciado,modelValue:e.tipoSelectEstudiante,"onUpdate:modelValue":o[0]||(o[0]=function(o){return e.tipoSelectEstudiante=o}),"float-label":"Tipo Estudiante"},null,8,["options","modelValue"]),(0,t.Lk)("div",m,[(0,t.bF)(X,{flat:"",dense:"",round:"",icon:"close",onClick:o[1]||(o[1]=function(o){return e.editarEstudiante=!1}),style:{"font-size":"10px"}})])])):((0,t.uX)(),(0,t.CE)("div",A,[(0,t.Lk)("fieldset",h,[(0,t.Lk)("legend",S,(0,n.v_)(e.$t("Tipo Estudiante"))+" :",1),(0,t.Lk)("span",null,(0,n.v_)(e.modoDiferenciadoEstudiante),1)]),(0,t.Lk)("div",v,[(0,t.bF)(X,{class:"q-ml-sm",flat:"",dense:"",round:"",icon:"edit",onClick:o[2]||(o[2]=function(o){return e.editarEstudiante=!0}),style:{"font-size":"10px"}})])]))])):(0,t.Q3)("v-if",!0),e.permiteSalidaPersonal?((0,t.uX)(),(0,t.CE)("div",E,[e.editarPersonal?((0,t.uX)(),(0,t.CE)("div",g,[(0,t.bF)(w,{class:"q-if-outlined",options:e.tipoDiferenciado,modelValue:e.tipoSelectProfe,"onUpdate:modelValue":o[3]||(o[3]=function(o){return e.tipoSelectProfe=o}),"float-label":"Tipo Personal"},null,8,["options","modelValue"]),(0,t.Lk)("div",C,[(0,t.bF)(X,{flat:"",dense:"",round:"",icon:"close",onClick:o[4]||(o[4]=function(o){return e.editarPersonal=!1}),style:{"font-size":"10px"}})])])):((0,t.uX)(),(0,t.CE)("div",k,[(0,t.Lk)("fieldset",b,[(0,t.Lk)("legend",O,(0,n.v_)(e.$t("Tipo Personal"))+" :",1),(0,t.Lk)("span",null,(0,n.v_)(e.modoDiferenciadoPersonal),1)]),(0,t.Lk)("div",P,[(0,t.bF)(X,{class:"q-ml-sm",flat:"",dense:"",round:"",icon:"edit",onClick:o[5]||(o[5]=function(o){return e.editarPersonal=!0}),style:{"font-size":"10px"}})])]))])):(0,t.Q3)("v-if",!0)])]}),_:1})]}),_:1})):(0,t.Q3)("v-if",!0)])]),(0,t.Lk)("div",y,[(0,t.Lk)("div",D,[(0,t.Lk)("div",L,[(0,t.Lk)("div",T,[(0,t.bF)(G,{class:"no-bottom q-if-outlined txt-especial",modelValue:e.usuario,"onUpdate:modelValue":o[6]||(o[6]=function(o){return e.usuario=o}),autofocus:!0,"stack-label":"Usuario",onKeydown:e.registraPistola},null,8,["modelValue","onKeydown"])]),e.sinCamara?(0,t.Q3)("v-if",!0):((0,t.uX)(),(0,t.Wv)(V,{key:0,onLeeQr:e.leerRegistro,cargaAnterior:e.cargaAnterior},null,8,["onLeeQr","cargaAnterior"]))]),(0,t.Lk)("div",{class:(0,n.C4)(["col q-mx-sm column justify-center",{"q-card":!(e.permiteSalidaPersonal&&1===e.componenteSelect)}])},[(0,t.Lk)("div",I,[e.componenteSelect>0?((0,t.uX)(),(0,t.Wv)(W,{key:0},{default:(0,t.k6)(function(){return[(0,t.bF)(z,null,{default:(0,t.k6)(function(){return[(0,t.Lk)("span",null,"Asistencia de "+(0,n.v_)(e.tipoDesc),1)]}),_:1})]}),_:1})):(0,t.Q3)("v-if",!0),e.permiteSalidaPersonal&&1===e.componenteSelect?((0,t.uX)(),(0,t.CE)("div",_,[e.infoPersona.message?((0,t.uX)(),(0,t.Wv)(oe,{key:0},{default:(0,t.k6)(function(){return[(0,t.bF)(J,null,{default:(0,t.k6)(function(){return[(0,t.bF)(K,{class:"q-mr-xs"},{default:(0,t.k6)(function(){return[(0,t.bF)(B,{profcod:e.infoTurno.PROFCOD},null,8,["profcod"])]}),_:1}),(0,t.bF)(Z,null,{default:(0,t.k6)(function(){return[(0,t.Lk)("b",null,(0,n.v_)(e.infoPersona.message),1)]}),_:1}),(0,t.bF)(K,{class:"column items-end",right:""},{default:(0,t.k6)(function(){return[(0,t.Lk)("div",F,[o[8]||(o[8]=(0,t.Lk)("b",{class:"sublabel-turno"},"Fecha: ",-1)),(0,t.Lk)("span",M,(0,n.v_)(e.date(e.infoTurno.F_ASISTENCIA,"DD/MM/YYYY")),1)]),(0,t.Lk)("div",N,[o[9]||(o[9]=(0,t.Lk)("b",{class:"sublabel-turno"},"Ingreso: ",-1)),(0,t.Lk)("span",U,(0,n.v_)(e.date(e.infoTurno.H_INGRESO,"hh:mm a")),1)]),(0,t.Lk)("div",$,[o[10]||(o[10]=(0,t.Lk)("b",{class:"sublabel-turno"},"Salida: ",-1)),(0,t.Lk)("span",q,(0,n.v_)(e.date(e.infoTurno.H_SALIDA,"hh:mm a")),1)])]}),_:1})]}),_:1}),e.infoTurno.ID_TIPO?((0,t.uX)(),(0,t.Wv)(J,{key:0,style:(0,n.Tr)({"background-color":e.dataTipos[e.infoTurno.ID_TIPO].COLOR})},{default:(0,t.k6)(function(){return[(0,t.bF)(Z,null,{default:(0,t.k6)(function(){return[o[11]||(o[11]=(0,t.Lk)("b",{class:"q-px-xs"},"Estado Actual",-1)),(0,t.bF)(ee,{class:"q-px-xs",name:e.dataTipos[e.infoTurno.ID_TIPO].ICONO},null,8,["name"]),(0,t.Lk)("span",H,(0,n.v_)(e.dataTipos[e.infoTurno.ID_TIPO].DESCRIPCION),1)]}),_:1})]}),_:1},8,["style"])):(0,t.Q3)("v-if",!0),e.dataTipos[e.infoTurno.ID_TIPO]?((0,t.uX)(),(0,t.Wv)(J,{key:1},{default:(0,t.k6)(function(){return[(0,t.bF)(K,{class:"q-mr-xs col"},{default:(0,t.k6)(function(){return[e.infoTurno.FH_INGRESO?((0,t.uX)(),(0,t.CE)("b",j,"Ingreso: ")):(0,t.Q3)("v-if",!0),e.infoTurno.FH_INGRESO?((0,t.uX)(),(0,t.CE)("span",R,(0,n.v_)(e.date(e.infoTurno.FH_INGRESO,"DD/MM/YYYY hh:mm a")),1)):(0,t.Q3)("v-if",!0)]}),_:1}),(0,t.bF)(K,{class:"q-mr-xs col"},{default:(0,t.k6)(function(){return[e.infoTurno.FH_SALIDA?((0,t.uX)(),(0,t.CE)("b",x,"Salida: ")):(0,t.Q3)("v-if",!0),e.infoTurno.FH_SALIDA?((0,t.uX)(),(0,t.CE)("span",Q,(0,n.v_)(e.date(e.infoTurno.FH_SALIDA,"DD/MM/YYYY hh:mm a")),1)):(0,t.Q3)("v-if",!0)]}),_:1})]}),_:1})):(0,t.Q3)("v-if",!0)]}),_:1})):(0,t.Q3)("v-if",!0)])):((0,t.uX)(),(0,t.Wv)((0,t.$y)(e.componentes[e.componenteSelect]),{key:2,class:"col","keep-alive":"",onLogout:e.logout,usucod:e.usuario,profcod:e.profcod,profnom:e.profnom,modoIng:2,isQR:e.camara,dataAsistencia:e.dataAsistenciaAlumno,tipoSelect:"E"===e.tipo?e.tipoSelectEstudiante:e.tipoSelectProfe,onLoguear:e.validarLogin,automarca:!0},null,40,["onLogout","usucod","profcod","profnom","isQR","dataAsistencia","tipoSelect","onLoguear"]))])],2)])])]}),_:1})}var X=a(99550),Y=a.n(X),G=a(57008),V=a.n(G),z=a(63053),W=a.n(z),B=(a(23825),a(10239),a(50310),a(90095),a(83190),a(27153),a(66307),a(13715),a(24066),a(6123)),K=a(80660),Z=a(65818),J=a(23527),ee=a(57668),oe=a(982),ae=a(66132),te={class:"col column justify-center items-center q-px-md"};function ne(e,o){var a=(0,t.g2)("sie-vacio");return(0,t.uX)(),(0,t.CE)("div",te,[(0,t.bF)(a,{class:"col column",subtitle:"Debe registrar una asistencia",icon:"person"})])}var se=a(80340),ie={components:{sieVacio:se.A}},re=a(12807);const le=(0,re.A)(ie,[["render",ne]]);var ue=le,ce=a(69027),de=a(74874),fe=a(24974),pe=a(18105),me=a(81288),Ae={components:{QClock:Z.A,qr:J.A,rAsistenciaPersonal:ae.A,asistenciaVacio:ue,QToolbar:B.ZV,QToolbarTitle:B.r_,rAsistenciaEstudiante:de.A,QSelect:B.Si,QInput:B.ie,sieUsuario:fe.A,QPopover:B.VM,QPage:B.Tu,QBtn:B.Il,QList:B.Mb,QItem:B.H0,QItemSide:B.n1,QItemMain:B.mF,QIcon:B.bP},data:function(){return{infoProfes:{},dataAlumnos:{},infoTablets:[],leeTablets:["0516","D004"].indexOf((0,ee["default"])().colcod)>=0,cargaAnterior:!1,componentes:["asistenciaVacio","rAsistenciaPersonal","rAsistenciaEstudiante"],tipoDesc:null,usuario:null,clave:null,profcod:null,profnom:null,camara:!0,componenteSelect:0,modManual:1,tipoSelectEstudiante:0,tipoSelectProfe:0,dataSalones:{},estados:{},infoTurno:{},infoPersona:{},dataTipos:{},dataAsistenciaAlumno:{},sinCamara:!1,editarEstudiante:!1,editarPersonal:!1,permiteSalidaEstudiante:!1,permiteSalidaPersonal:!1,tipo:"",tipoDiferenciado:[{label:"REGISTRAR INGRESO",value:0},{label:"REGISTRAR SALIDA",value:1}]}},methods:{date:pe.Ay,grabarRegistro:function(){var e=this;K.$http.post("api/HyoApasistencia/saveIngreso",this.infoTurno).then(function(o){var a=o.json;"success"===a.type&&(e.cargarAsistencia(e.infoProfes[e.profcod.toUpperCase()],!0),e.componenteSelect=1),(0,oe["default"])(e.$t("mensajes."+a.msg),a.type),e.limpiarData()})},limpiarData:function(){var e=this;setTimeout(function(){e.infoTurno={},e.infoPersona={},e.profcod=null,e.componenteSelect=0},3e3)},cargarAsistencia:function(e,o){var a=this;this.infoTurno={ID:null,H_INGRESO:null,H_SALIDA:null,PROFCOD:null},K.$http.get("api/HyoApturnoespecial/obtTurnoPersona",{params:{profcod:e}}).then(function(t){var n=t.json;"object"===W()(n)?(a.infoTurno=n,a.infoTurno.isSalida=1===a.tipoSelectProfe,a.profcod=e,0===a.tipoSelectProfe?n.FH_SALIDA?((0,oe["default"])("Ya existe un registro de salida","error"),a.componenteSelect=1):n.FH_INGRESO?o||((0,oe["default"])("Ya existe un registro de ingreso","error"),a.componenteSelect=1):a.grabarRegistro():n.FH_INGRESO?n.FH_SALIDA?(o||(0,oe["default"])("Ya existe un registro de salida","error"),a.limpiarData()):K.$http.post("api/HyoApasistencia/saveSalida",a.infoTurno).then(function(o){var t=o.json;(0,oe["default"])(a.$t("mensajes."+t.msg),t.type),"success"===t.type&&a.cargarAsistencia(e,!0),a.componenteSelect=1}):((0,oe["default"])("No existe un registro de ingreso","error"),a.componenteSelect=1),a.tipoDesc="Personal"):(0,oe["default"])(n,"error")})},asistenciaPersonal:function(e){var o=this;this.tipo="P",this.usuario=e.codigo,K.$http.post("api/HyoApasistencia/validarIngreso",e).then(function(e){var a=e.json;"Ok"===a.estado?(o.$refs.audioOk.play(),o.profnom=a.message,o.profcod=a.profcod,o.permiteSalidaPersonal?(o.componenteSelect=1,o.infoPersona=a,o.cargarAsistencia(a.profcod)):(o.profcod=a.profcod,(0,oe["default"])("Bienvenido "+a.message),o.componenteSelect=1,o.tipoDesc="Personal",o.camara=!0)):"e0003"!==a.tag?(o.$refs.audioInfo.play(),(0,oe["default"])(a.message,"error")):o.$refs.audioError.play()})},asistenciaAlumnos:function(e,o){var a,t,n=this;if(this.tipo="E",this.tipoDesc="Estudiante",a=this.dataAlumnos[e].ALUCOD,this.dataAlumnos[e].NEMO)if(this.dataSalones[this.dataAlumnos[e].NEMO].BIMECOD){this.componenteSelect=2,t=this.dataAlumnos[e].NEMO,this.dataAsistenciaAlumno=V()({},this.dataAlumnos[e]);var s={alucod:a,nemo:t,bimecod:this.dataSalones[t].BIMECOD,tardanzagen:this.dataSalones[t].TARDANZAGEN,modo:o},i=0===this.tipoSelectEstudiante?"registraAsistencia":"registraSalida";K.$http.get("api/HyoHorasis/".concat(i),{params:s}).then(function(e){var o=e.json;(0,oe["default"])(n.$t("regAsistencia."+o.mensaje)),n.dataAsistenciaAlumno=V()(V()(V()(V()({},n.dataAsistenciaAlumno),o.data),n.estados[o.data.ESTADOCOD]),n.dataSalones[t]),n.$refs.audioOk.play();var a=[n.dataAsistenciaAlumno.ALUCOD];0===n.tipoSelectEstudiante&&K.$http.get("api/HyoHorasis/enviarAlerta",{params:{alucods:a}}).then(function(e){e.json})}).catch(function(e){var o=e.error;"e0002"!==o.message?((0,oe["default"])(n.$t("regAsistencia."+o.message),"error"),n.dataAsistenciaAlumno=V()(V()(V()({},n.dataAsistenciaAlumno),o.params),n.estados[o.params.ESTADOCOD]),n.$refs.audioOk.play(),"m0001"===o.message||"m0008"===o.message?n.$refs.audioInfo.play():n.$refs.audioError.play()):(n.dataAsistenciaAlumno={},(0,ce.dialogConfirm)({title:n.$t("mensajes."+o.message),cancel:!1}),n.$refs.audioError.play())})}else(0,oe["default"])(this.$t("regAsistencia.m0006"),"error"),this.$refs.audioInfo.play();else(0,oe["default"])(this.$t("regAsistencia.m0005"),"error"),this.$refs.audioInfo.play()},asistenciaTablet:function(e){var o=this;K.$http.get("api/HyoTabletsprestamo/getPrestamoActivo",{params:{ID_TABLET:e}}).then(function(e){var a=e.json;if(a.length>0){var t=a[0].USUCOD;if(a[0].ID_REGISTRO)o.$refs.audioInfo.play(),(0,oe["default"])("Ya se registro asistencia con esta tablet","info");else{var n=a[0].ID_PRESTAMO;K.$http.post("api/HyoAsistenciaprestamo/saveAsistencia",{ID_PRESTAMO:n}).then(function(e){var a=e.json;a&&o.leerRegistro(t,o.sinCamara,"T")})}}else(0,oe["default"])("La tablet seleccionada no tiene un prestamo activo","error"),o.$refs.audioInfo.play()})},logout:function(){this.usuario=null,this.profcod=null,this.profnom=null,this.componenteSelect=0,this.camara=!1},validarLogin:function(e,o,a,t){this.usuario=o,this.profcod=e,this.profnom=a,this.componenteSelect=1,this.camara=!t},leerRegistro:function(e,o,a){var t;if(e)if(e=e.split("|")[0].toUpperCase(),this.infoProfes[e]?(e=this.infoProfes[e],t="P"):this.dataAlumnos[e]?(t="E",e=this.dataAlumnos[e]["ALUCOD"],a||(a="C")):this.leeTablets&&this.infoTablets.indexOf(parseInt(e))>=0&&(t="T"),t)switch(t){case"P":this.asistenciaPersonal({profcod:e});break;case"E":this.asistenciaAlumnos(e,a);break;case"T":this.asistenciaTablet(e);break}else(0,oe["default"])("El codigo ingresado no se encuentra registrado","error"),this.$refs.audioError.play();else this.sinCamara=o},registraPistola:function(e){13===e.which&&(this.leerRegistro(this.usuario),this.usuario=null)}},computed:{modoDiferenciadoEstudiante:function(){return this.tipoDiferenciado[this.tipoSelectEstudiante].label},modoDiferenciadoPersonal:function(){return this.tipoDiferenciado[this.tipoSelectProfe].label},isGreater:function(){return(0,me.isGreater)()}},watch:{tipoSelectEstudiante:function(e){this.$http.put("api/HyoControl/updateControl",{campo:"alumnoES",numero:e})},tipoSelectProfe:function(e){this.$http.put("api/HyoControl/updateControl",{campo:"personalES",numero:e})}},created:function(){var e=this;Promise.all([K.$http.get("api/HyoHorasis/validacionesIniciales"),K.$http.get("api/HyoProfes/obtListadoProfecActivos",{params:{todos:!0}})]).then(function(o){var a=Y()(o,2),t=a[0],n=a[1];n.json.forEach(function(o){var a=o.PROFCOD,t=o.USUCOD;e.infoProfes[a]=a,e.infoProfes[t]=a}),t.json.alumnos.forEach(function(o){e.dataAlumnos[o.ALUCOD]={ALUCOD:o.ALUCOD,NEMO:o.NEMO,USUCOD:o.USUCOD,NOMCOMP:o.NOMCOMP,FECNAC:o.FECNAC,ES_CUMPLEANOS:o.ES_CUMPLEANOS},e.dataAlumnos[o.USUCOD]={ALUCOD:o.ALUCOD,NEMO:o.NEMO,USUCOD:o.USUCOD,NOMCOMP:o.NOMCOMP,FECNAC:o.FECNAC,ES_CUMPLEANOS:o.ES_CUMPLEANOS},e.dataAlumnos[o.DOCIDENRO]={ALUCOD:o.ALUCOD,NEMO:o.NEMO,USUCOD:o.USUCOD,NOMCOMP:o.NOMCOMP,FECNAC:o.FECNAC,ES_CUMPLEANOS:o.ES_CUMPLEANOS}}),e.dataSalones=t.json.dataSalones,e.estados=t.json.estados,e.permiteSalidaEstudiante=t.json.isSalida,t.json.isSalida&&K.$http.get("api/HyoControl/obtCodigoActualPorCampo",{params:{campo:"alumnoES"}}).then(function(o){e.tipoSelectEstudiante=parseInt(o.json)}),K.$http.get("api/HyoControl/obtCodigoActualPorCampo",{params:{campo:"personalES"}}).then(function(o){var a=o.json;e.tipoSelectProfe=parseInt(a)}),K.$http.get("api/HyoAporden/getOrden",{params:{soloActivos:!0}}).then(function(o){var a=o.json;a.forEach(function(o){"diferenciado"===o.CAMPO&&(e.permiteSalidaPersonal=!0)})}),K.$http.get("api/HyoAptipos/obtInfo").then(function(o){var a=o.json;a.forEach(function(o){e.dataTipos[o.ID_TIPO]=o})}),e.leeTablets&&K.$http.get("api/HyoTablets/getTablets").then(function(o){var a=o.json;a.info.forEach(function(o){e.infoTablets.push(o.ID_TABLET)})})})}};const he=(0,re.A)(Ae,[["render",w]]);var Se=he}}]);