"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[99404],{99404:function(i,t,o){o.r(t),o.d(t,{default:function(){return U}});var e=o(58790),n=o(61758),r={class:(0,e.C4)({"col-md-12 col-xl-9":!0})};function a(i,t){var o=(0,n.g2)("q-option-group"),a=(0,n.g2)("q-icon"),l=(0,n.g2)("q-item-side"),s=(0,n.g2)("q-item-tile"),u=(0,n.g2)("q-chip"),d=(0,n.g2)("q-item-main"),c=(0,n.g2)("sie-usuario"),m=(0,n.g2)("q-item"),f=(0,n.g2)("q-list"),h=(0,n.g2)("q-card"),g=(0,n.g2)("sie-vacio"),p=(0,n.g2)("ver"),v=(0,n.g2)("q-page");return(0,n.uX)(),(0,n.Wv)(v,{class:"row bg-white-mobile"},{default:(0,n.k6)(function(){return[(0,n.Lk)("div",{class:(0,e.C4)(["overflow-auto",{"col-md-4 col-0":i.viewForm,"col-12":!i.viewForm}])},[(0,n.Lk)("div",r,[(0,n.bF)(o,{class:"q-if-outlined",modelValue:i.tipo,"onUpdate:modelValue":t[0]||(t[0]=function(t){return i.tipo=t}),options:i.tipoFormularios,color:"primary",inline:"",onInput:t[1]||(t[1]=function(t){return i.cambiarDisponible(i.tipo)})},null,8,["modelValue","options"])]),(0,n.bF)(h,{class:"q-ma-sm-sm q-card-mobile"},{default:(0,n.k6)(function(){return[(0,n.bF)(f,{class:"q-pa-none",separator:"",link:""},{default:(0,n.k6)(function(){return[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(i.forms,function(t,o){return(0,n.uX)(),(0,n.Wv)(m,{key:o,onClick:function(o){return i.clickDefault(t.id,t.dirigido)},class:(0,e.C4)({"q-item-active":i.id===t.id})},{default:(0,n.k6)(function(){return[(0,n.bF)(l,null,{default:(0,n.k6)(function(){return[(0,n.Lk)("div",{class:"q-item-icon q-item-inverted flex flex-center",style:(0,e.Tr)({"background-color":t.color})},[(0,n.bF)(a,{name:t.icon},null,8,["name"])],4)]}),_:2},1024),(0,n.bF)(d,null,{default:(0,n.k6)(function(){return[(0,n.bF)(s,{label:"",lines:"1"},{default:(0,n.k6)(function(){return[(0,n.eW)((0,e.v_)(t.title),1)]}),_:2},1024),(0,n.bF)(s,{sublabel:"",lines:"1"},{default:(0,n.k6)(function(){return[(0,n.eW)((0,e.v_)(t.subtitle),1)]}),_:2},1024),(0,n.bF)(s,{sublabel:""},{default:(0,n.k6)(function(){return[(0,n.bF)(u,{small:"",color:"secondary"},{default:(0,n.k6)(function(){return[(0,n.Lk)("div",null,"Vigencia: "+(0,e.v_)(t.start),1),(0,n.Lk)("div",null,(0,e.v_)(t.end),1)]}),_:2},1024)]}),_:2},1024)]}),_:2},1024),t.usucod?((0,n.uX)(),(0,n.Wv)(l,{key:0,right:""},{default:(0,n.k6)(function(){return[(0,n.bF)(c,{usucod:t.usucod},null,8,["usucod"])]}),_:2},1024)):(0,n.Q3)("v-if",!0)]}),_:2},1032,["onClick","class"])}),128))]}),_:1})]}),_:1}),i.forms.length<1?((0,n.uX)(),(0,n.Wv)(g,{key:0,class:(0,e.C4)({"col-md-4 col-0":i.id,"col-12":!i.id&&i.forms.length<1}),title:"intranet.formularios.noExistenFormularios"},null,8,["class"])):(0,n.Q3)("v-if",!0)],2),i.viewForm?((0,n.uX)(),(0,n.Wv)(p,{key:0,class:"col-md-8 col-12 q-pa-sm-sm overflow-auto",id:i.id,dirigido:i.dirigido},null,8,["id","dirigido"])):(0,n.Q3)("v-if",!0)]}),_:1})}o(10239),o(11777);var l=o(80660),s=o(13813),u=o(99637),d=o(78786),c=o(80340),m=o(6123),f=o(24974),h=o(81288),g={class:"column relative-position"},p={key:0,class:"row"},v={class:"col"};function b(i,t){var o=(0,n.g2)("sie-select"),e=(0,n.g2)("detail-form"),r=(0,n.g2)("formly"),a=(0,n.g2)("sie-vacio"),l=(0,n.g2)("q-spinner-oval"),s=(0,n.g2)("q-inner-loading");return(0,n.uX)(),(0,n.CE)("div",g,[i.valid&&i.combo&&i.destinatarios.length&&!i.matricula?((0,n.uX)(),(0,n.CE)("div",p,[(0,n.Lk)("div",v,[(0,n.bF)(o,{type:"outlined",modelValue:i.usucod,"onUpdate:modelValue":t[0]||(t[0]=function(t){return i.usucod=t}),options:i.destinatarios,val:"DEST_USUCOD",label:"DEST_USUNOM",placeholder:i.label,onSelected:i.loadForm},null,8,["modelValue","options","placeholder","onSelected"])])])):(0,n.Q3)("v-if",!0),i.valid?((0,n.uX)(),(0,n.Wv)(r,{key:1,class:"col",data:i.form,"is-submit":"",onSubmit:i.submit,onStart:i.start,onEnd:i.end,print:!i.esOtros&&i.final&&i.finalTest,ref:"formly",disableComment:!0},{default:(0,n.k6)(function(){return[i.detail?((0,n.uX)(),(0,n.Wv)(e,{key:0,id:i.id,"only-student":i.onlyStudent},null,8,["id","only-student"])):(0,n.Q3)("v-if",!0)]}),_:1},8,["data","onSubmit","onStart","onEnd","print"])):((0,n.uX)(),(0,n.Wv)(a,{key:2,class:"col",title:i.message,icon:i.icon},null,8,["title","icon"])),(0,n.bF)(s,{visible:i.loading},{default:(0,n.k6)(function(){return[(0,n.bF)(l,{size:"50px",color:"primary"})]}),_:1},8,["visible"])])}var F=o(93616),I=o(57668),O=o(982),_=o(60167),k=o(5106),T="intranet.formularios.noMostrarFormulario",S="info",D={components:{QInnerLoading:m.SQ,QSpinnerOval:m.VA,sieVacio:c.A,sieSelect:F.A,formly:_.A,detailForm:k.A},props:{id:{type:Number,required:!0},dirigido:{type:String},detail:{type:Boolean},matricula:{type:Boolean},onlyStudent:{type:Boolean,default:!1},usucodDirigido:String},data:function(){return{form:{},loading:!1,valid:!1,esOtros:(0,I["default"])().esOtros,message:T,icon:S,combo:!0,label:"usuario.nombre",destinatarios:[],usucod:null,isSave:!1,endQuiz:!1,endTime:!1,final:!1,finalTest:!1}},methods:{buildForm:function(i,t){var o=this;"number"===typeof i&&0!==i?(this.loading=!0,this.valid=!1,this.form={},l.$http.get("api/HyoFormulario/getHistory",{params:{id:i,detail:this.detail,matricula:this.matricula,usucod:t,dirigido:this.dirigido}}).then(function(i){return o.final=i.final,o.isSave=i.final,o.finalTest=i.finalTest,o.$nextTick(function(){o.form=i}),(0,h.constantes)(["REGISTRO_DE_NOTAS_VUE"])}).then(function(t){return l.$http.get("api/HyoFormulario/getDestinatarios",{params:{id:i,dirigido:o.dirigido,nr:t["REGISTRO_DE_NOTAS_VUE"],matricula:o.matricula}})}).then(function(i){o.valid=!0,o.loading=!1,i.length>0?(o.combo=!(null===i[0].TIPCOD_DIRIGIDO),"005"===i[0].TIPCOD_DIRIGIDO?o.label="estudiante":"006"===i[0].TIPCOD_DIRIGIDO&&(o.label="profesor"),i.unshift({DEST_USUCOD:null,DEST_USUNOM:"Seleccionar"}),o.destinatarios=i):(o.valid=!1,o.message="No disponible"),o.detail&&(o.valid=!0,o.combo=!1)}).catch(function(i){o.valid=!1,o.loading=!1,i&&i.error&&i.error.params?(o.message=i.error.message||T,i.error.params.success?(o.icon="timer_on",o.valid=!0,o.$nextTick(function(){o.form={error:!0,final:!0,continue:!0,message:o.message,time:i.error.params.time}})):(o.icon="timer_off",o.$nextTick(function(){o.form={}}))):(o.message=T,o.icon=S,o.$nextTick(function(){o.form={}}))})):(this.valid=!1,this.form={})},submit:function(i){var t=this;if(this.combo&&this.usucod||!this.combo){this.loading=!0;var o=this.form&&this.form.idHistoriaUsuario,e=this.usucod;this.form={},l.$http.post("api/HyoFormulario/save",{idForm:this.id,idUser:o,fields:i,dirigido:e,matricula:this.matricula,endQuiz:this.endQuiz}).then(function(i){t.loading=!1,t.valid=!0,t.isSave=!0,t.final=i.final,t.finalTest=i.finalTest,t.$nextTick(function(){t.form=i})}).catch(function(i){t.isSave=!1,t.loading=!1,t.form={}})}else this.isSave=!1,(0,O["default"])("Seleccione un "+this.label,"warning")},start:function(){var i=this;this.loading=!0,l.$http.post("api/HyoFormulario/startForm",{id:this.id,dirigido:this.usucod}).then(function(t){i.valid=!0,i.loading=!1,i.$nextTick(function(){i.form=t})}).catch(function(t){t&&t.error.message&&(i.message=t.error.message||T),i.valid=!1,i.loading=!1,i.$nextTick(function(){i.form={}})})},end:function(){var i=this;this.form&&this.form.error?((0,O["default"])("Se cargará el examen","info"),setTimeout(function(){i.matricula&&i.dirigido&&(i.usucod=i.usucodDirigido),i.buildForm(i.id,i.usucod)},200)):(this.$refs.formly.endTime=!0,this.$refs.formly.submit(),this.$refs.formly.secuence&&this.loadForm(),(0,O["default"])("Terminó el examen","info"))},loadForm:function(){this.buildForm(this.id,this.usucod)}},created:function(){this.matricula&&this.dirigido&&(this.usucod=this.usucodDirigido),this.buildForm(this.id,this.usucod)},watch:{id:function(i){this.buildForm(this.id),this.usucod=null}}},y=o(12807);const C=(0,y.A)(D,[["render",b]]);var R=C,q={props:{id:{type:Number},dirigido:{type:String}},components:{sieVacio:c.A,QChip:m.wQ,QOptionGroup:m.EX,sieUsuario:f.A,isGreater:h.isGreater,ver:R,QPage:m.Tu,QCard:m.C$,QList:m.Mb,QItem:m.H0,QItemSide:m.n1,QIcon:m.bP,QItemMain:m.mF,QItemTile:m.lp},data:function(){return{forms:[],tipo:"",tipoFormularios:[{value:1,label:"Disponibles"},{value:2,label:"Realizados"}],viewForm:!1}},computed:{isGreater:function(){return(0,h.isGreater)()}},methods:{getForms:function(){var i=this;this.loadForms=l.$http.get("api/HyoFormulario/obtFormulariosDisponibles",{params:{q:!0,available:this.tipo,tipo:6}}).catch(function(i){return console.error(i),{json:[]}}).then(function(t){var o=t.json;i.loading=!1;var e=[];(0,u["default"])(o,function(i){var t=(0,d["default"])(e,i.ID_HISTORIA_FORMULARIO,{key:"ID_HISTORIA_FORMULARIO"});t>=0?null!==i.TIPCOD_DIRIGIDO&&(e[t]=i):e.push(i)}),i.forms=(0,s["default"])(e,function(i){return{id:i["ID_HISTORIA_FORMULARIO"],type:i["ID_TIPO_FORMULARIO"],title:i["TITULO"],subtitle:i["DESCRIPCION"],start:i["FORMATO_INICIO"],end:i["FORMATO_FIN"],icon:i["ICONO"],color:i["COLOR"],usucod:!!i["POR_HIJO"]&&i["DEST_USUCOD"],dirigido:i["TIPCOD_DIRIGIDO"]}})})},ver:function(i,t){this.$router.push({name:"intranet.declaracionjurada",params:{id:i,dirigido:t}})},clickDefault:function(i,t){this.viewForm=!0,this.ver(i,t)},cambiarDisponible:function(i){this.viewForm=!1,this.getForms()}},created:function(){this.tipo=1,this.getForms()}};const Q=(0,y.A)(q,[["render",a]]);var U=Q}}]);