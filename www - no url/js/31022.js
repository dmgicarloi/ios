"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[31022],{31022:function(e,n,t){t.r(n),t.d(n,{default:function(){return te}});var o=t(61758),a=t(29104),r={class:"row q-ma-xs q-col-gutter-sm"},s={class:"col-xs-12 col-lg-6"},l={class:"row q-ma-xs q-col-gutter-sm"},i={class:"col-xs-3"},c={class:"col-xs-3"},u={class:"col-xs-6"},d={class:"row q-ma-xs q-col-gutter-sm"},p={key:0,class:"col-xs-3"},f={key:1,class:"col-xs-3"},v={class:"col-xs-3"},m={key:2,class:"col-xs-3"},g={class:"row q-ma-xs q-col-gutter-sm"},h={class:"col-xs-12 col-lg-12"},C={class:"col-xs-12 col-lg-6"};function A(e,n){var t=(0,o.g2)("pageHeader"),A=(0,o.g2)("q-separator"),b=(0,o.g2)("tesoreriaLoading"),E=(0,o.g2)("q-select"),w=(0,o.g2)("q-date"),D=(0,o.g2)("q-popup-proxy"),I=(0,o.g2)("q-icon"),O=(0,o.g2)("q-input"),P=(0,o.g2)("q-chip-table"),S=(0,o.g2)("sie-grid"),N=(0,o.g2)("footer-grid"),T=(0,o.g2)("q-card-section"),M=(0,o.g2)("visorMensaje"),R=(0,o.g2)("q-card");return(0,o.uX)(),(0,o.Wv)(R,{class:"layout-v1 my-card",flat:"",bordered:""},{default:(0,o.k6)(function(){return[(0,o.bF)(t,{tabs:e.tabs,componente:e.pageHeader.componente,botones:e.pageHeader.botones,nivelAcceso:e.pageHeader.nivelAcceso,title:e.pageHeader.title,useTab:"",onActionTab:e.changeTab},null,8,["tabs","componente","botones","nivelAcceso","title","onActionTab"]),(0,o.bF)(A),(0,o.bF)(b,{modelValue:e.loading.showLoading,total:e.loading.total,procesados:e.loading.procesados,label:"Enviando"},null,8,["modelValue","total","procesados"]),(0,o.bo)((0,o.bF)(T,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",r,[(0,o.Lk)("div",s,[(0,o.Lk)("div",l,[(0,o.Lk)("div",i,[(0,o.bF)(E,{label:"Perfil","option-label":"label","option-value":"value",options:e.perfiles,modelValue:e.selectPerfil,"onUpdate:modelValue":n[0]||(n[0]=function(n){return e.selectPerfil=n}),onInput:e.getPerPerfil},null,8,["options","modelValue","onInput"])]),(0,o.Lk)("div",c,[(0,o.bF)(E,{label:"Estado","option-label":"label","option-value":"value",options:e.estadoPersona,modelValue:e.selectEstadoPersona,"onUpdate:modelValue":n[1]||(n[1]=function(n){return e.selectEstadoPersona=n}),onInput:e.getDeudores},null,8,["options","modelValue","onInput"])]),(0,o.Lk)("div",u,[(0,o.bF)(E,{class:"truncate-label",label:"Persona","option-label":"label","option-value":"value",options:e.personas,modelValue:e.selectPersona,"onUpdate:modelValue":n[2]||(n[2]=function(n){return e.selectPersona=n}),onInput:e.getDeudores},null,8,["options","modelValue","onInput"])])]),(0,o.Lk)("div",d,[e.selectPerfil===e.PERFIL_ALUMNO?((0,o.uX)(),(0,o.CE)("div",p,[(0,o.bF)(E,{label:"Nivel",options:e.niveles,"option-label":"label","option-value":"value",modelValue:e.selectNivel,"onUpdate:modelValue":n[3]||(n[3]=function(n){return e.selectNivel=n}),onInput:e.getGrados},null,8,["options","modelValue","onInput"])])):(0,o.Q3)("v-if",!0),e.selectPerfil===e.PERFIL_ALUMNO?((0,o.uX)(),(0,o.CE)("div",f,[(0,o.bF)(E,{label:"Grado","option-label":"label","option-value":"value",options:e.grados,modelValue:e.selectGrado,"onUpdate:modelValue":n[4]||(n[4]=function(n){return e.selectGrado=n}),onInput:e.getSecciones},null,8,["options","modelValue","onInput"])])):(0,o.Q3)("v-if",!0),(0,o.Lk)("div",v,[(0,o.bF)(E,{label:"Año",options:e.anios,"option-label":"label","option-value":"value",modelValue:e.selectAnio,"onUpdate:modelValue":n[5]||(n[5]=function(n){return e.selectAnio=n}),onInput:e.getDeudores},null,8,["options","modelValue","onInput"])]),e.filtroPorMes?(0,o.Q3)("v-if",!0):((0,o.uX)(),(0,o.CE)("div",m,[(0,o.bF)(O,{"reverse-fill-mask":"",maxlength:"10",mask:"##/##/####",label:"Fecha Vencimiento",modelValue:e.selectDia,"onUpdate:modelValue":n[8]||(n[8]=function(n){return e.selectDia=n})},{append:(0,o.k6)(function(){return[(0,o.bF)(I,{class:"cursor-pointer",name:"date_range"},{default:(0,o.k6)(function(){return[(0,o.bF)(D,{ref:"qDateProxy1","transition-show":"scale","transition-hide":"scale"},{default:(0,o.k6)(function(){return[(0,o.bF)(w,{mask:"DD/MM/YYYY",modelValue:e.selectDia,"onUpdate:modelValue":n[6]||(n[6]=function(n){return e.selectDia=n}),onInput:n[7]||(n[7]=function(n){return e.closeModalCalendar("qDateProxy1")})},null,8,["modelValue"])]}),_:1},512)]}),_:1})]}),_:1},8,["modelValue"])]))]),(0,o.Lk)("div",g,[(0,o.Lk)("div",h,[(0,o.bF)(P,{items:e.dataConceptos,title:"Conceptos de Cobro",modelValue:e.conceptosSelect,"onUpdate:modelValue":n[9]||(n[9]=function(n){return e.conceptosSelect=n}),onInput:e.getDeudores,textValue:"Código",textLabel:"Concepto"},null,8,["items","modelValue","onInput"])])])]),(0,o.Lk)("div",C,[(0,o.bF)(S,{class:"fix-tab-height ag-theme-balham",frameworkComponents:e.frameworkComponents,columnDefs:e.columnDefs,rowData:e.rowData,rowSelection:"multiple",onRowSelected:e.rowSelected,onGridReady:e.onGridReady,style:{height:"50vh"},defaultColDef:e.defaultColDef},null,8,["frameworkComponents","columnDefs","rowData","onRowSelected","onGridReady","defaultColDef"]),(0,o.bF)(N,{modelValue:e.pagina,"onUpdate:modelValue":n[10]||(n[10]=function(n){return e.pagina=n}),max:e.pages,onLoad:e.getDeudores,rows:e.rowData},null,8,["modelValue","max","onLoad","rows"])])])]}),_:1},512),[[a.aG,e.tabskey.enviar===e.tabActive]]),(0,o.bo)((0,o.bF)(M,{ref:e.tabskey.mensaje,codigo:e.codigo,componente:e.pageHeader.componente,tab:!0},null,8,["codigo","componente"]),[[a.aG,e.tabskey.mensaje===e.tabActive]])]}),_:1})}var b=t(8445),E=t.n(b),w=t(41562),D=t.n(w),I=t(76080),O=t.n(I),P=t(45254),S=t.n(P),N=(t(30683),t(39866),t(52133),t(10239),t(50310),t(6724),t(83190),t(62692),t(88567)),T=t(95718),M=t(53380),R=t(54489),k=t(64208),_=t(3112),L=t(12143),V=t(95477),F=t(80660),G=t(6123),U=t(62006),y=t(36408),x=t(27560),H=t(75053),q=t(41615),j=t(33950),Q=t(59089),B=t(95051),$=t(6083),Y=t(54267),X=t(2652),z=t(71818),J=t(37804),K=t(57668),W=t(17915),Z={components:{QDate:L.A,QPopupProxy:V.A,QCard:N.A,QCardSection:T.A,QSelect:R.S,QOptionGroup:G.EX,QSeparator:M.A,sieGrid:y.A,QInput:k.A,footerGrid:x.A,sieModal:H.A,QCheckbox:_.A,Upload:j["default"],sieUpload:Q.A,QDownloadFile:U.A,QChip:B.A,pageHeader:X.A,visorMensaje:z["default"],sieEditor:$.A,tesoreriaLoading:W.A,QChipTable:J.A,QIcon:G.bP},data:function(){return{tabs:[{label:"Envio",name:"tabIndex"},{label:"Mensaje",name:"tabMensaje"}],tabskey:{enviar:"tabIndex",mensaje:"tabMensaje"},pageHeader:{componente:"avisoEstadoCuenta",nivelAcceso:(0,K["default"])().ruta.nivel,botones:this.botones,title:"Envío de Estado de Cuenta"},tabActive:"tabIndex",codigo:q["default"].TIPO_ALERTA.ESTADO_CUENTA,LECTURA_ESCRITURA:q["default"].LECTURA_ESCRITURA,nivelAcceso:(0,K["default"])().ruta.nivel,openModal:!0,openModalConfigMsg:!1,modalConceptos:!1,title:"Envio de Alertas Estado de Cuenta",api:"",rowData:null,columnDefs:null,frameworkComponents:{},PERFIL_ALUMNO:q["default"].PERFIL_ALUMNO,selectPerfil:q["default"].PERFIL_ALUMNO,selectAnio:q["default"].TOKEN_YEAR,selectDia:q["default"].CURRENT_DAY,selectNivel:q["default"].TODOS,selectGrado:q["default"].TODOS,selectSeccion:q["default"].TODOS,selectPersona:q["default"].TODOS,selectEstadoPersona:q["default"].TODOS,conceptosSelect:[],Conceptos:[],dataConceptos:[],estadoPersona:q["default"].ESTADO_PERSONA,formRemoveConceptos:{},ckbEnviarIntranet:!0,ckbNumMes:!1,perfiles:[],anios:[],niveles:[],grados:[],secciones:[],pagina:1,pages:1,nroDeudas:0,personas:[],mensaje:"",correoRemitente:"",asunto:"",statusBar:null,idEnvio:null,correoEnviado:!1,tipoMensaje:3,loading:{showLoading:!1,procesados:0,total:0},dataMeses:(0,Y.generarMeses)(),seleccionarMes:q["default"].CURRENT_MONTH,filtroPorMes:!1,optionsDeudas:[{label:"Deudas Vencidas",value:1},{label:"Aviso de Deudas",value:2}],defaultColDef:{suppressHeaderMenuButton:!0,filter:!0,floatingFilterComponentParams:{suppressFilterButton:!0},resizable:!0,sortable:!0,suppressDragLeaveHidesColumns:!0},DEUDAS_VENCIDAS:1,AVISO_DEUDAS:2,selectOption:1}},created:function(){this.statusBar={statusPanels:[{statusPanel:"agTotalAndFilteredRowCountComponent",align:"left"}]}},methods:{changeTab:function(e){var n=this;return S()(O()().m(function t(){var o;return O()().w(function(t){while(1)switch(t.n){case 0:if(n.tabActive=e,"tabIndex"!==e){t.n=1;break}return n.pageHeader.title=n.title,n.pageHeader.botones=n.botones,n.pageHeader.componente="avisoEstadoCuenta",n.pageHeader.nivelAcceso=(0,K["default"])().ruta.nivel,t.a(2,!0);case 1:return t.n=2,n.$refs[e].obtenerDatosTab();case 2:o=t.v,n.pageHeader.botones=o.botones,n.pageHeader.componente=o.componente,n.pageHeader.nivelAcceso=o.minAcceso,n.pageHeader.title=o.title;case 3:return t.a(2)}},t)}))()},searchParams:function(){},changeOptions:function(){this.filtroPorMes=this.selectOption===this.AVISO_DEUDAS,this.getDeudores()},rowSelected:function(){},checkDeudas:function(){!0===this.ckbNumMes&&this.nroDeudas>0&&this.getDeudores()},getPerPerfil:function(){var e=this;return S()(O()().m(function n(){var t,o,a;return O()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,e.personas=[],e.selectPersona=q["default"].TODOS,t={id_perfil:e.selectPerfil},n.n=1,F.$http.get("api/personaController/getPersonaPerfil",{params:{params:t}});case 1:o=n.v,o.length>0?(e.personas.push({value:"T",label:"Todos"}),o.map(function(n){return e.personas.push({value:n.ID_PERSONA,label:n.NOMBRE})})):e.personas=[],e.getDeudores(),n.n=3;break;case 2:n.p=2,a=n.v,console.error(a);case 3:return n.a(2)}},n,null,[[0,2]])}))()},onGridReady:function(e){this.api=e.api},obtenerConceptos:function(e){this.getDeudores()},getSelectConcepto:function(e){var n=this;return S()(O()().m(function t(){return O()().w(function(t){while(1)switch(t.n){case 0:return n.apiSelectConceptos=e,t.a(2,n.apiSelectConceptos)}},t)}))()},openModalConceptos:function(){var e=this;return S()(O()().m(function n(){return O()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,e.getConceptos();case 1:e.modalConceptos=!0;case 2:return n.a(2)}},n)}))()},getConceptos:function(){var e=this;return S()(O()().m(function n(){var t;return O()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,q["default"].API_CONCEPTOS({render:"grid"});case 1:t=n.v,e.dataConceptos=t,0===e.Conceptos.length?e.Conceptos=t:(e.Conceptos=t,e.Conceptos.map(function(n,t){var o,a=D()(e.conceptosSelect);try{for(a.s();!(o=a.n()).done;){var r=o.value;r.value===n.value&&delete e.Conceptos[t]}}catch(e){a.e(e)}finally{a.f()}}));case 2:return n.a(2)}},n)}))()},getTipoMensaje:function(){var e=this;return S()(O()().m(function n(){var t,o;return O()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,F.$http.get("api/EnvioAlertaController/getMensajeAlerta",{params:{params:{MSGCOD:q["default"].TIPO_ALERTA.ESTADO_CUENTA}}});case 1:t=n.v,o="Envio de Estado de Cuenta",t[0].CONFIG?(e.tipoMensaje=parseInt(t[0].CONFIG),parseInt(t[0].CONFIG)===q["default"].TIPO_MSG.CORREO_ELECTRONICO?e.title=o+" (Correo Electrónico)":parseInt(t[0].CONFIG)===q["default"].TIPO_MSG.MENSAJE_INTRANET?e.title=o+" (Mensaje Intranet)":parseInt(t[0].CONFIG)===q["default"].TIPO_MSG.AMBOS?e.title=o+" (Correo Electrónico y Mensaje Intranet)":e.title=o):e.title=o;case 2:return n.a(2)}},n)}))()},removeItem:function(e){var n=this;return S()(O()().m(function e(){var t;return O()().w(function(e){while(1)switch(e.n){case 0:return e.n=1,n.addRemoveTalonarios();case 1:t=e.v,n.removeTalonarios=E()(t),n.talonariosSelect=n.removeTalonarios;case 2:return e.a(2)}},e)}))()},addRemoveTalonarios:function(){var e=this;return S()(O()().m(function n(){var t,o,a,r;return O()().w(function(n){while(1)switch(n.n){case 0:t=[],o=D()(e.talonariosSelect);try{for(o.s();!(a=o.n()).done;)r=a.value,e.formRemoveTalonarios[r.value]&&t.push(r)}catch(e){o.e(e)}finally{o.f()}return n.a(2,t)}},n)}))()},removeItemConcepto:function(e){var n=this;return S()(O()().m(function e(){var t;return O()().w(function(e){while(1)switch(e.n){case 0:return e.n=1,n.addRemoveConceptos();case 1:return t=e.v,n.removeConceptos=E()(t),n.conceptosSelect=n.removeConceptos,e.n=2,n.getDeudores();case 2:return e.a(2)}},e)}))()},addRemoveConceptos:function(){var e=this;return S()(O()().m(function n(){var t,o,a,r;return O()().w(function(n){while(1)switch(n.n){case 0:t=[],o=D()(e.conceptosSelect);try{for(o.s();!(a=o.n()).done;)r=a.value,e.formRemoveConceptos[r.value]&&t.push(r)}catch(e){o.e(e)}finally{o.f()}return n.a(2,t)}},n)}))()},getPerfiles:function(){var e=this;return S()(O()().m(function n(){return O()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,q["default"].API_PERFILES();case 1:e.perfiles=n.v;case 2:return n.a(2)}},n)}))()},getAnios:function(){var e=this;return S()(O()().m(function n(){return O()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,q["default"].API_ANIOS();case 1:e.anios=n.v;case 2:return n.a(2)}},n)}))()},getAlumno:function(e){console.log(e)},reporteCorreo:function(){if(this.idEnvio){var e="".concat(origin,"/webservice/reporte-tesoreria/reporte-alertas?idEnvio=").concat(this.idEnvio);window.open(e,"_blank")}else this.$alert("No se han enviado correos")},submit:function(){},enviarCorreo:function(){var e=this;return S()(O()().m(function n(){var t,o;return O()().w(function(n){while(1)switch(n.n){case 0:if(t=e.api.getSelectedRows(),o="Ha ocurrido un error",0!==t.length){n.n=1;break}return n.a(2,e.$alert("No seleccionó ningún deudor para enviar correo"));case 1:e.$confirm("¿Esta seguro de enviar la alerta a los (".concat(t.length,") registros seleccionados?")).onOk(S()(O()().m(function n(){var a,r,s,l,i,c,u,d;return O()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.n=1,F.$http.post("api/EnvioAlertaController/postRegistrarMailCampaign",{params:{MSGCOD:q["default"].TIPO_ALERTA.ESTADO_CUENTA}});case 1:if(a=n.v,r={noEnviados:0,enviados:0},s=[],e.loading.showLoading=!0,e.loading.procesados=0,e.loading.total=t.length,!a.ID_MAIL_CAMPAIGN){n.n=12;break}l=D()(t),n.p=2,l.s();case 3:if((i=l.n()).done){n.n=9;break}return c=i.value,n.p=4,c.MSGCOD=q["default"].TIPO_ALERTA.ESTADO_CUENTA,c.ANOCOB=e.selectAnio,c.FECVEN=(0,Y.convertToYMD)(e.selectDia),c.ID_MAIL_CAMPAIGN=a.ID_MAIL_CAMPAIGN,c.CONCEPTO=e.conceptosSelect.map(function(e){return e.value}),n.n=5,F.$http.post("api/EnvioAlertaController/postEnviarAlerta",{params:c});case 5:r.enviados++,s.push(c.CODIGO),n.n=7;break;case 6:n.p=6,u=n.v,r.noEnviados++,u.error&&(o=u.error.message);case 7:return n.p=7,e.loading.procesados++,n.f(7);case 8:n.n=3;break;case 9:n.n=11;break;case 10:n.p=10,d=n.v,l.e(d);case 11:return n.p=11,l.f(),n.f(11);case 12:e.getDeudores(s),e.$q.loading.hide(),e.loading.showLoading=!1,r.enviados>0?e.$alert("(".concat(r.enviados,") Alertas Enviados Satisfactoriamente"),"success"):e.$alert(t.length>1?"(".concat(r.noEnviados,") Alertas con Problemas para enviar"):o,"warning"),e.idEnvio=a.ID_ENVIO;case 13:return n.a(2)}},n,null,[[4,6,7,8],[2,10,11,12]])})));case 2:return n.a(2)}},n)}))()},convertDay:function(e){return e.split("/")[2]+"-"+e.split("/")[1]+"-"+e.split("/")[0]},peticionDeudas:function(e){var n=arguments;return S()(O()().m(function t(){var o,a,r,s,l;return O()().w(function(t){while(1)switch(t.n){case 0:return o=n.length>1&&void 0!==n[1]?n[1]:[],t.n=1,F.$http.get("api/EnvioAlertaController/getDeudores",{params:{params:e}});case 1:a=t.v,r=D()(a);try{for(r.s();!(s=r.n()).done;)l=s.value,o.length>0&&o.includes(l.CODIGO)?l.Estado="Enviado":l.Estado="Sin enviar"}catch(e){r.e(e)}finally{r.f()}return t.a(2,a)}},t)}))()},getDeudores:function(e){var n=this;return S()(O()().m(function t(){var o,a;return O()().w(function(t){while(1)switch(t.p=t.n){case 0:if(t.p=0,o={ANOCOB:n.selectAnio,ID_PERFIL:n.selectPerfil,CONCOB:[],msgCod:n.codigo},0!==n.conceptosSelect.length){t.n=1;break}return n.rowData=[],t.a(2,!1);case 1:return o.CONCOB=n.conceptosSelect.map(function(e){return e.value}),n.selectDia&&!n.filtroPorMes&&(o.FECVEN=n.convertDay(n.selectDia)),!0===n.ckbNumMes&&n.nroDeudas>0&&(o.CANTIDAD=n.nroDeudas),n.selectPersona&&n.selectPersona!==q["default"].TODOS&&(o.ID_PERSONA=n.selectPersona),n.selectNivel&&(o.INSTRUCOD=n.selectNivel),n.selectGrado&&(o.GRADOCOD=n.selectGrado),n.seleccionarMes&&n.filtroPorMes&&(o.MESCOB=n.seleccionarMes),n.selectEstadoPersona&&"T"!==n.selectEstadoPersona&&(o.ESTADO_PERSONA=n.selectEstadoPersona),e=e||[],t.n=2,n.peticionDeudas(o,e);case 2:n.rowData=t.v,t.n=4;break;case 3:t.p=3,a=t.v,console.log(a),n.$alert(a.error?a.error.message:a.message,"warn");case 4:return t.a(2)}},t,null,[[0,3]])}))()},getNiveles:function(){var e=this;return S()(O()().m(function n(){return O()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,q["default"].API_NIVELES();case 1:e.niveles=n.v,e.getDeudores();case 2:return n.a(2)}},n)}))()},getGrados:function(){var e=this;return S()(O()().m(function n(){return O()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,q["default"].API_GRADOS(e.selectNivel);case 1:e.grados=n.v,e.getDeudores();case 2:return n.a(2)}},n)}))()},getSecciones:function(){var e=this;return S()(O()().m(function n(){return O()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,q["default"].API_SECCIONES(e.selectGrado,e.selectNivel);case 1:e.secciones=n.v,e.getDeudores();case 2:return n.a(2)}},n)}))()},crearBotones:function(){var e=this;return S()(O()().m(function n(){var t;return O()().w(function(n){while(1)switch(n.n){case 0:return t=[],t.push({click:e.enviarCorreo,label:"Enviar",icon:"send",minAcceso:q["default"].LECTURA_ESCRITURA}),e.pageHeader.botones=t,e.botones=t,n.a(2,t)}},n)}))()},columns:function(){var e=this;return S()(O()().m(function n(){return O()().w(function(n){while(1)switch(n.n){case 0:e.columnDefs=[{headerName:"Código",field:"CODIGO",width:100},{headerName:"Apellidos y Nombres",field:"NOMBRE",width:350},{headerName:"Perfil",field:"PERFIL",width:125},{headerName:"Estado",field:"Estado",width:120}];case 1:return n.a(2)}},n)}))()},closeModalCalendar:function(e){this.$refs[e].hide(),this.getDeudores()}},beforeMount:function(){var e=this;return S()(O()().m(function n(){return O()().w(function(n){while(1)switch(n.n){case 0:e.crearBotones(),e.getTipoMensaje(),e.getConceptos(),e.getPerfiles(),e.getAnios(),e.getNiveles(),e.getGrados(),e.getSecciones(),e.getPerPerfil(),e.columns();case 1:return n.a(2)}},n)}))()}},ee=t(12807);const ne=(0,ee.A)(Z,[["render",A]]);var te=ne}}]);