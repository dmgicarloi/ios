"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[34171],{34171:function(e,r,o){o.r(r),o.d(r,{default:function(){return ue}});var i=o(8445),t=o.n(i),s=o(61758),n=o(58790),a={class:"row justify-center q-pa-sm"},c={class:"col-12 col-md-10 col-lg-8"},l={class:"row items-center q-mb-sm"},u={class:"correos-grid"},d=["onClick"],m={key:0,class:"row justify-start mobile-chip-top"},f={class:"row items-center full-width"},v={class:"col text-left"},p={class:"row items-center q-mb-md"},h={class:"perfiles-container"},g={class:"correos-grid q-pa-md"},b=["onClick"],k={key:0,class:"row justify-start mobile-chip-top"},C={class:"row items-center full-width"},w={class:"col text-left"},E={class:"no-emails-content text-center q-py-lg"},x={class:"benefits-list q-mb-lg"},y={class:"benefit-item q-mb-sm"},q={class:"benefit-item q-mb-sm"},L={class:"benefit-item q-mb-sm"},S={class:"q-mt-sm"},F={class:"status-header text-center q-mb-md"},_={class:"email-info q-mb-md"},A={class:"row items-center justify-center"},Q={class:"text-subtitle1 text-weight-medium text-center text-primary"},R={key:0,class:"warning-box"},z={class:"row items-start q-pa-md"},O={key:1,class:"text-center send-code-section"},X={class:"send-code-info"},I={key:0,class:"text-caption text-grey-6"},P={key:1,class:"text-caption text-warning"},U={class:"header-section text-center q-mb-lg"},V={class:"email-chip q-mt-sm"},W={class:"info-section text-center q-mb-lg"},j={class:"info-box q-pa-md"},T={class:"actions-section text-center"},$={key:0,class:"countdown-section"},N={class:"q-mt-md"};function D(e,r){var o=(0,s.g2)("q-tooltip"),i=(0,s.g2)("q-btn"),D=(0,s.g2)("header-btn"),G=(0,s.g2)("q-icon"),K=(0,s.g2)("q-chip"),B=(0,s.g2)("q-card-section"),M=(0,s.g2)("q-card"),Y=(0,s.g2)("q-expansion-item"),H=(0,s.g2)("q-avatar"),J=(0,s.g2)("q-page");return(0,s.uX)(),(0,s.Wv)(J,{class:"q-pa-sm"},{default:(0,s.k6)(function(){return[(0,s.bF)(D,{name:"Correo Seguro"},{beforeText:(0,s.k6)(function(){return[(0,s.bF)(i,{icon:"arrow_back",flat:"",round:"",size:"md",color:"primary",onClick:r[0]||(r[0]=function(r){return e.$router.go(-1)})},{default:(0,s.k6)(function(){return[(0,s.bF)(o,null,{default:(0,s.k6)(function(){return t()(r[2]||(r[2]=[(0,s.eW)("Volver",-1)]))}),_:1})]}),_:1})]}),_:1}),(0,s.Lk)("div",a,[(0,s.Lk)("div",c,[e.esFamilia?(0,s.Q3)("v-if",!0):((0,s.uX)(),(0,s.Wv)(M,{key:0,class:(0,n.C4)(["q-mb-lg shadow-3 correos-card",{"disabled-card":e.isCountdownActive}])},{default:(0,s.k6)(function(){return[(0,s.bF)(B,null,{default:(0,s.k6)(function(){return[(0,s.Lk)("div",l,[(0,s.bF)(G,{class:"q-mr-sm",name:"email",color:"primary",size:"20px"}),r[3]||(r[3]=(0,s.Lk)("h5",{class:"q-ma-none text-weight-medium",style:{"font-size":"14px"}},"Seleccionar correo electrónico",-1))]),(0,s.Lk)("div",u,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.correos,function(r){return(0,s.uX)(),(0,s.CE)("div",{key:r,class:(0,n.C4)(["correo-item",{"correo-seleccionado":r===e.selectedEmail,"correo-principal":r===e.email}]),onClick:function(o){return e.seleccionarCorreo(r)}},[r===e.correoSeguro?((0,s.uX)(),(0,s.CE)("div",m,[(0,s.bF)(K,{class:"principal-badge-mobile",dense:"",color:"positive","text-color":"white",label:"SEGURO",size:"sm"})])):(0,s.Q3)("v-if",!0),(0,s.Lk)("div",f,[(0,s.bF)(G,{class:"q-mr-sm",name:r===e.selectedEmail?"radio_button_checked":"radio_button_unchecked",color:"primary"},null,8,["name"]),(0,s.Lk)("div",v,(0,n.v_)(r),1)]),r===e.correoSeguro?((0,s.uX)(),(0,s.Wv)(K,{key:1,class:"principal-badge-desktop",dense:"",color:"positive","text-color":"white",label:"SEGURO",size:"sm"})):(0,s.Q3)("v-if",!0)],10,d)}),128))])]}),_:1})]}),_:1},8,["class"])),e.esFamilia?((0,s.uX)(),(0,s.Wv)(M,{key:1,class:(0,n.C4)(["q-mb-lg shadow-3 correos-card",{"disabled-card":e.isCountdownActive}])},{default:(0,s.k6)(function(){return[(0,s.bF)(B,null,{default:(0,s.k6)(function(){return[(0,s.Lk)("div",p,[(0,s.bF)(G,{class:"q-mr-sm",name:"people",color:"primary",size:"md"}),r[4]||(r[4]=(0,s.Lk)("h5",{class:"q-ma-none text-weight-medium"},"Correos por perfil",-1))]),(0,s.Lk)("div",h,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.correosPorPerfil,function(r,o){return(0,s.uX)(),(0,s.Wv)(Y,{key:o,class:"perfil-item",label:o,"header-class":"text-weight-medium perfil-header",icon:"person"},{default:(0,s.k6)(function(){return[(0,s.Lk)("div",g,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r,function(r){return(0,s.uX)(),(0,s.CE)("div",{key:r,class:(0,n.C4)(["correo-item",{"correo-seleccionado":r===e.selectedEmail,"correo-principal":r===e.email}]),onClick:function(o){return e.seleccionarCorreo(r)}},[r===e.correoSeguro?((0,s.uX)(),(0,s.CE)("div",k,[(0,s.bF)(K,{class:"principal-badge-mobile",dense:"",color:"sucess","text-color":"white",label:"SEGURO",size:"sm"})])):(0,s.Q3)("v-if",!0),(0,s.Lk)("div",C,[(0,s.bF)(G,{class:"q-mr-sm",name:r===e.selectedEmail?"radio_button_checked":"radio_button_unchecked",color:"primary"},null,8,["name"]),(0,s.Lk)("div",w,(0,n.v_)(r),1)]),r===e.correoSeguro?((0,s.uX)(),(0,s.Wv)(K,{key:1,class:"principal-badge-desktop",dense:"",color:"sucess","text-color":"white",label:"SEGURO",size:"sm"})):(0,s.Q3)("v-if",!0)],10,b)}),128))])]}),_:2},1032,["label"])}),128))])]}),_:1})]}),_:1},8,["class"])):(0,s.Q3)("v-if",!0),e.correos&&0!==e.correos.length?(0,s.Q3)("v-if",!0):((0,s.uX)(),(0,s.Wv)(M,{key:2,class:"q-mb-lg shadow-3 no-emails-card"},{default:(0,s.k6)(function(){return[(0,s.bF)(B,null,{default:(0,s.k6)(function(){return[(0,s.Lk)("div",E,[(0,s.bF)(G,{class:"q-mb-md",name:"mail_outline",color:"grey-5",size:"80px"}),r[8]||(r[8]=(0,s.Lk)("h5",{class:"q-ma-none text-weight-medium text-grey-7 q-mb-sm"},"No cuenta con correos asociados",-1)),r[9]||(r[9]=(0,s.Lk)("p",{class:"text-grey-6 q-mb-lg"},[(0,s.eW)("Para mejorar su seguridad, por favor registre un correo electrónico."),(0,s.Lk)("br"),(0,s.eW)("Esto le permitirá recibir notificaciones importantes y verificar su identidad.")],-1)),(0,s.Lk)("div",x,[(0,s.Lk)("div",y,[(0,s.bF)(G,{class:"q-mr-sm",name:"security",color:"primary",size:"20px"}),r[5]||(r[5]=(0,s.Lk)("span",{class:"text-body2"},"Mayor seguridad en su cuenta",-1))]),(0,s.Lk)("div",q,[(0,s.bF)(G,{class:"q-mr-sm",name:"notifications",color:"primary",size:"20px"}),r[6]||(r[6]=(0,s.Lk)("span",{class:"text-body2"},"Notificaciones importantes",-1))]),(0,s.Lk)("div",L,[(0,s.bF)(G,{class:"q-mr-sm",name:"verified_user",color:"primary",size:"20px"}),r[7]||(r[7]=(0,s.Lk)("span",{class:"text-body2"},"Verificación de identidad",-1))])]),(0,s.Lk)("div",S,[(0,s.bF)(i,{label:"Volver",flat:"",color:"grey",size:"md",icon:"arrow_back",onClick:r[1]||(r[1]=function(r){return e.$router.go(-1)})})])])]}),_:1})]}),_:1})),!e.isCodeSent&&!e.correosEnEspera[e.selectedEmail]&&e.correos&&e.correos.length>0?((0,s.uX)(),(0,s.Wv)(M,{key:3,class:"q-mb-lg shadow-2"},{default:(0,s.k6)(function(){return[(0,s.bF)(B,null,{default:(0,s.k6)(function(){return[(0,s.Lk)("div",F,[(0,s.bF)(H,{class:"q-mb-sm",size:"50px",color:e.isEmailSecure?"positive":"warning","text-color":"white",icon:e.isEmailSecure?"verified_user":"warning"},null,8,["color","icon"]),(0,s.Lk)("h6",{class:(0,n.C4)(["q-ma-none status-title",e.isEmailSecure?"text-positive":"text-warning"])},(0,n.v_)(e.isEmailSecure?"Correo Verificado":"Correo Sin Verificar"),3)]),(0,s.Lk)("div",_,[(0,s.Lk)("div",A,[(0,s.bF)(G,{class:"q-mr-xs",name:"email",size:"sm",color:"grey-6"}),r[10]||(r[10]=(0,s.Lk)("div",{class:"text-body2 text-grey-7"},"Correo seleccionado:",-1))]),(0,s.Lk)("div",Q,(0,n.v_)(e.selectedEmail),1)]),e.sinCorreos?((0,s.uX)(),(0,s.CE)("div",R,[(0,s.Lk)("div",z,[(0,s.bF)(G,{class:"q-mr-sm",name:"info",size:"md",color:"warning"}),r[11]||(r[11]=(0,s.Lk)("div",null,[(0,s.Lk)("div",{class:"text-body2 text-weight-medium"},"No hay correos disponibles"),(0,s.Lk)("div",{class:"text-caption text-grey-7"},"Por favor, agregue un correo para continuar")],-1))])])):(0,s.Q3)("v-if",!0),e.isEmailSecure||e.sinCorreos?(0,s.Q3)("v-if",!0):((0,s.uX)(),(0,s.CE)("div",O,[(0,s.bF)(i,{class:"send-code-btn",label:"Enviar Código",color:"primary",size:"md",icon:"send",disable:e.isCountdownActive,onClick:e.sendValidationCode},null,8,["disable","onClick"]),(0,s.Lk)("div",X,[e.isCountdownActive?(0,s.Q3)("v-if",!0):((0,s.uX)(),(0,s.CE)("div",I," Se enviará un código de verificación a este correo.")),e.isCountdownActive?((0,s.uX)(),(0,s.CE)("div",P," Ya se envió un código. Espere "+(0,n.v_)(e.countdown)+" para reenviar.",1)):(0,s.Q3)("v-if",!0)])]))]}),_:1})]}),_:1})):(0,s.Q3)("v-if",!0),e.isCodeSent||e.selectedEmail&&e.correosEnEspera[e.selectedEmail]?((0,s.uX)(),(0,s.Wv)(M,{key:4,class:"sent-card shadow-2"},{default:(0,s.k6)(function(){return[(0,s.bF)(B,null,{default:(0,s.k6)(function(){return[(0,s.Lk)("div",U,[(0,s.bF)(H,{class:"q-mb-md",size:"60px",color:"positive","text-color":"white",icon:"mark_email_read"}),r[12]||(r[12]=(0,s.Lk)("h5",{class:"q-ma-none text-weight-medium"},"Correo de Verificación Enviado",-1)),r[13]||(r[13]=(0,s.Lk)("p",{class:"text-grey-7 q-mt-sm"},"Se ha enviado un correo de verificación, por favor revise su bandeja de entrada.",-1)),(0,s.Lk)("div",V,[(0,s.bF)(K,{color:"primary","text-color":"white",label:e.selectedEmail,icon:"email"},null,8,["label"])])]),(0,s.Lk)("div",W,[(0,s.Lk)("div",j,[(0,s.bF)(G,{class:"q-mr-sm",name:"info",color:"info",size:"30px"}),r[14]||(r[14]=(0,s.Lk)("div",null,[(0,s.Lk)("div",{class:"text-body2 text-weight-medium"},"Instrucciones:"),(0,s.Lk)("div",{class:"text-body2 q-mt-xs"},"1. Revise su bandeja de entrada"),(0,s.Lk)("div",{class:"text-body2"},"2. Haga clic en el enlace de verificación"),(0,s.Lk)("div",{class:"text-body2"},"3. Su correo quedará marcado como seguro")],-1))]),r[15]||(r[15]=(0,s.Lk)("p",{class:"text-primary q-mt-sm text-weight-bold"},"Solo podrá tener un correo seguro a la vez. Si verifica uno nuevo, el anterior dejará de estarlo.",-1))]),(0,s.Lk)("div",T,[e.isCountdownActive?((0,s.uX)(),(0,s.CE)("div",$,[(0,s.bF)(K,{class:"countdown-chip q-mb-md",icon:"timer",color:"orange","text-color":"white",label:"Reenvío disponible en ".concat(e.countdown),size:"md"},null,8,["label"])])):(0,s.Q3)("v-if",!0),(0,s.bF)(i,{class:"q-mb-md",label:"Reenviar Correo",outline:"",color:"primary",size:"md",icon:"refresh",onClick:e.sendValidationCode,disable:e.isCountdownActive},null,8,["onClick","disable"]),(0,s.Lk)("div",N,[(0,s.bF)(i,{label:"Volver",flat:"",color:"grey",size:"md",icon:"arrow_back",onClick:e.volverASeleccion},null,8,["onClick"])])])]}),_:1})]}),_:1})):(0,s.Q3)("v-if",!0)])])]}),_:1})}var G=o(76080),K=o.n(G),B=o(45254),M=o.n(B),Y=(o(30683),o(93870),o(71225),o(39866),o(77507),o(52133),o(10239),o(50310),o(5962),o(90095),o(6724),o(92802),o(11777),o(83190),o(49089),o(44264),o(2369),o(68017),o(13715),o(6123)),H=o(80660),J=o(88567),Z=o(82327),ee=o(11654),re=o(88865),oe=o(22926),ie=o(74656),te=o(57668),se=o(95051),ne=o(982),ae={components:{QCard:J.A,QItem:Z.A,QAvatar:ie.A,QItemSection:re.A,QExpansionItem:oe.A,QChip:se.A,QBtn:ee.A,QPage:Y.Tu,QTooltip:Y.nC,QIcon:Y.bP},data:function(){return{sieInfo:(0,te["default"])(),correoSeguro:"",modalPasswordModel:!1,email:"",sinCorreos:!1,validationCode:"",isCountdownActive:!1,countdown:"05:00",timer:null,correosEnEspera:{},fieldValues:Array(this.inputLength).fill(""),isEmailSecure:!1,isCodeSent:!1,perfil:"",nombre:"",correos:[],selectedEmail:"",esFamilia:(0,te["default"])().esFamilia,correosPorPerfil:{}}},props:{inputLength:{type:Number,default:6}},methods:{obtenerCorreoPrincipal:function(){var e=this;return M()(K()().m(function r(){var o,i,t;return K()().w(function(r){while(1)switch(r.p=r.n){case 0:return r.p=0,r.n=1,H.$http.get("api/UsuarioController/getCorreoPorUsuario",{params:{params:{usucod:(0,te["default"])().usucod}}});case 1:if(o=r.v,o.success){r.n=2;break}return e.sinCorreos=!0,(0,ne["default"])("No se encontraron correos asociados al usuario.","warning"),r.a(2);case 2:return i=o.data[0].CORREO.split(";").map(function(e){if(e.trim().length>0)return{CORREO:e.trim()}}).filter(Boolean),e.esFamilia?e.correosPorPerfil=i.reduce(function(e,r){var o=r.PERFIL||"Otros";return e[o]||(e[o]=[]),e[o].push(r.CORREO),e},{}):e.correos=i.map(function(e){return e.CORREO}),e.email=e.correos[0],e.selectedEmail=e.email,r.a(2,i);case 3:r.p=3,t=r.v,console.log(t);case 4:return r.a(2)}},r,null,[[0,3]])}))()},volverASeleccion:function(){this.isCodeSent=!1,this.selectedEmail="",this.isCountdownActive=!1,this.countdown="05:00",this.timer=null},updateFieldRef:function(e,r){e&&(this.fields[r]=e)},focus:function(e){e>=0&&e<this.length&&this.fields[e]&&this.fields[e].focus()},onUpdate:function(e,r){1===e.length&&this.focus(r+1)},onKeyUp:function(e,r){var o=e.key;["ArrowLeft","Backspace"].includes(o)?this.focus(r-1):"ArrowRight"===o&&this.focus(r+1)},sendValidationCode:function(){var e=this;return M()(K()().m(function r(){var o,i;return K()().w(function(r){while(1)switch(r.p=r.n){case 0:if(!e.correosEnEspera[e.selectedEmail]){r.n=1;break}return(0,ne["default"])("Ya se envió un código a este correo. Espere antes de solicitar otro.","warning"),r.a(2);case 1:return r.p=1,r.n=2,H.$http.post("api/SeguridadCorreoController/enviarCodigoSeguro",{usucod:(0,te["default"])().usucod,email:e.selectedEmail});case 2:o=r.v,o.intentos&&o.intentos.data[0].penultimo&&e.$confirm("Usted esta a punto de superar el maximo de intentos, el proximo intento bloqueara su usuario por 24h","warning"),e.isCodeSent=!0,e.startCountdownForEmail(e.selectedEmail),(0,ne["default"])("Correo enviado, revisa tu bandeja de entrada.","success"),r.n=4;break;case 3:r.p=3,i=r.v,(0,ne["default"])(i.message||"No se pudo enviar el código de seguridad.","warning");case 4:return r.a(2)}},r,null,[[1,3]])}))()},getCorreoSeguro:function(){var e=this;return M()(K()().m(function r(){var o,i;return K()().w(function(r){while(1)switch(r.p=r.n){case 0:return r.p=0,console.log("componente correoSeguro"),r.n=1,H.$http.get("api/SeguridadCorreoController/getCorreoSeguroPorUsuario",{params:{usucod:e.sieInfo.usucod}});case 1:return o=r.v,e.correoSeguro=o.CORREO,r.a(2,o.CORREO);case 2:return r.p=2,i=r.v,console.error("Error fetching seguridad correo status:",i),r.a(2,!1)}},r,null,[[0,2]])}))()},verificarCorreoSeguro:function(e){var r=this;return M()(K()().m(function o(){var i,t,s;return K()().w(function(o){while(1)switch(o.p=o.n){case 0:return o.p=0,i={CORREO:e,USUCOD:(0,te["default"])().usucod},o.n=1,H.$http.get("api/UsuarioController/getCorreoSeguro",{params:{params:i}});case 1:if(t=o.v,!t.success){o.n=3;break}return o.n=2,r.getCorreoSeguro();case 2:r.isEmailSecure=!0,o.n=4;break;case 3:r.isEmailSecure=!1;case 4:return o.a(2,t);case 5:return o.p=5,s=o.v,console.error("Error al verificar correo seguro:",s),r.isEmailSecure=!1,o.a(2,{success:!1})}},o,null,[[0,5]])}))()},seleccionarCorreo:function(e){this.selectedEmail=e,this.isCodeSent=!1,this.correosEnEspera[e]?(this.isCountdownActive=!0,this.countdown=this.formatTime(this.correosEnEspera[e].remainingTime),this.timer=this.correosEnEspera[e].timer):(this.isCountdownActive=!1,this.countdown="05:00",this.timer=null),this.verificarCorreoSeguro(e)},validateCode:function(){var e=this;return M()(K()().m(function r(){var o,i,t,s;return K()().w(function(r){while(1)switch(r.p=r.n){case 0:return o={code:e.validationCode,usucod:(0,te["default"])().usucod,email:e.selectedEmail},r.p=1,r.n=2,H.$http.post("api/SeguridadCorreoController/verificarCorreo",{params:o});case 2:i=r.v,e.isEmailSecure=!0,e.isCodeSent=!1,e.isCountdownActive=!1,e.clearData(),(0,ne["default"])(i.message||"Código de seguridad validado correctamente.","positive"),r.n=4;break;case 3:return r.p=3,s=r.v,e.clearData(),e.isCountdownActive=!1,(0,ne["default"])(s.message||"Error al validar el código.","warning"),r.a(2,{success:!1,message:(null===(t=s.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||"Error al validar el código."});case 4:return r.a(2)}},r,null,[[1,3]])}))()},startCountdownForEmail:function(e){var r=this;this.isCountdownActive=!0;var o=300,i=setInterval(function(){o-=1,r.selectedEmail===e&&(r.countdown=r.formatTime(o)),r.correosEnEspera[e]&&(r.correosEnEspera[e].remainingTime=o),o<=0&&(clearInterval(i),delete r.correosEnEspera[e],r.selectedEmail===e&&(r.isCountdownActive=!1,r.countdown="05:00",r.timer=null))},1e3);this.correosEnEspera[e]={timer:i,remainingTime:o},this.timer=i,this.countdown=this.formatTime(o)},formatTime:function(e){var r=Math.floor(e/60).toString().padStart(2,"0"),o=(e%60).toString().padStart(2,"0");return"".concat(r,":").concat(o)},clearAllTimers:function(){Object.values(this.correosEnEspera).forEach(function(e){var r=e.timer;r&&clearInterval(r)}),this.correosEnEspera={}},clearData:function(){this.validationCode="",this.fieldValues=Array(this.inputLength).fill(""),this.isCountdownActive=!1,this.countdown="05:00",this.timer&&(clearInterval(this.timer),this.timer=null)}},watch:{fieldValues:{handler:function(e){this.validationCode=e.join("")},deep:!0}},computed:{length:function(){return this.inputLength}},mounted:function(){var e=this;return M()(K()().m(function r(){return K()().w(function(r){while(1)switch(r.n){case 0:return(0,te["default"])().profcod||e.$router.push("/login"),r.n=1,e.obtenerCorreoPrincipal();case 1:if(e.sinCorreos){r.n=3;break}return r.n=2,e.getCorreoSeguro();case 2:return r.n=3,e.verificarCorreoSeguro(e.selectedEmail);case 3:e.fields=[];case 4:return r.a(2)}},r)}))()},beforeDestroy:function(){this.timer&&clearInterval(this.timer)}},ce=o(12807);const le=(0,ce.A)(ae,[["render",D]]);var ue=le}}]);