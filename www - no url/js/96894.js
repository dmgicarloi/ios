"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[96894],{96894:function(e,o,n){n.r(o),n.d(o,{default:function(){return oe}});var t=n(8445),a=n.n(t),r=n(61758),i={class:"row q-gutter-sm"},l={class:"col-xs-12"},s={key:0,class:"row q-col-gutter-sm q-pt-sm"},c={class:"col-xs-12"},u={class:"row q-gutter-sm"},d={class:"col-11"},f={key:1,class:"row q-col-gutter-sm q-pt-sm"},p={class:"col-xs-12 col-sm-3"},m={class:"col-xs-12 col-sm-3"},b={class:"col-xs-12 col-sm-5"},v={class:"row q-gutter-xs"},h={class:"col"},g={class:"row sie-flat"},w={class:"col-xs-12"},k={class:"col-xs-12"},E={class:"row q-col-gutter-sm"},C={class:"col-xs-12 col-sm-12 col-md-6"},S={class:"row sie-flat"},L={class:"col-xs-12"},j={class:"col-xs-12"},y={class:"col-xs-12 col-sm-12 col-md-6"},O={class:"row sie-flat"},I={class:"col-xs-12"},x={class:"col-xs-12"},A={class:"row q-pa-sm q-col-gutter-sm"},P={class:"col-xs-12"},V={key:0,class:"col-xs-12"},D={key:1,class:"col-xs-12"};function F(e,o){var n=this,t=(0,r.g2)("header-btn"),F=(0,r.g2)("q-radio"),q=(0,r.g2)("q-card-section"),B=(0,r.g2)("q-separator"),T=(0,r.g2)("q-input"),$=(0,r.g2)("q-tooltip"),N=(0,r.g2)("q-btn"),M=(0,r.g2)("q-select"),R=(0,r.g2)("autocomplete"),U=(0,r.g2)("sie-table"),_=(0,r.g2)("sie-modal"),Q=(0,r.g2)("q-card"),G=(0,r.g2)("q-page");return(0,r.uX)(),(0,r.Wv)(G,{class:"movimiento-operaciones q-pa-sm sie-flat"},{default:(0,r.k6)(function(){return[(0,r.bF)(Q,{flat:"",bordered:""},{default:(0,r.k6)(function(){return[(0,r.bF)(t,{name:"Modificaciones por lote:",buttons:e.buttons},null,8,["buttons"]),(0,r.bF)(q,{class:"q-pb-xs"},{default:(0,r.k6)(function(){return[(0,r.Lk)("div",i,[(0,r.Lk)("div",l,[(0,r.bF)(F,{modelValue:e.tipo,"onUpdate:modelValue":o[0]||(o[0]=function(o){return e.tipo=o}),val:2,label:"Título",onInput:e.limpiar},null,8,["modelValue","onInput"]),(0,r.bF)(F,{modelValue:e.tipo,"onUpdate:modelValue":o[1]||(o[1]=function(o){return e.tipo=o}),val:1,label:"Número de ingreso",onInput:e.limpiar},null,8,["modelValue","onInput"])])])]}),_:1}),(0,r.bF)(B),(0,r.bF)(q,null,{default:(0,r.k6)(function(){return[1===e.tipo?((0,r.uX)(),(0,r.CE)("div",s,[(0,r.Lk)("div",c,[(0,r.Lk)("div",u,[(0,r.Lk)("div",d,[(0,r.bF)(T,{modelValue:e.numingreso,"onUpdate:modelValue":o[2]||(o[2]=function(o){return e.numingreso=o}),label:"Número de Ingreso",onKeyup:e.getDataNumeroIngreso},null,8,["modelValue","onKeyup"])]),(0,r.bF)(N,{icon:"broom",dense:"",color:"primary",onClick:e.limpiar},{default:(0,r.k6)(function(){return[(0,r.bF)($,null,{default:(0,r.k6)(function(){return a()(o[13]||(o[13]=[(0,r.eW)("Limpiar",-1)]))}),_:1})]}),_:1},8,["onClick"])])])])):(0,r.Q3)("v-if",!0),2===e.tipo?((0,r.uX)(),(0,r.CE)("div",f,[(0,r.Lk)("div",p,[(0,r.bF)(M,{class:"q-ma-none",label:"Biblioteca",type:"outlined",modelValue:e.biblioteca,"onUpdate:modelValue":o[3]||(o[3]=function(o){return e.biblioteca=o}),options:e.bibliotecas,"option-value":"BIBCOD","option-label":"BIBDESC",onInput:o[4]||(o[4]=function(o){return e.setearColeccion()})},null,8,["modelValue","options"])]),(0,r.Lk)("div",m,[(0,r.bF)(M,{class:"q-ma-none",label:"Colección",type:"outlined",modelValue:e.coleccion,"onUpdate:modelValue":o[5]||(o[5]=function(o){return e.coleccion=o}),options:e.coleccionesBib,"option-value":"COLECOD","option-label":"COLEDES",onInput:o[6]||(o[6]=function(o){return e.getEjemplares()})},null,8,["modelValue","options"])]),(0,r.Lk)("div",b,[(0,r.Lk)("div",v,[(0,r.Lk)("div",h,[(0,r.bF)(R,{class:"q-ma-none",modelValue:e.titulo,"onUpdate:modelValue":o[7]||(o[7]=function(o){return e.titulo=o}),data:e.titulos,keys:e.keysComplete,onSelected:e.selected},null,8,["modelValue","data","keys","onSelected"])]),(0,r.bF)(N,{icon:"search",color:"primary",dense:"",onClick:e.getEjemplares},{default:(0,r.k6)(function(){return[(0,r.bF)($,null,{default:(0,r.k6)(function(){return a()(o[14]||(o[14]=[(0,r.eW)("Buscar",-1)]))}),_:1})]}),_:1},8,["onClick"]),(0,r.bF)(N,{icon:"broom",color:"primary",dense:"",onClick:e.limpiar},{default:(0,r.k6)(function(){return[(0,r.bF)($,null,{default:(0,r.k6)(function(){return a()(o[15]||(o[15]=[(0,r.eW)("Limpiar",-1)]))}),_:1})]}),_:1},8,["onClick"])])])])):(0,r.Q3)("v-if",!0)]}),_:1}),1===e.tipo?((0,r.uX)(),(0,r.Wv)(q,{key:0},{default:(0,r.k6)(function(){return[(0,r.Lk)("div",g,[(0,r.Lk)("div",w,[(0,r.bF)(t,{auto:!1,name:"PROCESAR","font-size":"15px",buttons:e.buttonsProcesar,border:!1},null,8,["buttons"])]),(0,r.Lk)("div",k,[(0,r.bF)(U,{ref:"procesar",columns:e.fields,data:e.rowsProcesar,selection:"multiple",context:n,"load-selection":e.lote,css:{height:"calc(100vh - 310px)"}},null,8,["columns","data","load-selection"])])])]}),_:1})):(0,r.Q3)("v-if",!0),2===e.tipo?((0,r.uX)(),(0,r.Wv)(q,{key:1},{default:(0,r.k6)(function(){return[(0,r.Lk)("div",E,[(0,r.Lk)("div",C,[(0,r.Lk)("div",S,[(0,r.Lk)("div",L,[(0,r.bF)(t,{auto:!1,name:"EJEMPLARES","font-size":"15px",paddingX:"q-px-xs",border:!1,buttons:e.buttonsEjemplares},null,8,["buttons"])]),(0,r.Lk)("div",j,[(0,r.bF)(U,{ref:"ejemplares",columns:e.fields,data:e.rowsEjemplares,selection:"multiple",context:n,css:{height:"calc(100vh - 314px)"}},null,8,["columns","data"])])])]),(0,r.Lk)("div",y,[(0,r.Lk)("div",O,[(0,r.Lk)("div",I,[(0,r.bF)(t,{auto:!1,name:"PROCESAR",border:!1,"font-size":"15px",buttons:e.buttonsProcesar},null,8,["buttons"])]),(0,r.Lk)("div",x,[(0,r.bF)(U,{ref:"procesar",columns:e.fields,data:e.rowsProcesar,selection:"multiple",context:n,"load-selection":e.lote,css:{height:"calc(100vh - 314px)"}},null,8,["columns","data","load-selection"])])])])])]}),_:1})):(0,r.Q3)("v-if",!0),(0,r.bF)(_,{modelValue:e.openModal,"onUpdate:modelValue":o[12]||(o[12]=function(o){return e.openModal=o}),title:"Procesar Lote",onSubmit:e.procesarLote,css:{minWidth:"40vw",maxWidth:"40vw",minHeight:"40vh"}},{default:(0,r.k6)(function(){return[(0,r.bF)(q,null,{default:(0,r.k6)(function(){return[(0,r.Lk)("div",A,[(0,r.Lk)("div",P,[(0,r.bF)(M,{class:"q-ma-none",label:"Acción",type:"outlined",modelValue:e.form.accion,"onUpdate:modelValue":o[8]||(o[8]=function(o){return e.form.accion=o}),options:e.acciones,onInput:o[9]||(o[9]=function(o){return e.selectAcciones()})},null,8,["modelValue","options"])]),"coleccion"===e.form.accion?((0,r.uX)(),(0,r.CE)("div",V,[(0,r.bF)(M,{class:"q-ma-none",label:"Colección",type:"outlined",modelValue:e.form.coleccion,"onUpdate:modelValue":o[10]||(o[10]=function(o){return e.form.coleccion=o}),options:e.colecciones,"option-value":"COLECOD","option-label":"COLEDES"},null,8,["modelValue","options"])])):(0,r.Q3)("v-if",!0),"baja"===e.form.accion?((0,r.uX)(),(0,r.CE)("div",D,[(0,r.bF)(T,{type:"textarea",modelValue:e.form.motivoBaja,"onUpdate:modelValue":o[11]||(o[11]=function(o){return e.form.motivoBaja=o}),label:"Motivo de la baja",rows:"4"},null,8,["modelValue"])])):(0,r.Q3)("v-if",!0)])]}),_:1})]}),_:1},8,["modelValue","onSubmit"])]}),_:1})]}),_:1})}var q=n(76080),B=n.n(q),T=n(45254),$=n.n(T),N=n(41562),M=n.n(N),R=(n(30683),n(23825),n(77507),n(10239),n(89571),n(50310),n(90095),n(70199),n(515),n(83190),n(52776),n(81813),n(7346),n(13715),n(24066),n(6123)),U=n(88567),_=n(95718),Q=n(53380),G=n(9736),W=n(16648),X=n(3042),z=n(99515),H=n(3112),J=n(57668),K=n(85226),Y={components:{QCard:U.A,QCardSection:_.A,QSeparator:Q.A,QInput:G.A,QSelect:W.A,autocomplete:X.A,QRadio:z.A,loading:K.A,QCheckbox:H.A,QPage:R.Tu,QBtn:R.Il,QTooltip:R.nC},computed:{},data:function(){var e=this;return{buttons:[{icon:"cogs",permiso:">1",label:"Procesar",click:this.openModalProcesar}],buttonsProcesar:[{icon:"delete",click:function(){e.quitar(!0)}}],buttonsEjemplares:[{icon:"keyboard_arrow_left",click:this.regresar},{icon:"keyboard_arrow_right",click:this.agregar}],sieInfo:(0,J["default"])(),tipo:2,allTitulos:[],titulos:[],keysComplete:["TITULO","TOTAL","FICHACOD"],bibliotecas:[],coleccionesBib:[],colecciones:[],titulo:"",biblioteca:"",coleccion:"",numingreso:"",fichacod:"",rowsEjemplares:[],rowsProcesar:[],fields:[{name:"NUMINGRESO",label:"# Ingreso",field:"NUMINGRESO",align:"left"},{name:"PARTE",label:"Cod. Clasif.",field:"PARTE",align:"left"},{name:"TITULO",label:"Título",field:"TITULO",align:"left"}],openModal:!1,acciones:[{label:"Asociar a colección",value:"coleccion"},{label:"Dar de baja",value:"baja"},{label:"Revertir baja",value:"revertir_baja"}],form:{accion:"coleccion",lote:[],coleccion:"",motivoBaja:""},lote:{key:"NUMINGRESO",values:[]},loading:!1,sumPorcentage:0}},methods:{selected:function(e){e&&(this.titulo=e.TITULO,this.fichacod=e.FICHACOD,this.getEjemplares())},agregar:function(){var e=this.$refs.ejemplares.rowsSelected(null,null,!0);if(0!==e.length){this.rowsProcesar=this.rowsProcesar.concat(e),this.lote.values=this.$refs.procesar.rowsSelected(["NUMINGRESO"],this.rowsProcesar);var o,n=M()(e);try{for(n.s();!(o=n.n()).done;){var t=o.value;this.rowsEjemplares.splice(this.rowsEjemplares.indexOf(t),1)}}catch(e){n.e(e)}finally{n.f()}}else this.$notify("Debe seleccionar registros","info")},regresar:function(){var e=this.$refs.procesar.rowsSelected(null,null,!0);if(0!==e.length){this.rowsEjemplares=this.rowsEjemplares.concat(e);var o,n=M()(e);try{for(n.s();!(o=n.n()).done;){var t=o.value;this.rowsProcesar.splice(this.rowsProcesar.indexOf(t),1)}}catch(e){n.e(e)}finally{n.f()}this.lote.values=this.$refs.procesar.rowsSelected(["NUMINGRESO"],this.rowsProcesar)}else this.$notify("Debe seleccionar registros","info")},quitar:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=this.$refs.procesar.rowsSelected();if(0!==o.length){e||(this.rowsEjemplares=this.rowsEjemplares.concat(o));var n,t=M()(o);try{for(t.s();!(n=t.n()).done;){var a=n.value;this.rowsProcesar.splice(this.rowsProcesar.indexOf(a),1)}}catch(e){t.e(e)}finally{t.f()}}else this.$notify("Debe seleccionar registros","info")},limpiar:function(){this.numingreso="",this.coleccion="",this.titulo="",this.biblioteca=this.bibliotecas[0].BIBCOD,this.rowsEjemplares=[],this.rowsProcesar=[]},getBibliotecas:function(){var e=this;return $()(B()().m(function o(){var n,t;return B()().w(function(o){while(1)switch(o.p=o.n){case 0:return o.p=0,n={columnas:["bibcod","bibdesc"],joins:[],order:{sidx:"bibdesc",sord:"asc"}},o.n=1,e.$http.get("api/MantenimientosController/getBibliotecas",{params:{parametros:n}});case 1:t=o.v,t.unshift({BIBCOD:"",BIBDESC:"Seleccione..."}),e.bibliotecas=t,e.coleccionesBib=[{COLECOD:"",COLEDES:"Seleccione..."}],o.n=3;break;case 2:o.p=2,o.v,e.bibliotecas=[],e.biblioteca="";case 3:return o.a(2)}},o,null,[[0,2]])}))()},setearColeccion:function(){var e=this;return $()(B()().m(function o(){return B()().w(function(o){while(1)switch(o.n){case 0:return o.n=1,e.getColecciones();case 1:e.coleccionesBib=o.v,e.coleccion="",e.rowsEjemplares=[],e.rowsProcesar=[];case 2:return o.a(2)}},o)}))()},getColecciones:function(){var e=arguments,o=this;return $()(B()().m(function n(){var t,a,r;return B()().w(function(n){while(1)switch(n.p=n.n){case 0:return t=!(e.length>0&&void 0!==e[0])||e[0],n.p=1,a={},t&&(a.bibcod=o.biblioteca),n.n=2,o.$http.get("api/MantenimientosController/getColeccionesBiblioteca",{params:{parametros:a}});case 2:return r=n.v,r.unshift({COLECOD:"",COLEDES:"Seleccione..."}),n.a(2,r);case 3:return n.p=3,n.v,n.a(2,[])}},n,null,[[1,3]])}))()},getTitulos:function(){var e=this;return $()(B()().m(function o(){var n,t;return B()().w(function(o){while(1)switch(o.p=o.n){case 0:return o.p=0,n={columnas:["fichacod","titulo","disponibles","prestados","reservados"],joins:[],order:{sidx:"titulo",sord:"asc"}},o.n=1,e.$http.get("api/MantenimientosController/getTitulos",{params:{parametros:n}});case 1:t=o.v,t.forEach(function(e){var o=e.DISPONIBLES?parseInt(e.DISPONIBLES):0,n=e.PRESTADOS?parseInt(e.PRESTADOS):0,t=e.RESERVADOS?parseInt(e.RESERVADOS):0,a=o+n+t;e.TOTAL="Cant.:".concat(a)}),e.allTitulos=t,e.titulos=JSON.parse(JSON.stringify(t)),o.n=3;break;case 2:o.p=2,o.v,e.allTitulos=[];case 3:return o.a(2)}},o,null,[[0,2]])}))()},getDataNumeroIngreso:function(e){var o=this;return $()(B()().m(function n(){var t,a,r,i,l,s,c,u,d,f,p,m,b,v;return B()().w(function(n){while(1)switch(n.p=n.n){case 0:if(n.p=0,13===e.keyCode){n.n=1;break}return n.a(2);case 1:if(o.numingreso){n.n=2;break}return o.$notify("Aviso - Debe indicar un numero de ingreso.","warning"),n.a(2);case 2:o.numingreso=(o.numingreso||"").replace(/\s|'|"/g,""),t=o.numingreso.split(","),a=!1,t.length>1&&(a=!0),r=[],i={},l=[],s=M()(o.rowsProcesar);try{for(s.s();!(c=s.n()).done;)u=c.value,i[u.NUMINGRESO]=u}catch(e){s.e(e)}finally{s.f()}d=M()(t);try{for(d.s();!(f=d.n()).done;)p=f.value,i[p]?r.push(p):l.push(p)}catch(e){d.e(e)}finally{d.f()}if(m=l.join(","),r.length>0&&o.$alert("Aviso- Los siguientes valores fueron retirados por duplicidad: <b>".concat(r.join(", "),"</b>"),"warning",!0),m){n.n=3;break}return n.a(2,!1);case 3:return b={numingreso:m,multiples:a},n.n=4,o.getEjemplaresApi(b);case 4:v=n.v,o.rowsProcesar=o.rowsProcesar.concat(v),o.lote.values=o.$refs.procesar.rowsSelected(["NUMINGRESO"],o.rowsProcesar),o.numingreso="",n.n=6;break;case 5:n.p=5,n.v,o.rowsProcesar=[];case 6:return n.a(2)}},n,null,[[0,5]])}))()},getEjemplares:function(){var e=this;return $()(B()().m(function o(){var n;return B()().w(function(o){while(1)switch(o.p=o.n){case 0:if(o.p=0,e.titulo||e.biblioteca||e.coleccion){o.n=1;break}return e.$notify("Aviso - Debe indicar datos para la consulta","warning"),o.a(2);case 1:return n={bibcod:e.biblioteca,colecod:e.coleccion,titulo:e.titulo,fichacod:e.fichacod},o.n=2,e.getEjemplaresApi(n);case 2:e.rowsEjemplares=o.v,o.n=4;break;case 3:o.p=3,o.v,e.rowsEjemplares=[];case 4:return o.a(2)}},o,null,[[0,3]])}))()},getEjemplaresApi:function(e){var o=this;return $()(B()().m(function n(){return B()().w(function(n){while(1)switch(n.n){case 0:return n.a(2,o.$http.get("api/MantenimientosController/getEjemplares",{params:{parametros:e}}))}},n)}))()},selectAcciones:function(){var e=this;return $()(B()().m(function o(){var n;return B()().w(function(o){while(1)switch(o.n){case 0:if("coleccion"!==e.form.accion){o.n=3;break}if(0!==e.colecciones.length){o.n=2;break}return o.n=1,e.getColecciones(!1);case 1:n=o.v,e.colecciones=n,e.form.coleccion=n[0].COLECOD;case 2:o.n=4;break;case 3:e.form.motivoBaja="";case 4:return o.a(2)}},o)}))()},openModalProcesar:function(){var e=this.$refs.procesar.rowsSelected(["NUMINGRESO"]);0!==e.length?(this.form.lote=e,this.openModal=!0,this.selectAcciones()):this.$notify("Debe seleccionar los registros a procesar","info")},procesarLote:function(){var e=this;return $()(B()().m(function o(){var n,t,a,r,i,l;return B()().w(function(o){while(1)switch(o.p=o.n){case 0:if(o.p=0,n="",""!==e.form.accion){o.n=1;break}return e.$notify("Aviso- Seleccione una acción.","info"),o.a(2);case 1:if("coleccion"!==e.form.accion){o.n=2;break}if(n="Se asociarán los ejemplares a la colección elegida",e.form.coleccion){o.n=2;break}return e.$notify("Aviso- Seleccione una colección.","info"),o.a(2);case 2:if("baja"!==e.form.accion){o.n=3;break}if(n="Se darán de baja los ejemplares",e.form.motivoBaja){o.n=3;break}return e.$notify("Aviso- Seleccione una colección.","info"),o.a(2);case 3:return"revertir_baja"===e.form.accion&&(n="Se revertirá la baja de los ejemplares"),o.n=4,e.$confirmar("".concat(n," ¿Esta seguro de procesar el lote?"),"warning",!0);case 4:if(t=o.v,!t){o.n=6;break}return o.n=5,e.$http.post("api/MantenimientosController/procesarLote",{data:e.form});case 5:a=o.v,r=a.message,i=a.data,e.$alert(r,i.type,!0),e.openModal=!1,e.limpiar();case 6:return o.a(2,!0);case 7:return o.p=7,l=o.v,e.$notify(l.message,"warning"),o.a(2,!1)}},o,null,[[0,7]])}))()}},created:function(){var e=this;return $()(B()().m(function o(){return B()().w(function(o){while(1)switch(o.n){case 0:e.titulo="",e.getBibliotecas(),e.getTitulos();case 1:return o.a(2)}},o)}))()}},Z=n(12807);const ee=(0,Z.A)(Y,[["render",F]]);var oe=ee}}]);