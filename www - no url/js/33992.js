"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[33992],{33992:function(e,a,l){l.r(a),l.d(a,{default:function(){return b}});var n=l(61758),t=l(29104);function i(e,a){var l=this,i=(0,n.g2)("sie-upload"),o=(0,n.g2)("sie-table"),r=(0,n.g2)("sie-modal"),c=(0,n.g2)("header-btn"),s=(0,n.g2)("q-card"),d=(0,n.g2)("q-page");return(0,n.uX)(),(0,n.Wv)(d,{class:"intranet--gestion-calidad bg-white q-pt-md q-px-sm"},{default:(0,n.k6)(function(){return[(0,n.bo)((0,n.bF)(i,{allow:["xlsx","xls"],onUpload:e.uploadExcel,ref:"upload"},null,8,["onUpload"]),[[t.aG,!1]]),(0,n.bF)(r,{title:"Detalle de importación",modelValue:e.detalleImportacion,"onUpdate:modelValue":a[0]||(a[0]=function(a){return e.detalleImportacion=a}),footer:!1},{default:(0,n.k6)(function(){return[(0,n.bF)(o,{class:"q-mt-xs",dense:"",flat:"",bordered:"","wrap-cells":"",context:l,columns:e.columnsDetalle,data:e.dataDetalle,config:e.configDetalle,"hide-bottom":!0,"show-search":!1},null,8,["columns","data","config"])]}),_:1},8,["modelValue"]),(0,n.bF)(r,{title:"Observaciones",modelValue:e.detalleObservaciones,"onUpdate:modelValue":a[1]||(a[1]=function(a){return e.detalleObservaciones=a}),footer:!1},{default:(0,n.k6)(function(){return[(0,n.bF)(o,{class:"q-mt-xs",dense:"",flat:"",bordered:"","wrap-cells":"",context:l,columns:e.columnsObservacion,data:e.dataObservacion,config:e.columnsObservacion,"hide-bottom":!1,"show-search":!1,css:"height: calc(100vh - 130px)"},null,8,["columns","data","config"])]}),_:1},8,["modelValue"]),(0,n.bF)(s,{class:"layout-v1 my-card",flat:"",bordered:""},{default:(0,n.k6)(function(){return[(0,n.bF)(c,{name:"Importación de datos",buttons:e.buttons},null,8,["buttons"])]}),_:1}),(0,n.bF)(o,{class:"q-mt-xs",loadSelection:e.load,ref:"tablaIndicadores",dense:"",flat:"",bordered:"","wrap-cells":"",selection:"multiple",css:"height: calc(100vh - 130px)","show-search":!0,context:l,columns:e.columns,data:e.indicadores,config:e.config,selected:e.indicadoresSelect},null,8,["loadSelection","columns","data","config","selected"])]}),_:1})}var o=l(76080),r=l.n(o),c=l(8445),s=l.n(c),d=l(45254),I=l.n(d),E=(l(23825),l(10239),l(50310),l(90095),l(83190),l(13715),l(24066),l(2819)),O=l(57668),u=l(59089),A=l(33950),f=l(30640),D=l(33777),m=l(88567),h=l(95718),p=l(6123),R={components:{SieUpload:u.A,SieTable:D.A,sieModal:f.A,QCard:m.A,QCardSection:h.A,QInnerLoading:p.SQ,QSpinnerGears:p.hV,QSpinnerFacebook:p.Pv,QPage:p.Tu},data:function(){return{acceso:(0,O["default"])().ruta.nivel,cargando:!1,file:{},indicadores:[],load:{values:[],key:"CODIGO"},indicadoresSelect:[],detalleImportacion:!1,detalleObservaciones:!1,dataDetalle:[],columnsDetalle:[{name:"ANIO",label:this.$t("AÑO"),align:"center",field:"ANIO"},{name:"META",label:this.$t("META ANUAL"),align:"center",field:"META"},{name:"AGRUPADOR",label:this.$t("AGRUPADOR"),align:"center",field:"AGRUPADOR"},{name:"NUMERADOR",label:this.$t("NUMERADOR"),align:"center",field:"NUMERADOR"},{name:"DENOMINADOR",label:this.$t("DENOMINADOR"),align:"center",field:"DENOMINADOR"}],dataObservacion:[],columnsObservacion:[{name:"IDINDICADOR",label:this.$t("IDINDICADOR"),align:"center",field:"IDINDICADOR"},{name:"TITULO",label:this.$t("TITULO"),align:"center",field:"TITULO"},{name:"MENSAJE",label:this.$t("MENSAJE"),align:"center",field:"MENSAJE"}],configDetalle:{flat:!0,round:!0,color:"secondary"},columns:[{name:"IDINDICADOR",label:this.$t("N°"),align:"center",field:"IDINDICADOR"},{name:"TITULO",label:this.$t("NOMBRE DEL INDICADOR"),align:"center",field:"TITULO"},{name:"CRITERIO",label:this.$t("CRITERIO"),align:"center",field:"CRITERIO"},{name:"FORMULA",label:this.$t("FORMULA"),align:"center",field:"FORMULA"},{name:"CODSPROCESO",label:this.$t("SUBPROCESO"),align:"center",field:"CODSPROCESO"},{name:"TIPO",label:this.$t("TIPO"),align:"center",field:"TIPO"},{name:"CATEGORIA",label:this.$t("CATEGORIA"),align:"center",field:"CAMPO"},{name:"META_VISUAL",label:this.$t("META GLOBAL"),align:"center",field:"META_VISUAL"},{name:"TENDENCIADES",label:this.$t("TENDENCIA ESPERADA"),align:"center",field:"TENDENCIADES"},{name:"FRECUENCIA",label:this.$t("FRECUENCIA DE MEDICIÓN"),align:"center",field:"FRECUENCIA"},{name:"FUENTE",label:this.$t("FUENTE DE INFORMACIÓN"),align:"center",field:"FUENTE"},{name:"DETALLE",label:this.$t("INFORMACIÓN DE REPORTE"),align:"center",field:"DETALLE"}],config:{fields:[{name:"IDINDICADOR",label:this.$t("N°"),align:"center",field:"IDINDICADOR"},{name:"TITULO",label:this.$t("NOMBRE DEL INDICADOR"),align:"center",field:"TITULO"},{name:"CRITERIO",label:this.$t("CRITERIO"),align:"center",field:"CRITERIO"},{name:"FORMULA",label:this.$t("FORMULA"),align:"center",field:"FORMULA"},{name:"CODSPROCESO",label:this.$t("SUBPROCESO"),align:"center",field:"CODSPROCESO"},{name:"TIPO",label:this.$t("TIPO"),align:"center",field:"TIPO"},{name:"CATEGORIA",label:this.$t("CATEGORIA"),align:"center",field:"CAMPO"},{name:"META_VISUAL",label:this.$t("META GLOBAL"),align:"center",field:"META_VISUAL"},{name:"TENDENCIADES",label:this.$t("TENDENCIA ESPERADA"),align:"center",field:"TENDENCIADES"},{name:"FRECUENCIA",label:this.$t("FRECUENCIA DE MEDICIÓN"),align:"center",field:"FRECUENCIA"},{name:"FUENTE",label:this.$t("FUENTE DE INFORMACIÓN"),align:"center",field:"FUENTE"}],DETALLE:{flat:!0,component:"button",icon:["remove_red_eye"],preventCell:!0,tooltip:{print:"Ver Detalle"},remove_red_eye:function(e){this.showDetalle(e.DETALLE)}},flat:!0,round:!0,color:"primary"}}},methods:{showDetalle:function(e){e&&e.length>0?(this.detalleImportacion=!0,this.dataDetalle=e):this.$notify("No hay información adicional por mostrar","error")},exportarPlantilla:function(){var e="intranet/reporte-node/reporte";(0,E.exportFilePhp)({repcod:"gestionCalidad"},e)},importFile:function(){this.$refs.upload.$el.querySelector("input").click()},addFile:function(e){var a=this;(0,A.Upload)({url:"",file:e[0]}).then(function(e){a.file=e}).catch(function(){})},uploadExcel:function(e){var a=this;return I()(r()().m(function l(){var n,t,i,o,c,d;return r()().w(function(l){while(1)switch(l.p=l.n){case 0:return n=e[0],l.p=1,l.n=2,(0,A.Upload)({url:"api/HyoArchivo/tmp/upload",file:n});case 2:return t=l.v,l.n=3,a.$http.post("api/CcIndicadorController/preImport",{pathFile:t});case 3:i=l.v,o=i.observaciones,c=i.data,a.dataObservacion=o,a.indicadores=s()(c),a.load.values=s()(c),a.load.key="CODIGO",a.detalleObservaciones=o&&o.length>0,l.n=5;break;case 4:l.p=4,d=l.v,console.log(d);case 5:return l.a(2)}},l,null,[[1,4]])}))()},procesarInfo:function(){var e=this;return I()(r()().m(function a(){var l,n;return r()().w(function(a){while(1)switch(a.n){case 0:if(!(e.$refs.tablaIndicadores.rowsSelected().length>0)){a.n=2;break}return e.cargando=!0,e.$q.loading.show({spinner:p.Pv,spinnerSize:100,message:"Procesando..."}),l=[],e.$refs.tablaIndicadores.rowsSelected().forEach(function(e){var a=e.AGRUPAMIENTO,n=e.IDINDICADOR,t=e.IDPROCESO,i=e.IDTIPO,o=e.IDCAMPO,r=e.IDCRITERIO,c=e.TITULO,s=e.TIPO_REPORTE,d=e.META_GLOBAL,I=e.FORMULA,E=e.TENDENCIA,O=e.FRECUENCIA,u=e.NIVEL_CUMPLIMIENTO,A=e.DETALLE,f=e.ORDEN;l.push({AGRUPAMIENTO:a,IDINDICADOR:n,IDPROCESO:t,IDTIPO:i,IDCAMPO:o,META_GLOBAL:d,TENDENCIA:E,TITULO:c,FRECUENCIA:O,FORMULA:I,NIVEL_CUMPLIMIENTO:u,DETALLE:A,TIPO_REPORTE:s,IDCRITERIO:r,ORDEN:f})}),a.n=1,e.$http.post("api/CcIndicadorController/importarData",{data:l});case 1:n=a.v,setTimeout(function(){"listo"===n&&(e.$notify("Registros importados correctamente"),e.indicadores=[]),e.cargando=!1,e.$q.loading.hide()},"5000"),a.n=3;break;case 2:e.$notify("No hay información por procesar","warning");case 3:return a.a(2)}},a)}))()}},computed:{buttons:function(){var e=this,a=[];return a.push({icon:"cogs",label:"Procesar",tooltip:"Procesar Informacion",permiso:">= 2",click:function(){e.procesarInfo()},loading:this.cargando}),a.push({icon:"file_import",label:"Imp. Archivo",tooltip:"Importar Archivo",permiso:">= 2",click:function(){e.importFile()},loading:this.cargando}),a.push({icon:"import_export_excel",label:"Desc. Plantilla",tooltip:"Descargar Plantilla",permiso:">= 2",click:function(){e.exportarPlantilla()},loading:this.cargando}),a}}},C=l(12807);const T=(0,C.A)(R,[["render",i]]);var b=T}}]);