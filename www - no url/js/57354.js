"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[57354],{57354:function(e,t,i){i.r(t),i.d(t,{default:function(){return be}});var s=i(61758);function n(e,t){var i=(0,s.g2)("acceso"),n=(0,s.g2)("q-page");return(0,s.uX)(),(0,s.Wv)(n,null,{default:(0,s.k6)(function(){return[(0,s.bF)(i)]}),_:1})}var l=i(6123),o=(i(71225),i(50310),i(5962),i(83190),i(58790)),r={class:"components--acceso-menu q-pa-sm"},a={class:"row q-col-gutter-sm"},u={class:"col-md-6 col-xs-12"},c={class:"row q-col-gutter-sm"},d={class:"col-12"},p={class:"col-12"},f={class:"col-12"},h={class:"col-12"},m={class:"q-table q-table-horizontal-separator q-card newHead"},v=["onClick"],b={key:1,class:"col-12"},g={class:"col-md-6 col-xs-12"},k={key:0,class:"row q-col-gutter-sm"},S={class:"col-12"},y={class:"col-12"},L={class:"col-12"},M={class:"q-table q-table-horizontal-separator q-card newHead"},w={class:"column"},I={class:"col"},A={key:0,class:"col caption"},C={class:"text-center"},x={colspan:"3"},U={class:"row justify-end"},q={class:"text-bold"};function E(e,t){var i=(0,s.g2)("header-btn"),n=(0,s.g2)("q-select"),l=(0,s.g2)("q-icon"),E=(0,s.g2)("q-input"),O=(0,s.g2)("q-scroll-area"),_=(0,s.g2)("sie-select"),F=(0,s.g2)("sie-vacio"),P=(0,s.g2)("q-card-section"),V=(0,s.g2)("q-card");return(0,s.uX)(),(0,s.CE)("div",r,[(0,s.bF)(V,{flat:"",bordered:""},{default:(0,s.k6)(function(){return[(0,s.bF)(i,{class:"q-card",name:e.menunom,buttons:e.buttons},null,8,["name","buttons"]),(0,s.bF)(P,null,{default:(0,s.k6)(function(){return[(0,s.Lk)("div",a,[(0,s.Lk)("div",u,[(0,s.Lk)("div",c,[(0,s.Lk)("div",d,[(0,s.bF)(n,{modelValue:e.sistSelect,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.sistSelect=t}),outlined:"",options:e.sistemas,label:"Modulos","option-value":"SISCOD","option-label":"SISNOM",onInput:e.init},null,8,["modelValue","options","onInput"])]),(0,s.Lk)("div",p,[(0,s.bF)(n,{modelValue:e.tipoSelect,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.tipoSelect=t}),outlined:"",options:e.tipos,label:"Tipo de usuario","option-value":"TIPCOD","option-label":"TIPNOM",onInput:e.cargarMenus},null,8,["modelValue","options","onInput"])]),e.isGreater?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.Lk)("div",f,[(0,s.bF)(E,{modelValue:e.filter,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.filter=t})},{prepend:(0,s.k6)(function(){return[(0,s.bF)(l,{name:"search"})]}),_:1},8,["modelValue"])]),(0,s.Lk)("div",h,[(0,s.bF)(O,{style:(0,o.Tr)([{height:e.alto},{overflow:"auto"}])},{default:(0,s.k6)(function(){return[(0,s.Lk)("table",m,[t[6]||(t[6]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",{class:"text-bold"},[(0,s.Lk)("th",null,[(0,s.Lk)("div",{class:"text-bold"},"Usuario")])])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.listaMEnus,function(t){return(0,s.uX)(),(0,s.CE)("tr",{class:(0,o.C4)({"custom-selected":e.menuSelect===t.MENUCOD}),onClick:function(i){return e.seleccionarMenu(t)}},[(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,o.C4)(["derecha-"+t.margen])},(0,o.v_)(t.MENUNOM),3)])],10,v)}),256))])])]}),_:1},8,["style"])])],64)):((0,s.uX)(),(0,s.CE)("div",b,[(0,s.bF)(_,{class:"menus",modelValue:e.menuSelect,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.menuSelect=t}),options:e.listaMEnus,label:"MENUNOM",val:"MENUCOD",type:"outlined",placeholder:"Menu","no-bottom":"",onSelected:e.seleccionarMenu,chilName:"submenus"},null,8,["modelValue","options","onSelected"])]))])]),(0,s.Lk)("div",g,[e.menuSelect?((0,s.uX)(),(0,s.CE)("div",k,[(0,s.Lk)("div",S,[(0,s.bF)(n,{label:"Perfil",options:e.perfiles,modelValue:e.perfilSelect,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.perfilSelect=t}),"option-value":"TIPCOD","option-label":"TIPNOM",onInput:e.filtrarUsuarios},null,8,["options","modelValue","onInput"])]),(0,s.Lk)("div",y,[(0,s.bF)(E,{modelValue:e.filterUsuarios,"onUpdate:modelValue":t[5]||(t[5]=function(t){return e.filterUsuarios=t})},{prepend:(0,s.k6)(function(){return[(0,s.bF)(l,{name:"search"})]}),_:1},8,["modelValue"])]),(0,s.Lk)("div",L,[(0,s.bF)(O,{style:(0,o.Tr)({height:e.altoUsuarios})},{default:(0,s.k6)(function(){return[(0,s.Lk)("table",M,[t[7]||(t[7]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",{class:"text-bold"},[(0,s.Lk)("th",null,[(0,s.Lk)("div",{class:"text-bold"},"Usuario")]),(0,s.Lk)("th",null,[(0,s.Lk)("div",{class:"text-bold"},"Apellidos y Nombres")]),(0,s.Lk)("th",null,[(0,s.Lk)("div",{class:"text-bold"},"Acceso")])])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.usuariosMenu,function(t){return(0,s.uX)(),(0,s.CE)("tr",null,[(0,s.Lk)("td",null,(0,o.v_)(t.USUCOD),1),(0,s.Lk)("td",null,[(0,s.Lk)("div",w,[(0,s.Lk)("span",I,(0,o.v_)(t.USUNOM),1),"T"===e.perfilSelect?((0,s.uX)(),(0,s.CE)("span",A,(0,o.v_)(t.TIPNOM),1)):(0,s.Q3)("v-if",!0)])]),(0,s.Lk)("td",C,[(0,s.Lk)("span",null,(0,o.v_)(t.PERMISODES),1)])])}),256))]),(0,s.Lk)("tfoot",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("td",x,[(0,s.Lk)("div",U,[(0,s.Lk)("div",q,"Total: "+(0,o.v_)(e.usuariosMenu.length)+"Â ",1)])])])])])]}),_:1},8,["style"])])])):((0,s.uX)(),(0,s.Wv)(F,{key:1,class:"col column bordered",icon:"sieweb",title:e.menunom,subtitle:"Debe seleccionar un Menu para revisar los usuarios"},null,8,["title"]))])])]}),_:1})]}),_:1})])}var O=i(76080),_=i.n(O),F=i(45254),P=i.n(F),V=(i(10239),i(90095),i(515),i(13715),i(96122)),$=i(16648),D=i(65673),Q=i(82327),T=i(66824),N=i(88865),X=i(9736),B=i(88567),R=i(95718),z=i(57668),H=i(33001),K=i(36493),G=i(2819),W=i(80340),j=i(81288),Z={class:"sie-select"},J={class:"col q-input-target ellipsis"},Y={key:0},ee={key:1,style:{opacity:"0.6"}};function te(e,t){var i=(0,s.g2)("q-icon"),n=(0,s.g2)("q-search"),l=(0,s.g2)("q-item-main"),r=(0,s.g2)("q-item"),a=(0,s.g2)("virtual-list"),u=(0,s.g2)("q-loading"),c=(0,s.g2)("q-input-frame");return(0,s.uX)(),(0,s.CE)("div",Z,[(0,s.bF)(c,{class:(0,o.C4)(["q-select",[e.classSelect,e.noBottom?"no-bottom":null,e.noMargin?"no-margin":null]]),"float-label":e.$floatLabel,focused:e.openList,focusable:!0,onClick:e.togglePopup,onFocus:e.focus,inverted:e.inverted,length:e.length,disable:!e.editable},{after:(0,s.k6)(function(){return[(0,s.Lk)("div",null,[(0,s.bF)(i,{class:"q-if-control",name:e.openList?"arrow_drop_up":"arrow_drop_down"},null,8,["name"])]),((0,s.uX)(),(0,s.Wv)((0,s.$y)(e.hasTouch?"q-modal":"q-popover"),{class:"q-popover-select",onShow:t[1]||(t[1]=function(t){return e.toggle(!0)}),onHide:t[2]||(t[2]=function(t){return e.toggle(!1)}),ref:"popover",cover:!0,"keep-on-screen":!0,disable:!e.editable,onKeydown:e.keyboardEvent,"anchor-click":!1},{default:(0,s.k6)(function(){return[e.openList?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[e.options&&e.options.length>e.maxItems?((0,s.uX)(),(0,s.Wv)(n,{key:0,modelValue:e.filter,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.filter=t}),"no-icon":e.noIcon,autofocus:!0,style:{padding:"10px"},clearable:!0,ref:"filter"},null,8,["modelValue","no-icon"])):(0,s.Q3)("v-if",!0),(0,s.bF)(a,{size:e.heightDefault,remain:e.maxItems,start:e.start,wclass:"q-list no-border",ref:"vl",options:e.filterOptions,dense:!0},{item:(0,s.k6)(function(t){var i=t.item,n=t.index;return[(0,s.bF)(r,{link:"",tabindex:"-1",onClick:function(t){return e.select(i,n)},class:(0,o.C4)({"q-select-highlight":e.start===n})},{default:(0,s.k6)(function(){return[(0,s.RG)(e.$slots,"default",{item:i,index:n,label:e.getLabel(i)},function(){return[(0,s.bF)(l,{label:e.getLabel(i),class:(0,o.C4)(["derecha-"+i.margen])},null,8,["label","class"])]})]}),_:2},1032,["onClick","class"])]}),_:3},8,["size","remain","start","options"])],64)):((0,s.uX)(),(0,s.Wv)(u,{key:1}))]}),_:3},40,["disable","onKeydown"]))]}),default:(0,s.k6)(function(){return[(0,s.Lk)("div",J,[e.length?((0,s.uX)(),(0,s.CE)("div",Y,(0,o.v_)(e.text),1)):((0,s.uX)(),(0,s.CE)("div",ee,(0,o.v_)(e.$placeholder),1))]),(0,s.RG)(e.$slots,"main")]}),_:3},8,["class","float-label","focused","onClick","onFocus","inverted","length","disable"])])}i(11777),i(27153);var ie=i(41597),se=i(34858),ne=i(78786),le=i(13813),oe=i(60845),re=function(e){var t;return t=e?"arrow_drop_up":"arrow_drop_down",[{icon:t}]},ae={emits:["focus","blur","update:modelValue","input","selected"],components:{QSearch:l.Ks,QInputFrame:l.jf,QPopover:l.VM,QList:l.Mb,QItem:l.H0,virtualList:se.Ay,QModal:l.tU,QLoading:oe.A,QScrollArea:V.A,QIcon:l.bP,QItemMain:l.mF},props:{preSelect:{required:!1},modelValue:{required:!1},placeholder:{type:String},options:{type:Array},filterMode:{type:Number,default:1},label:{type:String},val:{type:String},noIcon:{type:Boolean,default:!1},height:{type:Number,default:40},inverted:{type:Boolean,default:!1},type:{type:String,default:"basic",validator:function(e){return["basic","outlined","filled"].indexOf(e)>=0}},disable:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},noBottom:{type:Boolean,default:!1},noMargin:{type:Boolean,default:!1},chilName:{type:String,default:"children"}},data:function(){return{text:null,icon:re(!1),open:!1,start:0,currentStart:0,filterOptions:null,filter:"",heightDefault:this.height,multiple:!1,maxItems:j.isMobil?5:8,openList:!1,hasTouch:!!ie.Ay.has.touch}},computed:{length:function(){return[null,void 0,""].indexOf(this.text)>=0?0:1},classSelect:function(){return"outlined"===this.type?"q-if-outlined":"filled"===this.type?"q-if-filled":""},editable:function(){return!this.disable&&!this.readonly},$placeholder:function(){if(!this.placeholder)return this.$t("siecombo")},$floatLabel:function(){if(this.placeholder)return this.$t(this.placeholder)}},methods:{isChildren:function(e){return e[this.chilName]&&e[this.chilName].length>0},childrenArray:function(e){return e[this.chilName]},keyboardEvent:function(e){if(e){var t=e.keyCode;40===t?this.keyboardDirection(e,1):38===t?this.keyboardDirection(e,-1):13===t&&this.keyboardSelect(e)}},keyboardDirection:function(e,t){e.preventDefault(),e.stopPropagation();var i=this.start+t,s=this.filterOptions.length-1,n=0;i<n?i=0:i>s&&(i=s),this.start=i},keyboardSelect:function(e){e.preventDefault(),e.stopPropagation(),this.filterOptions[this.start]&&this.select(this.filterOptions[this.start],this.start)},togglePopup:function(){this.$refs.popover&&this[this.$refs.popover.showing?"hide":"show"]()},show:function(){return this.$refs.popover?this.$refs.popover.show():Promise.resolve()},hide:function(){return this.$refs.popover?this.$refs.popover.hide():Promise.resolve()},focus:function(e){if(this.editable){if(this.hasTouch){var t=this.options&&this.options.length>this.maxItems?44:0;this.maxItems=Math.floor((.8*window.innerHeight-t)/this.heightDefault)}this.$emit("focus",e)}},blur:function(e){this.$emit("blur",e)},setOptions:function(){var e=this.filter;if(e&&"string"===typeof e){var t=1===this.filterMode?this.label:[this.label,this.val];this.filterOptions=(0,H.filterArray)(e,{field:t,list:this.options})}else this.filterOptions=this.options},getStart:function(e){return e&&"number"===typeof e&&e>0?e:0},getValue:function(e){return(0,le.getProp)(e,this.val)},getLabel:function(e){return(0,le.getProp)(e,this.label)+""},getIndex:function(e){return(0,ne["default"])(this.options,e,{key:this.val})},getItem:function(e){var t=this.getValue(e),i=this.getLabel(e),s=this.getIndex(t);return console.log({value:t,label:i,index:s}),{value:t,label:i,index:s}},select:function(e,t,i){var s=this,n=Promise.resolve(!0);this.preSelect&&("function"===typeof this.preSelect.then?(this.hide(),n=this.preSelect):"function"===typeof this.preSelect&&(this.hide(),n=this.preSelect())),n.then(function(){var t=s.getItem(e);(i||t.value!==s.modelValue)&&(s.currentStart=s.getStart(t.index),s.hide(),s.text=t.label,s.$emit("update:modelValue",t.value),s.$emit("input",t.value),s.$emit("selected",e))}).catch(function(e){})},setText:function(e){if(Array.isArray(this.options)){if(e&&1===this.options.length)return this.select(this.options[0],0,!0),void(this.filterOptions=[]);var t=this.getIndex(this.modelValue);if(t>=0)return this.currentStart=t,void(this.text=this.getLabel(this.options[t]))}this.currentStart=0,this.text=null},init:function(e){this.setOptions(),this.setText(e)},toggle:function(e){e?(this.start=this.getStart(this.currentStart),this.$refs.filter&&this.$refs.filter.focus()):(this.blur({}),this.filter=""),this.openList=e,this.reloadPosition()},reloadPosition:function(){this.$refs.popover&&"function"===typeof this.$refs.popover.__updatePosition&&this.$refs.popover.__updatePosition()}},watch:{filter:function(e){this.setOptions()},modelValue:function(e){this.setText()},options:function(e){this.init(!0)},filterOptions:function(){var e=this;setTimeout(function(){e.reloadPosition()})}},created:function(){this.init(!0)}},ue=i(12807);const ce=(0,ue.A)(ae,[["render",te]]);var de=ce,pe={components:{QSelect:$.A,QList:D.A,QItem:Q.A,QItemMain:l.mF,QInput:X.A,QCard:B.A,QCardSection:R.A,QListHeader:l.XR,QItemSection:N.A,QItemLabel:T.A,QCheckbox:l.vZ,QScrollArea:V.A,SieVacio:W.A,sieSelect:de,QIcon:l.bP},data:function(){return{sistemas:[],sistSelect:(0,z["default"])().siscod,menunom:(0,z["default"])().ruta.titulo,tipoSelect:null,tipos:[],listaMEnusBase:[],listaMEnus:[],alto:0,altoUsuarios:0,filter:"",menuSelect:null,usuariosBase:[],usuariosMenu:[],estadoSelect:"A",perfilSelect:null,perfiles:[],filterUsuarios:"",cantidad:{},estadoUsuario:"A",estados:[{label:"Todos",value:"T"},{label:"Activos",value:"A"},{label:"Inactivos",value:"I"}],accesos:[{label:"Sin Acceso",value:null},{label:"Solo Lectura",value:"1"},{label:"Lectura y escritura",value:"2"},{label:"Acceso Total",value:"3"}]}},methods:{init:function(){var e=this;return P()(_()().m(function t(){var i,s,n,l;return _()().w(function(t){while(1)switch(t.n){case 0:return i={siscod:e.sistSelect},t.n=1,e.$http.get("api/AuditoriaMenuController/getCargaInicial",{params:{params:i}});case 1:s=t.v,n=s.tipos,l=s.sistemas,e.sistemas=l,e.tipos=n,n.length>0?e.tipoSelect=null:e.tipoSelect=n[0].TIPCOD,e.cargarMenus();case 2:return t.a(2)}},t)}))()},cargarMenus:function(){var e=this;return P()(_()().m(function t(){var i,s,n;return _()().w(function(t){while(1)switch(t.n){case 0:return i=e.tipoSelect,s=e.sistSelect,n={tipcod:i,siscod:s},t.n=1,e.$http.get("api/AuditoriaMenuController/getMenus",{params:{params:n}});case 1:e.listaMEnusBase=t.v,e.menuSelect=null,e.usuariosBase=[],e.usuariosMenu=[],e.perfiles=[],e.perfilSelect=null,e.estadoUsuario="A",e.cantidad={},e.filtrarData();case 2:return t.a(2)}},t)}))()},handleResize:function(){var e=(0,j.isGreater)()?245:350;this.alto=window.innerHeight-e+"px",this.altoUsuarios=window.innerHeight-e+"px"},filtrarData:function(){this.filter&&this.filter.length>0?this.listaMEnus=(0,H.filterArray)(this.filter,{field:"MENUNOM",list:this.listaMEnusBase})||[]:this.listaMEnus=this.listaMEnusBase},seleccionarMenu:function(e){var t=this;return P()(_()().m(function i(){var s,n,l,o;return _()().w(function(i){while(1)switch(i.n){case 0:return t.menuSelect=e.MENUCOD,i.n=1,t.$http.get("api/AuditoriaMenuController/getUsuariosMenu",{params:{params:{menucod:t.menuSelect,estado:t.estadoSelect,siscod:t.sistSelect,tipo:t.tipoSelect,activo:t.estadoUsuario}}});case 1:s=i.v,n=s.menus,l=s.tipos,o=s.valorActual,t.perfiles=l,t.usuariosBase=n,t.usuariosMenu=[],t.perfilSelect=o,t.cantidad={},t.filtrarUsuarios();case 2:return i.a(2)}},i)}))()},filtrarUsuarios:function(){if("T"!==this.perfilSelect?this.usuariosMenu=(0,H.filterArray)(this.perfilSelect,{field:"TIPCOD",list:this.usuariosBase})||[]:this.usuariosMenu=this.usuariosBase,this.filterUsuarios&&this.filterUsuarios.length>0&&(this.usuariosMenu=(0,H.filterArray)(this.filterUsuarios,{field:"USUNOM",list:this.usuariosBase})||[]),"T"===this.estadoSelect){var e=(0,K["default"])(this.usuariosMenu,"ESTADO");Object.keys(e).forEach(function(t){e[t]=e[t].length}),this.cantidad={Activos:e["S"],Inactivos:e["N"]||0}}},imprimirReporte:function(e){var t={repcod:"reporteAuditoriaMenus",menucod:this.menuSelect,estado:this.estadoSelect,siscod:this.sistSelect,tipo:this.tipoSelect,activo:this.estadoUsuario,formato:e};(0,G.exportFilePhp)(t,"webservice/reportes/reporte","reporteAuditoriaMenus")},imprimirReportePDF:function(){this.imprimirReporte("pdf")},imprimirReporteXLS:function(){this.imprimirReporte("xls")}},computed:{buttons:function(){var e=[];return this.menuSelect&&(e.push({label:"Imp, Excel",icon:"file_excel",click:this.imprimirReporteXLS}),e.push({label:"Imp. PDF",icon:"file_pdf_o",click:this.imprimirReportePDF})),e},isGreater:function(){return(0,j.isGreater)()}},watch:{filter:function(){this.filtrarData()},filterUsuarios:function(){this.filtrarUsuarios()}},mounted:function(){var e=this;return P()(_()().m(function t(){return _()().w(function(t){while(1)switch(t.n){case 0:e.init(),window.addEventListener("resize",e.handleResize),e.handleResize();case 1:return t.a(2)}},t)}))()}};const fe=(0,ue.A)(pe,[["render",E]]);var he=fe,me={components:{acceso:he,QPage:l.Tu}};const ve=(0,ue.A)(me,[["render",n]]);var be=ve}}]);