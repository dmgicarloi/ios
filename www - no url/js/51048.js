"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[51048],{51048:function(e,t,n){n.r(t),n.d(t,{default:function(){return W}});var i=n(8445),a=n.n(i),s=(n(71225),n(50310),n(5962),n(83190),n(52776),n(53113),n(61758)),o=n(58790),r=n(29104),l={class:"col row"},c={key:0},u={key:1},d={key:2},f={key:3},h={class:"col"},m={key:1,class:"col"},p={key:2,class:"col"},k={class:"col-xl-2 col-lg-4 col-sm-6 col-xs-12"},b={class:"col-xl-2 col-lg-4 col-sm-6 col-xs-12"},v={class:"col-xl-2 col-lg-4 col-sm-6 col-xs-12"},g={class:"col-xl-2 col-lg-4 col-sm-6 col-xs-12"},M={class:"col-xl-4 col-lg-4 col-sm-6 col-xs-12"},_={class:"bg-blue-grey-3 text-white q-pa-md q-mb-md-sm"},A={class:"row col no-wrap"},C={key:0},I={key:1},y={key:0,class:"col scroll-y column"};function j(e,t){var n=(0,s.g2)("q-btn"),i=(0,s.g2)("q-search"),j=(0,s.g2)("q-toolbar"),E=(0,s.g2)("q-checkbox"),R=(0,s.g2)("q-tooltip"),F=(0,s.g2)("q-icon"),S=(0,s.g2)("q-item-main"),$=(0,s.g2)("q-item"),x=(0,s.g2)("q-list"),T=(0,s.g2)("q-popover"),q=(0,s.g2)("q-item-side"),D=(0,s.g2)("q-toggle"),U=(0,s.g2)("q-datetime"),O=(0,s.g2)("q-select"),P=(0,s.g2)("sie-usuario"),Q=(0,s.g2)("q-item-tile"),w=(0,s.g2)("q-spinner-dots"),V=(0,s.g2)("q-infinite-scroll"),J=(0,s.g2)("router-view"),L=(0,s.g2)("q-card"),X=(0,s.gN)("close-overlay");return(0,s.uX)(),(0,s.Wv)(L,{class:"q-card-mobile intranet-programados column no-wrap"},{default:(0,s.k6)(function(){return[e.isGreater?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[e.send?((0,s.uX)(),(0,s.Wv)(n,{key:0,class:"q-btn-fab q-btn-redactar",round:"",onClick:e.openRedactar,icon:"create","no-caps":"",color:"primary"},null,8,["onClick"])):(0,s.Q3)("v-if",!0)],64)):(0,s.Q3)("v-if",!0),e.isGreater?(0,s.Q3)("v-if",!0):((0,s.uX)(),(0,s.Wv)(j,{key:1,class:"q-toolbar-menu fixed-top",style:{width:"calc(100% - 50px)",left:"50px"},color:"primary"},{default:(0,s.k6)(function(){return[(0,s.Lk)("div",l,["micorreo"===e.option.CARPETA?((0,s.uX)(),(0,s.CE)("span",c,(0,o.v_)(e.$t("intranet.mensajeria.micorreo")),1)):"enviados"===e.option.CARPETA?((0,s.uX)(),(0,s.CE)("span",u,(0,o.v_)(e.$t("intranet.mensajeria.enviados")),1)):"papelera"===e.option.CARPETA?((0,s.uX)(),(0,s.CE)("span",d,(0,o.v_)(e.$t("intranet.mensajeria.papelera")),1)):((0,s.uX)(),(0,s.CE)("span",f,(0,o.v_)(e.option.CARPETA),1))]),(0,s.Lk)("div",h,[(0,s.bF)(i,{inverted:"",modelValue:e.filter.search,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.filter.search=t}),placeholder:"Buscar",onInput:e.filteringMessage,debounce:500},null,8,["modelValue","onInput"])]),(0,s.bF)(n,{icon:"create",dense:"",round:"",flat:"",onClick:e.newMessage},null,8,["onClick"])]}),_:1})),(0,s.bF)(x,{class:"q-py-none shadow-1","no-border":"",separator:"",style:{"z-index":"2000"}},{default:(0,s.k6)(function(){return[(0,s.bF)($,{class:"row",separator:""},{default:(0,s.k6)(function(){return[(0,s.bF)(q,{class:"col q-pa-none"},{default:(0,s.k6)(function(){return[(0,s.bF)(E,{class:"q-pa-none q-pr-sm",modelValue:e.select,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.select=t}),onInput:e.checkAll},null,8,["modelValue","onInput"]),e.checked.length>0&&e.eliminaMensaje?((0,s.uX)(),(0,s.Wv)(n,{key:0,onClick:e.deleteMessages,round:"",flat:"",dense:"",icon:"delete",size:"md"},{default:(0,s.k6)(function(){return[(0,s.bF)(R,null,{default:(0,s.k6)(function(){return a()(t[11]||(t[11]=[(0,s.eW)("Cancelar Envío",-1)]))}),_:1})]}),_:1},8,["onClick"])):(0,s.Q3)("v-if",!0),e.checked.length>0?((0,s.uX)(),(0,s.Wv)(n,{key:1,round:"",flat:"",dense:"",icon:"more_vert"},{default:(0,s.k6)(function(){return[(0,s.bF)(T,{style:(0,o.Tr)(e.isGreater?"width: 40vh":"width: 33vh")},{default:(0,s.k6)(function(){return[(0,s.bF)(x,{class:"no-border",link:""},{default:(0,s.k6)(function(){return[(0,s.bo)(((0,s.uX)(),(0,s.Wv)($,{onClick:t[2]||(t[2]=function(t){return e.checkRead(1)})},{default:(0,s.k6)(function(){return[(0,s.bF)(F,{class:"q-pr-lg",name:"email"}),(0,s.bF)(S,{label:"Marcar como leído"})]}),_:1})),[[X]]),(0,s.bo)(((0,s.uX)(),(0,s.Wv)($,{onClick:t[3]||(t[3]=function(t){return e.checkRead(0)})},{default:(0,s.k6)(function(){return[(0,s.bF)(F,{class:"q-pr-lg",name:"email_open"}),(0,s.bF)(S,{label:"Marcar como no leído"})]}),_:1})),[[X]])]}),_:1})]}),_:1},8,["style"])]}),_:1})):(0,s.Q3)("v-if",!0)]}),_:1}),(0,s.bo)((0,s.bF)(n,{style:{visibility:"hidden"},onClick:e.openMenu,flat:"",round:"",icon:"backburger"},null,8,["onClick"]),[[r.aG,!e.isGreater]]),(0,s.bF)(q,{class:"row items-end justify-end"},{default:(0,s.k6)(function(){return[e.isGreater?((0,s.uX)(),(0,s.Wv)(i,{key:0,class:"q-if-outlined no-bottom",modelValue:e.filter.search,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.filter.search=t}),placeholder:"Buscar",onInput:e.filteringMessage,debounce:500},null,8,["modelValue","onInput"])):(0,s.Q3)("v-if",!0),e.isGreater?((0,s.uX)(),(0,s.CE)("div",m,[(0,s.bF)(n,{class:"q-pa-none",loading:e.loading,icon:"filter_search",flat:"",dense:"",size:"lg",onClick:e.filterSearch},null,8,["loading","onClick"])])):((0,s.uX)(),(0,s.CE)("div",p,[(0,s.bF)(n,{icon:"backburger",dense:"",round:"",flat:"",onClick:e.openMenu},null,8,["onClick"])]))]}),_:1})]}),_:1}),e.isGreater?(0,s.bo)(((0,s.uX)(),(0,s.Wv)($,{key:0,class:"row"},{default:(0,s.k6)(function(){return[(0,s.Lk)("div",k,[(0,s.bF)(D,{color:"secondary",modelValue:e.filter.adjunt,"onUpdate:modelValue":t[5]||(t[5]=function(t){return e.filter.adjunt=t}),label:"Adjunto",onInput:e.filterReceived},null,8,["modelValue","onInput"])]),(0,s.Lk)("div",b,[(0,s.bF)(D,{color:"secondary",modelValue:e.filter.date,"onUpdate:modelValue":t[6]||(t[6]=function(t){return e.filter.date=t}),label:"Solo fecha",onInput:e.filterReceived},null,8,["modelValue","onInput"])]),(0,s.Lk)("div",v,[(0,s.bF)(U,{class:"q-if-outlined",modelValue:e.filter.from,"onUpdate:modelValue":t[7]||(t[7]=function(t){return e.filter.from=t}),type:"date",format:"DD/MM/YYYY",modal:"",onInput:e.filterReceived},null,8,["modelValue","onInput"])]),(0,s.Lk)("div",g,[e.filter.date?(0,s.Q3)("v-if",!0):((0,s.uX)(),(0,s.Wv)(U,{key:0,class:"q-if-outlined",modelValue:e.filter.to,"onUpdate:modelValue":t[8]||(t[8]=function(t){return e.filter.to=t}),type:"date",format:"DD/MM/YYYY",modal:"",onInput:e.filterReceived},null,8,["modelValue","onInput"]))]),(0,s.Lk)("div",M,[(0,s.bF)(O,{class:"q-if-outlined",onInput:e.selectFindIn,modelValue:e.filter.selectDataOption,"onUpdate:modelValue":t[9]||(t[9]=function(t){return e.filter.selectDataOption=t}),"float-label":"Buscar en",options:e.filter.dataOption},null,8,["onInput","modelValue","options"])])]}),_:1},512)),[[r.aG,e.filter.showFilter]]):(0,s.Q3)("v-if",!0)]}),_:1}),(0,s.Lk)("div",_,[(0,s.bF)(F,{name:"send",size:"20px"}),t[12]||(t[12]=(0,s.Lk)("span",null,"  Los mensajes incluidos en Programados se enviarán en el momento especificado",-1))]),(0,s.Lk)("div",A,[(0,s.bo)((0,s.bF)(V,{class:"scroll-y col text-center",ref:"infinite",handler:e.loadMensajes},{message:(0,s.k6)(function(){return[(0,s.bF)(w,{size:40})]}),default:(0,s.k6)(function(){return[(0,s.bF)(x,{link:"",separator:"","no-border":""},{default:(0,s.k6)(function(){return[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.messages,function(n,i){return(0,s.uX)(),(0,s.Wv)($,{key:n.ID_MSJ_CARPETA_USUARIO,class:(0,o.C4)(["q-py-xs",{"row-noread":null===n.LECTURA,"q-item-active":String(n.ID_MENSAJERIA)===String(e.$route.params.id)}]),onClick:function(t){return e.selectMessage(i,n)}},{default:(0,s.k6)(function(){return[(0,s.bF)(q,null,{default:(0,s.k6)(function(){return[(0,s.bF)(E,{modelValue:e.checked,"onUpdate:modelValue":t[10]||(t[10]=function(t){return e.checked=t}),val:n,onInput:function(t){return e.loadCheck(n.ID_MSJ_CARPETA_USUARIO)}},null,8,["modelValue","val","onInput"])]}),_:2},1024),e.isGreater?((0,s.uX)(),(0,s.Wv)(q,{key:0},{default:(0,s.k6)(function(){return[(0,s.bF)(P,{usucod:n.USUCOD},null,8,["usucod"])]}),_:2},1024)):(0,s.Q3)("v-if",!0),(0,s.bF)(S,{class:"max-width"},{default:(0,s.k6)(function(){return[(0,s.bF)(Q,{class:(0,o.C4)(["cutText q-body-1 q-pt-md q-pb-md",{"text-weight-bold":0===n.LECTURA||null===n.LECTURA}])},{default:(0,s.k6)(function(){return[(0,s.Lk)("span",null,(0,o.v_)(n.EMISORNOM),1)]}),_:2},1032,["class"])]}),_:2},1024),(0,s.bF)(S,null,{default:(0,s.k6)(function(){return[(0,s.bF)(Q,{class:(0,o.C4)(["cutText q-body-1",{"text-weight-bold":0===n.LECTURA||null===n.LECTURA}]),label:""},{default:(0,s.k6)(function(){return[(0,s.eW)((0,o.v_)(n.ASUNTO),1)]}),_:2},1032,["class"]),(0,s.bF)(Q,{sublabel:""},{default:(0,s.k6)(function(){return[(0,s.eW)((0,o.v_)(n.HIJO),1)]}),_:2},1024)]}),_:2},1024),(0,s.bF)(q,{right:""},{default:(0,s.k6)(function(){return[(0,s.bF)(Q,null,{default:(0,s.k6)(function(){return[n.CC?((0,s.uX)(),(0,s.Wv)(F,{key:0,name:"closed_caption",color:"primary",size:"20px"})):(0,s.Q3)("v-if",!0),n.ADJUNTO>0?((0,s.uX)(),(0,s.Wv)(F,{key:1,size:"20px",name:"paperclip",color:"primary",style:{transform:"rotate(90deg)"}})):(0,s.Q3)("v-if",!0)]}),_:2},1024),(0,s.bF)(Q,{class:"q-body-1"},{default:(0,s.k6)(function(){return[n.ESHOY?((0,s.uX)(),(0,s.CE)("span",C,(0,o.v_)(e.date(n.FH_ENVIO,"hh:mm")),1)):((0,s.uX)(),(0,s.CE)("span",I,(0,o.v_)(e.date(n.FH_ENVIO,"DD-MM-YYYY")),1))]}),_:2},1024)]}),_:2},1024)]}),_:2},1032,["class","onClick"])}),128))]}),_:1})]}),_:1},8,["handler"]),[[r.aG,!e.move]]),e.$route.params.folder&&e.isGreater?((0,s.uX)(),(0,s.CE)("div",y,[(0,s.bF)(n,{flat:"",dense:"",onClick:e.moveLeft,size:"sm",icon:e.move?"chevron_double_right":"chevron_double_left"},null,8,["onClick","icon"]),(0,s.bF)(J,{class:"col column"})])):(0,s.Q3)("v-if",!0)])]}),_:1})}var E=n(57008),R=n.n(E),F=(n(30683),n(52133),n(10239),n(89571),n(56285),n(6724),n(11777),n(30022),n(80660)),S=n(6123),$=n(96122),x=n(18105),T=n(24974),q=n(81288),D=n(69027),U=n(65229),O=n(982),P=n(57668),Q=n(93616),w=n(36980),V=n(99637),J=n(46877),L={props:{idCarpeta:[Number,String]},directives:{sieActive:U.A},components:{QDatetime:S.T5,QPopover:S.VM,QSelect:S.Si,QToggle:S.c5,QList:S.Mb,QItem:S.H0,QItemMain:S.mF,QItemSide:S.n1,QItemTile:S.lp,QCheckbox:S.vZ,QStepper:S.jn,QStep:S.q$,sieUsuario:T.A,QScrollArea:$.A,QSpinnerDots:S.FS,QSearch:S.Ks,sieSelect:Q.A,treeNode:J.A,QCard:S.C$,QBtn:S.Il,QToolbar:S.ZV,QTooltip:S.nC,QIcon:S.bP,QInfiniteScroll:S.nN},name:"recibidos",data:function(){return{move:!1,carpeta:1,select:!1,checked:[],checkedIndex:[],filter:{search:"",adjunt:!1,date:!1,hijo:"",from:new Date("".concat((new Date).getFullYear(),"/01/01")),to:new Date,showFilter:!1,selectDataOption:"T",dataOption:[]},index:0,dataSelected:{},op:null,eliminaMensaje:!1,send:(0,P["default"])().ruta.nivel>1,loading:!1,step:0,steps:[]}},methods:{date:x.Ay,selectFindIn:function(){this.filterReceived()},moveLeft:function(){this.move=!this.move},filterSearch:function(){this.move=!1,this.loading=!0,this.filter.showFilter=!this.filter.showFilter,this.filter.showFilter?this.$store.commit("menu/setDisabled",!0):this.$store.commit("menu/setDisabled",!1),this.filter.dataOption=this.unificar(),this.filter.dataHijos=this.hijos,this.filterReceived(),this.$router.push({name:"intranet.mensajeria.bandeja",params:{id:this.$route.params.folder||this.$route.params.id}})},filterReceived:function(){this.index=0,this.$store.commit("bandeja/setMessages",[]),this.$store.commit("bandeja/setFilterMessages",[]),this.$refs.infinite.reset(),this.$refs.infinite.resume(),this.$refs.infinite.loadMore()},filteringMessage:function(){this.filterReceived()},adjunto:function(){console.log("adjunto")},cloud:function(){console.log("cloud")},moveTo:function(e){var t=this;if(e.ID_MSJ_CARPETA!==this.carpeta){var n=this.checked.map(function(e){return e.ID_MSJ_CARPETA_USUARIO});F.$http.post("api/HyoMsjusuariotipo/moverMensajes",{destino:e.ID_MSJ_CARPETA,mensajes:n}).then(function(e){(0,O["default"])(t.$t("mensajes."+e.json.mensaje)),t.checked=[],t.checkedIndex=[],t.select=!1,t.index=0,t.$store.commit("bandeja/setMessages",[]),t.$store.commit("bandeja/setFilterMessages",[]),"intranet.mensajeria.bandeja.correo"===t.$route.name&&t.$router.push({name:"intranet.mensajeria.bandeja",params:{id:t.$route.params.folder||t.$route.params.id}}),t.loadMensajes()}).catch(function(e){(0,D.alertModal)("Hyo System",t.$t("mensajes."+e.json.mensaje))})}},messagesFilter:function(){var e=this;return this.messages.filter(function(t){if(-1===e.checkedIndex.indexOf(t.ID_MSJ_CARPETA_USUARIO))return!0})},messagesCheckedRead:function(e){var t=this;return this.messages.map(function(n){return-1!==t.checkedIndex.indexOf(n.ID_MSJ_CARPETA_USUARIO)&&(n.LECTURA=e),n})},selectMessage:function(e,t){this.$store.commit("menu/setDisabled",!1),this.$router.push({name:"intranet.mensajeria.redactar",params:{folder:null,type:5,mensaje:t.ID_MENSAJERIA},query:{programado:!0,edicion:!0}})},dataChange:function(e){var t=this;return this.checked.map(function(n){return e?{idActual:t.carpeta,idMensaje:n.ID_MENSAJERIA,idOri:n.ID_MSJ_CARPETA_ORI}:n.ID_MSJ_CARPETA_USUARIO})},checkRead:function(e){var t=this,n=this.dataChange();F.$http.post("api/HyoMsjusuariotipo/readVarious",{ids:n,type:1===e}).then(function(){t.$store.commit("bandeja/setMessages",t.messagesCheckedRead(e))}).catch(function(e){(0,D.alertModal)("Hyo System",t.$t("Ha ocurrido un problema en la conexión intétenlo nuevamente."))})},deleteMessages:function(){var e=this,t=3===this.carpeta?"¿Los mensajes serán eliminados permanentemente desea continuar?":"¿Se cancelará los mensajes programados, deseas continuar?";(0,D.confirmar)(t,function(){var t=e.dataChange();F.$http.post("api/HyoMsjusuariotipo/deleteMultiple",{mensajes:t,programado:!0}).then(function(n){var i=[];(0,V["default"])(e.messages,function(e){-1===t.indexOf(e.ID_MSJ_CARPETA_USUARIO)&&i.push(e)}),e.$store.commit("bandeja/setMessages",i),e.$store.commit("bandeja/setFilterMessages",[])}).catch(function(e){})})},openMenu:function(){this.$store.commit("menu/setOpenMenu",!this.openM)},newMessage:function(){this.$router.push({name:"intranet.mensajeria.redactar"})},loadCheck:function(e){this.existCheck(e),this.select=this.messages.length===this.checked.length},existCheck:function(e){var t=this.checkedIndex.indexOf(e);-1!==t?this.checkedIndex.splice(t,1):this.checkedIndex.push(e)},checkAll:function(){if(this.checked=[],this.checkedIndex=[],this.select){this.checked=this.messages;for(var e=0;e<this.checked.length;e++)this.checkedIndex.push(this.checked[e].ID_MSJ_CARPETA_USUARIO)}},unificar:function(){var e=[];for(var t in this.myMenu)if("groups"!==t)for(var n=this.myMenu[t].child.length,i=0;i<n;i++)if(this.myMenu[t].child[i].ID_MSJ_CARPETA>0){switch(this.myMenu[t].child[i].ID_MSJ_CARPETA){case 1:this.myMenu[t].child[i].label="Mis mensajes";break;case 2:this.myMenu[t].child[i].label="Enviados";break;case 3:this.myMenu[t].child[i].label="Papelera";break;default:this.myMenu[t].child[i].label=this.myMenu[t].child[i].CARPETA;break}this.myMenu[t].child[i].value=this.myMenu[t].child[i].ID_MSJ_CARPETA,e.push(this.myMenu[t].child[i])}return e.unshift({value:"T",label:"Todos"}),e},loadMensajes:function(e,t){var n=this;t="function"===typeof t?t:function(){};var i={search:this.filter.search,programado:!0};this.index>0&&(i.segmento=this.index),this.filter.showFilter?(i.filter={adjunto:this.filter.adjunt,desde:!this.filter.date,fecIni:this.filter.from,idCarpeta:this.filter.selectDataOption,search:this.filter.search},this.filter.hijo&&(i.filter.hijo=this.filter.hijo),this.filter.date||(i.filter.fecFin=this.filter.to)):i.idCarpeta=this.$route.params.folder||this.carpeta,F.$http.get("api/HyoMensajeria/obtMensajes",{params:i}).then(function(e){var i=e.json;n.$store.commit("bandeja/setMessages",n.messages.concat(i)),n.$store.commit("bandeja/setFilterMessages",n.filterMessages.concat(i)),i.length>0?(setTimeout(function(){n.loading=!1},1e3),t()):(n.loading=!1,t(),n.$refs.infinite.stop()),n.index+=1})},openRedactar:function(){this.$store.commit("menu/setDisabled",!1),this.$router.push({name:"intranet.mensajeria.redactar"})},init:function(){var e=this;this.index=0,this.move=!1,this.carpeta=this.$route.params.folder||this.$route.params.id||this.idCarpeta||this.$route.params.folder||1,this.$refs.infinite&&this.$refs.infinite&&"function"===typeof this.$refs.infinite.resume&&(this.$refs.infinite.resume(),this.$refs.infinite.poll());var t={famcod:(0,P["default"])().usucod};F.$http.get("api/HyoFamilias/obtHijos",{params:t}).then(function(t){var n=t.json;e.hijos=n}),F.$http.get("api/HyoControl/obtEstadoEliminarMensajes").then(function(t){var n=t.json;e.eliminaMensaje=3!==e.carpeta||"S"===n.ELIMENSAJE})},bloquearCarpeta:function(e){e.ID_MSJ_CARPETA===Number.parseInt(this.carpeta)&&(e.disabled=!0)}},created:function(){this.init(),this.steps=[{value:0,titulo:"Los mensajes incluidos en Programados se enviarán en el momento especificado",icono:"send"}]},computed:R()(R()(R()({},(0,w.aH)("menu",["myMenu","openM","currentOption","inactive"])),(0,w.aH)("bandeja",["messages","filterMessages"])),{},{isGreater:function(){return(0,q.isGreater)()},option:function(){return this.currentOption?this.currentOption.CARPETA?this.currentOption:{CARPETA:"micorreo"}:{}},menu:function(){var e=[];return this.myMenu.principal.child.map(function(t){t.ID_MSJ_CARPETA>0&&t.ID_MSJ_CARPETA<3&&(t.LABEL=1===t.ID_MSJ_CARPETA?"Mis Mensajes":"Enviados",t.children=Array(0),t.color=1===t.ID_MSJ_CARPETA?"#2196F3":"#009688",t.icon=1===t.ID_MSJ_CARPETA?"inbox":"send",t.name=1===t.ID_MSJ_CARPETA?"Mis Mensajes":"Enviados",t.principal=!0,e.push(t))}),this.myMenu.folders.child.map(function(t){e.push(t)}),e}}),watch:{idCarpeta:function(e){e&&this.init()},carpeta:function(){this.index=0,this.checked=[],this.select=!1},messages:function(){(this.checked.length<1||this.messages.length<1)&&(this.select=!1)}}},X=n(12807);const H=(0,X.A)(L,[["render",j]]);var W=H}}]);