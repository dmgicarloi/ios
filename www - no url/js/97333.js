"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[97333],{97333:function(e,a,t){t.r(a),t.d(a,{default:function(){return q}});var o=t(61758),n=t(58790),r={class:"row q-ma-xs q-col-gutter-sm"},i={key:0,class:"col-xs-4"},s={class:"texthelper"},l={class:"col-xs-4"},c={key:1,class:"col-xs-4"},u={class:"text-h5"};function d(e,a){var t=(0,o.g2)("q-page-header"),d=(0,o.g2)("q-separator"),p=(0,o.g2)("q-option-group"),h=(0,o.g2)("q-select"),b=(0,o.g2)("q-checkbox"),m=(0,o.g2)("q-card-section"),f=(0,o.g2)("header-grid"),g=(0,o.g2)("sie-grid"),A=(0,o.g2)("footer-grid"),C=(0,o.g2)("q-card");return(0,o.uX)(),(0,o.Wv)(C,{class:"layout-v1 my-card",flat:"",bordered:""},{default:(0,o.k6)(function(){return[(0,o.bF)(t,{title:e.pageHeader.title,nivelAcceso:e.pageHeader.nivelAcceso,useTab:"",tabs:e.pageHeader.tabs,componente:e.pageHeader.componente,onActionTab:e.actionTab,botones:e.pageHeader.botones},null,8,["title","nivelAcceso","tabs","componente","onActionTab","botones"]),(0,o.bF)(d),(0,o.bF)(m,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",r,["index"===e.pageHeader.tabActive?((0,o.uX)(),(0,o.CE)("div",i,[(0,o.bF)(p,{options:e.optionsCopia,type:"checkbox",modelValue:e.tipo,"onUpdate:modelValue":a[0]||(a[0]=function(a){return e.tipo=a}),onInput:e.changeOptionsTipo},null,8,["options","modelValue","onInput"]),(0,o.Lk)("div",s,(0,n.v_)(e.texthelper),1)])):(0,o.Q3)("v-if",!0),(0,o.Lk)("div",l,[(0,o.bF)(h,{label:e.labelAnio,"option-value":"ANO","option-label":"ANO",options:e.dataAnios,modelValue:e.filtros.anio,"onUpdate:modelValue":a[1]||(a[1]=function(a){return e.filtros.anio=a}),onInput:e.getBecas},null,8,["label","options","modelValue","onInput"])]),e.pageHeader.tabActive===e.pageHeader.tabsKeys.matricula?((0,o.uX)(),(0,o.CE)("div",c,[(0,o.bF)(b,{label:"Forzar Matricula",modelValue:e.forzarMatricula,"onUpdate:modelValue":a[2]||(a[2]=function(a){return e.forzarMatricula=a})},null,8,["modelValue"])])):(0,o.Q3)("v-if",!0)])]}),_:1}),(0,o.bF)(d),(0,o.bF)(m,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",null,[(0,o.bF)(f,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",u,(0,n.v_)(e.headerLabel),1)]}),_:1}),(0,o.bF)(g,{class:"fix-table-global ag-theme-balham",columnDefs:e.columnDefs,rowData:e.rowData,frameworkComponents:e.frameworkComponents,rowSelection:"multiple",onGridReady:e.onGridReady,componentFromFramework:e.componentFromFramework,rowMultiSelectWithClick:!0,onSelectionChanged:e.onSelectionChanged,style:{height:"calc(100vh - 400px)"}},null,8,["columnDefs","rowData","frameworkComponents","onGridReady","componentFromFramework","onSelectionChanged"]),(0,o.bF)(A,{modelValue:e.pagina,"onUpdate:modelValue":a[3]||(a[3]=function(a){return e.pagina=a}),max:e.pages,onLoad:e.getBecas,rows:e.rowData},null,8,["modelValue","max","onLoad","rows"])])]}),_:1})]}),_:1})}var p=t(99550),h=t.n(p),b=t(41562),m=t.n(b),f=t(76080),g=t.n(f),A=t(45254),C=t.n(A),v=(t(71225),t(39866),t(50310),t(5962),t(11777),t(83190),t(27153),t(62540),t(62692),t(88567)),w=t(95718),O=t(64303),k=t(41615),B=t(80660),D=t(53380),N=t(54489),x=t(6123),S=t(3112),E=t(36408),F=t(27560),T=t(96330),y=t(57668),$=t(42037),H=t(2652),M={components:{QCard:v.A,QCardSection:w.A,crearBotones:O.A,QSeparator:D.A,QSelect:N.S,QOptionGroup:x.EX,QCheckbox:S.A,sieGrid:E.A,footerGrid:F.A,headerGrid:T.A,QPageHeader:H.A},data:function(){return{title:"Copia del Año Anterior",name:"CopiaAnioAnterior",texthelper:"(*) Para copiar becados es necesario tener calendarios y becas creadas o migradas",buttons:[],nivelAcceso:(0,y["default"])().ruta.nivel,filtros:{anio:String(Number(k["default"].CURRENT_YEAR)-1)},tipo:["beca","calendar","becaOto"],dataAnios:[],optionsCopia:[{label:"Calendario",value:"calendar"},{label:"Becas",value:"beca"},{label:"Becas Otorgadas",value:"becaOto"}],becaOtoAnt:!0,columnDefs:[],labelBoton:"Ejecutar proceso",rowData:[],frameworkComponents:"",api:null,todos:!1,pagina:1,pages:1,componentFromFramework:[],disabled:!1,anioDelSistema:(0,y["default"])().ano,pageHeader:{tabs:[{name:"index",label:"Tablas"},{name:"matriculas",label:"Matriculas"}],tabsKeys:{index:"index",matricula:"matriculas"},botones:[],componente:"copiaAnioAnterior",nivelAcceso:(0,y["default"])().ruta.nivel,title:"Copia Año Anterior",tabActive:"index"},labelAnio:"Copiar del Año",forzarMatricula:!1,headerLabel:"Becas Otorgadas"}},methods:{actionTab:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"index";this.pageHeader.tabActive="string"!==typeof e?"index":e,this.texthelper=e===this.pageHeader.tabsKeys.index?"(*) Para copiar becados es necesario tener calendarios y becas creadas o migradas":"",e===this.pageHeader.tabsKeys.index?(this.columns(),this.getBecas(),this.labelAnio="Copiar del Año",this.headerLabel="Becas Otorgadas",this.labelBoton="Ejecutar Proceso"):(this.headerLabel="Alumnos Deudores",this.labelAnio="Año",this.labelBoton="Matricular",this.obtenerDeudoresNoMatriculados()),this.crearBotones()},changeChecks:function(){var e=this;return this.tipo.includes("becaOto")&&!1===this.becaOtoAnt?(this.becaOtoAnt=!0,setTimeout(function(){e.api.selectAll()},100),!0):this.tipo.includes("becaOto")?(this.disabled=0===this.api.getSelectedRows().length&&!this.tipo.includes("calendar")&&!this.tipo.includes("beca"),void this.crearBotones()):(this.becaOtoAnt=!1,this.api.deselectAll())},allItems:function(){this.columns(!this.todos)},changeOptionsTipo:function(){this.crearBotones(),this.columns(),this.changeChecks()},columns:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=[{headerName:"Código",field:"BECACOD",width:65,cellClass:"text-right",sortable:!0},{headerName:"Descripción",field:"BECADES",width:300,resizable:!0},{headerName:"Tipo",field:"TIPO_BECA",width:80},{headerName:"",field:"BECAPOR",width:80,valueFormatter:$.toFixed,cellClass:"text-right"},{headerName:"Cantidad",field:"BECADOS",width:75,cellClass:"text-right",sortable:!0}],t=e&&this.tipo.includes("becaOto");a.unshift({sortable:t,headerCheckboxSelection:t,headerCheckboxSelectionFilteredOnly:t,checkboxSelection:t,width:30}),this.columnDefs=a},onGridReady:function(e){var a=this;this.api=e.api,setTimeout(function(){a.api.selectAll()},100)},crearBotones:function(){this.buttons=[{label:this.labelBoton,icon:"settings",click:this.procesar,minAcceso:k["default"].ACCESO_TOTAL,disable:0===this.tipo.length||this.disabled}],this.pageHeader.botones=this.buttons},onSelectionChanged:function(){this.tipo.includes("becaOto")&&(this.disabled=0===this.api.getSelectedRows().length&&!this.tipo.includes("calendar")&&!this.tipo.includes("beca"),this.crearBotones())},copiarCalendario:function(){var e=this;return C()(g()().m(function a(){var t,o;return g()().w(function(a){while(1)switch(a.p=a.n){case 0:return a.p=0,a.n=1,B.$http.post("api/CalendarController/postCopiarCalendarioAnterior",{params:{anioAnterior:e.filtros.anio,anioActual:(0,y["default"])().ano}});case 1:return t=a.v,a.a(2,t.message);case 2:a.p=2,o=a.v,console.log(o.error.message?o.error.messsage:o.message);case 3:return a.a(2)}},a,null,[[0,2]])}))()},copiarBecas:function(){var e=this;return C()(g()().m(function a(){var t,o;return g()().w(function(a){while(1)switch(a.p=a.n){case 0:return a.p=0,a.n=1,B.$http.post("api/BecaController/postBecasDeAniosAnteriores",{params:{anioAnterior:e.filtros.anio,anioActual:(0,y["default"])().ano}});case 1:return t=a.v,a.a(2,t.message);case 2:a.p=2,o=a.v,console.log(o.error.message?o.error.messsage:o.message);case 3:return a.a(2)}},a,null,[[0,2]])}))()},copiarBecasOtorgadas:function(){var e=this;return C()(g()().m(function a(){var t,o,n,r,i,s,l,c,u,d,p,h,b,f,A;return g()().w(function(a){while(1)switch(a.p=a.n){case 0:t={procesados:0,noProcesados:0},o=e.api.getSelectedRows(),n=m()(o),a.p=1,n.s();case 2:if((r=n.n()).done){a.n=16;break}if(i=r.value,0!==i.BECADOS){a.n=3;break}return a.a(3,15);case 3:return s={BECACOD:i.BECACOD,ANOBEC:e.filtros.anio},a.n=4,B.$http.get("api/BecaController/getCantidadBecasOtorgadas",{params:{parametros:s}});case 4:if(l=a.v,0!==l.length){a.n=5;break}return a.a(3,15);case 5:c=m()(l),a.p=6,c.s();case 7:if((u=c.n()).done){a.n=12;break}return d=u.value,p={ID_PERSONA:d.ID_PERSONA,BECACOD:d.BECACOD,ID_BECA_OTO:d.ID_BECA_OTO,ALUCOD:d.ALUCOD,ANOBEC:e.filtros.anio,anioVigente:(0,y["default"])().ano},a.p=8,a.n=9,B.$http.post("api/BecaController/postCopiarBecaOtoAnioAnterior",{params:p});case 9:h=a.v,1===h.estado?t.procesados++:t.noProcesados++,a.n=11;break;case 10:a.p=10,a.v,t.procesados=0;case 11:a.n=7;break;case 12:a.n=14;break;case 13:a.p=13,f=a.v,c.e(f);case 14:return a.p=14,c.f(),a.f(14);case 15:a.n=2;break;case 16:a.n=18;break;case 17:a.p=17,A=a.v,n.e(A);case 18:return a.p=18,n.f(),a.f(18);case 19:return b="BECADOS: (".concat(t.procesados,") Copiados"),t.noProcesados>0&&(b+=", (".concat(t.noProcesados,") NO Copiados")),a.a(2,b)}},a,null,[[8,10],[6,13,14,15],[1,17,18,19]])}))()},matricularAlumnos:function(){var e=this;this.$confirm("¿Esta seguro de matricular a los deudores del año ".concat(this.filtros.anio,"?")).onOk(C()(g()().m(function a(){var t,o,n;return g()().w(function(a){while(1)switch(a.p=a.n){case 0:return a.p=0,e.$q.loading.show(),t={anio:e.filtros.anio,cantidad:e.rowData.length,forzarMatricula:Number(e.forzarMatricula)},a.n=1,B.$http.post("api/personaController/postMatricularDeudoresPorAnio",{params:t});case 1:o=a.v,e.$q.loading.hide(),e.obtenerDeudoresNoMatriculados(),e.$alert(o.message,"success"),a.n=3;break;case 2:a.p=2,n=a.v,e.$alert(n.error?n.error.message:n.message,"warning");case 3:return a.a(2)}},a,null,[[0,2]])})))},procesar:function(){var e=this;return this.pageHeader.tabActive===this.pageHeader.tabsKeys.matricula?this.matricularAlumnos():0===this.tipo.length?this.$alert("No selecciono ninguna opción","warning"):void this.$confirm("¿Desea realizar el proceso?").onOk(C()(g()().m(function a(){var t,o,n,r,i,s,l;return g()().w(function(a){while(1)switch(a.n){case 0:if(e.$q.loading.show(),t="Proceso Finalizado: ",o="success",!e.tipo.includes("calendar")){a.n=2;break}return n=t,a.n=1,e.copiarCalendario();case 1:r=a.v,t=n+=r+" - ";case 2:if(!e.tipo.includes("beca")){a.n=4;break}return i=t,a.n=3,e.copiarBecas();case 3:s=a.v,t=i+=s+" - ";case 4:if(!e.tipo.includes("becaOto")){a.n=6;break}return l=t,a.n=5,e.copiarBecasOtorgadas();case 5:t=l+=a.v;case 6:return e.$q.loading.hide(),a.a(2,e.$alert(t,o))}},a)})))},getAnios:function(){var e=this;return C()(g()().m(function a(){return g()().w(function(a){while(1)switch(a.n){case 0:B.$http.get("api/anioController/getAnios").then(function(a){if(a=a.filter(function(e){return Number(e.ANO)<Number((0,y["default"])().ano)}),a.length>0){var t=a,o=h()(t,1),n=o[0];e.filtros.anio=String(n.ANO)}e.dataAnios=a,e.getBecas()}).catch(function(a){return e.$alert(a.error?a.error.message:a.message,"")});case 1:return a.a(2)}},a)}))()},getBecas:function(){var e=this;if(this.pageHeader.tabActive===this.pageHeader.tabsKeys.matricula)return this.obtenerDeudoresNoMatriculados();this.$q.loading.show(),B.$http.get("api/becaController/getBecasAnioAnteriores",{params:{parametros:this.filtros}}).then(function(a){e.rowData=a,setTimeout(function(){if(e.tipo.includes("becaOto"))return setTimeout(function(){e.api.selectAll()},100),!0},100)}).catch(function(a){return e.$alert(a.error?a.error.message:a.message,"")}).finally(this.$q.loading.hide())},obtenerDeudoresNoMatriculados:function(){var e=this;return C()(g()().m(function a(){var t,o;return g()().w(function(a){while(1)switch(a.n){case 0:return a.n=1,B.$http.get("api/personaController/getDeudoresNoMatriculados",{params:{params:{anio:e.filtros.anio}}});case 1:t=a.v,o=[{headerName:"Año",field:"ANOCOB",width:65,sortable:!0},{headerName:"Código",field:"ALUCOD",resizable:!0,width:80},{headerName:"Nombre",field:"NOMBRE",width:300},{headerName:"Nemo",field:"NEMO",resizable:!0,width:80},{headerName:"Nivel",field:"INSTRUCOD",resizable:!0,width:80},{headerName:"Grado",field:"GRADOCOD",resizable:!0,width:80},{headerName:"Sección",field:"SECCIONCOD",resizable:!0,width:80}],e.columnDefs=o,e.rowData=t;case 2:return a.a(2)}},a)}))()}},computed:{},created:function(){},beforeMount:function(){var e=this;return C()(g()().m(function a(){return g()().w(function(a){while(1)switch(a.n){case 0:e.crearBotones(),k["default"].USUARIOS_ADMIN.includes((0,y["default"])().usucod)?e.pageHeader.tabs=[{name:"index",label:"Tablas"},{name:"matriculas",label:"Matriculas"}]:e.pageHeader.tabs=[{name:"index",label:"Tablas"}],e.getAnios(),e.actionTab();case 1:return a.a(2)}},a)}))()},destroy:function(){}},R=t(12807);const _=(0,R.A)(M,[["render",d]]);var q=_}}]);