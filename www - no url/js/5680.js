"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[5680],{5680:function(o,t,a){a.r(t),a.d(t,{default:function(){return A}});var e=a(8445),i=a.n(e),l=a(61758),n={key:0,class:"row q-pa-sm"},r={class:"col"},s={class:"col"},c={class:"col"},d={key:1,class:"row q-px-sm q-mb-md"},u={clas:"col"};function p(o,t){var a=(0,l.g2)("q-tooltip"),e=(0,l.g2)("q-fab-action"),p=(0,l.g2)("importar"),m=(0,l.g2)("sie-select"),f=(0,l.g2)("q-checkbox"),h=(0,l.g2)("q-table"),g=(0,l.g2)("sie-modal");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.bF)(p,{titulo:"Actualización de Datos",url:o.url,onImport:o.loadTemplate,onProcess:o.procesar,"show-help-text":!1},{buttons:(0,l.k6)(function(){return[(0,l.bF)(e,{color:"secondary",icon:"file_excel",onClick:t[0]||(t[0]=function(t){return o.openModalFields=!0})},{default:(0,l.k6)(function(){return[(0,l.bF)(a,{anchor:"center left",self:"center right"},{default:(0,l.k6)(function(){return i()(t[9]||(t[9]=[(0,l.eW)("Exportar plantilla",-1)]))}),_:1})]}),_:1})]}),_:1},8,["url","onImport","onProcess"]),(0,l.bF)(g,{modelValue:o.openModalFields,"onUpdate:modelValue":t[8]||(t[8]=function(t){return o.openModalFields=t}),title:"Seleccione los campos a exportar",css:{minWidth:"40vw"},onShow:o.obtenerCamposAExp,onClose:o.limpiar,onSubmit:o.exportar,ok:"Exportar"},{default:(0,l.k6)(function(){return["familia"===o.formFiltro.tabla||"alumno"===o.formFiltro.tabla?((0,l.uX)(),(0,l.CE)("div",n,[(0,l.Lk)("div",r,[(0,l.bF)(m,{type:"outlined",options:o.niveles,val:"INSTRUCOD",label:"INSTRUDES",placeholder:"Nivel",modelValue:o.formFiltro.instrucod,"onUpdate:modelValue":t[1]||(t[1]=function(t){return o.formFiltro.instrucod=t}),onSelected:o.getListaGrados},null,8,["options","modelValue","onSelected"])]),(0,l.Lk)("div",s,[(0,l.bF)(m,{type:"outlined",options:o.grados,val:"GRADOCOD",label:"GRADODES",placeholder:"Grado",modelValue:o.formFiltro.gradocod,"onUpdate:modelValue":t[2]||(t[2]=function(t){return o.formFiltro.gradocod=t}),onSelected:o.getListaSecciones},null,8,["options","modelValue","onSelected"])]),(0,l.Lk)("div",c,[(0,l.bF)(m,{type:"outlined",options:o.secciones,val:"SECCIONCOD",label:"SECCIONDES",placeholder:"Sección",modelValue:o.formFiltro.seccioncod,"onUpdate:modelValue":t[3]||(t[3]=function(t){return o.formFiltro.seccioncod=t})},null,8,["options","modelValue"])])])):(0,l.Q3)("v-if",!0),"familia"===o.formFiltro.tabla||"alumno"===o.formFiltro.tabla?((0,l.uX)(),(0,l.CE)("div",d,[(0,l.Lk)("div",u,[(0,l.bF)(f,{class:"q-mr-sm",modelValue:o.formFiltro.estados,"onUpdate:modelValue":t[4]||(t[4]=function(t){return o.formFiltro.estados=t}),label:"Vigentes (Matriculados)",val:"V"},null,8,["modelValue"]),(0,l.bF)(f,{modelValue:o.formFiltro.estados,"onUpdate:modelValue":t[5]||(t[5]=function(t){return o.formFiltro.estados=t}),label:"Promovidos",val:"P"},null,8,["modelValue"])])])):(0,l.Q3)("v-if",!0),(0,l.bF)(h,{"table-class":"no-scroll",data:o.dataCampos,columns:o.columnsCampos,selected:o.dataSelected,"onUpdate:selected":t[6]||(t[6]=function(t){return o.dataSelected=t}),pagination:o.paginationFields,"onUpdate:pagination":t[7]||(t[7]=function(t){return o.paginationFields=t}),"rows-per-page-options":[0],"hide-bottom":"","row-key":"ID",selection:"multiple",color:"primary"},null,8,["data","columns","selected","pagination"])]}),_:1},8,["modelValue","onShow","onClose","onSubmit"])])}a(71225),a(52133),a(10239),a(50310),a(5962),a(6724),a(70199),a(83190),a(68017);var m=a(83972),f=a(6123),h=a(24729),g=a(46267),b=a(21658),C=a(93616),S=a(30640),F=a(57668),v=a(982),D=a(82640),O=a(80660),E={setup:function(){var o=(0,m.fG)();return{v$:o}},components:{QTable:f.kH,QCard:f.C$,QCardMain:f.d1,QFab:f.l6,QFabAction:f.B$,Dialog:h.A,QCheckbox:f.vZ,importar:g.A,btnCustom:b.A,notify:v["default"],sieSelect:C.A,sieModal:S.A,sieInfo:F["default"],QTooltip:f.nC},data:function(){return{niveles:[],grados:[],secciones:[],formFiltro:{instrucod:"",gradocod:"",seccioncod:"",estados:["V","P"],tabla:this.$route.params.tabla},openModalFields:!1,dataProcesar:[],dataCampos:[],dataSelected:[],url:"api/HyoExcel/cargarDataActualizar",urlExp:"/".concat(O.API_LMS,"/api/HyoExcel/exportarPlantillaActualizacion"),columnsCampos:[{name:"DESCRIPCION",label:"SELECCIONAR TODOS",field:"DESCRIPCION",align:"left"}],paginationFields:{sortBy:null,descending:!1,page:1,rowsPerPage:2e4}}},created:function(){this.init()},validations:{formFiltro:{tabla:{required:D.mw}}},methods:{init:function(){this.getListaNivel(),this.cargarTabla()},loadTemplate:function(o){this.dataProcesar=o.json,this.procesar()},obtenerCamposAExp:function(){var o=this,t=this.formFiltro.tabla.toUpperCase();this.$http.get("api/HyoMCampos/obtCampos",{params:{tabla:t}}).then(function(t){o.dataCampos=t.json.filter(function(o){return"S"===o.RECOMENDADO.trim()})}).catch(function(o){console.log(o)})},getListaNivel:function(){var o=this;this.$http.get("api/HyoInstrus/obtInstru").then(function(t){var a=t.json;a.unshift({INSTRUCOD:"T",INSTRUDES:"Todos",INSTRUANO:0}),o.niveles=a})},getListaGrados:function(){var o=this;"T"===this.formFiltro.instrucod?this.grados.push({GRADOCOD:"T",GRADODES:"Todos"}):this.$http.get("api/HyoGradoNivs/obtGrados").then(function(t){var a=t.json;o.grados=a.filter(function(t){return t.INSTRUCOD===o.formFiltro.instrucod}),o.grados.unshift({GRADOCOD:"T",GRADODES:"Todos"})})},getListaSecciones:function(){var o=this;if("T"===this.formFiltro.gradocod)this.secciones.push({SECCIONCOD:"T",SECCIONDES:"Todos"});else{var t={instrucod:this.formFiltro.instrucod,gradocod:this.formFiltro.gradocod};this.$http.get("api/HyoSalones/obtSecciones",{params:t}).then(function(t){o.secciones=t.json,o.secciones.unshift({SECCIONCOD:"T",SECCIONDES:"Todos"})})}},procesar:function(){var o=this;this.dataProcesar.length>0?this.$q.dialog({title:"¿Desea continuar con el proceso de importación?",ok:"SI",cancel:"NO"}).onOk(function(){o.$http.post("api/HyoMigracion/actualizarDatos",{data:o.dataProcesar,tabla:o.formFiltro.tabla}).then(function(o){(0,v["default"])(o.json.message)}).catch(function(o){(0,v["default"])(o.error.message,"error")})}):this.$q.dialog({title:"Aviso",message:"No hay información para actualizar información",ok:"Aceptar"})},exportar:function(){if(this.openModalFields=!1,this.v$.$touch(),!this.v$.$invalid)if(this.dataSelected.length>0){var o=this.dataSelected.map(function(o){return o.ID}),t={params:this.formFiltro,campos:o};location.href=this.urlExp+"?sie-token="+(0,F["default"])().token+"&data="+JSON.stringify(t)}else this.$q.dialog({title:"Aviso",message:"No ha seleccionado los campos a actualizar"})},cargarTabla:function(){this.url+="?tipo="+this.formFiltro.tabla},limpiar:function(){this.formFiltro={instrucod:"",gradocod:"",seccioncod:"",tabla:this.$route.params.tabla},this.dataSelected=[]}}},I=a(12807);const k=(0,I.A)(E,[["render",p]]);var A=k}}]);