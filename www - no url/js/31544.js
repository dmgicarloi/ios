"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[31544],{31544:function(e,n,t){t.r(n),t.d(n,{default:function(){return rr}});var o=t(61758),r={class:"container-panel-configuracion flex",style:{"flex-wrap":"wrap","justify-content":"center"}};function i(e,n){var t=(0,o.g2)("header-btn"),i=(0,o.g2)("q-separator"),a=(0,o.g2)("crearBotones"),s=(0,o.g2)("q-card-section"),l=(0,o.g2)("planificacion"),u=(0,o.g2)("documentos"),c=(0,o.g2)("prompts"),d=(0,o.g2)("q-card");return(0,o.uX)(),(0,o.Wv)(d,{class:"background-buttons my-card",flat:"",bordered:""},{default:(0,o.k6)(function(){return[(0,o.bF)(t,{name:e.titulo,buttons:e.buttons},null,8,["name","buttons"]),(0,o.bF)(i),"inicio"===e.estadoActual?((0,o.uX)(),(0,o.Wv)(s,{key:0},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",r,[(0,o.bF)(a,{class:"create-buttons-style",componente:e.componente,buttons:e.botones,nivelAcceso:e.nivelAcceso,bigClass:"button-big-intranet"},null,8,["componente","buttons","nivelAcceso"])])]}),_:1})):(0,o.Q3)("v-if",!0),"planificacion"===e.estadoActual?((0,o.uX)(),(0,o.Wv)(l,{key:1})):(0,o.Q3)("v-if",!0),"documentos"===e.estadoActual?((0,o.uX)(),(0,o.Wv)(u,{key:2,ref:"documentos"},null,512)):(0,o.Q3)("v-if",!0),"prompts"===e.estadoActual?((0,o.uX)(),(0,o.Wv)(c,{key:3,ref:"prompts"},null,512)):(0,o.Q3)("v-if",!0),(0,o.Q3)('envio(v-if="estadoActual === \'envio\'" :hideHeader="true"  :sendMensaje="sendMensaje" @terminaMensaje="falsoMensaje" @changeEnvioTab="changeEnvioTab" ref="envio")'),(0,o.Q3)('analytics(v-if="estadoActual === \'analytics\'" :hideHeader="true" ref="analytics")'),(0,o.Q3)('inbox(v-if="estadoActual === \'inbox\'" :hideHeader="true")'),(0,o.Q3)('plantillas(v-if="estadoActual === \'plantillas\'" :hideHeader="true" :infoMenus="dataMenu" @closeModalPlantilla="closeModalPlantilla" ref="plantillas") '),(0,o.Q3)('exclusiones(v-if="estadoActual === \'exclusiones\'" ref="exclusiones")')]}),_:1})}var a=t(76080),s=t.n(a),l=t(45254),u=t.n(l),c=(t(74260),t(39866),t(52133),t(10239),t(25751),t(56285),t(50310),t(32203),t(6724),t(83190),t(57668)),d=t(88567),m=t(82327),p=t(88865),f=t(74656),v=t(66824),h=t(8445),g=t.n(h),b=(t(11777),t(58790)),S={class:"flex row"},k={class:"q-pa-md flex",style:{"justify-content":"space-evenly"}},_={key:0,class:"q-py-md q-pr-md",style:{width:"50%"}},w={class:"flex justify-between"},y={class:"q-pa-lg"},P={key:0,style:{"font-size":"1.5em",height:"24px"}},C={class:"q-pa-md"},T={class:"container relative"},A={key:0,class:"absolute",style:{bottom:"10px",right:"20px","z-index":"10"}},E={class:"preview-container"},O={class:"ai-message"},D={key:1,class:"q-py-md q-pr-md",style:{width:"30%"}},I={class:"container"},x={key:0,class:"chat-message-container",ref:"chatWindow"},F={class:"text-caption text-grey q-mb-xs"},N={key:0},M={class:"human-message"},q={style:{display:"flex","justify-content":"end"}},R={key:1,class:"ai-message"},L={class:"q-pa-sm",style:{color:"darkblue"}},V={class:"q-pr-sm"},U={class:"q-pa-sm",style:{color:"darkblue"}},G={class:"q-pr-sm"},Q={class:"q-pa-sm",style:{color:"darkblue"}},$={class:"q-pr-sm"},j={key:2,class:"q-py-md q-pr-md",style:{width:"80%"}},X={class:"center"},W={class:"default-container center"},H={style:{"max-width":"680px"}},z={key:0,class:"row q-ma-xs q-col-gutter-sm"},B={class:"col-xs-12 col-sm-2 center"},J={key:1,class:"row q-ma-xs q-col-gutter-sm"},K={class:"col-xs-12 col-sm-2 center"},Y={key:2,class:"row q-ma-xs q-col-gutter-sm"},Z={class:"col-xs-12 col-sm-2 center"},ee={class:"row items-center q-col-gutter-sm"},ne={class:"col-xs-12"},te={class:"row q-col-gutter-sm"},oe={class:"col-xs-12"},re={key:0,class:"col-xs-6"},ie={key:1,class:"col-xs-3"},ae={key:2,class:"col-xs-3"},se={key:3,class:"col-xs-12"},le={key:4,class:"col-xs-12"},ue={key:5,class:"col-xs-9"},ce={key:6,class:"col-xs-3"},de={key:7,class:"col-xs-3"},me={class:"col-xs-12"},pe={class:"row q-col-gutter-sm"},fe={class:"col-xs-6"},ve={class:"col-xs-6"},he={key:0,class:"col-xs-6"},ge={key:1,class:"col-xs-6"},be={class:"col-xs-12"},Se={class:"row q-col-gutter-sm"},ke={class:"col-xs-11"},_e={class:"col-xs-1"},we={class:"col-xs-12",style:{position:"relative"}},ye={class:"col-xs-12"},Pe={class:"row q-ma-xs q-col-gutter-sm"},Ce={key:0,class:"col-xs-12"},Te={key:1,class:"col-xs-12"},Ae={class:"col-xs-6"},Ee={class:"col-xs-6"},Oe={class:"row items-center justify-between q-pb-xs q-col-gutter-sm sesiones-toolbar"},De={class:"col-auto row items-center q-gutter-xs"},Ie={class:"col-auto"},xe={class:"flex items-center q-gutter-xs"},Fe={class:"row q-col-gutter-sm items-center q-pb-md"},Ne={class:"col-1"},Me={class:"col"},qe={class:"col-2"},Re={class:"col-2"},Le={class:"row items-center justify-between q-pb-xs q-col-gutter-sm sesiones-toolbar"},Ve={class:"col-auto row items-center q-gutter-xs"},Ue={class:"col-auto"},Ge={class:"flex items-center q-gutter-xs"},Qe={class:"row q-col-gutter-sm items-center q-pb-md"},$e={class:"col-1"},je={class:"col"},Xe={class:"col-2"},We={class:"col-xs-12"},He={class:"row q-col-gutter-sm"},ze={class:"col-xs-11"},Be={class:"col-xs-1"},Je={class:"col-xs-12",style:{position:"relative"}},Ke={class:"col-xs-12"},Ye={class:"row q-ma-xs q-col-gutter-sm"},Ze={class:"col-xs-12 q-pb-sm"},en={class:"col-xs-12"},nn={class:"col-xs-12"},tn={class:"row items-center no-wrap q-mb-sm"},on={class:"col-auto"},rn={class:"text-caption text-grey-7"},an={class:"row q-col-gutter-md"},sn={class:"col-xs-12 col-sm-4"},ln={class:"col-xs-12 col-sm-8"};function un(e,n){var t=this,r=(0,o.g2)("loaderAI"),i=(0,o.g2)("q-tooltip"),a=(0,o.g2)("q-btn"),s=(0,o.g2)("q-icon"),l=(0,o.g2)("q-separator"),u=(0,o.g2)("q-item-section"),c=(0,o.g2)("q-item"),d=(0,o.g2)("q-list"),m=(0,o.g2)("q-card"),p=(0,o.g2)("q-card-section"),f=(0,o.g2)("tip-tap-editor"),v=(0,o.g2)("skeleton"),h=(0,o.g2)("MarkdownViewer"),un=(0,o.g2)("QSpinnerOval"),cn=(0,o.g2)("q-infinite-scroll"),dn=(0,o.g2)("q-select"),mn=(0,o.g2)("sie-modal"),pn=(0,o.g2)("q-input-v1"),fn=(0,o.g2)("q-tab"),vn=(0,o.g2)("q-tabs"),hn=(0,o.g2)("q-date-sys"),gn=(0,o.g2)("q-select-core"),bn=(0,o.g2)("q-expansion-item"),Sn=(0,o.g2)("q-form"),kn=(0,o.g2)("q-chip"),_n=(0,o.g2)("q-checkbox"),wn=(0,o.g2)("modalExportarEnPlantilla"),yn=(0,o.gN)("ripple");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.bF)(r,{modelValue:e.loaderAIShow,"onUpdate:modelValue":n[0]||(n[0]=function(n){return e.loaderAIShow=n})},null,8,["modelValue"]),(0,o.Lk)("div",S,[(0,o.bF)(p,{style:{width:"20%"}},{default:(0,o.k6)(function(){return[(0,o.bF)(m,{bordered:""},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",k,[(0,o.bF)(a,{flat:"",round:"",size:"md",icon:"documents",onClick:n[1]||(n[1]=function(n){return e.changeTypeSession(e.SESSION_PA)}),class:(0,b.C4)(e.currentTypeSession===e.SESSION_PA?"session-active":""),disable:e.loadingDocument},{default:(0,o.k6)(function(){return[(0,o.bF)(i,{offset:[0,10]},{default:(0,o.k6)(function(){return g()(n[52]||(n[52]=[(0,o.eW)("Programación Anual",-1)]))}),_:1})]}),_:1},8,["class","disable"]),(0,o.bF)(s,{name:"arrow_forward"}),(0,o.bF)(a,{flat:"",round:"",size:"md",icon:"cursos_classroom",onClick:n[2]||(n[2]=function(n){return e.changeTypeSession(e.SESSION_UNIDAD)}),class:(0,b.C4)(e.currentTypeSession===e.SESSION_UNIDAD?"session-active":""),disable:e.loadingDocument},{default:(0,o.k6)(function(){return[(0,o.bF)(i,{offset:[0,10]},{default:(0,o.k6)(function(){return g()(n[53]||(n[53]=[(0,o.eW)("Unidad",-1)]))}),_:1})]}),_:1},8,["class","disable"]),(0,o.bF)(s,{name:"arrow_forward"}),(0,o.bF)(a,{flat:"",round:"",size:"md",icon:"classroom",onClick:n[3]||(n[3]=function(n){return e.changeTypeSession(e.SESSION_CLASE)}),class:(0,b.C4)(e.currentTypeSession===e.SESSION_CLASE?"session-active":""),disable:e.loadingDocument},{default:(0,o.k6)(function(){return[(0,o.bF)(i,{offset:[0,10]},{default:(0,o.k6)(function(){return g()(n[54]||(n[54]=[(0,o.eW)("Clase",-1)]))}),_:1})]}),_:1},8,["class","disable"])]),(0,o.bF)(l),(0,o.bF)(a,{id:"button-new-session",flat:"",icon:"add",label:e.tituloNuevo(),onClick:e.openModalNuevaSession,style:{width:"100%"}},null,8,["label","onClick"]),(0,o.bF)(l),(0,o.bF)(d,{separator:"",id:"lista-chats"},{default:(0,o.k6)(function(){return[(0,o.bF)(l),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.sessions,function(t){return(0,o.bo)(((0,o.uX)(),(0,o.Wv)(c,{key:t.session_id,clickable:"",onClick:function(n){return e.selectSession(t)},disable:e.loading||e.loadingDocument,class:(0,b.C4)(e.currentSessionId===t.session_id?"current-chat":"default-chat")},{default:(0,o.k6)(function(){return[(0,o.bF)(u,null,{default:(0,o.k6)(function(){return[(0,o.eW)((0,b.v_)(t.name_chat),1)]}),_:2},1024),(0,o.bF)(u,{avatar:"",style:{display:"flex","flex-direction":"row"}},{default:(0,o.k6)(function(){return[(0,o.bF)(a,{flat:"",round:"",size:"sm",icon:"delete",onClick:function(n){return e.eliminarSession(t.session_id)}},{default:(0,o.k6)(function(){return[(0,o.bF)(i,{offset:[0,10]},{default:(0,o.k6)(function(){return g()(n[55]||(n[55]=[(0,o.eW)("Eliminar Chat",-1)]))}),_:1})]}),_:1},8,["onClick"])]}),_:2},1024)]}),_:2},1032,["onClick","disable","class"])),[[yn]])}),128))]}),_:1})]}),_:1})]}),_:1}),null!=e.currentSessionId?((0,o.uX)(),(0,o.CE)("div",_,[(0,o.bF)(m,{bordered:""},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",w,[(0,o.Lk)("div",y,[e.getCurrentSession().parametros?((0,o.uX)(),(0,o.CE)("div",P,(0,b.v_)(e.getCurrentSession().parametros.nombreSession||"Plan de ".concat(e.keyword())),1)):(0,o.Q3)("v-if",!0)]),(0,o.Lk)("div",C,[(0,o.bF)(a,{flat:"",size:"md",icon:"f_word",color:"primary",round:"",onClick:n[4]||(n[4]=function(n){return e.exportToWord(e.getCurrentSession().documentoGenerado,e.getCurrentSession().parametros.tema)})},{default:(0,o.k6)(function(){return[(0,o.bF)(i,{offset:[0,10]},{default:(0,o.k6)(function(){return g()(n[56]||(n[56]=[(0,o.eW)("Exportar como Word",-1)]))}),_:1})]}),_:1}),(0,o.bF)(a,{flat:"",size:"md",icon:"file_export",color:"primary",round:"",onClick:e.openModalExportarEnPlantilla},{default:(0,o.k6)(function(){return[(0,o.bF)(i,{offset:[0,10]},{default:(0,o.k6)(function(){return g()(n[57]||(n[57]=[(0,o.eW)("Exportar en Plantilla",-1)]))}),_:1})]}),_:1},8,["onClick"])])]),(0,o.bF)(l),(0,o.Lk)("div",T,[e.hasEdits&&!e.loadingDocument?((0,o.uX)(),(0,o.CE)("div",A,[(0,o.bF)(a,{icon:"save",color:"primary",size:"md",round:"",onClick:e.saveCurrentHtml},null,8,["onClick"])])):(0,o.Q3)("v-if",!0),(0,o.Lk)("div",E,[(0,o.bF)(p,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",O,[(0,o.bF)(f,{ref:"editor",src:e.streamedText,editable:!0,"content-format":"auto","enable-ask":!0,onGetHtml:e.getCurrentHtml,onAsk:e.onEditorAsk},null,8,["src","onGetHtml","onAsk"]),e.loadingDocument?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:0},(0,o.pI)(e.skeletonWidthsDocument,function(e,n){return(0,o.uX)(),(0,o.Wv)(v,{width:e,height:"12px"},null,8,["width"])}),256)):(0,o.Q3)("v-if",!0)])]}),_:1})])])]}),_:1})])):(0,o.Q3)("v-if",!0),null!=e.currentSessionId?((0,o.uX)(),(0,o.CE)("div",D,[(0,o.bF)(m,{bordered:""},{default:(0,o.k6)(function(){return[n[60]||(n[60]=(0,o.Lk)("div",{class:"q-pa-lg"},[(0,o.Lk)("div",{style:{"font-size":"1.5em"}},"Asistente IA")],-1)),(0,o.bF)(l),(0,o.Lk)("div",I,[e.getCurrentSession()?((0,o.uX)(),(0,o.CE)("div",x,[(0,o.bF)(cn,{reverse:!0,offset:100},{default:(0,o.k6)(function(){return[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.getCurrentSession().messages,function(t,r){return(0,o.uX)(),(0,o.Wv)(p,{key:r,style:{width:"100%"}},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",{class:(0,b.C4)(["row q-mb-md","human"===t.type?"justify-end":"justify-start"])},[(0,o.Lk)("div",{class:(0,b.C4)(["column","human"===t.type?"items-end":"items-start"])},[(0,o.Lk)("div",F,(0,b.v_)("human"===t.type?"Tú":"Asistente"),1),"human"===t.type?((0,o.uX)(),(0,o.CE)("div",N,[(0,o.Lk)("div",M,[(0,o.bF)(h,{src:t.content},null,8,["src"])]),(0,o.Lk)("div",q,[(0,o.bF)(a,{flat:"",size:"sm",icon:"save",round:"",onClick:function(n){return e.openModalGuardarPrompt(t.content)}},{default:(0,o.k6)(function(){return[(0,o.bF)(i,{offset:[0,10]},{default:(0,o.k6)(function(){return g()(n[58]||(n[58]=[(0,o.eW)("Guardar Prompt",-1)]))}),_:1})]}),_:1},8,["onClick"])])])):((0,o.uX)(),(0,o.CE)("div",R,["pending"===t.loading?((0,o.uX)(),(0,o.Wv)(m,{key:0,class:"q-mb-sm",bordered:""},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",L,[(0,o.Lk)("span",V,(0,b.v_)(t.label),1),(0,o.bF)(un,{color:"primary",size:"16"})])]}),_:2},1024)):(0,o.Q3)("v-if",!0),"done"===t.loading?((0,o.uX)(),(0,o.Wv)(m,{key:1,bordered:""},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",U,[(0,o.Lk)("span",G,(0,b.v_)(t.label),1),(0,o.bF)(s,{color:"primary",size:"16",name:"check_circle"})])]}),_:2},1024)):(0,o.Q3)("v-if",!0),"error"===t.loading?((0,o.uX)(),(0,o.Wv)(m,{key:2,bordered:""},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",Q,[(0,o.Lk)("span",$,(0,b.v_)(t.label),1),(0,o.bF)(s,{color:"red",size:"16",name:"close"})])]}),_:2},1024)):(0,o.Q3)("v-if",!0),t.loading?(0,o.Q3)("v-if",!0):((0,o.uX)(),(0,o.Wv)(h,{key:3,src:t.content},null,8,["src"]))]))],2)],2)]}),_:2},1024)}),128)),e.loading?((0,o.uX)(),(0,o.Wv)(p,{key:0,class:"row q-gutter-sm flex column"},{default:(0,o.k6)(function(){return[n[59]||(n[59]=(0,o.Lk)("div",{class:"text-caption text-grey q-mb-xs"},"Asistente",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.skeletonWidths,function(e,n){return(0,o.uX)(),(0,o.Wv)(v,{width:e,height:"12px"},null,8,["width"])}),256))]}),_:1})):(0,o.Q3)("v-if",!0)]}),_:1})],512)):(0,o.Q3)("v-if",!0)])]}),_:1})])):(0,o.Q3)("v-if",!0),e.sessions.length&&e.getCurrentSession()&&null!==e.currentSessionId?(0,o.Q3)("v-if",!0):((0,o.uX)(),(0,o.CE)("div",j,[(0,o.bF)(m,{bordered:""},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",X,[(0,o.Lk)("div",W,[e.currentTypeSession===e.SESSION_CLASE?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.bF)(s,{class:"q-pa-sm",name:"classroom",size:"8rem",color:"grey"}),n[61]||(n[61]=(0,o.Lk)("span",{style:{color:"grey"}},"Elige o crea una sesión de clase para empezar.",-1))],64)):(0,o.Q3)("v-if",!0),e.currentTypeSession===e.SESSION_UNIDAD?((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.bF)(s,{class:"q-pa-sm",name:"cursos_classroom",size:"8rem",color:"grey"}),n[62]||(n[62]=(0,o.Lk)("span",{style:{color:"grey"}},"Elige o crea una unidad para empezar.",-1))],64)):(0,o.Q3)("v-if",!0),e.currentTypeSession===e.SESSION_PA?((0,o.uX)(),(0,o.CE)(o.FK,{key:2},[(0,o.bF)(s,{class:"q-pa-sm",name:"documents",size:"8rem",color:"grey"}),n[63]||(n[63]=(0,o.Lk)("span",{style:{color:"grey"}},"Elige o crea una programación anual para empezar.",-1))],64)):(0,o.Q3)("v-if",!0)])])]}),_:1})]))]),(0,o.bF)(mn,{modelValue:e.modalPrompts,"onUpdate:modelValue":n[6]||(n[6]=function(n){return e.modalPrompts=n}),onSubmit:e.usePrompt,ok:"Usar",title:"Lista de prompts"},{default:(0,o.k6)(function(){return[e.optionsPrompts.length?((0,o.uX)(),(0,o.Wv)(p,{key:0},{default:(0,o.k6)(function(){return[(0,o.bF)(dn,{modelValue:e.selectedPrompt,"onUpdate:modelValue":n[5]||(n[5]=function(n){return e.selectedPrompt=n}),"option-value":"ID_PROMPT","option-label":"NAME_PROMPT",options:e.optionsPrompts},null,8,["modelValue","options"]),e.selectedPrompt?((0,o.uX)(),(0,o.Wv)(m,{key:0,class:"q-mt-md",bordered:""},{default:(0,o.k6)(function(){return[(0,o.bF)(p,{style:{overflow:"auto","max-height":"500px","max-width":"500px"}},{default:(0,o.k6)(function(){return[(0,o.bF)(h,{src:e.getContentToPreview(e.getSelectedPromptContent())},null,8,["src"])]}),_:1})]}),_:1})):(0,o.Q3)("v-if",!0)]}),_:1})):((0,o.uX)(),(0,o.Wv)(p,{key:1,class:"center"},{default:(0,o.k6)(function(){return g()(n[64]||(n[64]=[(0,o.Lk)("span",null,"Todavía no has guardado ningún prompt",-1)]))}),_:1}))]}),_:1},8,["modelValue","onSubmit"]),(0,o.bF)(mn,{modelValue:e.modalGuardarPrompt,"onUpdate:modelValue":n[8]||(n[8]=function(n){return e.modalGuardarPrompt=n}),onSubmit:e.guardarPrompt,ok:"Guardar",title:"Guardar prompt"},{default:(0,o.k6)(function(){return[(0,o.bF)(p,null,{default:(0,o.k6)(function(){return[(0,o.bF)(pn,{modelValue:e.namePromptToSave,"onUpdate:modelValue":n[7]||(n[7]=function(n){return e.namePromptToSave=n}),label:"Nombre del Prompt"},null,8,["modelValue"]),(0,o.bF)(m,{class:"q-mt-md",bordered:""},{default:(0,o.k6)(function(){return[(0,o.bF)(p,{style:{overflow:"auto","max-height":"500px","max-width":"500px"}},{default:(0,o.k6)(function(){return[(0,o.bF)(h,{src:e.getContentToPreview(t.contentToSave)},null,8,["src"])]}),_:1})]}),_:1})]}),_:1})]}),_:1},8,["modelValue","onSubmit"]),(0,o.bF)(mn,{modelValue:e.modalSession,"onUpdate:modelValue":n[42]||(n[42]=function(n){return e.modalSession=n}),onSubmit:e.createChatSession,ok:e.currentTypeSession===e.SESSION_CLASE&&"grupal"===e.tabGeneracion?"Crear sesiones":e.currentTypeSession===e.SESSION_UNIDAD&&"grupal"===e.tabGeneracion?"Crear unidades":"Crear",title:e.tituloNuevo()},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",H,[(0,o.bF)(p,null,{default:(0,o.k6)(function(){return[e.currentTypeSession===e.SESSION_CLASE?((0,o.uX)(),(0,o.CE)("div",z,[(0,o.Lk)("div",B,[(0,o.bF)(s,{name:"classroom",size:"xl"})]),n[65]||(n[65]=(0,o.Lk)("div",{class:"col-xs-12 col-sm-10"},[(0,o.Lk)("b",null,"Planificación de Clase"),(0,o.Lk)("div",null,"Crea un nuevo contexto para que el asistente IA conozca tus preferencias para crear una clase")],-1))])):(0,o.Q3)("v-if",!0),e.currentTypeSession===e.SESSION_UNIDAD?((0,o.uX)(),(0,o.CE)("div",J,[(0,o.Lk)("div",K,[(0,o.bF)(s,{name:"cursos_classroom",size:"xl"})]),n[66]||(n[66]=(0,o.Lk)("div",{class:"col-xs-12 col-sm-10"},[(0,o.Lk)("b",null,"Planificación de Unidades"),(0,o.Lk)("div",null,"Crea un nuevo contexto para que el asistente IA conozca tus preferencias para crear una unidad")],-1))])):(0,o.Q3)("v-if",!0),e.currentTypeSession===e.SESSION_PA?((0,o.uX)(),(0,o.CE)("div",Y,[(0,o.Lk)("div",Z,[(0,o.bF)(s,{name:"documents",size:"xl"})]),n[67]||(n[67]=(0,o.Lk)("div",{class:"col-xs-12 col-sm-10"},[(0,o.Lk)("b",null,"Planificación de Programación Curricular"),(0,o.Lk)("div",null,"Crea un nuevo contexto para que el asistente IA conozca tus preferencias para crear una programación curricular")],-1))])):(0,o.Q3)("v-if",!0)]}),_:1}),e.showTabs?((0,o.uX)(),(0,o.Wv)(p,{key:0},{default:(0,o.k6)(function(){return[(0,o.bF)(vn,{modelValue:e.tabGeneracion,"onUpdate:modelValue":n[9]||(n[9]=function(n){return e.tabGeneracion=n}),align:"justify",dense:"",onInput:e.cambiarTab},{default:(0,o.k6)(function(){return[(0,o.bF)(fn,{name:"individual",label:"Generar Individualmente"}),(0,o.bF)(fn,{name:"grupal",label:"Generar Grupalmente"})]}),_:1},8,["modelValue","onInput"])]}),_:1})):(0,o.Q3)("v-if",!0),"individual"===e.tabGeneracion?((0,o.uX)(),(0,o.Wv)(p,{key:1},{default:(0,o.k6)(function(){return[(0,o.bF)(Sn,{ref:"formSession"},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",ee,[(0,o.Lk)("div",ne,[(0,o.bF)(m,{class:"q-card-legend",title:"General"},{default:(0,o.k6)(function(){return[(0,o.bF)(p,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",te,[(0,o.Lk)("div",oe,[(0,o.bF)(pn,{class:"input-requerido",modelValue:e.formSession.nombreSession,"onUpdate:modelValue":n[10]||(n[10]=function(n){return e.formSession.nombreSession=n}),label:"Titulo*",rules:[e.required]},null,8,["modelValue","rules"])]),e.currentTypeSession===e.SESSION_PA?((0,o.uX)(),(0,o.CE)("div",re,[(0,o.bF)(pn,{class:"input-requerido",modelValue:e.formSession.area,"onUpdate:modelValue":n[11]||(n[11]=function(n){return e.formSession.area=n}),label:"Área*"},null,8,["modelValue"])])):(0,o.Q3)("v-if",!0),e.currentTypeSession===e.SESSION_PA?((0,o.uX)(),(0,o.CE)("div",ie,[(0,o.bF)(pn,{class:"input-requerido",modelValue:e.formSession.numUnidades,"onUpdate:modelValue":n[12]||(n[12]=function(n){return e.formSession.numUnidades=n}),label:"Unidades*",type:"number"},null,8,["modelValue"])])):(0,o.Q3)("v-if",!0),e.currentTypeSession===e.SESSION_PA?((0,o.uX)(),(0,o.CE)("div",ae,[(0,o.bF)(pn,{class:"input-requerido",modelValue:e.formSession.horasSemana,"onUpdate:modelValue":n[13]||(n[13]=function(n){return e.formSession.horasSemana=n}),label:"Horas Semanales*",type:"number"},null,8,["modelValue"])])):(0,o.Q3)("v-if",!0),e.currentTypeSession===e.SESSION_UNIDAD?((0,o.uX)(),(0,o.CE)("div",se,[(0,o.bF)(dn,{modelValue:e.formSession.pa_session_id,"onUpdate:modelValue":n[14]||(n[14]=function(n){return e.formSession.pa_session_id=n}),label:"Programación Curricular Anual",options:e.optionsPA,"option-value":"session_id","option-label":"name_chat",onInput:e.paFueSeleccionado},null,8,["modelValue","options","onInput"])])):(0,o.Q3)("v-if",!0),e.currentTypeSession===e.SESSION_CLASE?((0,o.uX)(),(0,o.CE)("div",le,[(0,o.bF)(dn,{modelValue:e.formSession.unidad_session_id,"onUpdate:modelValue":n[15]||(n[15]=function(n){return e.formSession.unidad_session_id=n}),label:"Unidad",options:e.optionsUnidad,"option-value":"session_id","option-label":"name_chat",onInput:e.unidadFueSeleccionado},null,8,["modelValue","options","onInput"])])):(0,o.Q3)("v-if",!0),e.currentTypeSession!==e.SESSION_PA?((0,o.uX)(),(0,o.CE)("div",ue,[e.hasPA?(0,o.Q3)("v-if",!0):((0,o.uX)(),(0,o.Wv)(pn,{key:0,class:"input-requerido",modelValue:e.formSession.tema,"onUpdate:modelValue":n[16]||(n[16]=function(n){return e.formSession.tema=n}),label:"Tema*",rules:[e.required]},null,8,["modelValue","rules"])),e.hasPA?((0,o.uX)(),(0,o.Wv)(dn,{key:1,modelValue:e.formSession.tema,"onUpdate:modelValue":n[17]||(n[17]=function(n){return e.formSession.tema=n}),label:"Tema*",options:e.PAData,"option-value":"titulo","option-label":"titulo"},null,8,["modelValue","options"])):(0,o.Q3)("v-if",!0)])):(0,o.Q3)("v-if",!0),e.currentTypeSession===e.SESSION_UNIDAD?((0,o.uX)(),(0,o.CE)("div",ce,[(0,o.bF)(pn,{class:"input-requerido",modelValue:e.formSession.sesiones,"onUpdate:modelValue":n[18]||(n[18]=function(n){return e.formSession.sesiones=n}),modelModifiers:{number:!0},type:"number",dense:"",label:"Número de sesiones"},null,8,["modelValue"])])):(0,o.Q3)("v-if",!0),e.currentTypeSession===e.SESSION_CLASE?((0,o.uX)(),(0,o.CE)("div",de,[(0,o.bF)(pn,{class:"input-requerido",modelValue:e.formSession.tiempo_sesion,"onUpdate:modelValue":n[19]||(n[19]=function(n){return e.formSession.tiempo_sesion=n}),modelModifiers:{number:!0},type:"number",dense:"",label:"Tiempo"},null,8,["modelValue"])])):(0,o.Q3)("v-if",!0)])]}),_:1})]}),_:1})]),(0,o.Lk)("div",me,[(0,o.bF)(m,{class:"q-card-legend",title:"Parametros de programación"},{default:(0,o.k6)(function(){return[(0,o.bF)(p,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",pe,[(0,o.Lk)("div",fe,[(0,o.bF)(dn,{class:"input-requerido",modelValue:e.formSession.nivel,"onUpdate:modelValue":n[20]||(n[20]=function(n){return e.formSession.nivel=n}),label:"Nivel*",options:e.optionsNivel,rules:[e.required],onInput:n[21]||(n[21]=function(n){return e.obtenerGrados(e.formSession.nivel)}),disable:Boolean(e.formSession.pa_session_id)||Boolean(e.formSession.unidad_session_id)},null,8,["modelValue","options","rules","disable"])]),(0,o.Lk)("div",ve,[(0,o.bF)(dn,{class:"input-requerido",modelValue:e.formSession.grado,"onUpdate:modelValue":n[22]||(n[22]=function(n){return e.formSession.grado=n}),label:"Grado*",options:e.optionsGrado,rules:[e.required],disable:Boolean(e.formSession.pa_session_id)||Boolean(e.formSession.unidad_session_id)},null,8,["modelValue","options","rules","disable"])]),e.formSession.pa_session_id||e.formSession.unidad_session_id?(0,o.Q3)("v-if",!0):((0,o.uX)(),(0,o.CE)("div",he,[(0,o.bF)(hn,{modelValue:e.formSession.fechaInicio,"onUpdate:modelValue":n[23]||(n[23]=function(n){return e.formSession.fechaInicio=n}),label:"Fecha de Inicio",ref:"qDateProxy",outlined:""},null,8,["modelValue"])])),e.formSession.pa_session_id||e.formSession.unidad_session_id?(0,o.Q3)("v-if",!0):((0,o.uX)(),(0,o.CE)("div",ge,[(0,o.bF)(hn,{modelValue:e.formSession.fechaFin,"onUpdate:modelValue":n[24]||(n[24]=function(n){return e.formSession.fechaFin=n}),label:"Fecha de Fin",ref:"qDateProxy2",outlined:""},null,8,["modelValue"])]))])]}),_:1})]}),_:1})]),(0,o.Lk)("div",be,[(0,o.bF)(bn,{icon:"spark",label:"Personalización IA","header-class":" text-weight-medium"},{default:(0,o.k6)(function(){return[(0,o.bF)(m,{class:"q-card-legend"},{default:(0,o.k6)(function(){return[(0,o.bF)(p,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",Se,[(0,o.Lk)("div",ke,[(0,o.bF)(gn,{class:"q-if-outlined col chips-compact",modelValue:e.formSession.promptsSelected,"onUpdate:modelValue":n[25]||(n[25]=function(n){return e.formSession.promptsSelected=n}),"float-label":"Prompts",options:e.optionsPrompts,multiple:"",dense:"",filter:"",onInput:e.onChangePromptsMultiple},null,8,["modelValue","options","onInput"])]),(0,o.Lk)("div",_e,[(0,o.bF)(a,{flat:"",size:"md",icon:"broom",onClick:n[26]||(n[26]=function(n){return e.clearSelectedPrompts()})},{default:(0,o.k6)(function(){return[(0,o.bF)(i,null,{default:(0,o.k6)(function(){return g()(n[68]||(n[68]=[(0,o.eW)("Limpiar selección",-1)]))}),_:1})]}),_:1})]),(0,o.Lk)("div",we,[(0,o.bF)(pn,{ref:"ctxInput",modelValue:e.formSession.contexto,"onUpdate:modelValue":n[27]||(n[27]=function(n){return e.formSession.contexto=n}),label:"Contexto",type:"textarea",autogrow:"",placeholder:"Escribe o pega tu contexto aquí…","input-style":"max-height: 100px; height: 100px;"},null,8,["modelValue"]),(0,o.bF)(a,{style:{position:"absolute",bottom:"0px",right:"0px",background:"white"},flat:"",dense:"",size:"md",icon:"open_in_new",onClick:e.openContextEditor},{default:(0,o.k6)(function(){return[(0,o.bF)(i,null,{default:(0,o.k6)(function(){return g()(n[69]||(n[69]=[(0,o.eW)("Editar",-1)]))}),_:1})]}),_:1},8,["onClick"])]),(0,o.Lk)("div",ye,[(0,o.bF)(a,{flat:"",icon:"add",round:"",onClick:e.clickSubirDocumento,disable:e.loading||e.loadingDocument},{default:(0,o.k6)(function(){return[(0,o.bF)(i,{offset:[0,10]},{default:(0,o.k6)(function(){return g()(n[70]||(n[70]=[(0,o.eW)("Agrega un documento para que el asistente IA lo considere en sus respuestas",-1)]))}),_:1})]}),_:1},8,["onClick","disable"]),n[71]||(n[71]=(0,o.Lk)("span",null,"Agregar Documento",-1)),(0,o.Lk)("input",{ref:"docInput",type:"file",accept:".docx,.pdf",style:{display:"none"},onChange:n[28]||(n[28]=function(){return e.setArchivo&&e.setArchivo.apply(e,arguments)})},null,544)])])]}),_:1})]}),_:1})]}),_:1})]),(0,o.bF)(p,{class:"col-xs-12"},{default:(0,o.k6)(function(){return g()(n[72]||(n[72]=[(0,o.Lk)("b",null,"*Se generá un documento con los parámetros indicados",-1)]))}),_:1})])]}),_:1},512)]}),_:1})):(0,o.Q3)("v-if",!0),"grupal"===e.tabGeneracion?((0,o.uX)(),(0,o.Wv)(p,{key:2},{default:(0,o.k6)(function(){return[(0,o.bF)(Sn,{ref:"formSession"},{default:(0,o.k6)(function(){return[(0,o.bF)(m,{class:"q-card-legend",title:"General"},{default:(0,o.k6)(function(){return[(0,o.bF)(p,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",Pe,[e.currentTypeSession===e.SESSION_UNIDAD?((0,o.uX)(),(0,o.CE)("div",Ce,[(0,o.bF)(dn,{modelValue:e.formSession.pa_session_id,"onUpdate:modelValue":n[29]||(n[29]=function(n){return e.formSession.pa_session_id=n}),label:"Programación Curricular Anual",options:e.optionsPA,"option-value":"session_id","option-label":"name_chat",onInput:e.paFueSeleccionado},null,8,["modelValue","options","onInput"])])):(0,o.Q3)("v-if",!0),e.currentTypeSession===e.SESSION_CLASE?((0,o.uX)(),(0,o.CE)("div",Te,[(0,o.bF)(dn,{modelValue:e.formSession.unidad_session_id,"onUpdate:modelValue":n[30]||(n[30]=function(n){return e.formSession.unidad_session_id=n}),label:"Unidad",options:e.optionsUnidad,"option-value":"session_id","option-label":"name_chat",onInput:e.unidadFueSeleccionado},null,8,["modelValue","options","onInput"])])):(0,o.Q3)("v-if",!0),(0,o.Lk)("div",Ae,[(0,o.bF)(dn,{class:"input-requerido",modelValue:e.formSession.nivel,"onUpdate:modelValue":n[31]||(n[31]=function(n){return e.formSession.nivel=n}),label:"Nivel*",options:e.optionsNivel,onInput:n[32]||(n[32]=function(n){return e.obtenerGrados(e.formSession.nivel)}),rules:[e.required],disable:Boolean(e.formSession.pa_session_id)||Boolean(e.formSession.unidad_session_id)},null,8,["modelValue","options","rules","disable"])]),(0,o.Lk)("div",Ee,[(0,o.bF)(dn,{class:"input-requerido",modelValue:e.formSession.grado,"onUpdate:modelValue":n[33]||(n[33]=function(n){return e.formSession.grado=n}),label:"Grado*",options:e.optionsGrado,rules:[e.required],disable:Boolean(e.formSession.pa_session_id)||Boolean(e.formSession.unidad_session_id)},null,8,["modelValue","options","rules","disable"])])])]}),_:1})]}),_:1}),(0,o.bF)(l,{vertical:"",color:"grey-3",spaced:""}),e.formSession.genUnidades?((0,o.uX)(),(0,o.Wv)(m,{key:0,class:"q-mt-md q-card-legend",title:"Unidades"},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",Oe,[(0,o.Lk)("div",De,[n[73]||(n[73]=(0,o.Lk)("div",{class:"text-caption text-grey-7"},"Total",-1)),(0,o.bF)(kn,{outline:"",color:"primary",dense:"",square:""},{default:(0,o.k6)(function(){return[(0,o.eW)((0,b.v_)(e.formSession.genUnidades),1)]}),_:1})]),(0,o.Lk)("div",Ie,[(0,o.Lk)("div",xe,[(0,o.bF)(a,{flat:"",dense:"",icon:"done_all",label:"Marcar todas",onClick:n[34]||(n[34]=function(n){return e.toggleSelectAllGrupal(!0)})}),(0,o.bF)(a,{flat:"",dense:"",icon:"remove",label:"Desmarcar",onClick:n[35]||(n[35]=function(n){return e.toggleSelectAllGrupal(!1)})})])])]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.formSession.unidadesConfig,function(e,n){return(0,o.uX)(),(0,o.CE)("div",{key:"u-".concat(n)},[(0,o.Lk)("div",Fe,[(0,o.Lk)("div",Ne,[(0,o.bF)(_n,{modelValue:e.enabled,"onUpdate:modelValue":function(n){return e.enabled=n}},null,8,["modelValue","onUpdate:modelValue"])]),(0,o.Lk)("div",Me,[(0,o.bF)(pn,{modelValue:e.nombre,"onUpdate:modelValue":function(n){return e.nombre=n},dense:"",label:"Unidad ".concat(n+1)},null,8,["modelValue","onUpdate:modelValue","label"])]),(0,o.Lk)("div",qe,[(0,o.bF)(pn,{modelValue:e.sesiones,"onUpdate:modelValue":function(n){return e.sesiones=n},modelModifiers:{number:!0},type:"number",dense:"",label:"Sesiones"},null,8,["modelValue","onUpdate:modelValue"])]),(0,o.Lk)("div",Re,[(0,o.bF)(pn,{modelValue:e.tiempo,"onUpdate:modelValue":function(n){return e.tiempo=n},modelModifiers:{number:!0},type:"number",dense:"",label:"Tiempo"},null,8,["modelValue","onUpdate:modelValue"])])])])}),128))]}),_:1})):(0,o.Q3)("v-if",!0),e.formSession.genSesiones?((0,o.uX)(),(0,o.Wv)(m,{key:1,class:"q-mt-md q-card-legend",title:"Sesiones"},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",Le,[(0,o.Lk)("div",Ve,[n[74]||(n[74]=(0,o.Lk)("div",{class:"text-caption text-grey-7"},"Total",-1)),(0,o.bF)(kn,{outline:"",color:"primary",dense:"",square:""},{default:(0,o.k6)(function(){return[(0,o.eW)((0,b.v_)(e.formSession.genSesiones),1)]}),_:1})]),(0,o.Lk)("div",Ue,[(0,o.Lk)("div",Ge,[(0,o.bF)(a,{flat:"",dense:"",icon:"done_all",label:"Marcar todas",onClick:n[36]||(n[36]=function(n){return e.toggleSelectAllSesiones(!0)})}),(0,o.bF)(a,{flat:"",dense:"",icon:"remove",label:"Desmarcar",onClick:n[37]||(n[37]=function(n){return e.toggleSelectAllSesiones(!1)})})])])])]}),_:1})):(0,o.Q3)("v-if",!0),(0,o.bF)(m,{class:"q-mt-md",flat:""},{default:(0,o.k6)(function(){return[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.formSession.sesionesConfig,function(e,n){return(0,o.uX)(),(0,o.CE)("div",{key:"s-".concat(n)},[(0,o.Lk)("div",Qe,[(0,o.Lk)("div",$e,[(0,o.bF)(_n,{modelValue:e.enabled,"onUpdate:modelValue":function(n){return e.enabled=n}},null,8,["modelValue","onUpdate:modelValue"])]),(0,o.Lk)("div",je,[(0,o.bF)(pn,{modelValue:e.nombre,"onUpdate:modelValue":function(n){return e.nombre=n},dense:"",label:"Sesión ".concat(n+1)},null,8,["modelValue","onUpdate:modelValue","label"])]),(0,o.Lk)("div",Xe,[(0,o.bF)(pn,{modelValue:e.tiempo,"onUpdate:modelValue":function(n){return e.tiempo=n},modelModifiers:{number:!0},type:"number",dense:"",label:"Minutos"},null,8,["modelValue","onUpdate:modelValue"])])])])}),128)),(0,o.Lk)("div",We,[(0,o.bF)(bn,{icon:"spark",label:"Personalización IA","header-class":" text-weight-medium"},{default:(0,o.k6)(function(){return[(0,o.bF)(m,{class:"q-card-legend"},{default:(0,o.k6)(function(){return[(0,o.bF)(p,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",He,[(0,o.Lk)("div",ze,[(0,o.bF)(gn,{class:"q-if-outlined col chips-compact",modelValue:e.formSession.promptsSelected,"onUpdate:modelValue":n[38]||(n[38]=function(n){return e.formSession.promptsSelected=n}),"float-label":"Prompts",options:e.optionsPrompts,multiple:"",dense:"",filter:"",onInput:e.onChangePromptsMultiple},null,8,["modelValue","options","onInput"])]),(0,o.Lk)("div",Be,[(0,o.bF)(a,{flat:"",size:"md",icon:"broom",onClick:n[39]||(n[39]=function(n){return e.clearSelectedPrompts()})},{default:(0,o.k6)(function(){return[(0,o.bF)(i,null,{default:(0,o.k6)(function(){return g()(n[75]||(n[75]=[(0,o.eW)("Limpiar selección",-1)]))}),_:1})]}),_:1})]),(0,o.Lk)("div",Je,[(0,o.bF)(pn,{ref:"ctxInput",modelValue:e.formSession.contexto,"onUpdate:modelValue":n[40]||(n[40]=function(n){return e.formSession.contexto=n}),label:"Contexto",type:"textarea",autogrow:"",placeholder:"Escribe o pega tu contexto aquí…","input-style":"max-height: 100px; height: 100px;"},null,8,["modelValue"]),(0,o.bF)(a,{style:{position:"absolute",bottom:"0px",right:"0px",background:"white"},flat:"",dense:"",size:"md",icon:"open_in_new",onClick:e.openContextEditor},{default:(0,o.k6)(function(){return[(0,o.bF)(i,null,{default:(0,o.k6)(function(){return g()(n[76]||(n[76]=[(0,o.eW)("Editar",-1)]))}),_:1})]}),_:1},8,["onClick"])]),(0,o.Lk)("div",Ke,[(0,o.bF)(a,{flat:"",icon:"add",round:"",onClick:e.clickSubirDocumento,disable:e.loading||e.loadingDocument},{default:(0,o.k6)(function(){return[(0,o.bF)(i,{offset:[0,10]},{default:(0,o.k6)(function(){return g()(n[77]||(n[77]=[(0,o.eW)("Agrega un documento para que el asistente IA lo considere en sus respuestas",-1)]))}),_:1})]}),_:1},8,["onClick","disable"]),n[78]||(n[78]=(0,o.Lk)("span",null,"Agregar Documento",-1)),(0,o.Lk)("input",{ref:"docInput",type:"file",accept:".docx,.pdf",style:{display:"none"},onChange:n[41]||(n[41]=function(){return e.setArchivo&&e.setArchivo.apply(e,arguments)})},null,544)])])]}),_:1})]}),_:1})]}),_:1})])]}),_:1})]}),_:1},512)]}),_:1})):(0,o.Q3)("v-if",!0)])]}),_:1},8,["modelValue","onSubmit","ok","title"]),(0,o.bF)(mn,{modelValue:e.modalSubirDocumentos,"onUpdate:modelValue":n[45]||(n[45]=function(n){return e.modalSubirDocumentos=n}),title:"Subir Documento",width:"600px",ok:"Subir",onSubmit:e.submitDocumento},{default:(0,o.k6)(function(){return[(0,o.bF)(p,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",Ye,[(0,o.Lk)("div",Ze,[n[79]||(n[79]=(0,o.Lk)("b",null,"Documento:",-1)),(0,o.Lk)("span",null,(0,b.v_)(e.formData.name),1)]),(0,o.Lk)("div",en,[(0,o.bF)(dn,{modelValue:e.formData.categoria,"onUpdate:modelValue":n[43]||(n[43]=function(n){return e.formData.categoria=n}),options:e.categoriaDocumentos,label:"Categoría de Documento",disable:""},null,8,["modelValue","options"])]),(0,o.Lk)("div",nn,[(0,o.bF)(dn,{modelValue:e.formData.tipo,"onUpdate:modelValue":n[44]||(n[44]=function(n){return e.formData.tipo=n}),options:e.tipoDocumentos,label:"Tipo de Documento",disable:!e.esAdmin},null,8,["modelValue","options","disable"])])])]}),_:1})]}),_:1},8,["modelValue","onSubmit"]),e.modalExportarEnPlantilla?((0,o.uX)(),(0,o.Wv)(wn,{key:0,modelValue:e.modalExportarEnPlantilla,"onUpdate:modelValue":n[46]||(n[46]=function(n){return e.modalExportarEnPlantilla=n}),session_id:Number(e.currentSessionId),content:e.getCurrentSession().documentoGenerado},null,8,["modelValue","session_id","content"])):(0,o.Q3)("v-if",!0),(0,o.bF)(mn,{modelValue:e.modalContextEditor,"onUpdate:modelValue":n[51]||(n[51]=function(n){return e.modalContextEditor=n}),title:"Editor de contexto",ok:"OK",onSubmit:e.openContextEditor,css:{height:"90%",maxHeight:"1000px",width:"95%",maxWidth:"1200px"}},{default:(0,o.k6)(function(){return[(0,o.bF)(p,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",tn,[n[80]||(n[80]=(0,o.Lk)("div",{class:"col"},[(0,o.Lk)("div",{class:"text-title text-grey-8"},"Prompt")],-1)),(0,o.Lk)("div",on,[(0,o.Lk)("div",rn,(0,b.v_)(e.formSession.contexto.length)+" caracteres",1)])]),(0,o.Lk)("div",an,[(0,o.Lk)("div",sn,[(0,o.bF)(gn,{class:"q-if-outlined col chips-compact",modelValue:e.formSession.promptsSelected,"onUpdate:modelValue":n[47]||(n[47]=function(n){return e.formSession.promptsSelected=n}),options:e.optionsPrompts,multiple:"",chips:"",filter:"","float-label":"Prompts",onInput:n[48]||(n[48]=function(n){return e.onChangePromptsMultiple()})},null,8,["modelValue","options"]),(0,o.bF)(a,{class:"q-mb-sm",flat:"",dense:"",icon:"broom",label:"Limpiar",onClick:e.clearSelectedPrompts,style:{width:"100%"}},null,8,["onClick"]),(0,o.bF)(a,{class:"q-mb-sm",dense:"",icon:"save",label:"Guardar como nuevo Prompt",onClick:n[49]||(n[49]=function(n){return e.openModalGuardarPrompt(e.formSession.contexto)}),style:{width:"100%"}})]),(0,o.Lk)("div",ln,[(0,o.bF)(pn,{ref:"ctxInput",modelValue:e.formSession.contexto,"onUpdate:modelValue":n[50]||(n[50]=function(n){return e.formSession.contexto=n}),type:"textarea",autogrow:"",placeholder:"Escribe o pega tu contexto aquí…","input-style":"height: 650px; max-height: 100%;"},null,8,["modelValue"])])])]}),_:1})]}),_:1},8,["modelValue","onSubmit"])])}var cn=t(41562),dn=t.n(cn),mn=t(57008),pn=t.n(mn),fn=(t(12563),t(30683),t(71225),t(23825),t(77507),t(23513),t(5962),t(90095),t(92802),t(9240),t(70199),t(7689),t(515),t(49089),t(27153),t(52776),t(66307),t(33092),t(81813),t(68017),t(7346),t(13715),t(24066),t(57053),t(94013),t(32701),t(67396),t(50923),t(59502),t(6123)),vn=t(80660),hn=t(93616),gn=(t(982),t(30640)),bn=t(30545),Sn=t(65673),kn=t(34262),_n=t(11654),wn=t(62006),yn=t(95051),Pn=t(33366),Cn=t(53380),Tn=t(56089),An=t(60975),En=t(37500),On=t(33551),Dn=t(69874),In=t(16648),xn=t(9736),Fn=t(41615),Nn=t(39893),Mn=t(2739),qn=t(88706),Rn=(t(7958),{class:"q-pa-xs",style:{width:"20%"}}),Ln={key:0,class:"q-pa-xs",style:{width:"80%"}},Vn={key:1,class:"q-pa-xs",style:{width:"80%"}},Un={class:"default-container-plantillas center"};function Gn(e,n){var t=this,r=(0,o.g2)("q-separator"),i=(0,o.g2)("q-item-section"),a=(0,o.g2)("q-item"),s=(0,o.g2)("q-list"),l=(0,o.g2)("q-card"),u=(0,o.g2)("QIframe"),c=(0,o.g2)("q-icon"),d=(0,o.g2)("q-card-section"),m=(0,o.g2)("sie-modal"),p=(0,o.gN)("ripple");return(0,o.uX)(),(0,o.Wv)(m,{modelValue:e.openModalEmit,"onUpdate:modelValue":n[0]||(n[0]=function(n){return e.openModalEmit=n}),title:"Exportar en Plantilla",width:"600px",ok:"Exportar",onSubmit:e.exportar},{default:(0,o.k6)(function(){return[(0,o.bF)(d,{class:"flex",style:{width:"1000px",height:"calc(100vh - 200px)"}},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",Rn,[(0,o.bF)(l,{bordered:""},{default:(0,o.k6)(function(){return[n[1]||(n[1]=(0,o.Lk)("div",{class:"q-pa-md flex"},[(0,o.Lk)("div",{style:{"font-size":"1.5em"}},"Plantillas")],-1)),(0,o.bF)(r),(0,o.bF)(s,{separator:"",id:"lista-chats",class:(0,b.C4)({"loading-list":e.loading})},{default:(0,o.k6)(function(){return[(0,o.bF)(r),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.dataDocumentos,function(n){return(0,o.bo)(((0,o.uX)(),(0,o.Wv)(a,{key:n.id_documento,clickable:"",disable:e.loading,class:(0,b.C4)(e.currentPlantilla===n.id_documento?"current-plantilla":"default-plantilla"),onClick:function(t){return e.onPlantillaSelected(n)}},{default:(0,o.k6)(function(){return[(0,o.bF)(i,null,{default:(0,o.k6)(function(){return[(0,o.eW)((0,b.v_)(n.nombre),1)]}),_:2},1024)]}),_:2},1032,["disable","class","onClick"])),[[p]])}),128))]}),_:1},8,["class"])]}),_:1})]),e.previewPlantillaURL?((0,o.uX)(),(0,o.CE)("div",Ln,[(0,o.bF)(u,{src:e.linkView(e.previewPlantillaURL),style:{height:"calc(100vh - 250px)"}},null,8,["src"])])):(0,o.Q3)("v-if",!0),t.dataDocumentos.length?(0,o.Q3)("v-if",!0):((0,o.uX)(),(0,o.CE)("div",Vn,[(0,o.bF)(l,{bordered:""},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",Un,[(0,o.bF)(c,{class:"q-pa-sm",name:"documents",size:"4rem",color:"grey"}),n[2]||(n[2]=(0,o.Lk)("span",{style:{color:"grey"}},"No hay plantillas disponibles.",-1))])]}),_:1})]))]}),_:1})]}),_:1},8,["modelValue","onSubmit"])}var Qn=t(66099),$n=t(47206),jn={emits:["update:modelValue","input"],components:{marked:Dn.xI,sieHtml:Qn.A,QSeparator:Cn.A,QIframe:Tn.A,QList:Sn.A,QItem:m.A,QItemSection:p.A,QCard:fn.C$,QIcon:fn.bP},props:{modelValue:{type:Boolean,default:!1},session_id:{type:Number,default:0},content:{type:String,default:""}},data:function(){return{sie:(0,c["default"])(),dataDocumentos:[],previewPlantillaURL:"",loading:!1,currentPlantilla:null}},watch:{},computed:{openModalEmit:{set:function(e){this.$emit("update:modelValue",e),this.$emit("input",e)},get:function(){return this.modelValue}}},methods:{exportar:function(){var e=this;return u()(s()().m(function n(){var t,o,r,i,a,l,u;return s()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,e.$q.loading.show({message:"Generando documento..."}),t=e.dataDocumentos.find(function(n){return n.id_documento===e.currentPlantilla}),o={content:e.content,session_id:e.session_id,plantilla:t},n.n=1,e.exportarEnPlantilla(o);case 1:r=n.v,i=window.URL.createObjectURL(r),a=document.createElement("a"),a.href=i,l=(new Date).toISOString().slice(0,10),a.download="Programacion_Anual_".concat(l,".docx"),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(i),document.body.removeChild(a),n.n=3;break;case 2:n.p=2,u=n.v,e.$notify(u.error?u.error.message:u.message,"warning");case 3:return n.p=3,e.$q.loading.hide(),n.f(3);case 4:return n.a(2)}},n,null,[[0,2,3,4]])}))()},exportarEnPlantilla:function(e){var n=this;return u()(s()().m(function t(){var o,r,i,a,l,u,c;return s()().w(function(t){while(1)switch(t.n){case 0:return o=e.plantilla.tags,r={content:e.content,template:JSON.stringify(o),session_id:e.session_id},t.n=1,n.streamRequest("convert-to-json",r);case 1:return i=t.v,console.log("resCTJ",i),a=i.replace(/^```json\s*/,"").replace(/```$/,""),l="http://ies_bpastor.proyectpg.hyo/ies/api/PersonaController/exportarEnPlantilla",e.cleanedString=a,t.n=2,fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});case 2:return u=t.v,t.n=3,u.blob();case 3:return c=t.v,t.a(2,c)}},t)}))()},streamRequest:function(e,n){return u()(s()().m(function t(){var o,r,i,a,l,u,c,d,m,p,f,v,h,g,b,S;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,o="",r=JSON.stringify(n),t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/".concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:r});case 1:i=t.v,a=i.body.getReader(),l=new TextDecoder,u="";case 2:return t.n=3,a.read();case 3:if(c=t.v,d=c.done,m=c.value,!d){t.n=4;break}return t.a(3,5);case 4:u+=l.decode(m,{stream:!0}),p=u.split("\n"),u=p.pop(),f=dn()(p);try{for(f.s();!(v=f.n()).done;)if(h=v.value,h.trim())try{g=JSON.parse(h),"item"===g.type&&g.content&&(o+=g.content)}catch(e){console.error("Error parsing JSON:",e,h)}}catch(e){f.e(e)}finally{f.f()}t.n=2;break;case 5:if(u.trim())try{b=JSON.parse(u),"item"===b.type&&b.content&&(o+=b.content)}catch(e){console.error("Error parsing final JSON:",e,u)}return t.a(2,o);case 6:throw t.p=6,S=t.v,console.error("Error streaming data:",S),new Error(S.error?S.error.message:S.message);case 7:return t.a(2)}},t,null,[[0,6]])}))()},linkView:function(e){return this.sie.token=this.sie.tokenViewer,(0,$n.linkPreview)(e,this.sie)},getDocumentos:function(e){var n=this;return u()(s()().m(function t(){var o,r,i;return s()().w(function(t){while(1)switch(t.n){case 0:return o={query:"GET",categoria:e},t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/ia-documentos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});case 1:return r=t.v,t.n=2,r.json();case 2:i=t.v,i.length&&!i[0].id_documento&&(i=[]),n.dataDocumentos=i;case 3:return t.a(2)}},t)}))()},onPlantillaSelected:function(e){this.currentPlantilla=e.id_documento,this.previewPlantillaURL="https://n8n.sieweb.com.pe/webhook/documentosS3?key=".concat(e.url_s3,"&t=").concat(+(new Date).getTime())}},beforeMount:function(){var e=this;return u()(s()().m(function n(){return s()().w(function(n){while(1)switch(n.n){case 0:return e.$q.loading.show(),n.n=1,e.getDocumentos("plantilla");case 1:e.dataDocumentos.length&&e.onPlantillaSelected(e.dataDocumentos[0]),e.$q.loading.hide();case 2:return n.a(2)}},n)}))()}},Xn=t(12807);const Wn=(0,Xn.A)(jn,[["render",Gn]]);var Hn=Wn,zn=t(29104),Bn={class:"editor-scroll",ref:"scroller"},Jn={class:"bubble-menu"},Kn={class:"q-px-sm q-pa-sm ask-popup flex",style:{"min-width":"320px","max-width":"520px"}},Yn={class:"row q-gutter-sm justify-end q-mt-sm"};function Zn(e,n){var t=(0,o.g2)("editor-content"),r=(0,o.g2)("q-icon"),i=(0,o.g2)("q-input"),a=(0,o.g2)("q-btn"),s=(0,o.g2)("q-popup-proxy"),l=(0,o.g2)("bubble-menu");return(0,o.uX)(),(0,o.CE)("div",{class:(0,b.C4)(["editor",{"is-readonly":!e.editable}])},[(0,o.Lk)("div",Bn,[e.editor?((0,o.uX)(),(0,o.Wv)(t,{key:0,class:"editor__content",ref:"tiptap",editor:e.editor},null,8,["editor"])):(0,o.Q3)("v-if",!0),e.editor?((0,o.uX)(),(0,o.Wv)(l,{key:1,editor:e.editor,options:{placement:"bottom",offset:8}},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",Jn,[e.enableAsk?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("button",{ref:"askBtn",onClick:n[0]||(n[0]=function(){return e.openAsk&&e.openAsk.apply(e,arguments)})},[(0,o.bF)(r,{name:"spark"}),n[4]||(n[4]=(0,o.Lk)("span",{class:"q-ml-xs"},"Editar con IA",-1))],512),(0,o.bF)(s,{ref:"qAskProxy","no-parent-event":"",offset:[0,8],"transition-show":"scale","transition-hide":"scale",onBeforeShow:e.onAskBeforeShow,onHide:e.onAskHide},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",Kn,[(0,o.bF)(i,{ref:"askInput",modelValue:e.pregunta,"onUpdate:modelValue":n[1]||(n[1]=function(n){return e.pregunta=n}),dense:"",autofocus:"",type:"textarea",autogrow:"",placeholder:"Escribe tu texto aquí...",onKeyup:(0,zn.jR)((0,zn.D$)(e.submitAsk,["exact"]),["enter"]),"input-class":"text-white",style:{width:"300px"}},null,8,["modelValue","onKeyup"]),(0,o.Lk)("div",Yn,[(0,o.bF)(a,{class:"q-ml-sm",round:"",icon:"arrow_upward",onClick:e.submitAsk,size:"sm"},null,8,["onClick"])])])]}),_:1},8,["onBeforeShow","onHide"])],64)):(0,o.Q3)("v-if",!0),(0,o.Lk)("button",{onClick:n[2]||(n[2]=function(n){return e.editor.chain().focus().toggleBold().run()}),class:(0,b.C4)({"is-active":e.editor.isActive("bold")})},[(0,o.bF)(r,{name:"format_bold"})],2),(0,o.Lk)("button",{onClick:n[3]||(n[3]=function(n){return e.editor.chain().focus().toggleItalic().run()}),class:(0,b.C4)({"is-active":e.editor.isActive("italic")})},[(0,o.bF)(r,{name:"format_italic"})],2)])]}),_:1},8,["editor"])):(0,o.Q3)("v-if",!0)],512)],2)}t(84433),t(34993);var et=t(56384),nt=t(50492),tt=t(48975),ot=t(67837),rt=t(10386),it=t(82390),at=t(87601),st=t(43564),lt=t(96561),ut=t(2002),ct=t(73545),dt=t(99750),mt=t(47175),pt=t(80308),ft=t(55421),vt=t(43028),ht=t(40410),gt=t(15161),bt={name:"TipTapEditor",emits:["getHtml","update:modelValue","input","ask","ready"],components:{EditorContent:at.$Z,BubbleMenu:st.m,QPopupProxy:tt.A,QIcon:nt.A,QBtn:et.A,QInput:ot.A,QSeparator:rt.A},props:{src:{type:String,default:""},editable:{type:Boolean,default:!0},placeholder:{type:String,default:""},contentFormat:{type:String,default:"auto"},enableAsk:{type:Boolean,default:!0}},data:function(){return{editor:null,pregunta:"",savedSelection:null,_hydrating:!0}},methods:{getText:function(){var e,n=this._ed(),t=null===n||void 0===n||null===(e=n.state)||void 0===e?void 0:e.doc;return t?t.textBetween(0,t.content.size,"\n\n","\n"):""},openAsk:function(){this.pregunta="",this.$refs.qAskProxy&&this.$refs.qAskProxy.show()},onAskBeforeShow:function(){var e=this;if(this.editor&&this.editor.state){var n=this.editor.state.selection;this.savedSelection={from:n.from,to:n.to},this.$nextTick(function(){var n;return(null===(n=e.$refs)||void 0===n?void 0:n.askInput)&&e.$refs.askInput.focus()})}},onAskHide:function(){this.restoreSelection()},restoreSelection:function(){if(this.editor&&this.editor.state&&this.savedSelection){var e=this.savedSelection,n=e.from,t=e.to,o=this.editor.state,r=Math.max(1,o.doc.nodeSize-2),i=function(e){return Math.min(Math.max(1,e),r)};n=i(n),t=i(t);try{var a=o.tr.setSelection(ht.U3.create(o.doc,n,t));this.editor.view.dispatch(a),this.editor.view.focus()}catch(e){var s,l;null===(s=this.editor)||void 0===s||null===(s=s.commands)||void 0===s||null===(l=s.focus)||void 0===l||l.call(s)}}},getSelectedText:function(){if(!this.editor||!this.savedSelection)return"";var e=this.savedSelection,n=e.from,t=e.to;return this.editor.state.doc.textBetween(n,t,"\n")},getSelectedHTML:function(){if(!this.editor)return"";var e=this.editor.state,n=e.selection.content(),t=document.createElement("div"),o=gt.ZF.fromSchema(e.schema);return t.appendChild(o.serializeFragment(n.content)),t.innerHTML},submitAsk:function(){this.$emit("ask",{pregunta:this.pregunta,selection:this.savedSelection,selectedText:this.getSelectedText(),selectedHTML:this.getSelectedHTML()}),this.$refs.qAskProxy&&this.$refs.qAskProxy.hide()},_ed:function(){var e,n;return this.editor||(null===(e=this.$refs)||void 0===e||null===(e=e.tiptap)||void 0===e?void 0:e.editor)||(null===(n=this.$refs)||void 0===n?void 0:n.tiptap)},getHtml:function(){var e,n=this._ed();return(null===n||void 0===n||null===(e=n.getHTML)||void 0===e?void 0:e.call(n))||""},setHtml:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.editor&&!this.editor.isDestroyed)try{this.editor.commands.setContent(e||"",!1)}catch(n){console.warn("setHtml fallback por mismatch:",n);try{this.editor.commands.clearContent(!1),this.editor.commands.setContent("<p></p>",!1),this.editor.commands.setContent(e||"",!1)}catch(e){console.error("Fallback también falló:",e)}}},_escapeHtml:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},_looksLikeHTML:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/<\/?[a-z][\s\S]*>/i.test(e)||/^\s*<(table|div|p|ul|ol|h[1-6]|section|article|span)\b/i.test(e)},_textToHtml:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=this._escapeHtml(e||"");return n.split(/\n{2,}/).map(function(e){return"<p>".concat(e.replace(/\n/g,"<br>"),"</p>")}).join("\n")},_mdToHtml:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this._textToHtml(e)},_migrateV1TodosToV2Tasks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e?(e=e.replace(/data-type="todoList"/g,'data-type="taskList"'),e=e.replace(/data-type="todoItem"/g,""),e=e.replace(/data-checked="(true|false)"/g,'data-checked="$1"'),e):e},_normalizeToHTML:function(e){var n,t=null==e?"":String(e),o=(this.contentFormat||"auto").toLowerCase();return n="html"===o?t:"markdown"===o?this._mdToHtml(t):"text"===o?this._textToHtml(t):this._looksLikeHTML(t)?t:this._textToHtml(t),n=this._migrateV1TodosToV2Tasks(n),n},applyAskResult:function(e){var n=(null===e||void 0===e?void 0:e.json)||e||{},t=n.edited||"",o=n.range,r=this._ed();if(r&&o){var i=r.state,a=r.view,s=i.schema,l=Math.max(1,i.doc.nodeSize-2),u=function(e){return Math.min(Math.max(1,+e||1),l)},c=u(o.from),d=u(o.to),m=document.createElement("div");m.innerHTML=t||"";var p=gt.S4.fromSchema(s),f=p.parseSlice(m,{preserveWhitespace:!0}),v=i.tr.replaceRange(c,d,f);a.dispatch(v),a.focus()}}},watch:{src:function(e){if(!this._hydrating){var n=this._normalizeToHTML(e),t=this.getHtml();(n||"")!==(t||"")&&this.setHtml(n)}},editable:function(e){var n,t,o,r;(null===(n=this.editor)||void 0===n||null===(t=n.setEditable)||void 0===t?void 0:t.call(n,!!e))||null===(o=this.editor)||void 0===o||null===(r=o.setOptions)||void 0===r||r.call(o,{editable:!!e})}},mounted:function(){var e=this;this.editor=new at.KE({editable:this.editable,extensions:[it.A.configure({heading:{levels:[1,2,3]},history:!0}),lt.A,ut.Ay,ct.XI.configure({resizable:!0}),dt.A,mt.h,pt.A,ft.A,vt.A.configure({nested:!0})],content:"",onUpdate:function(n){var t=n.editor;e._hydrating||(e.$emit("getHtml",t.getHTML()),e.$emit("update:modelValue",e.getText()),e.$emit("input",e.getText()))}});var n=this._normalizeToHTML(this.src);this.$nextTick(function(){try{e.editor.commands.setContent(n,!1)}finally{e._hydrating=!1}}),this.$emit("ready",{getHtml:function(){return e.getHtml()},getText:function(){return e.getText()}})},beforeUnmount:function(){var e,n;null===(e=this.editor)||void 0===e||null===(n=e.destroy)||void 0===n||n.call(e)}};const St=(0,Xn.A)(bt,[["render",Zn]]);var kt=St,_t=t(53093),wt=t(26697),yt=t(43346),Pt=t(53811),Ct=t(66864),Tt=t(22926),At={class:"edge-borders","aria-hidden":"true"};function Et(e,n){return(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",At,[(0,o.Q3)("div.edge-top"),n[0]||(n[0]=(0,o.Lk)("div",{class:"edge-bottom"},null,-1)),(0,o.Q3)("div.edge-left"),(0,o.Q3)("div.edge-right")],512)),[[zn.aG,e.value]])}var Ot={name:"loaderAI",props:{modelValue:{type:Boolean,default:!1}}};const Dt=(0,Xn.A)(Ot,[["render",Et]]);var It=Dt,xt={components:{QSelect:In.A,QSelectCore:fn.Si,QToggle:fn.c5,QCheckbox:fn.vZ,sieSelect:hn.A,QTable:bn.A,QTd:fn.Ef,QTr:fn.qh,QPopupEdit:fn.GT,sieModal:gn.A,QList:Sn.A,QItem:m.A,QItemSection:p.A,QItemLabel:v.A,QDownloadFile:wn.A,QChip:yn.A,QChatMessage:Pn.A,QSeparator:Cn.A,QSpinnerDots:fn.FS,QSpinnerOval:fn.VA,QIframe:Tn.A,QIcon:kn.A,QAvatar:f.A,QBtn:_n.A,MarkdownViewer:An.A,QInfiniteScroll:En.A,Skeleton:On.A,QInputV1:xn.A,QForm:Mn.A,QMenu:qn.A,modalExportarEnPlantilla:Hn,tipTapEditor:kt,QTab:_t.A,QTabs:wt.A,QTabPanel:yt.A,QTabPanels:Pt.A,QDateSys:Ct.A,QExpansionItem:Tt.A,loaderAI:It,QCard:fn.C$,QTooltip:fn.nC},data:function(){return{loaderAIShow:!1,esAdmin:!1,dataPrompts:[],sie:(0,c["default"])(),sessions:[],sessionsData:[],currentSessionId:null,userInput:"",mensajeInicio:{type:"ai",content:"Hola 👋 soy su *asistente virtual*. Su documento se está generando. Espere un momento, por favor.",is_document:!1,tool_calls:[],additional_kwargs:{},response_metadata:{},invalid_tool_calls:[]},objMensaje:{type:"ai",content:"",is_document:!1,tool_calls:[],additional_kwargs:{},response_metadata:{},invalid_tool_calls:[]},objMensajeUser:{type:"human",content:""},loading:!1,skeletonWidths:[],skeletonWidthsDocument:[this.getRandomIntInRange(60,100)+"%",this.getRandomIntInRange(60,100)+"%",this.getRandomIntInRange(40,100)+"%",this.getRandomIntInRange(40,100)+"%",this.getRandomIntInRange(60,100)+"%",this.getRandomIntInRange(40,100)+"%"],modalPrompts:!1,selectedPrompt:null,optionsPrompts:[],contentToSave:"",namePromptToSave:"",modalGuardarPrompt:!1,modalSession:!1,formSession:{nombreSession:"",fechaInicio:"",fechaFin:"",tema:"",nivel:"",grado:"",prompt:null,contexto:"",promptsSelected:[],pa_session_id:null,unidad_session_id:null,numUnidades:null,horasSemana:null,area:"",unidadesConfig:[],genSesiones:null,sesionesConfig:[],genUnidades:null},optionsNivel:[],optionsGrado:[],gradosTodos:[],typeSessions:[{label:"Clase",value:1},{label:"Unidad",value:2},{label:"Programación Anual",value:3}],SESSION_CLASE:1,SESSION_UNIDAD:2,SESSION_PA:3,currentTypeSession:3,apiSessionType:{1:"clase",2:"unidad",3:"pa"},modalSubirDocumentos:!1,formData:{name:"",tipo:1,fileName:"",archivo:null,extension:"",categoria:"contextual",session_id:null},tipoDocumentos:[{label:"Por Usuario",value:1},{label:"General",value:2}],categoriaDocumentos:[{label:"Contextual",value:"contextual"},{label:"Plantilla",value:"plantilla"}],modalExportarEnPlantilla:!1,colegioData:null,optionsPA:[],optionsUnidad:[],streamedText:"",currentHtmlEditor:"",loadingDocument:!1,preloadingDocument:!1,controller:null,streamingAsk:{id:null,mode:"inline",inTableCell:!1},tabGeneracion:"individual",selectedPA:null,lastSavedHtml:"",hasEdits:!1,concatOptions:{separator:"\n\n---\n\n"},modalContextEditor:!1,hasPA:!1,PAData:null}},watch:{loading:function(e){e&&(this.skeletonWidths=[this.getRandomIntInRange(40,60)+"%",this.getRandomIntInRange(60,80)+"%",this.getRandomIntInRange(40,80)+"%"])},streamedText:function(e){}},computed:{showTabs:function(){return this.currentTypeSession===this.SESSION_CLASE||this.currentTypeSession===this.SESSION_UNIDAD},puedeGenerarGrupal:function(){var e=!!this.formSession.pa_session_id,n=(this.formSession.unidadesConfig||[]).some(function(e){return e.enabled});return e&&n}},methods:{required:Nn.required,cambiarTab:function(e){this.tabGeneracion=e,this.cleanFormSession()},getCurrentHtml:function(e){if(this.currentHtmlEditor=e,!this.lastSavedHtml)return this.lastSavedHtml=e,void(this.hasEdits=!1);this.hasEdits=e!==this.lastSavedHtml},changeTypeSession:function(e){var n=this;return u()(s()().m(function t(){return s()().w(function(t){while(1)switch(t.n){case 0:return n.currentSessionId=null,n.$q.loading.show(),n.currentTypeSession=e,t.n=1,n.getChatSessions(n.currentTypeSession);case 1:n.$q.loading.hide();case 2:return t.a(2)}},t)}))()},keyword:function(){return this.currentTypeSession===this.SESSION_CLASE?"Clase":this.currentTypeSession===this.SESSION_UNIDAD?"Unidad":"Plan"},tituloNuevo:function(){return this.currentTypeSession===this.SESSION_PA?"Nuevo ".concat(this.keyword()):"Nueva ".concat(this.keyword())},getRandomIntInRange:function(e,n){return Math.floor(Math.random()*(n-e+1))+e},markdownToHtml:function(e){return(0,Dn.xI)(e)},getParamsSession:function(e){var n=this.getCurrentSession().parametros,t=this.optionsNivel.find(function(e){return e.value===n.nivel}),o=this.gradosTodos.find(function(e){return e.GRADOCOD===n.grado&&e.INSTRUCOD===n.nivel}),r=(new Date).getFullYear(),i={chatInput:e,session_id:this.currentSessionId,usucod:this.sie.usucod,nivel:t?t.label:"",grado:o?o.GRADODES:"",area:n.area,docente:n.docente,anioActual:r,ugel:this.colegioData.NOMUSE,colegio:this.colegioData.COLNOMMINEDU,director:this.colegioData.DIRECTOR,contexto:n.contexto};return this.currentTypeSession===this.SESSION_CLASE?(i.tema=n.tema,i.unidad_session_id=n.unidad_session_id):this.currentTypeSession===this.SESSION_UNIDAD?(i.tema=n.tema,i.pa_session_id=n.pa_session_id,i.tiempo=this.formSession.tiempo_sesion,i.unidadesConfig=this.formSession.unidadesConfig):this.currentTypeSession===this.SESSION_PA&&(i.dre="",i.ciclo="",i.coordinador="",i.fechaInicio=this.formSession.fechaInicio,i.fechaFin=this.formSession.fechaFin,i.numUnidades=this.formSession.numUnidades,i.horasSemana=this.formSession.horasSemana),i},scrollToBottom:function(){var e=this;this.$nextTick(function(){var n=e.$refs.chatWindow;n&&(n.scrollTop=n.scrollHeight)})},copyToClipboard:function(e){return u()(s()().m(function n(){var t;return s()().w(function(n){while(1)switch(n.n){case 0:if(!navigator.clipboard||!window.isSecureContext){n.n=2;break}return n.n=1,navigator.clipboard.writeText(e);case 1:n.n=3;break;case 2:t=document.createElement("textarea"),t.value=e,t.style.position="absolute",t.style.left="-999999px",document.body.prepend(t),t.select();try{document.execCommand("copy")}catch(e){console.error(e)}finally{t.remove()}case 3:return n.a(2)}},n)}))()},selectSession:function(e){e&&e.session_id&&(this.currentSessionId=e.session_id,this.streamedText="",this.currentHtmlEditor="",this.getChatDocument(this.currentSessionId))},agruparChatsSessions:function(e){var n=Object.values(e.reduce(function(e,n){var t="".concat(n.session_id,"-").concat(n.name_chat);return e[t]||(e[t]={session_id:n.session_id,name_chat:n.name_chat,usucod:n.usucod,parametros:n.parametros,session_type:n.session_type,messages:[],manifest:n.manifest}),n.message&&e[t].messages.push({id:n.id,type:n.message.type,content:n.message.content}),e},{}));return n.forEach(function(e){e.messages.sort(function(e,n){return Number(e.id)-Number(n.id)})}),n.sort(function(e,n){return Number(n.session_id)-Number(e.session_id)}),n},sendMessage:function(){var e=this;return u()(s()().m(function n(){var t;return s()().w(function(n){while(1)switch(n.n){case 0:if(t=e.userInput.trim(),t){n.n=1;break}return n.a(2);case 1:return e.getCurrentSession().messages.push({type:"human",content:t}),e.userInput="",e.loading=!0,e.$nextTick(e.scrollToBottom),n.n=2,e.enviarRespuestaIA(t);case 2:e.loading=!1,e.$nextTick(e.scrollToBottom),e.$refs.messageInput.focus();case 3:return n.a(2)}},n)}))()},enviarRespuestaIA:function(e){var n=this;return u()(s()().m(function t(){var o;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:return o=null,t.p=1,t.n=2,n.editarDocumento(e);case 2:t.n=4;break;case 3:t.p=3,t.v,o&&(o.loading="error"),n.$notify("Ocurrió un error","warning");case 4:return t.a(2)}},t,null,[[1,3]])}))()},createChatSession:function(){var e=this;return u()(s()().m(function n(){var t,o,r,i,a,l;return s()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,e.$q.loading.show(),e.loaderAIShow=!0,n.n=1,e.$refs.formSession.validate();case 1:if(t=n.v,t){n.n=2;break}throw new Error("Debe ingresar los campos requeridos");case 2:if(e.currentTypeSession!==e.SESSION_UNIDAD||"grupal"!==e.tabGeneracion){n.n=5;break}if(e.formSession.pa_session_id){n.n=3;break}throw new Error("Seleccione una Programación Anual para generar unidades.");case 3:return e.modalSession=!1,n.n=4,e.generarUnidadesGrupal();case 4:return n.a(2);case 5:if(e.currentTypeSession!==e.SESSION_CLASE||"grupal"!==e.tabGeneracion){n.n=8;break}if(e.formSession.unidad_session_id){n.n=6;break}throw new Error("Seleccione una Unidad para generar sesiones.");case 6:return e.modalSession=!1,n.n=7,e.generarClasesGrupal();case 7:return n.a(2);case 8:return o=JSON.stringify(pn()({},e.formSession)),r={usucod:e.sie.usucod,name_chat:e.formSession.nombreSession||"Nueva Clase",parametros:o,session_type:e.currentTypeSession},n.n=9,fetch("https://n8n.sieweb.com.pe/webhook/new-chat-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 9:return i=n.v,n.n=10,i.json();case 10:return a=n.v,n.n=11,e.addChatMessage({session_id:a[0].session_id,message:JSON.stringify(e.mensajeInicio)});case 11:return n.n=12,e.getChatSessions(e.currentTypeSession);case 12:return e.currentSessionId=a[0].session_id,e.modalSession=!1,e.$q.loading.hide(),n.n=13,e.generarDocumentoInicial();case 13:n.n=15;break;case 14:n.p=14,l=n.v,e.$notify(l.error?l.error.message:l.message,"warning");case 15:return n.p=15,e.$q.loading.hide(),e.loaderAIShow=!1,n.f(15);case 16:return n.a(2)}},n,null,[[0,14,15,16]])}))()},getCurrentSession:function(){var e=this;return this.sessions.find(function(n){return n.session_id===e.currentSessionId})||{}},deleteChatSession:function(e){var n=this;return u()(s()().m(function t(){var o,r,i,a;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,n.$q.loading.show(),o={session_id:e},t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/delete-chat-session",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});case 1:if(r=t.v,!r.ok){t.n=2;break}null===(i=n.$notify)||void 0===i||i.call(n,"Session eliminada.","positive"),t.n=3;break;case 2:return n.$notify(error.error?error.error.message:error.message,"warning"),t.a(2);case 3:return t.n=4,n.getChatSessions(n.currentTypeSession);case 4:if(!n.sessions.length){t.n=5;break}return n.currentSessionId=n.sessions[0].session_id,n.streamedText=n.getCurrentSession().documentoGenerado||"",t.n=5,n.getChatDocument(n.currentSessionId);case 5:t.n=7;break;case 6:t.p=6,a=t.v,n.$notify(a.error?a.error.message:a.message,"warning");case 7:return t.p=7,n.$q.loading.hide(),t.f(7);case 8:return t.a(2)}},t,null,[[0,6,7,8]])}))()},eliminarSession:function(e){var n=this;this.$confirm("¿Está seguro de eliminar este chat?").onOk(function(){n.deleteChatSession(e)})},editarNombre:function(e){},getChatSessions:function(e){var n=this;return u()(s()().m(function t(){var o,r,i;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/n8n-chats?usucod=".concat(n.sie.usucod),{method:"GET",headers:{"Content-Type":"application/json"}});case 1:return o=t.v,t.n=2,o.json();case 2:r=t.v,r.length&&!r[0].session_id&&(r=[]),n.sessionsData=r,n.sessions=n.agruparChatsSessions(r.filter(function(n){return n.session_type===e})),n.optionsPA=n.agruparChatsSessions(r.filter(function(e){return e.session_type===n.SESSION_PA})),n.optionsUnidad=n.agruparChatsSessions(r.filter(function(e){return e.session_type===n.SESSION_UNIDAD})),n.getUserPrompts(),t.n=4;break;case 3:t.p=3,i=t.v,n.$notify(i.error?i.error.message:i.message,"warning");case 4:return t.a(2)}},t,null,[[0,3]])}))()},addChatMessage:function(e){var n=this;return u()(s()().m(function t(){var o,r;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,o={session_id:e.session_id,message:e.message},t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/new-chat-message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});case 1:t.n=3;break;case 2:t.p=2,r=t.v,n.$notify(r.error?r.error.message:r.message,"warning");case 3:return t.a(2)}},t,null,[[0,2]])}))()},openModalUserPrompts:function(){var e=this;return u()(s()().m(function n(){return s()().w(function(n){while(1)switch(n.n){case 0:if(e.optionsPrompts.length){n.n=1;break}return n.a(2,e.$alert("No hay prompts disponibles"));case 1:e.selectedPrompt=e.optionsPrompts[0].id_prompt,e.modalPrompts=!0;case 2:return n.a(2)}},n)}))()},getUserPrompts:function(){var e=arguments,n=this;return u()(s()().m(function t(){var o,r,i,a,l,u;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:return o=e.length>0&&void 0!==e[0]?e[0]:3,t.p=1,i={type:3===o?"":String(o),usucod:n.sie.usucod},t.n=2,vn.$http.get("api/ChatPromptController/getPrompts",{params:{params:i}});case 2:a=t.v,l=Array.isArray(a.data)?a.data:(null===(r=a.data)||void 0===r?void 0:r.data)||[],n.dataPrompts=l,n.optionsPrompts=l.map(function(e){return{label:e.NAME_PROMPT,value:Number(e.ID_PROMPT),content:e.CONTENT}}),t.n=4;break;case 3:t.p=3,t.v,null===(u=n.$notify)||void 0===u||u.call(n,"Error al obtener prompts","warning");case 4:return t.a(2)}},t,null,[[1,3]])}))()},getSelectedPromptContent:function(){var e=this;if(!this.optionsPrompts.length)return"";if(!this.selectedPrompt)return"";var n=this.optionsPrompts.find(function(n){return n.ID_PROMPT===e.selectedPrompt});return n.CONTENT||""},usePrompt:function(){this.userInput=this.getSelectedPromptContent(),this.modalPrompts=!1},openModalGuardarPrompt:function(e){var n=0,t=g()(this.optionsPrompts).reverse(),o=t[0];o&&(n=o.ID_PROMPT),this.namePromptToSave="Prompt #".concat(Number(n)+1),this.modalGuardarPrompt=!0,this.contentToSave=e},getContentToPreview:function(e){return e.replace(/\n/g,"<br>")},guardarPrompt:function(){var e=this;return u()(s()().m(function n(){var t,o,r,i,a,l;return s()().w(function(n){while(1)switch(n.p=n.n){case 0:if(n.p=0,e.$q.loading.show(),e.contentToSave){n.n=1;break}throw new Error("No se guardar como prompt contenido vacío");case 1:if(e.namePromptToSave){n.n=2;break}throw new Error("Debe ingresar un nombre para el prompt");case 2:return r={name_prompt:e.namePromptToSave||"",usucod:e.sie.usucod,type:e.formData.TYPE,content:e.contentToSave||""},n.n=3,vn.$http.post("api/ChatPromptController/postPrompt",{params:r});case 3:return i=n.v,a=(null===i||void 0===i||null===(t=i.data)||void 0===t?void 0:t.message)||"Prompt guardado.",null===(o=e.$notify)||void 0===o||o.call(e,a,"positive"),e.contentToSave="",e.modalGuardarPrompt=!1,n.n=4,e.getUserPrompts();case 4:n.n=6;break;case 5:n.p=5,l=n.v,e.$notify(l.error?l.error.message:l.message,"warning");case 6:return n.p=6,e.$q.loading.hide(),n.f(6);case 7:return n.a(2)}},n,null,[[0,5,6,7]])}))()},cleanFormSession:function(){this.formSession.nombreSession="".concat(this.keyword()," #").concat(this.sessions.length+1),this.formSession.fechaInicio="",this.formSession.fechaFin="",this.formSession.horasSemana="",this.formSession.area="",this.formSession.numUnidades="",this.formSession.tema="",this.formSession.nivel="",this.formSession.grado="",this.formSession.prompt=null,this.formSession.contexto="",this.formSession.pa_session_id=null,this.formSession.unidad_session_id=null,this.formSession.genUnidades=null,this.formSession.unidadesConfig=[],this.formSession.genSesiones=null,this.formSession.sesionesConfig=[],this.formSession.sesiones="",this.formSession.pa_session_id=null,this.formSession.unidad_session_id=null,this.formSession.tiempo_sesion="",this.formSession.sesiones="",this.hasPA=!1},openModalNuevaSession:function(){this.cleanFormSession(),this.modalSession=!0,this.tabGeneracion="individual"},obtenerGradosTodos:function(){var e=this;return u()(s()().m(function n(){var t;return s()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,vn.$http.get("api/gradoController/getGradosTodos");case 1:t=n.v,e.gradosTodos=t;case 2:return n.a(2)}},n)}))()},obtenerGrados:function(e){var n=this;return u()(s()().m(function t(){var o,r;return s()().w(function(t){while(1)switch(t.n){case 0:return t.n=1,Fn["default"].API_GRADOS(e);case 1:o=t.v,r=o.filter(function(e){return e.value!==Fn["default"].TODOS}),r.sort(function(e,n){return e.value-n.value}),n.optionsGrado=r;case 2:return t.a(2)}},t)}))()},obtenerNiveles:function(){var e=this;return u()(s()().m(function n(){var t;return s()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,Fn["default"].API_NIVELES({filter:!1});case 1:t=n.v,e.optionsNivel=t.filter(function(e){return e.value!==Fn["default"].TODOS});case 2:return n.a(2)}},n)}))()},clickSubirDocumento:function(){this.$refs.docInput.click()},setArchivo:function(e){var n=this;return u()(s()().m(function t(){var o,r,i;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:if(t.p=0,o=e.target.files[0],o){t.n=1;break}return t.a(2);case 1:r=new FileReader,r.onload=u()(s()().m(function e(){var t,r;return s()().w(function(e){while(1)switch(e.n){case 0:t=o.name.split("."),r=t.pop().toLowerCase(),n.$q.loading.show(),n.formData.name=o.name,n.formData.archivo=o,n.formData.extension=r,n.formData.tipo=1,n.formData.categoria="contextual",n.$q.loading.hide();case 1:return e.a(2)}},e)})),n.modalSubirDocumentos=!0,r.readAsDataURL(o),t.n=3;break;case 2:t.p=2,i=t.v,n.$notify(i.error?i.error.message:i.message,"warning");case 3:return t.p=3,n.$q.loading.hide(),t.f(3);case 4:return t.a(2)}},t,null,[[0,2,3,4]])}))()},submitDocumento:function(){var e=this;return u()(s()().m(function n(){var t,o,r;return s()().w(function(n){while(1)switch(n.n){case 0:return e.$q.loading.show({message:"Subiendo documento..."}),n.n=1,e.uploadFileS3(e.formData.archivo,e.formData.extension);case 1:return t=n.v,e.formData.fileName=t.fileName+".".concat(e.formData.extension),e.formData.session_id=e.currentSessionId,n.n=2,e.registrarDocumento(e.formData);case 2:return o=n.v,r=o[0],r.session_id=e.currentSessionId,n.n=3,e.registrarContenidoDocumento(r);case 3:e.modalSubirDocumentos=!1,e.$q.loading.hide(),e.$notify("Documento subido satisfactoriamente","success");case 4:return n.a(2)}},n)}))()},uploadFileS3:function(e,n){var t=this;return u()(s()().m(function o(){var r,i,a;return s()().w(function(o){while(1)switch(o.p=o.n){case 0:return o.p=0,o.n=1,fetch("https://n8n.sieweb.com.pe/webhook/upload-s3",{method:"POST",headers:{"Content-Type":e.type,"X-File-Extension":n},body:e});case 1:return r=o.v,o.n=2,r.json();case 2:return i=o.v,o.a(2,i);case 3:o.p=3,a=o.v,t.$notify(a.error?a.error.message:a.message,"warning");case 4:return o.a(2)}},o,null,[[0,3]])}))()},registrarDocumento:function(e){var n=this;return u()(s()().m(function t(){var o,r,i;return s()().w(function(t){while(1)switch(t.n){case 0:return o={query:"POST",nombre:e.name,tipo:e.tipo,url_s3:e.fileName,usucod:n.sie.usucod,categoria:e.categoria,session_id:Number(e.session_id)||null},t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/ia-documentos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});case 1:return r=t.v,t.n=2,r.json();case 2:return i=t.v,t.a(2,i)}},t)}))()},registrarContenidoDocumento:function(e){return u()(s()().m(function n(){var t;return s()().w(function(n){while(1)switch(n.n){case 0:return t={query:"POST",key:e.url_s3,id_documento:Number(e.id_documento),usucod:e.usucod,tipo:e.tipo,categoria:e.categoria,session_id:Number(e.session_id)||null},n.n=1,fetch("https://n8n.sieweb.com.pe/webhook/conversion-s3",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 1:return n.a(2)}},n)}))()},openModalExportarEnPlantilla:function(){this.modalExportarEnPlantilla=!0},getColegio:function(){var e=this;return u()(s()().m(function n(){var t,o;return s()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,n.n=1,e.$http.get("api/WhatsappController/getColegio",{params:{params:{fields:"*"}}});case 1:t=n.v,e.colegioData=t,n.n=3;break;case 2:n.p=2,o=n.v,e.$notify(o.error?o.error.message:o.message,"error");case 3:return n.a(2)}},n,null,[[0,2]])}))()},paFueSeleccionado:function(){var e,n,t,o=this;this.hasPA=!0;var r=this.optionsPA.find(function(e){return Number(e.session_id)===Number(o.formSession.pa_session_id)});if(r){this.selectedPA=r;var i=Number(r.manifest.data_unidades.total_unidades)||Number(null===(e=r.parametros)||void 0===e?void 0:e.numUnidades)||0;this.formSession.genUnidades=i,this.formSession.nivel=(null===(n=r.parametros)||void 0===n?void 0:n.nivel)||this.formSession.nivel,this.formSession.grado=(null===(t=r.parametros)||void 0===t?void 0:t.grado)||this.formSession.grado,this.buildUnidadesConfig(i,r)}},buildUnidadesConfig:function(e){var n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=null===t||void 0===t||null===(n=t.manifest)||void 0===n?void 0:n.data_unidades,r=Array.isArray(null===o||void 0===o?void 0:o.unidades)?o.unidades:[];this.PAData=r;for(var i=Number(null===o||void 0===o?void 0:o.total_unidades)||r.length||0,a=Number(e)>0?Number(e):i||4,s=function(e){if(!e)return null;var n=String(e).match(/(\d+)\s*sesiones/i);return n&&n[1]?Math.max(1,Number(n[1])||0):null},l=[],u=1;u<=a;u++){var c=r[u-1]||{},d=c.titulo&&String(c.titulo).trim()?c.titulo:"Unidad ".concat(u,": ").concat((null===t||void 0===t?void 0:t.name_chat)||""),m=s(c.cantidad),p=null!==m&&void 0!==m?m:4;l.push({enabled:!0,nombre:d,sesiones:p,tiempo:45})}this.formSession.unidadesConfig=l},toggleSelectAllGrupal:function(e){(this.formSession.unidadesConfig||[]).forEach(function(n){n.enabled=!!e})},unidadFueSeleccionado:function(){var e,n,t,o,r,i=this,a=this.optionsUnidad.find(function(e){return Number(e.session_id)===Number(i.formSession.unidad_session_id)});if(a){this.formSession.nivel=(null===(e=a.parametros)||void 0===e?void 0:e.nivel)||this.formSession.nivel,this.formSession.grado=(null===(n=a.parametros)||void 0===n?void 0:n.grado)||this.formSession.grado;var s=(null===a||void 0===a||null===(t=a.manifest)||void 0===t?void 0:t.data_sesiones)||(null===a||void 0===a||null===(o=a.manifest)||void 0===o?void 0:o.data_unidad)||(null===a||void 0===a?void 0:a.manifest)||{},l=Array.isArray(s.sesiones)?s.sesiones:Array.isArray(s.items)?s.items:Array.isArray(s.lista)?s.lista:[],u=Number(s.total_sesiones)||(Array.isArray(l)?l.length:0)||0,c=u||Number(null===(r=a.parametros)||void 0===r?void 0:r.sesiones)||4;this.formSession.genSesiones=c;var d=function(e){if(null==e)return null;if("number"===typeof e&&Number.isFinite(e))return Math.max(1,Math.floor(e));var n=String(e).trim(),t=n.match(/(\d{1,3})/);return t&&t[1]?Math.max(1,Number(t[1])):null},m=d(s.duracion_sesion)||d(s.duracion)||d(s.minutos)||45;this.buildSesionesConfig(c,a,m)}},buildSesionesConfig:function(e){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:45,o=[],r=1;r<=e;r++)o.push({enabled:!0,nombre:"Sesión ".concat(r," de ").concat(e),duracion:n.manifest.data_sesiones.minutos_por_sesion||t});this.formSession.sesionesConfig=o},toggleSelectAllSesiones:function(e){(this.formSession.sesionesConfig||[]).forEach(function(n){n.enabled=!!e})},promptSeleccionado:function(e){var n=this.dataPrompts.find(function(n){return n.ID_PROMPT===e});this.formSession.contexto=(null===n||void 0===n?void 0:n.CONTENT)||""},generarDocumentoInicial:function(){var e=this;return u()(s()().m(function n(){return s()().w(function(n){while(1)switch(n.n){case 0:if(e.currentTypeSession!==e.SESSION_PA){n.n=2;break}return n.n=1,e.generarPA();case 1:n.n=5;break;case 2:if(e.currentTypeSession!==e.SESSION_UNIDAD){n.n=4;break}return n.n=3,e.generarUnidad();case 3:n.n=5;break;case 4:if(e.currentTypeSession!==e.SESSION_CLASE){n.n=5;break}return n.n=5,e.generarClase();case 5:return n.a(2)}},n)}))()},saveContenidoGenerado:function(e){var n=this;return u()(s()().m(function t(){var o;return s()().w(function(t){while(1)switch(t.n){case 0:return o={contenidoGenerado:e,session_id:Number(n.getCurrentSession().session_id)},t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/save-documento-generado",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});case 1:return t.a(2)}},t)}))()},saveDocumentGenerado:function(e){var n=arguments,t=this;return u()(s()().m(function o(){var r,i;return s()().w(function(o){while(1)switch(o.n){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:"insert",i={type:r,content:e,session_id:Number(t.getCurrentSession().session_id)},o.n=1,fetch("https://n8n.sieweb.com.pe/webhook/new-chat-document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});case 1:return o.a(2)}},o)}))()},generarPA:function(){var e=this;return u()(s()().m(function n(){var t,o,r,i,a,l,u,c,d,m;return s()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,e.streamedText="",t="Genera una programación curricular anual con los parámetros indicados",o=e.getParamsSession(t),r="pa-nuevo-documento",n.n=1,e.streamApi(r,o);case 1:return i=n.v,a=e.getParamsSession(i),e.streamedText+="\n\n",l="pa-nuevo-documento-2",n.n=2,e.streamApi(l,a);case 2:return u=n.v,n.n=3,e.saveContenidoGenerado(u);case 3:return n.n=4,e.saveDocumentGenerado(u);case 4:return e.getCurrentSession().documentoGenerado=u,e.streamedText=u,c="El documento ha sido generado con éxito ✅. ¿Desea que modifique alguna sección del documento?",e.objMensaje.content=c,e.objMensaje.is_document=!1,n.n=5,e.addChatMessage({session_id:e.getCurrentSession().session_id,message:e.objMensaje});case 5:e.getCurrentSession().messages.push({type:"ai",content:c,is_document:!1}),e.hasEdits=!1,n.n=8;break;case 6:return n.p=6,m=n.v,d="Hubo un error al modificar el documento ❌. Inténtelo nuevamente.","abort"===m.message&&(d="La generación del documento fue detenida ⛔"),e.objMensaje.content=d,e.objMensaje.is_document=!1,n.n=7,e.addChatMessage({session_id:e.getCurrentSession().session_id,message:e.objMensaje});case 7:e.getCurrentSession().messages.push({type:"ai",content:d,is_document:!1});case 8:return n.a(2)}},n,null,[[0,6]])}))()},generarUnidad:function(){var e=this;return u()(s()().m(function n(){var t,o,r,i,a,l,u,c,d,m;return s()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,e.streamedText="",t="Genera una planificación de unidades de clase con los parámetros indicados",o=e.getParamsSession(t),r="unidad-nuevo-documento",n.n=1,e.streamApi(r,o);case 1:return i=n.v,a=e.getParamsSession(i),e.streamedText+="\n\n",l="unidad-nuevo-documento-2",n.n=2,e.streamApi(l,a);case 2:return u=n.v,n.n=3,e.saveContenidoGenerado(u);case 3:return n.n=4,e.saveDocumentGenerado(u);case 4:return e.getCurrentSession().documentoGenerado=u,e.streamedText=u,c="El documento ha sido generado con éxito ✅. ¿Desea que modifique alguna sección del documento?",e.objMensaje.content=c,e.objMensaje.is_document=!1,n.n=5,e.addChatMessage({session_id:e.getCurrentSession().session_id,message:e.objMensaje});case 5:e.getCurrentSession().messages.push({type:"ai",content:c,is_document:!1}),e.hasEdits=!1,n.n=8;break;case 6:return n.p=6,m=n.v,d="Hubo un error al modificar el documento ❌. Inténtelo nuevamente.","abort"===m.message&&(d="La generación del documento fue detenida ⛔"),e.objMensaje.content=d,e.objMensaje.is_document=!1,n.n=7,e.addChatMessage({session_id:e.getCurrentSession().session_id,message:e.objMensaje});case 7:e.getCurrentSession().messages.push({type:"ai",content:d,is_document:!1});case 8:return n.a(2)}},n,null,[[0,6]])}))()},generarClase:function(){var e=this;return u()(s()().m(function n(){var t,o,r,i,a,l,u;return s()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,e.streamedText="",t="Genera una sesión de clase con los parámetros indicados",o=e.getParamsSession(t),r="clase-nuevo-documento",n.n=1,e.streamApi(r,o);case 1:return i=n.v,n.n=2,e.saveContenidoGenerado(i);case 2:return n.n=3,e.saveDocumentGenerado(i);case 3:return e.getCurrentSession().documentoGenerado=i,a="El documento ha sido generado con éxito ✅. ¿Desea que modifique alguna sección del documento?",e.objMensaje.content=a,e.objMensaje.is_document=!1,n.n=4,e.addChatMessage({session_id:e.getCurrentSession().session_id,message:e.objMensaje});case 4:e.getCurrentSession().messages.push({type:"ai",content:a,is_document:!1}),e.hasEdits=!1,n.n=7;break;case 5:return n.p=5,u=n.v,l="Hubo un error al modificar el documento ❌. Inténtelo nuevamente.","abort"===u.message&&(l="La generación del documento fue detenida ⛔"),e.objMensaje.content=l,e.objMensaje.is_document=!1,n.n=6,e.addChatMessage({session_id:e.getCurrentSession().session_id,message:e.objMensaje});case 6:e.getCurrentSession().messages.push({type:"ai",content:l,is_document:!1});case 7:return n.a(2)}},n,null,[[0,5]])}))()},stopStreaming:function(){this.controller&&this.controller.abort()},streamApi:function(e,n){var t=this;return u()(s()().m(function o(){var r,i,a,l,u,c,d,m,p,f,v,h,g,b,S,k;return s()().w(function(o){while(1)switch(o.p=o.n){case 0:return n.cookie=t.sie.cookie,o.p=1,t.loaderAIShow=!0,t.controller=new AbortController,t.loadingDocument=!0,t.preloadingDocument=!0,r=JSON.stringify(n),i={"Content-Type":"application/json",token:t.sie.token,cookie:t.sie.cookie},o.n=2,fetch("https://n8n.sieweb.com.pe/webhook/".concat(e),{method:"POST",headers:i,body:r,signal:t.controller.signal});case 2:a=o.v,l=a.body.getReader(),u=new TextDecoder,c="";case 3:return o.n=4,l.read();case 4:if(d=o.v,m=d.done,p=d.value,!m){o.n=5;break}return o.a(3,6);case 5:c+=u.decode(p,{stream:!0}),f=c.split("\n"),c=f.pop(),v=dn()(f);try{for(v.s();!(h=v.n()).done;)if(g=h.value,g.trim())try{b=JSON.parse(g),"item"===b.type&&b.content&&(t.preloadingDocument=!1,t.streamedText+=b.content)}catch(e){console.error("Error parsing JSON:",e,g)}}catch(e){v.e(e)}finally{v.f()}o.n=3;break;case 6:if(c.trim())try{S=JSON.parse(c),"item"===S.type&&S.content&&(t.preloadingDocument=!1,t.streamedText+=S.content)}catch(e){console.error("Error parsing final JSON:",e,c)}return t.preloadingDocument=!1,t.loadingDocument=!1,o.a(2,t.streamedText);case 7:if(o.p=7,k=o.v,t.loadingDocument=!1,t.preloadingDocument=!1,"AbortError"!==k.name){o.n=8;break}throw new Error("abort");case 8:throw console.error("Error streaming data:",k),new Error(k.error?k.error.message:k.message);case 9:return o.p=9,t.loaderAIShow=!1,o.f(9);case 10:return o.a(2)}},o,null,[[1,7,9,10]])}))()},getChatDocument:function(e){var n=this;return u()(s()().m(function t(){var o,r,i,a,l,u,c,d;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,n.loadingDocument=!0,n.preloadingDocument=!0,r={session_id:Number(e),usucod:n.sie.usucod},t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/get-chat-document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 1:if(i=t.v,i.ok){t.n=3;break}return t.n=2,i.text().catch(function(){return""});case 2:throw a=t.v,new Error(a||"Error ".concat(i.status));case 3:return t.n=4,i.json();case 4:return l=t.v,u=null!==(o=null===l||void 0===l?void 0:l.document_content)&&void 0!==o?o:"",c=n.getCurrentSession(),c&&(c.documentoGenerado=u),n.streamedText=u||"",n.currentHtmlEditor=u||"",n.lastSavedHtml="",n.hasEdits=!1,t.a(2,u);case 5:return t.p=5,d=t.v,n.$notify(d.error?d.error.message:d.message,"warning"),t.a(2,"");case 6:return t.p=6,n.loadingDocument=!1,n.preloadingDocument=!1,t.f(6);case 7:return t.a(2)}},t,null,[[0,5,6,7]])}))()},onEditorAsk:function(e){var n=this;return u()(s()().m(function t(){var o,r,i,a,l,u,c,d,m,p,f;return s()().w(function(t){while(1)switch(t.n){case 0:if(o=e.pregunta,r=e.selection,i=e.selectedText,a=e.selectedHTML,n.$q.loading.show(),n.loaderAIShow=!0,l=n.getCurrentSession(),null!==l&&void 0!==l&&l.session_id&&o){t.n=1;break}return t.a(2);case 1:return u=150,c=(i||"").trim(),d=c?c.length>u?c.slice(0,u)+"…":c:"(sin selección)",m=d.replace(/\n/g,"\n> "),p="> ".concat(m,"\n\n").concat(o),f={type:"human",content:p,is_document:!1},l.messages.push(f),t.n=2,n.addChatMessage({session_id:l.session_id,message:JSON.stringify(f)});case 2:return t.n=3,n.streamEditorAsk({session_id:Number(l.session_id),usucod:n.sie.usucod,pregunta:o,selection:r,selectedText:i,selectedHTML:a});case 3:n.$q.loading.hide(),n.loaderAIShow=!1;case 4:return t.a(2)}},t)}))()},streamEditorAsk:function(e){var n=this;return u()(s()().m(function t(){var o,r,i,a,l,u,c,d,m,p,f,v,h,g,b,S,k,_,w,y,P,C;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:return o=n.getCurrentSession(),r={type:"ai",content:"Editando selección…",is_document:!1},o.messages.push(r),n.controller=new AbortController,n.loadingDocument=!0,n.preloadingDocument=!0,i=null,a=function(t){var o=t&&t.trim();if(o){var r;try{r=JSON.parse(o)}catch(e){return}if("item"===r.type){var a=r.content;if(a){var s;if("string"===typeof a)try{s=JSON.parse(a)}catch(e){return}else s=a;s&&"string"===typeof s.edited&&(i={edited:s.edited,range:s.range||e.selection},n.preloadingDocument=!1)}}}},t.p=1,t.n=2,fetch("https://n8n.sieweb.com.pe/webhook/editor-document",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/x-ndjson, application/json"},body:JSON.stringify(e)});case 2:if(l=t.v,l.ok){t.n=3;break}throw new Error("HTTP ".concat(l.status));case 3:if(!l.body||!l.body.getReader){t.n=8;break}u=l.body.getReader(),c=new TextDecoder,d="";case 4:return t.n=5,u.read();case 5:if(m=t.v,p=m.done,f=m.value,!p){t.n=6;break}return t.a(3,7);case 6:d+=c.decode(f,{stream:!0}),d=d.replace(/}\s*{/g,"}\n{"),v=d.split("\n"),d=v.pop(),h=dn()(v);try{for(h.s();!(g=h.n()).done;)b=g.value,a(b)}catch(e){h.e(e)}finally{h.f()}t.n=4;break;case 7:d.trim()&&a(d),t.n=10;break;case 8:return t.n=9,l.json().catch(function(){return{}});case 9:S=t.v,k=Array.isArray(S)?S:[S],_=dn()(k);try{for(_.s();!(w=_.n()).done;)y=w.value,P=JSON.stringify(y.type?y:{type:"item",content:JSON.stringify(y)}),a(P)}catch(e){_.e(e)}finally{_.f()}case 10:return i&&i.edited?(n.$refs.editor.applyAskResult(i),r.content="✅ Edición aplicada. Guarda para no perder los cambios."):r.content="⚠️No llegó contenido de edición",t.n=11,n.addChatMessage({session_id:o.session_id,message:r});case 11:t.n=13;break;case 12:t.p=12,C=t.v,r.content="AbortError"===C.name?"⛔ Edición cancelada":"❌ Error en edición",n.$notify(r.content,"warning");case 13:return t.p=13,n.controller=null,n.loadingDocument=!1,n.preloadingDocument=!1,n.$nextTick(n.scrollToBottom),t.f(13);case 14:return t.a(2)}},t,null,[[1,12,13,14]])}))()},createUnidadSession:function(e){var n=this;return u()(s()().m(function t(){var o,r,i,a,l,u,c,d,m,p,f,v;return s()().w(function(t){while(1)switch(t.n){case 0:return r=e.nombre,i=e.nivel,a=e.grado,l=e.pa_session_id,u=e.contexto,c=e.extraParams,d=void 0===c?{}:c,m=JSON.stringify(pn()({nombreSession:r,tema:"",nivel:i,grado:a,prompt:null,contexto:u||"",pa_session_id:l},d)),p={usucod:n.sie.usucod,name_chat:r||"Nueva Unidad",parametros:m,session_type:n.SESSION_UNIDAD},t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/new-chat-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});case 1:return f=t.v,t.n=2,f.json();case 2:return v=t.v,t.a(2,null===v||void 0===v||null===(o=v[0])||void 0===o?void 0:o.session_id)}},t)}))()},buildParamsUnidadFor:function(e,n,t){var o,r,i,a,s,l,u,c=this,d=t.numero_unidad,m=t.total_unidades,p=t.nombre_unidad,f=t.sesiones,v=this.optionsNivel.find(function(e){return e.value===c.formSession.nivel}),h=this.gradosTodos.find(function(e){return e.GRADOCOD===c.formSession.grado&&e.INSTRUCOD===c.formSession.nivel}),g=(null===(o=this.selectedPA)||void 0===o||null===(o=o.parametros)||void 0===o?void 0:o.area)||(null===(r=this.getCurrentSession())||void 0===r||null===(r=r.parametros)||void 0===r?void 0:r.area)||"";return{chatInput:n,session_id:e,id_session:e,usucod:this.sie.usucod,nivel:v?v.label:"",grado:h?h.GRADODES:"",area:g,docente:(null===(i=this.getCurrentSession())||void 0===i||null===(i=i.parametros)||void 0===i?void 0:i.docente)||"",anioActual:(new Date).getFullYear(),ugel:(null===(a=this.colegioData)||void 0===a?void 0:a.NOMUSE)||"",colegio:(null===(s=this.colegioData)||void 0===s?void 0:s.COLNOMMINEDU)||"",director:(null===(l=this.colegioData)||void 0===l?void 0:l.DIRECTOR)||"",contexto:(null===(u=this.getCurrentSession())||void 0===u||null===(u=u.parametros)||void 0===u?void 0:u.contexto)||"",tema:"",pa_session_id:this.formSession.pa_session_id,numero_unidad:d,total_unidades:m,nombre_unidad:p,sesiones:f,modo_generacion:"grupal"}},streamApiSilent:function(e,n){var t=this;return u()(s()().m(function o(){var r,i,a,l,u,c,d,m,p,f,v,h,g,b,S,k;return s()().w(function(o){while(1)switch(o.p=o.n){case 0:return n.cookie=t.sie.cookie,r=new AbortController,o.n=1,fetch("https://n8n.sieweb.com.pe/webhook/".concat(e),{method:"POST",headers:{"Content-Type":"application/json",token:t.sie.token,cookie:t.sie.cookie},body:JSON.stringify(n),signal:r.signal});case 1:i=o.v,a=i.body.getReader(),l=new TextDecoder,u="",c="";case 2:return o.n=3,a.read();case 3:if(d=o.v,m=d.done,p=d.value,!m){o.n=4;break}return o.a(3,13);case 4:u+=l.decode(p,{stream:!0}),f=u.split("\n"),u=f.pop(),v=dn()(f),o.p=5,v.s();case 6:if((h=v.n()).done){o.n=9;break}if(g=h.value,g.trim()){o.n=7;break}return o.a(3,8);case 7:try{b=JSON.parse(g),"item"===b.type&&b.content&&(c+=b.content)}catch(e){}case 8:o.n=6;break;case 9:o.n=11;break;case 10:o.p=10,k=o.v,v.e(k);case 11:return o.p=11,v.f(),o.f(11);case 12:o.n=2;break;case 13:if(u.trim())try{S=JSON.parse(u),"item"===S.type&&S.content&&(c+=S.content)}catch(e){}return o.a(2,c)}},o,null,[[5,10,11,12]])}))()},saveContenidoGeneradoFor:function(e,n){return u()(s()().m(function t(){var o;return s()().w(function(t){while(1)switch(t.n){case 0:return o={contenidoGenerado:n,session_id:Number(e)},t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/save-documento-generado",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});case 1:return t.a(2)}},t)}))()},saveDocumentGeneradoFor:function(e,n){var t=arguments,o=this;return u()(s()().m(function r(){var i,a,l,u;return s()().w(function(r){while(1)switch(r.p=r.n){case 0:return i=t.length>2&&void 0!==t[2]?t[2]:"insert",r.p=1,a={type:i,content:n,session_id:Number(e)},r.n=2,fetch("https://n8n.sieweb.com.pe/webhook/new-chat-document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 2:return l="El documento ha sido generado con éxito ✅. ¿Desea que modifique alguna sección del documento?",o.objMensaje.content=l,r.n=3,o.addChatMessage({session_id:e,message:o.objMensaje});case 3:r.n=5;break;case 4:return r.p=4,r.v,u="Hubo un error al generar el documento ❌. Inténtelo nuevamente.","abort"===error.message&&(u="La generación del documento fue detenida ⛔"),o.objMensaje.content=u,r.n=5,o.addChatMessage({session_id:e,message:o.objMensaje});case 5:return r.a(2)}},r,null,[[1,4]])}))()},generarUnidadesGrupal:function(){var e=this;return u()(s()().m(function n(){var t,o,r,i,a,l,u,c,d,m,p,f,v,h,g,b;return s()().w(function(n){while(1)switch(n.p=n.n){case 0:if(n.p=0,t=(e.formSession.unidadesConfig||[]).map(function(e,n){return pn()(pn()({},e),{},{index:n})}).filter(function(e){return e.enabled}),t.length){n.n=1;break}return e.$notify("Seleccione al menos una unidad.","warning"),n.a(2);case 1:o=t.length,e.$q.loading.show({message:"Generando unidades 0/".concat(o,"…")}),e.loaderAIShow=!0,r=0,i=dn()(t),n.p=2,i.s();case 3:if((a=i.n()).done){n.n=11;break}return u=a.value,c=u.nombre,n.n=4,e.createUnidadSession({nombre:c,nivel:e.formSession.nivel,grado:e.formSession.grado,pa_session_id:e.formSession.pa_session_id,contexto:(null===(l=e.getCurrentSession())||void 0===l||null===(l=l.parametros)||void 0===l?void 0:l.contexto)||"",extraParams:{numero_unidad:u.index+1,total_unidades:e.formSession.genUnidades,sesiones:u.sesiones,nombre_unidad:c}});case 4:return d=n.v,n.n=5,e.addChatMessage({session_id:d,message:JSON.stringify(e.mensajeInicio)});case 5:return m=e.buildParamsUnidadFor(d,"Genera una planificación de unidades de clase con los parámetros indicados",{numero_unidad:u.index+1,total_unidades:e.formSession.genUnidades,nombre_unidad:c,sesiones:u.sesiones}),n.n=6,e.streamApiSilent("unidad-nuevo-documento",m);case 6:return p=n.v,f=e.buildParamsUnidadFor(d,p,{numero_unidad:u.index+1,total_unidades:e.formSession.genUnidades,nombre_unidad:c,sesiones:u.sesiones}),n.n=7,e.streamApiSilent("unidad-nuevo-documento-2",f);case 7:return v=n.v,h=e.mergeHtmlParts(p,v),n.n=8,e.saveContenidoGeneradoFor(d,h);case 8:return n.n=9,e.saveDocumentGeneradoFor(d,h,"insert");case 9:r++,e.$q.loading.show({message:"Generando unidades ".concat(r,"/").concat(o,"…")});case 10:n.n=3;break;case 11:n.n=13;break;case 12:n.p=12,g=n.v,i.e(g);case 13:return n.p=13,i.f(),n.f(13);case 14:return n.n=15,e.getChatSessions(e.SESSION_UNIDAD);case 15:e.$notify("Unidades generadas correctamente.","positive"),n.n=17;break;case 16:n.p=16,b=n.v,e.$notify(b.message||"Error al generar unidades.","warning");case 17:return n.p=17,e.$q.loading.hide(),e.loaderAIShow=!1,n.f(17);case 18:return n.a(2)}},n,null,[[2,12,13,14],[0,16,17,18]])}))()},createClaseSession:function(e){var n=this;return u()(s()().m(function t(){var o,r,i,a,l,u,c,d,m,p,f,v;return s()().w(function(t){while(1)switch(t.n){case 0:return r=e.nombre,i=e.nivel,a=e.grado,l=e.unidad_session_id,u=e.contexto,c=e.extraParams,d=void 0===c?{}:c,m=JSON.stringify(pn()({nombreSession:r,nivel:i,grado:a,prompt:null,contexto:u||"",unidad_session_id:l},d)),p={usucod:n.sie.usucod,name_chat:r||"Nueva Clase",parametros:m,session_type:n.SESSION_CLASE},t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/new-chat-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});case 1:return f=t.v,t.n=2,f.json();case 2:return v=t.v,t.a(2,null===v||void 0===v||null===(o=v[0])||void 0===o?void 0:o.session_id)}},t)}))()},buildParamsClaseFor:function(e,n,t){var o,r,i,a,s,l,u,c=this,d=t.numero_sesion,m=t.total_sesiones,p=t.nombre_sesion,f=t.duracion,v=this.optionsNivel.find(function(e){return e.value===c.formSession.nivel}),h=this.gradosTodos.find(function(e){return e.GRADOCOD===c.formSession.grado&&e.INSTRUCOD===c.formSession.nivel}),g=null===(o=this.optionsUnidad.find(function(e){return Number(e.session_id)===Number(c.formSession.unidad_session_id)}))||void 0===o||null===(o=o.parametros)||void 0===o?void 0:o.area,b=(null===(r=this.getCurrentSession())||void 0===r||null===(r=r.parametros)||void 0===r?void 0:r.area)||"",S=g||b;return{chatInput:n,session_id:e,id_session:e,usucod:this.sie.usucod,nivel:v?v.label:"",grado:h?h.GRADODES:"",area:S,docente:(null===(i=this.getCurrentSession())||void 0===i||null===(i=i.parametros)||void 0===i?void 0:i.docente)||"",anioActual:(new Date).getFullYear(),ugel:(null===(a=this.colegioData)||void 0===a?void 0:a.NOMUSE)||"",colegio:(null===(s=this.colegioData)||void 0===s?void 0:s.COLNOMMINEDU)||"",director:(null===(l=this.colegioData)||void 0===l?void 0:l.DIRECTOR)||"",contexto:(null===(u=this.getCurrentSession())||void 0===u||null===(u=u.parametros)||void 0===u?void 0:u.contexto)||"",unidad_session_id:this.formSession.unidad_session_id,numero_sesion:d,total_sesiones:m,nombre_sesion:p,duracion:Number(f)||60,modo_generacion:"grupal"}},generarClasesGrupal:function(){var e=this;return u()(s()().m(function n(){var t,o,r,i,a,l,u,c,d,m,p,f,v,h;return s()().w(function(n){while(1)switch(n.p=n.n){case 0:if(n.p=0,t=(e.formSession.sesionesConfig||[]).map(function(e,n){return pn()(pn()({},e),{},{index:n})}).filter(function(e){return e.enabled}),t.length){n.n=1;break}return n.a(2,e.$notify("Seleccione al menos una sesión.","warning"));case 1:if(e.formSession.unidad_session_id){n.n=2;break}return n.a(2,e.$notify("Seleccione una Unidad primero.","warning"));case 2:o=t.length,e.$q.loading.show({message:"Generando sesiones 0/".concat(o,"…")}),e.loaderAIShow=!0,r=0,i=dn()(t),n.p=3,i.s();case 4:if((a=i.n()).done){n.n=11;break}return u=a.value,c=u.index+1,d=u.nombre||"Sesión ".concat(c),n.n=5,e.createClaseSession({nombre:d,nivel:e.formSession.nivel,grado:e.formSession.grado,unidad_session_id:e.formSession.unidad_session_id,contexto:(null===(l=e.getCurrentSession())||void 0===l||null===(l=l.parametros)||void 0===l?void 0:l.contexto)||"",extraParams:{numero_sesion:c,total_sesiones:e.formSession.genSesiones,nombre_sesion:d,duracion:u.duracion}});case 5:return m=n.v,n.n=6,e.addChatMessage({session_id:m,message:JSON.stringify(e.mensajeInicio)});case 6:return p=e.buildParamsClaseFor(m,"Genera una sesión de clase lista para usar con los parámetros indicados (estructura con Inicio, Desarrollo, Cierre; evaluación; recursos; y tarea).",{numero_sesion:c,total_sesiones:e.formSession.genSesiones,nombre_sesion:d,duracion:u.duracion}),n.n=7,e.streamApiSilent("clase-nuevo-documento",p);case 7:return f=n.v,n.n=8,e.saveContenidoGeneradoFor(m,f);case 8:return n.n=9,e.saveDocumentGeneradoFor(m,f,"insert");case 9:r++,e.$q.loading.show({message:"Generando sesiones ".concat(r,"/").concat(o,"…")});case 10:n.n=4;break;case 11:n.n=13;break;case 12:n.p=12,v=n.v,i.e(v);case 13:return n.p=13,i.f(),n.f(13);case 14:return n.n=15,e.getChatSessions(e.SESSION_CLASE);case 15:e.$notify("Sesiones generadas correctamente.","positive"),n.n=17;break;case 16:n.p=16,h=n.v,e.$notify((null===h||void 0===h?void 0:h.message)||"Error al generar sesiones.","warning");case 17:return n.p=17,e.$q.loading.hide(),e.loaderAIShow=!1,n.f(17);case 18:return n.a(2)}},n,null,[[3,12,13,14],[0,16,17,18]])}))()},exportToWord:function(e,n){return u()(s()().m(function t(){var o,r,i,a,l;return s()().w(function(t){while(1)switch(t.n){case 0:o='\n        <style>\n          @page { size: A4; margin: 2cm; }         /* márgenes de impresión */\n          .page-break { page-break-before: always; }/* <div class="page-break"></div> */\n          table { width:100%; border-collapse:collapse; margin:8px 0; }\n          th, td { border:1px solid #000; padding:8px; text-align:left; }\n          th { background:#f2f2f2; }\n        </style>',r='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40"><head><meta charset="utf-8"><title>Documento</title>'+o+"</head><body>",i=new Blob(["\ufeff",r+e+"</body></html>"],{type:"application/msword"}),a=URL.createObjectURL(i),l=document.createElement("a"),l.href=a,l.download="".concat(n||"Plan de clase",".doc"),document.body.appendChild(l),l.click(),document.body.removeChild(l),setTimeout(function(){return URL.revokeObjectURL(a)},0);case 1:return t.a(2)}},t)}))()},saveCurrentHtml:function(){var e=this;return u()(s()().m(function n(){var t;return s()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,e.$q.loading.show({message:"Guardando contenido..."}),n.n=1,e.saveContenidoGenerado(e.currentHtmlEditor);case 1:return n.n=2,e.saveDocumentGenerado(e.currentHtmlEditor,"update");case 2:e.getCurrentSession().documentoGenerado=e.currentHtmlEditor,e.lastSavedHtml=e.currentHtmlEditor,e.hasEdits=!1,n.n=4;break;case 3:n.p=3,t=n.v,e.$notify(t.error?t.error.message:t.message,"warning");case 4:return n.p=4,e.$q.loading.hide(),n.f(4);case 5:return n.a(2)}},n,null,[[0,3,4,5]])}))()},mergeHtmlParts:function(e,n){if(!e)return n||"";if(!n)return e||"";var t=function(e){return e.replace(/<\/body>\s*<\/html>\s*$/i,"")},o=t(e);return"".concat(o,"\n").concat(n,"\n</body>\n</html>")},onChangePromptsMultiple:function(e){this.rebuildContextFromSelected(e)},rebuildContextFromSelected:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.formSession.promptsSelected,t=this.concatOptions.separator||"\n\n",o=[];n.forEach(function(n){var t=e.optionsPrompts.find(function(e){return e.value===n});t&&o.push("".concat(t.content||"").trim())}),this.formSession.contexto=o.filter(Boolean).join(t)},clearSelectedPrompts:function(){this.formSession.promptsSelected=[],this.formSession.contexto=""},openContextEditor:function(){this.modalContextEditor=!this.modalContextEditor}},beforeMount:function(){var e=this;return u()(s()().m(function n(){return s()().w(function(n){while(1)switch(n.n){case 0:return e.$q.loading.show(),e.esAdmin=e.sie.ruta.nivel>=3,e.obtenerNiveles(),e.obtenerGradosTodos(),n.n=1,e.getColegio();case 1:return n.n=2,e.getChatSessions(e.currentTypeSession);case 2:e.getUserPrompts(),e.$q.loading.hide();case 3:return n.a(2)}},n)}))()}};const Ft=(0,Xn.A)(xt,[["render",un]]);var Nt=Ft,Mt={class:"flex"},qt={class:"q-pa-xs",style:{width:"50%"}},Rt={key:0,class:"q-pa-xs",style:{width:"50%"}},Lt={key:1,class:"center",style:{width:"50%"}},Vt={key:0,class:"default-container center"},Ut={class:"row q-ma-xs q-col-gutter-sm"},Gt={class:"col-xs-12 q-pb-sm"},Qt={class:"col-xs-12"},$t={class:"col-xs-12"},jt={class:"row q-ma-xs q-col-gutter-sm q-pb-sm"},Xt={class:"col-xs-12 col-sm-2 center"},Wt={class:"row q-ma-xs q-col-gutter-sm"},Ht={key:0,class:"col-xs-12"};function zt(e,n){var t=this,r=(0,o.g2)("q-tab"),i=(0,o.g2)("q-tabs"),a=(0,o.g2)("sie-table"),s=(0,o.g2)("QIframe"),l=(0,o.g2)("q-icon"),u=(0,o.g2)("q-card"),c=(0,o.g2)("q-select"),d=(0,o.g2)("q-card-section"),m=(0,o.g2)("sie-modal"),p=(0,o.g2)("dynamic-form");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.bF)(u,{class:"layout-v1 my-card",flat:"",bordered:""},{default:(0,o.k6)(function(){return[(0,o.Lk)("input",{ref:"docInput",type:"file",accept:".docx,.pdf",style:{display:"none"},onChange:n[0]||(n[0]=function(){return e.setArchivo&&e.setArchivo.apply(e,arguments)})},null,544),(0,o.Lk)("div",Mt,[(0,o.Lk)("div",qt,[e.esAdmin?((0,o.uX)(),(0,o.Wv)(i,{key:0,modelValue:e.tab,"onUpdate:modelValue":n[1]||(n[1]=function(n){return e.tab=n}),align:"left",dense:"",style:{"font-weight":"semi-bold"},onInput:e.cambiarTab},{default:(0,o.k6)(function(){return[(0,o.bF)(r,{name:"contextual",label:"Contextuales"}),(0,o.bF)(r,{name:"plantilla",label:"Plantillas"})]}),_:1},8,["modelValue","onInput"])):(0,o.Q3)("v-if",!0),(0,o.bF)(a,{ref:"tablaDocumentos",dense:"",flat:"",bordered:"","wrap-cells":"",css:"height: calc(100vh - ".concat(e.esAdmin?160:125,"px); width: 100%; min-width: 300px;"),context:t,columns:e.columnsDocumentos,config:e.configDocumentos,"show-index":!0,data:e.dataDocumentos,"show-refresh":!0,selection:"single",onRowSelected:e.onRowSelected,onRefresh:n[2]||(n[2]=function(n){return e.getDocumentos(e.tab)})},null,8,["css","columns","config","data","onRowSelected"]),"plantilla"===e.tab?((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[],64)):(0,o.Q3)("v-if",!0)]),e.previewDocumentoURL?((0,o.uX)(),(0,o.CE)("div",Rt,[(0,o.bF)(s,{src:e.linkView(e.previewDocumentoURL),style:{height:"calc(100vh - 130px)"}},null,8,["src"])])):((0,o.uX)(),(0,o.CE)("div",Lt,[e.currentChat?(0,o.Q3)("v-if",!0):((0,o.uX)(),(0,o.CE)("div",Vt,[(0,o.bF)(l,{class:"q-pa-sm",name:"asistencia",size:"4rem",color:"grey"}),n[8]||(n[8]=(0,o.Lk)("span",{style:{color:"grey"}},"Seleccione un documento para mostrar la previsualización",-1))]))]))])]}),_:1}),(0,o.bF)(m,{modelValue:e.modalSubirDocumentos,"onUpdate:modelValue":n[5]||(n[5]=function(n){return e.modalSubirDocumentos=n}),title:"Subir Documento",width:"600px",ok:"Subir",onSubmit:e.submitDocumento},{default:(0,o.k6)(function(){return[(0,o.bF)(d,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",Ut,[(0,o.Lk)("div",Gt,[n[9]||(n[9]=(0,o.Lk)("b",null,"Documento:",-1)),(0,o.Lk)("span",null,(0,b.v_)(e.formData.name),1)]),(0,o.Lk)("div",Qt,[(0,o.bF)(c,{modelValue:e.formData.categoria,"onUpdate:modelValue":n[3]||(n[3]=function(n){return e.formData.categoria=n}),options:e.categoriaDocumentos,label:"Categoría de Documento",disable:!e.esAdmin},null,8,["modelValue","options","disable"])]),(0,o.Lk)("div",$t,[(0,o.bF)(c,{modelValue:e.formData.tipo,"onUpdate:modelValue":n[4]||(n[4]=function(n){return e.formData.tipo=n}),options:e.tipoDocumentos,label:"Tipo de Documento",disable:!e.esAdmin},null,8,["modelValue","options","disable"])])])]}),_:1})]}),_:1},8,["modelValue","onSubmit"]),(0,o.bF)(m,{modelValue:e.modalEditarEtiquetas,"onUpdate:modelValue":n[7]||(n[7]=function(n){return e.modalEditarEtiquetas=n}),title:"Etiquetas Identificadas",width:"600px",ok:"Guardar",onSubmit:e.actualizarEtiquetas},{default:(0,o.k6)(function(){return[(0,o.bF)(d,{style:{width:"700px"}},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",jt,[(0,o.Lk)("div",Xt,[(0,o.bF)(l,{name:"table_edit",size:"xl"})]),n[10]||(n[10]=(0,o.Lk)("div",{class:"col-xs-12 col-sm-10"},[(0,o.Lk)("b",null,"Descripción de Etiquetas"),(0,o.Lk)("div",null,"Agrega una descripción a las etiquetas correspondientes para que la IA sepa qué tipo de información colocar en dicha etiqueta.")],-1))]),(0,o.Lk)("div",Wt,[e.currentRowEtiquetas?((0,o.uX)(),(0,o.CE)("div",Ht,[(0,o.bF)(p,{value:e.currentRowEtiquetas.tags,"onUpdate:value":n[6]||(n[6]=function(n){return e.currentRowEtiquetas.tags=n})},null,8,["value"])])):(0,o.Q3)("v-if",!0)])]}),_:1})]}),_:1},8,["modelValue","onSubmit"])])}var Bt=t(20456),Jt=t(59089),Kt=t(33777),Yt={data:function(){return{columnsDocumentos:[],dataDocumentos:[],configDocumentos:{}}},methods:{setColumnsDocumentos:function(e){this.columnsDocumentos=[{name:"id_documento",label:"ID Documento",align:"center",field:"id_documento"},{name:"nombre",label:"Nombre",align:"left",field:"nombre"},{name:"tipo",label:"Tipo",align:"center",field:"tipo"},{name:"usucod",label:"Usuario",align:"center",field:"usucod"},{name:"fecha_subida",label:"Fecha Subida",align:"center",field:"fecha_subida"},{name:"edit",label:"",align:"left"}],"contextual"===e?this.setConfigDocumentosContextuales():"plantilla"===e&&this.setConfigDocumentosPlantillas()},setConfigDocumentosContextuales:function(){this.configDocumentos={flat:!0,round:!0,color:"primary",fecha_subida:{component:"date",edit:!1},tipo:{renderHtml:function(e){var n={1:"Por Usuario",2:"General"};return"<span>".concat(n[e.tipo],"</span>")}},edit:{flat:!0,component:"button",icon:["delete"],tooltip:{delete:"Eliminar"},delete:function(e){var n=this;return u()(s()().m(function t(){return s()().w(function(t){while(1)switch(t.n){case 0:n.$confirm("¿Está seguro que desea eliminar el documento?").onOk(function(){n.eliminarDocumento(e)});case 1:return t.a(2)}},t)}))()}}}},setConfigDocumentosPlantillas:function(){this.configDocumentos={flat:!0,round:!0,color:"primary",fecha_subida:{component:"date",edit:!1},tipo:{renderHtml:function(e){var n={1:"Por Usuario",2:"General"};return"<span>".concat(n[e.tipo],"</span>")}},edit:{flat:!0,component:"button",icon:["table_edit as etiquetas","delete"],tooltip:{etiquetas:"Etiquetas",delete:"Eliminar"},delete:function(e){var n=this;return u()(s()().m(function t(){return s()().w(function(t){while(1)switch(t.n){case 0:n.$confirm("¿Está seguro que desea eliminar el documento?").onOk(function(){n.eliminarDocumento(e)});case 1:return t.a(2)}},t)}))()},etiquetas:function(e){var n=this;return u()(s()().m(function t(){return s()().w(function(t){while(1)switch(t.n){case 0:n.openEditarEtiquetas(e);case 1:return t.a(2)}},t)}))()}}}}}},Zt={key:1,class:"bordered-section"},eo={class:"section-title"},no={key:2,class:"bordered-section"},to={class:"section-title q-pb-xs"},oo={key:0},ro={key:1};function io(e,n){var t=(0,o.g2)("q-input"),r=(0,o.g2)("dynamic-form");return(0,o.uX)(),(0,o.CE)("div",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.valueObj,function(n,i){return(0,o.uX)(),(0,o.CE)("div",{key:i,class:"q-pa-xs"},[e.isPrimitive(n)?((0,o.uX)(),(0,o.Wv)(t,{key:0,class:"q-mb-sm",dense:"",outlined:"",label:i,modelValue:e.valueObj[i],"onUpdate:modelValue":function(n){return e.valueObj[i]=n},id:i,autogrow:""},null,8,["label","modelValue","onUpdate:modelValue","id"])):e.isObject(n)?((0,o.uX)(),(0,o.CE)("div",Zt,[(0,o.Lk)("div",eo,(0,b.v_)(i),1),(0,o.bF)(r,{value:e.valueObj[i],"onUpdate:value":function(n){return e.valueObj[i]=n}},null,8,["value","onUpdate:value"])])):Array.isArray(n)?((0,o.uX)(),(0,o.CE)("div",no,[(0,o.Lk)("div",to,(0,b.v_)(i)+" (lista)",1),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n,function(a,s){return(0,o.uX)(),(0,o.CE)("div",{key:s,class:"q-gutter-sm"},[e.isPrimitive(a)?((0,o.uX)(),(0,o.CE)("div",oo,[(0,o.bF)(t,{dense:"",outlined:"",modelValue:n[s],"onUpdate:modelValue":function(e){return n[s]=e},label:i+" ["+s+"]",autogrow:""},null,8,["modelValue","onUpdate:modelValue","label"])])):e.isObject(a)?((0,o.uX)(),(0,o.CE)("div",ro,[(0,o.bF)(r,{value:n[s],"onUpdate:value":function(e){return n[s]=e}},null,8,["value","onUpdate:value"])])):(0,o.Q3)("v-if",!0)])}),128))])):(0,o.Q3)("v-if",!0)])}),128))])}var ao=t(63053),so=t.n(ao),lo={emits:["update:value"],name:"DynamicForm",props:{modelValue:{type:Object,required:!0}},components:{QInput:xn.A,QExpansionItem:Tt.A},computed:{valueObj:{get:function(){return this.modelValue},set:function(e){this.$emit("update:value",e)}}},methods:{isPrimitive:function(e){return"string"===typeof e||"number"===typeof e||"boolean"===typeof e||null===e},isObject:function(e){return"object"===so()(e)&&null!==e&&!Array.isArray(e)}}};const uo=(0,Xn.A)(lo,[["render",io]]);var co=uo,mo={components:{QSelect:In.A,QToggle:fn.c5,QCheckbox:fn.vZ,sieSelect:hn.A,QTable:bn.A,QTd:fn.Ef,QTr:fn.qh,QPopupEdit:fn.GT,sieModal:gn.A,QList:Sn.A,QItem:m.A,QItemSection:p.A,QItemLabel:v.A,QDownloadFile:wn.A,QChip:yn.A,QChatMessage:Pn.A,QSeparator:Cn.A,QSpinnerDots:fn.FS,QIframe:Tn.A,QIcon:kn.A,QAvatar:f.A,QBtn:_n.A,MarkdownViewer:An.A,QInfiniteScroll:En.A,Skeleton:On.A,QInputV1:xn.A,QForm:Mn.A,QMenu:qn.A,QTab:_t.A,QTabs:wt.A,QTabPanel:yt.A,QCardActions:Bt.A,sieUpload:Jt.A,QTabPanels:Pt.A,SieTable:Kt.A,QUploader:fn.Iu,dynamicForm:co,QCard:fn.C$},mixins:[Yt],data:function(){return{sie:(0,c["default"])(),urlToSave:"",previewDocumentoURL:"",tab:"contextual",modalSubirDocumentos:!1,formData:{name:"",tipo:1,fileName:"",archivo:null,extension:"",categoria:"contextual"},tipoDocumentos:[{label:"Por Usuario",value:1},{label:"General",value:2}],categoriaDocumentos:[{label:"Contextual",value:"contextual"},{label:"Plantilla",value:"plantilla"}],esAdmin:!1,modalEditarEtiquetas:!1,currentRowEtiquetas:null}},watch:{},methods:{required:Nn.required,linkView:function(e){return this.sie.token=this.sie.tokenViewer,(0,$n.linkPreview)(e,this.sie)},uploadFileS3:function(e,n){var t=this;return u()(s()().m(function o(){var r,i,a;return s()().w(function(o){while(1)switch(o.p=o.n){case 0:return o.p=0,o.n=1,fetch("https://n8n.sieweb.com.pe/webhook/upload-s3",{method:"POST",headers:{"Content-Type":e.type,"X-File-Extension":n},body:e});case 1:return r=o.v,o.n=2,r.json();case 2:return i=o.v,o.a(2,i);case 3:o.p=3,a=o.v,t.$notify(a.error?a.error.message:a.message,"warning");case 4:return o.a(2)}},o,null,[[0,3]])}))()},registrarDocumento:function(e){var n=this;return u()(s()().m(function t(){var o,r,i;return s()().w(function(t){while(1)switch(t.n){case 0:return o={query:"POST",nombre:e.name,tipo:e.tipo,url_s3:e.fileName,usucod:n.sie.usucod,categoria:e.categoria,tags:e.tags||null},t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/ia-documentos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});case 1:return r=t.v,t.n=2,r.json();case 2:return i=t.v,t.a(2,i)}},t)}))()},registrarContenidoDocumento:function(e){return u()(s()().m(function n(){var t;return s()().w(function(n){while(1)switch(n.n){case 0:return t={query:"POST",key:e.url_s3,id_documento:Number(e.id_documento),usucod:e.usucod,tipo:e.tipo,categoria:e.categoria},n.n=1,fetch("https://n8n.sieweb.com.pe/webhook/conversion-s3",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 1:return n.a(2)}},n)}))()},getDocumentos:function(e){var n=this;return u()(s()().m(function t(){var o,r,i;return s()().w(function(t){while(1)switch(t.n){case 0:return o={query:"GET",categoria:e},t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/ia-documentos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});case 1:return r=t.v,t.n=2,r.json();case 2:i=t.v,i.length&&!i[0].id_documento&&(i=[]),n.dataDocumentos=i;case 3:return t.a(2)}},t)}))()},eliminarRegistroDocumento:function(e){return u()(s()().m(function n(){var t;return s()().w(function(n){while(1)switch(n.n){case 0:return t={query:"DELETE",id_documento:e.id_documento},n.n=1,fetch("https://n8n.sieweb.com.pe/webhook/ia-documentos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 1:return n.a(2)}},n)}))()},eliminarDocumentoS3:function(e){var n=this;return u()(s()().m(function t(){var o,r,i;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/delete-s3?url_s3=".concat(e),{method:"DELETE"});case 1:return o=t.v,t.n=2,o.json();case 2:return r=t.v,t.a(2,r);case 3:t.p=3,i=t.v,n.$notify(i.error?i.error.message:i.message,"warning");case 4:return t.a(2)}},t,null,[[0,3]])}))()},eliminarContenidoDocumento:function(e){var n=this;return u()(s()().m(function t(){var o;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,t.n=1,fetch("https://n8n.sieweb.com.pe/webhook/delete-contenido?id_documento=".concat(e.id_documento),{method:"DELETE",headers:{"Content-Type":"application/json"}});case 1:t.n=3;break;case 2:t.p=2,o=t.v,n.$notify(o.error?o.error.message:o.message,"warning");case 3:return t.a(2)}},t,null,[[0,2]])}))()},eliminarDocumento:function(e){var n=this;return u()(s()().m(function t(){return s()().w(function(t){while(1)switch(t.n){case 0:return n.$q.loading.show({message:"Eliminando documento..."}),t.n=1,n.eliminarDocumentoS3(e.url_s3);case 1:return t.n=2,n.eliminarRegistroDocumento(e);case 2:if("contextual"!==e.categoria){t.n=3;break}return t.n=3,n.eliminarContenidoDocumento(e);case 3:n.getDocumentos(n.tab),n.previewDocumentoURL="",n.$q.loading.hide(),n.$notify("Documento eliminado satisfactoriamente","success");case 4:return t.a(2)}},t)}))()},clickSubirDocumento:function(){this.$refs.docInput.click()},extraerEtiquetas:function(e){return u()(s()().m(function n(){var t,o,r;return s()().w(function(n){while(1)switch(n.n){case 0:return t="http://ies_bpastor.proyectpg.hyo/ies/api/PersonaController/extraerEtiquetas",n.n=1,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url_s3:e})});case 1:return o=n.v,n.n=2,o.json();case 2:return r=n.v,n.a(2,r)}},n)}))()},submitDocumento:function(){var e=this;return u()(s()().m(function n(){var t,o,r,i;return s()().w(function(n){while(1)switch(n.n){case 0:return e.$q.loading.show({message:"Subiendo documento..."}),n.n=1,e.uploadFileS3(e.formData.archivo,e.formData.extension);case 1:if(t=n.v,e.formData.fileName=t.fileName+".".concat(e.formData.extension),"plantilla"!==e.formData.categoria){n.n=3;break}return n.n=2,e.extraerEtiquetas(e.formData.fileName);case 2:o=n.v,e.formData.tags=o;case 3:return n.n=4,e.registrarDocumento(e.formData);case 4:if(r=n.v,i=r[0],"contextual"!==i.categoria){n.n=5;break}return n.n=5,e.registrarContenidoDocumento(i);case 5:e.tab=e.formData.categoria,e.getDocumentos(e.formData.categoria),e.onRowSelected(i),e.modalSubirDocumentos=!1,e.$q.loading.hide(),e.$notify("Documento subido satisfactoriamente","success");case 6:return n.a(2)}},n)}))()},setArchivo:function(e){var n=this;return u()(s()().m(function t(){var o,r,i;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:if(t.p=0,o=e.target.files[0],o){t.n=1;break}return t.a(2);case 1:r=new FileReader,r.onload=u()(s()().m(function e(){var t,r;return s()().w(function(e){while(1)switch(e.n){case 0:t=o.name.split("."),r=t.pop().toLowerCase(),n.$q.loading.show(),n.formData.name=o.name,n.formData.archivo=o,n.formData.extension=r,n.formData.categoria=n.tab,n.$q.loading.hide();case 1:return e.a(2)}},e)})),n.modalSubirDocumentos=!0,r.readAsDataURL(o),t.n=3;break;case 2:t.p=2,i=t.v,n.$notify(i.error?i.error.message:i.message,"warning");case 3:return t.p=3,n.$q.loading.hide(),t.f(3);case 4:return t.a(2)}},t,null,[[0,2,3,4]])}))()},openEditarEtiquetas:function(e){if(!e.tags)return this.$notify("No se identificaron etiquetas para esta plantilla","warning");this.currentRowEtiquetas=e,this.modalEditarEtiquetas=!0},actualizarEtiquetas:function(){var e=this;return u()(s()().m(function n(){var t;return s()().w(function(n){while(1)switch(n.n){case 0:return e.$q.loading.show({message:"Actualizando..."}),t={query:"PUT",id_documento:e.currentRowEtiquetas.id_documento,tags:e.currentRowEtiquetas.tags},n.n=1,fetch("https://n8n.sieweb.com.pe/webhook/ia-documentos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 1:return n.n=2,e.getDocumentos(e.tab);case 2:e.modalEditarEtiquetas=!1,e.$q.loading.hide();case 3:return n.a(2)}},n)}))()},onRowSelected:function(e){this.previewDocumentoURL="https://n8n.sieweb.com.pe/webhook/documentosS3?key=".concat(e.url_s3,"&t=").concat(+(new Date).getTime())},cambiarTab:function(){var e=this;return u()(s()().m(function n(){return s()().w(function(n){while(1)switch(n.n){case 0:return e.$q.loading.show(),e.previewDocumentoURL="",e.setColumnsDocumentos(e.tab),n.n=1,e.getDocumentos(e.tab);case 1:e.$q.loading.hide();case 2:return n.a(2)}},n)}))()}},beforeMount:function(){var e=this;return u()(s()().m(function n(){return s()().w(function(n){while(1)switch(n.n){case 0:e.esAdmin=e.sie.ruta.nivel>=3,e.getDocumentos(e.tab),e.setColumnsDocumentos(e.tab);case 1:return n.a(2)}},n)}))()}};const po=(0,Xn.A)(mo,[["render",zt]]);var fo=po,vo={class:"q-ma-md u-prompt"},ho={class:"row no-gutters q-mb-md u-main"},go={class:"u-searchbar"},bo={key:1},So={class:"row items-center no-wrap"},ko={key:2,class:"u-empty"},_o={key:3,class:"u-vscroll"},wo={class:"row items-center no-wrap full-width"},yo={class:"text-body2 text-weight-medium"},Po={key:1,class:"q-pa-sm text-grey-7"},Co={class:"col u-preview-wrap"},To={class:"row items-center justify-between no-wrap"},Ao={class:"col-auto"},Eo={class:"text-subtitle2 text-weight-bold"},Oo={class:"col-auto"},Do={class:"u-actions"},Io={key:1,class:"row q-col-gutter-sm"},xo={class:"row items-center justify-between q-mb-md u-footer-head"},Fo={class:"col-auto"},No={key:1,class:"row q-col-gutter-sm q-pb-md"},Mo={class:"u-card-general-title"},qo={class:"u-card-general-snippet"},Ro={key:2,class:"u-empty small"},Lo={class:"row q-col-gutter-sm"},Vo={class:"col-12 col-md-8"},Uo={class:"col-6 col-md-3"},Go={class:"col-6 col-md-1 flex items-center"},Qo={key:0,class:"col-12"},$o={class:"col-12"},jo={class:"row q-ma-xs q-col-gutter-sm"},Xo={class:"col-12 col-md-12"};function Wo(e,n){var t=(0,o.g2)("q-tab"),r=(0,o.g2)("q-tabs"),i=(0,o.g2)("q-icon"),a=(0,o.g2)("q-input"),s=(0,o.g2)("q-item-label"),l=(0,o.g2)("q-item-section"),u=(0,o.g2)("q-btn"),c=(0,o.g2)("q-item"),d=(0,o.g2)("q-separator"),m=(0,o.g2)("q-list"),p=(0,o.g2)("q-menu"),f=(0,o.g2)("q-virtual-scroll"),v=(0,o.g2)("q-expansion-item"),h=(0,o.g2)("q-card"),S=(0,o.g2)("q-card-section"),k=(0,o.g2)("tip-tap-editor"),_=(0,o.g2)("q-linear-progress"),w=(0,o.g2)("q-select"),y=(0,o.g2)("q-checkbox"),P=(0,o.g2)("sie-modal"),C=(0,o.g2)("q-tooltip"),T=(0,o.gN)("close-popup"),A=(0,o.gN)("ripple");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("div",vo,[(0,o.Lk)("div",ho,[(0,o.bF)(h,{class:"flat u-sidebar"},{default:(0,o.k6)(function(){return[e.esAdmin?((0,o.uX)(),(0,o.Wv)(r,{key:0,modelValue:e.tab,"onUpdate:modelValue":n[0]||(n[0]=function(n){return e.tab=n}),align:"justify",dense:"",style:{"font-weight":"semi-bold"},onInput:e.cambiarTab},{default:(0,o.k6)(function(){return[(0,o.bF)(t,{name:"prompts",label:"Prompts"}),(0,o.bF)(t,{name:"grupos",label:"Grupos"})]}),_:1},8,["modelValue","onInput"])):(0,o.Q3)("v-if",!0),(0,o.Lk)("div",go,[(0,o.bF)(a,{modelValue:e.filterData,"onUpdate:modelValue":n[1]||(n[1]=function(n){return e.filterData=n}),borderless:"",placeholder:"Buscar prompt"},{prepend:(0,o.k6)(function(){return[(0,o.bF)(i,{name:"search",size:"16px"})]}),_:1},8,["modelValue"])]),"prompts"===e.tab?((0,o.uX)(),(0,o.CE)("div",bo,[(0,o.bF)(f,{class:"u-vscroll",items:e.filteredPrompts,"virtual-scroll-item-size":8},{default:(0,o.k6)(function(t){return[(0,o.bo)(((0,o.uX)(),(0,o.Wv)(c,{key:t.item.ID_PROMPT||t.index,clickable:"",onClick:function(n){return e.verMensajes(t.item)},class:(0,b.C4)(["prompt-item",e.currentPrompt&&e.currentPrompt.ID_PROMPT===t.item.ID_PROMPT?"prompt-item--active":""])},{default:(0,o.k6)(function(){return[(0,o.bF)(l,{class:"item-prompt"},{default:(0,o.k6)(function(){return[(0,o.bF)(s,{lines:"1"},{default:(0,o.k6)(function(){return[(0,o.eW)((0,b.v_)(t.item.NAME_PROMPT),1)]}),_:2},1024),(0,o.bF)(s,{caption:"",lines:"1"},{default:(0,o.k6)(function(){return[(0,o.eW)((0,b.v_)(t.item.CONTENT),1)]}),_:2},1024)]}),_:2},1024),(0,o.bF)(l,{side:""},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",So,[(0,o.bF)(u,{flat:"",dense:"",round:"",icon:Number(t.item.FAVORITO)?"star":"star_border",color:Number(t.item.FAVORITO)?"primary":"grey-2",onClick:(0,zn.D$)(function(n){return e.togglePromptFav(t.item)},["stop"]),title:Number(t.item.FAVORITO)?"Quitar de favoritos":"Marcar como favorito"},null,8,["icon","color","onClick","title"]),(0,o.bF)(u,{flat:"",dense:"",round:"",icon:"more_vert",onClick:n[2]||(n[2]=(0,zn.D$)(function(){},["stop"]))},{default:(0,o.k6)(function(){return[(0,o.bF)(p,{cover:"","auto-close":"",anchor:"top right",self:"top right"},{default:(0,o.k6)(function(){return[(0,o.bF)(m,{dense:""},{default:(0,o.k6)(function(){return[(0,o.bo)(((0,o.uX)(),(0,o.Wv)(c,{clickable:"",onClick:function(n){return e.openModal(t.item,"edit")}},{default:(0,o.k6)(function(){return[(0,o.bF)(l,null,{default:(0,o.k6)(function(){return g()(n[15]||(n[15]=[(0,o.eW)("Editar",-1)]))}),_:1})]}),_:1},8,["onClick"])),[[T]]),(0,o.bo)(((0,o.uX)(),(0,o.Wv)(c,{clickable:"",onClick:function(n){return e.duplicatePrompt(t.item)}},{default:(0,o.k6)(function(){return[(0,o.bF)(l,null,{default:(0,o.k6)(function(){return g()(n[16]||(n[16]=[(0,o.eW)("Duplicar",-1)]))}),_:1})]}),_:1},8,["onClick"])),[[T]]),(0,o.bo)(((0,o.uX)(),(0,o.Wv)(c,{clickable:"",onClick:function(n){return e.movePrompt(t.item)}},{default:(0,o.k6)(function(){return[(0,o.bF)(l,null,{default:(0,o.k6)(function(){return g()(n[17]||(n[17]=[(0,o.eW)("Mover a grupo…",-1)]))}),_:1})]}),_:1},8,["onClick"])),[[T]]),(0,o.bF)(d),(0,o.bo)(((0,o.uX)(),(0,o.Wv)(c,{clickable:"",onClick:function(n){return e.deletePrompt(t.item)}},{default:(0,o.k6)(function(){return[(0,o.bF)(l,{class:"text-negative"},{default:(0,o.k6)(function(){return g()(n[18]||(n[18]=[(0,o.eW)("Eliminar",-1)]))}),_:1})]}),_:1},8,["onClick"])),[[T]])]}),_:2},1024)]}),_:2},1024)]}),_:2},1024)])]}),_:2},1024)]}),_:2},1032,["onClick","class"])),[[A]])]}),_:1},8,["items"])])):"prompts"!==e.tab||e.dataPrompts.length?(0,o.Q3)("v-if",!0):((0,o.uX)(),(0,o.CE)("div",ko,g()(n[19]||(n[19]=[(0,o.Lk)("span",null,"No se encontró ningún prompt.",-1)])))),"grupos"===e.tab?((0,o.uX)(),(0,o.CE)("div",_o,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.filteredGroups,function(t){return(0,o.uX)(),(0,o.Wv)(v,{key:t.ID_GRUPO_PROMPT,dense:"","hide-expand-icon":"","header-class":"q-pa-sm"},{header:(0,o.k6)(function(){return[(0,o.Lk)("div",wo,[(0,o.bF)(i,{class:"q-mr-sm",name:"folder",size:"sm"}),(0,o.Lk)("div",yo,(0,b.v_)(t.NAME_GRUPO_PROMPT||"(Sin nombre)"),1),n[22]||(n[22]=(0,o.Lk)("div",{style:{flex:"1"}},null,-1)),(0,o.bF)(u,{flat:"",dense:"",round:"",icon:Number(t.FAVORITO)?"star":"star_border",color:Number(t.FAVORITO)?"primary":"grey-2",onClick:(0,zn.D$)(function(n){return e.toggleGroupFavItem(t)},["stop"]),title:Number(t.FAVORITO)?"Quitar de favoritos":"Marcar como favorito"},null,8,["icon","color","onClick","title"]),(0,o.bF)(u,{class:"q-ml-xs",flat:"",dense:"",round:"",icon:"more_vert",onClick:n[3]||(n[3]=(0,zn.D$)(function(){},["stop"]))},{default:(0,o.k6)(function(){return[(0,o.bF)(p,{cover:"","auto-close":"",anchor:"top right",self:"top right"},{default:(0,o.k6)(function(){return[(0,o.bF)(m,{dense:""},{default:(0,o.k6)(function(){return[(0,o.bo)(((0,o.uX)(),(0,o.Wv)(c,{clickable:"",onClick:function(n){return e.openGrupoModal(t,"edit")}},{default:(0,o.k6)(function(){return[(0,o.bF)(l,null,{default:(0,o.k6)(function(){return g()(n[20]||(n[20]=[(0,o.eW)("Renombrar",-1)]))}),_:1})]}),_:1},8,["onClick"])),[[T]]),(0,o.bo)(((0,o.uX)(),(0,o.Wv)(c,{clickable:"",onClick:function(n){return e.toggleGroupFavItem(t)}},{default:(0,o.k6)(function(){return[(0,o.bF)(l,null,{default:(0,o.k6)(function(){return[(0,o.eW)((0,b.v_)(Number(t.FAVORITO)?"Quitar de favoritos":"Marcar como favorito"),1)]}),_:2},1024)]}),_:2},1032,["onClick"])),[[T]]),(0,o.bF)(d),(0,o.bo)(((0,o.uX)(),(0,o.Wv)(c,{clickable:"",onClick:function(n){return e.deleteGroup(t)}},{default:(0,o.k6)(function(){return[(0,o.bF)(l,{class:"text-negative"},{default:(0,o.k6)(function(){return g()(n[21]||(n[21]=[(0,o.eW)("Eliminar grupo",-1)]))}),_:1})]}),_:1},8,["onClick"])),[[T]])]}),_:2},1024)]}),_:2},1024)]}),_:2},1024)])]}),default:(0,o.k6)(function(){return[e.childrenOf(t.ID_GRUPO_PROMPT).length?((0,o.uX)(),(0,o.Wv)(m,{key:0,padding:""},{default:(0,o.k6)(function(){return[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.childrenOf(t.ID_GRUPO_PROMPT),function(n){return(0,o.bo)(((0,o.uX)(),(0,o.Wv)(c,{key:n.ID_PROMPT,clickable:"",onClick:function(t){return e.verMensajes(n)}},{default:(0,o.k6)(function(){return[(0,o.bF)(l,{class:"item-prompt"},{default:(0,o.k6)(function(){return[(0,o.bF)(s,{lines:"1"},{default:(0,o.k6)(function(){return[(0,o.eW)((0,b.v_)(n.NAME_PROMPT),1)]}),_:2},1024),(0,o.bF)(s,{caption:"",lines:"1"},{default:(0,o.k6)(function(){return[(0,o.eW)((0,b.v_)(n.CONTENT),1)]}),_:2},1024)]}),_:2},1024),(0,o.bF)(l,{side:""})]}),_:2},1032,["onClick"])),[[A]])}),128))]}),_:2},1024)):((0,o.uX)(),(0,o.CE)("div",Po,"(Vacío)"))]}),_:2},1024)}),128))])):(0,o.Q3)("v-if",!0)]}),_:1}),(0,o.Lk)("div",Co,[(0,o.bF)(h,{class:"flat u-preview-card"},{default:(0,o.k6)(function(){return[(0,o.bF)(S,{class:"u-preview-head"},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",To,[(0,o.Lk)("div",Ao,[(0,o.Lk)("div",Eo,(0,b.v_)(e.previewTitulo||"Editor"),1)]),(0,o.Lk)("div",Oo,[(0,o.Lk)("div",Do,[e.previewMeta&&"1"===e.previewMeta.type&&e.isDirty?((0,o.uX)(),(0,o.Wv)(u,{key:0,flat:"",dense:"",round:"",icon:"save",title:"Guardar cambios",onClick:e.saveInlineEdit},null,8,["onClick"])):(0,o.Q3)("v-if",!0),e.previewMeta&&"1"===e.previewMeta.type&&e.isDirty?((0,o.uX)(),(0,o.Wv)(u,{key:1,flat:"",dense:"",round:"",icon:"undo",title:"Descartar cambios",onClick:e.discardInlineEdit},null,8,["onClick"])):(0,o.Q3)("v-if",!0),e.previewMeta&&"2"===e.previewMeta.type?((0,o.uX)(),(0,o.Wv)(u,{key:2,flat:"",dense:"",round:"",icon:"content_copy",onClick:n[4]||(n[4]=function(n){return e.duplicateCurrent()}),title:"Duplicar a mis prompts"})):(0,o.Q3)("v-if",!0),e.previewMeta&&"1"===e.previewMeta.type?((0,o.uX)(),(0,o.Wv)(u,{key:3,flat:"",dense:"",round:"",icon:"delete",onClick:n[5]||(n[5]=function(n){return e.deleteCurrent()}),title:"Eliminar prompt"})):(0,o.Q3)("v-if",!0)])])])]}),_:1}),e.previewMeta&&(e.previewContent||e.previewMeta)?((0,o.uX)(),(0,o.Wv)(S,{key:0,class:"u-preview-body",style:{position:"relative"}},{default:(0,o.k6)(function(){return[e.canEdit?((0,o.uX)(),(0,o.Wv)(k,{ref:"editor",key:e.editorKey,src:e.previewContent,editable:e.canEdit,"content-format":"text","enable-ask":!1,onInput:e.onEditorText},null,8,["src","editable","onInput"])):((0,o.uX)(),(0,o.CE)("div",Io,[(0,o.bF)(i,{class:"q-mr-sm",name:"lock"}),(0,o.Lk)("span",null,(0,b.v_)(e.previewContent),1)]))]}),_:1})):((0,o.uX)(),(0,o.Wv)(S,{key:1,class:"u-preview-empty"},{default:(0,o.k6)(function(){return[(0,o.bF)(i,{name:"chat",size:"120px",color:"grey-6"}),n[23]||(n[23]=(0,o.Lk)("span",null,"Selecciona un prompt para previsualizar",-1))]}),_:1}))]}),_:1})])]),(0,o.bF)(h,{class:"flat q-pa-md u-footer"},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",xo,[n[24]||(n[24]=(0,o.Lk)("div",{class:"col-auto"},[(0,o.Lk)("div",{class:"u-footer-title"},"PROMPTS GLOBALES")],-1)),(0,o.Lk)("div",Fo,[(0,o.bF)(u,{flat:"",dense:"",size:"sm",icon:"refresh",label:"Actualizar",loading:e.loadingGeneral,onClick:n[6]||(n[6]=function(n){return e.getPrompts(2)})},null,8,["loading"])])]),e.loadingGeneral?((0,o.uX)(),(0,o.Wv)(_,{key:0,class:"q-mb-sm",indeterminate:"",color:"primary"})):(0,o.Q3)("v-if",!0),e.generalPrompts.length?((0,o.uX)(),(0,o.CE)("div",No,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.generalPrompts,function(n,t){return(0,o.uX)(),(0,o.CE)("div",{key:n.ID_PROMPT||t,class:"col-12 col-sm-6 col-md-3"},[(0,o.bF)(h,{class:"flat cursor-pointer u-card-general",onClick:function(t){return e.previewGeneral(n)}},{default:(0,o.k6)(function(){return[(0,o.bF)(S,{class:"u-card-general-head"},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",Mo,(0,b.v_)(n.NAME_PROMPT),1)]}),_:2},1024),(0,o.bF)(S,{class:"u-card-general-body"},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",qo,(0,b.v_)(n.CONTENT),1)]}),_:2},1024)]}),_:2},1032,["onClick"])])}),128))])):((0,o.uX)(),(0,o.CE)("div",Ro,g()(n[25]||(n[25]=[(0,o.Lk)("span",null,"No hay prompts generales aún",-1)]))))]}),_:1})]),(0,o.bF)(P,{modelValue:e.statusModal,"onUpdate:modelValue":n[12]||(n[12]=function(n){return e.statusModal=n}),ok:"Guardar",onSubmit:e.submitPrompt,title:e.titleModal},{default:(0,o.k6)(function(){return[(0,o.bF)(S,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",Lo,[(0,o.Lk)("div",Vo,[(0,o.bF)(a,{modelValue:e.formData.NAME_PROMPT,"onUpdate:modelValue":n[7]||(n[7]=function(n){return e.formData.NAME_PROMPT=n}),label:"Título del prompt","hide-bottom-space":""},null,8,["modelValue"])]),(0,o.Lk)("div",Uo,[(0,o.bF)(w,{modelValue:e.formData.VISIBILIDAD,"onUpdate:modelValue":n[8]||(n[8]=function(n){return e.formData.VISIBILIDAD=n}),options:e.optionsVisibilidad,"option-value":"id","option-label":"value",label:"Visibilidad",disable:!e.esAdmin,"hide-bottom-space":""},null,8,["modelValue","options","disable"])]),(0,o.Lk)("div",Go,[(0,o.bF)(y,{modelValue:e.formData.INGROUP,"onUpdate:modelValue":n[9]||(n[9]=function(n){return e.formData.INGROUP=n}),"true-value":1,"false-value":0,color:"secondary",label:"",dense:""},null,8,["modelValue"])]),1===Number(e.formData.INGROUP)?((0,o.uX)(),(0,o.CE)("div",Qo,[(0,o.bF)(w,{modelValue:e.formData.GRUPO,"onUpdate:modelValue":n[10]||(n[10]=function(n){return e.formData.GRUPO=n}),options:e.dataGrupoPrompts,"option-value":"ID_GRUPO_PROMPT","option-label":"NAME_GRUPO_PROMPT",label:"Grupo"},null,8,["modelValue","options"])])):(0,o.Q3)("v-if",!0),(0,o.Lk)("div",$o,[(0,o.bF)(a,{modelValue:e.formData.CONTENT,"onUpdate:modelValue":n[11]||(n[11]=function(n){return e.formData.CONTENT=n}),label:"Contenido",type:"textarea","input-style":"max-height: 450px; height: 450px;"},null,8,["modelValue"])])])]}),_:1})]}),_:1},8,["modelValue","onSubmit","title"]),(0,o.bF)(P,{modelValue:e.grupoPromptModal,"onUpdate:modelValue":n[14]||(n[14]=function(n){return e.grupoPromptModal=n}),ok:"Guardar",onSubmit:e.submitGrupoPrompt,title:e.titleModal},{default:(0,o.k6)(function(){return[(0,o.bF)(S,null,{default:(0,o.k6)(function(){return[(0,o.Lk)("div",jo,[(0,o.Lk)("div",Xo,[(0,o.bF)(a,{modelValue:e.form.NAME_GRUPO_PROMPT,"onUpdate:modelValue":n[13]||(n[13]=function(n){return e.form.NAME_GRUPO_PROMPT=n}),label:"Nombre del Grupo",type:"text",dense:""},{append:(0,o.k6)(function(){return[(0,o.bF)(u,{flat:"",dense:"",round:"",icon:e.form.FAVORITO?"star":"star_border",color:e.form.FAVORITO?"primary":"grey-6",onClick:e.toggleGroupFav},null,8,["icon","color","onClick"]),e.$q.platform.is.desktop?((0,o.uX)(),(0,o.Wv)(C,{key:0},{default:(0,o.k6)(function(){return[(0,o.Lk)("span",null,(0,b.v_)(e.form.FAVORITO?"Quitar de favoritos":"Marcar como favorito"),1)]}),_:1})):(0,o.Q3)("v-if",!0)]}),_:1},8,["modelValue"])])])]}),_:1})]}),_:1},8,["modelValue","onSubmit","title"])])}t(62692),t(2369);var Ho={data:function(){return{columnsPrompts:[],dataPrompts:[],configPrompts:{}}},methods:{setColumnsPrompts:function(e){this.columnsPrompts=[{name:"id_prompt",label:"ID",align:"center",field:"id_prompt"},{name:"usucod",label:"Usuario",align:"center",field:"usucod"},{name:"name_prompt",label:"Titulo",align:"left",field:"name_prompt"},{name:"edit",label:"",align:"left"}]},setConfigPrompts:function(){this.configPrompts={flat:!0,round:!0,color:"primary",fecha_creacion:{component:"date",edit:!1},edit:{flat:!0,component:"button",icon:["delete"],tooltip:{delete:"Eliminar"},delete:function(e){var n=this;return u()(s()().m(function t(){return s()().w(function(t){while(1)switch(t.n){case 0:n.$confirm("¿Está seguro que desea eliminar el prompt?").onOk(function(){n.eliminarPrompt(e)});case 1:return t.a(2)}},t)}))()}}}}}},zo=t(95718),Bo=t(34963),Jo=t(54387),Ko=t(3112),Yo={name:"MantenimientoPromptIA",components:{QMenu:qn.A,sieModal:gn.A,QBtn:_n.A,QIcon:kn.A,QInput:xn.A,QAvatar:f.A,QCard:d.A,QCardSection:zo.A,QLinearProgress:Bo.A,QVirtualScroll:Jo.A,QItem:m.A,QItemSection:p.A,QItemLabel:v.A,QSelect:In.A,QCheckbox:Ko.A,QTab:_t.A,QTabs:wt.A,QTabPanel:yt.A,QTabPanels:Pt.A,QExpansionItem:Tt.A,QSeparator:Cn.A,Skeleton:On.A,tipTapEditor:kt,QList:fn.Mb,QTooltip:fn.nC},mixins:[Ho],data:function(){return{sie:(0,c["default"])(),tab:"prompts",esAdmin:!1,previewTitulo:"",previewContent:"",originalPreviewContent:"",previewMeta:null,editorKey:0,modalSubir:!1,dataPrompts:[],generalPrompts:[],loadingGeneral:!1,filterData:"",currentPrompt:null,loadingDocument:!1,statusModal:!1,titleModal:"Nuevo Prompt",modalType:"create",formData:{ID_PROMPT:null,NAME_PROMPT:"",CONTENT:"",VISIBILIDAD:1,INGROUP:0,GRUPO:null,FAVORITO:0,USUCOD:""},grupoPromptModal:!1,dataGrupoPrompts:[],form:{ID_GRUPO_PROMPT:null,NAME_GRUPO_PROMPT:"",FAVORITO:0},optionsVisibilidad:[{id:1,value:"Privado"},{id:2,value:"Global"}]}},computed:{filteredPrompts:function(){var e=Array.isArray(this.dataPrompts)?g()(this.dataPrompts):[],n=(this.filterData||"").trim().toLowerCase();return n&&(e=e.filter(function(e){return(e.NAME_PROMPT||"").toLowerCase().includes(n)||(e.CONTENT||"").toLowerCase().includes(n)||String(e.ID_PROMPT||"").includes(n)})),e.sort(function(e,n){var t=Number(e.FAVORITO)||0,o=Number(n.FAVORITO)||0;if(o!==t)return o-t;var r=e.FECHA_CREACION?new Date(e.FECHA_CREACION).getTime():0,i=n.FECHA_CREACION?new Date(n.FECHA_CREACION).getTime():0;return i!==r?i-r:(n.ID_PROMPT||0)-(e.ID_PROMPT||0)})},searchTerm:function(){return(this.filterData||"").trim().toLowerCase()},filteredGroups:function(){var e=this,n=Array.isArray(this.dataGrupoPrompts)?this.dataGrupoPrompts:[],t=this.searchTerm;return t?n.filter(function(n){var o=(n.NAME_GRUPO_PROMPT||"").toLowerCase();return!!o.includes(t)||(e.dataPrompts||[]).some(function(e){return Number(e.ID_GRUPO_PROMPT)===Number(n.ID_GRUPO_PROMPT)&&((e.NAME_PROMPT||"").toLowerCase().includes(t)||(e.CONTENT||"").toLowerCase().includes(t))})}):n},canEdit:function(){return!(!this.previewMeta||"1"!==this.previewMeta.type)},isDirty:function(){return this.canEdit&&this.previewContent!==this.originalPreviewContent}},methods:{onEditorText:function(e){this.previewContent="string"===typeof e||null!==e&&void 0!==e?e:""},getPrompts:function(){var e=arguments,n=this;return u()(s()().m(function t(){var o,r,i,a,l,u,c;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:return o=e.length>0&&void 0!==e[0]?e[0]:1,t.p=1,2===o&&(n.loadingGeneral=!0),i={visibilidad:2===o?o:"",usucod:1===o?String(n.sie.usucod||""):""},t.n=2,vn.$http.get("api/ChatPromptController/getPrompts",{params:{params:i}});case 2:a=t.v,l=Array.isArray(a.data)?a.data:(null===(r=a.data)||void 0===r?void 0:r.data)||[],1===o?n.dataPrompts=l:n.generalPrompts=l,t.n=4;break;case 3:t.p=3,c=t.v,null===(u=n.$notify)||void 0===u||u.call(n,(null===c||void 0===c?void 0:c.message)||"Error al obtener prompts","warning");case 4:return t.p=4,2===o&&(n.loadingGeneral=!1),t.f(4);case 5:return t.a(2)}},t,null,[[1,3,4,5]])}))()},getGrupoPrompts:function(){var e=this;return u()(s()().m(function n(){var t,o,r,i,a,l;return s()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,e.$q.loading.show(),o={usucod:String(e.sie.usucod||"")},n.n=1,vn.$http.get("api/ChatPromptController/getGrupoPrompt",{params:{params:o}});case 1:r=n.v,i=Array.isArray(r.data)?r.data:(null===(t=r.data)||void 0===t?void 0:t.data)||[],e.dataGrupoPrompts=i,n.n=3;break;case 2:n.p=2,l=n.v,null===(a=e.$notify)||void 0===a||a.call(e,(null===l||void 0===l?void 0:l.message)||"Error al obtener prompts","warning");case 3:return n.p=3,e.$q.loading.hide(),n.f(3);case 4:return n.a(2)}},n,null,[[0,2,3,4]])}))()},childrenOf:function(e){return(this.dataPrompts||[]).filter(function(n){return Number(n.ID_GRUPO_PROMPT)===Number(e)})},cambiarTab:function(){var e=this;return u()(s()().m(function n(){return s()().w(function(n){while(1)switch(n.n){case 0:return e.$q.loading.show(),n.n=1,e.getGrupoPrompts();case 1:return n.n=2,e.getPrompts(1);case 2:return n.n=3,e.getPrompts(2);case 3:e.cleanSpace(),e.$q.loading.hide();case 4:return n.a(2)}},n)}))()},formatTimeShort:function(e){try{var n=new Date(e),t=function(e){return String(e).padStart(2,"0")};return"".concat(t(n.getDate()),"/").concat(t(n.getMonth()+1))}catch(e){return""}},verMensajes:function(e){this.currentPrompt=e,this.previewMeta=pn()({type:"1"},e),this.onRowSelected(e)},onRowSelected:function(e){var n=(null===e||void 0===e?void 0:e.CONTENT)||"";this.previewTitulo=(null===e||void 0===e?void 0:e.NAME_PROMPT)||"",this.previewContent=n,this.originalPreviewContent=n,this.editorKey++},previewGeneral:function(e){var n=(null===e||void 0===e?void 0:e.CONTENT)||"";this.previewTitulo=(null===e||void 0===e?void 0:e.NAME_PROMPT)||"",this.previewContent=n,this.originalPreviewContent=n,this.currentPrompt=null,this.previewMeta=pn()({type:"2"},e),this.editorKey++},useGeneral:function(e){this.modalSubir=!0},copyPrompt:function(e){var n=this;this.$q.copyToClipboard(e).then(function(){var e;return null===(e=n.$notify)||void 0===e?void 0:e.call(n,"Prompt copiado","positive")}).catch(function(){var e;return null===(e=n.$notify)||void 0===e?void 0:e.call(n,"No se pudo copiar el prompt","warning")})},openModal:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"create";this.statusModal=!0,this.modalType=n,"edit"===n?(this.titleModal="Editar Prompt",this.formData={ID_PROMPT:e.ID_PROMPT,NAME_PROMPT:e.NAME_PROMPT,CONTENT:e.CONTENT,VISIBILIDAD:e.VISIBILIDAD||1,INGROUP:e.ID_GRUPO_PROMPT?1:0,GRUPO:e.ID_GRUPO_PROMPT,FAVORITO:e.FAVORITO,USUCOD:e.USUCOD}):"duplicate"===n?(this.titleModal="Duplicar Prompt",this.formData={ID_PROMPT:null,NAME_PROMPT:(e.NAME_PROMPT||"")+" (copia)",CONTENT:e.CONTENT||"",VISIBILIDAD:1,INGROUP:0,GRUPO:null,FAVORITO:e.FAVORITO,USUCOD:this.sie.usucod}):(this.titleModal="Nuevo Prompt",this.formData={ID_PROMPT:null,NAME_PROMPT:"",CONTENT:"",VISIBILIDAD:1,INGROUP:0,GRUPO:null,FAVORITO:0,USUCOD:this.sie.usucod})},duplicateCurrent:function(){this.previewMeta&&"2"===this.previewMeta.type&&this.openModal(this.previewMeta,"duplicate")},submitPrompt:function(){var e=this;return u()(s()().m(function n(){var t,o,r,i,a,l,u,c,d,m,p,f,v,h,g;return s()().w(function(n){while(1)switch(n.p=n.n){case 0:if(n.p=0,t="edit"===e.modalType,o={id_prompt:t?e.formData.ID_PROMPT:null,name_prompt:e.formData.NAME_PROMPT,usucod:e.sie.usucod,visibilidad:e.formData.VISIBILIDAD,content:e.formData.CONTENT,inGroup:e.formData.INGROUP,grupo:e.formData.GRUPO,favorito:e.formData.FAVORITO},e.formData.NAME_PROMPT){n.n=1;break}return n.a(2,null===(r=e.$notify)||void 0===r?void 0:r.call(e,"El nombre del prompt es obligatorio","warning"));case 1:if(e.formData.CONTENT){n.n=2;break}return n.a(2,null===(i=e.$notify)||void 0===i?void 0:i.call(e,"El contenido del prompt es obligatorio","warning"));case 2:if(!t||e.formData.ID_PROMPT){n.n=3;break}return n.a(2,null===(a=e.$notify)||void 0===a?void 0:a.call(e,"El ID del prompt es obligatorio para editar","warning"));case 3:if(!t){n.n=5;break}return n.n=4,vn.$http.put("api/ChatPromptController/putPrompt",{params:o});case 4:u=n.v,c=(null===u||void 0===u?void 0:u.message)||"Prompt actualizado",null===(l=e.$notify)||void 0===l||l.call(e,c,"positive"),n.n=7;break;case 5:return n.n=6,vn.$http.post("api/ChatPromptController/postPrompt",{params:o});case 6:m=n.v,p=(null===m||void 0===m?void 0:m.message)||"Prompt guardado.",null===(d=e.$notify)||void 0===d||d.call(e,p,"positive");case 7:return n.n=8,e.getPrompts(1);case 8:return n.n=9,e.getPrompts(2);case 9:e.cleanSpace(),e.statusModal=!1,n.n=11;break;case 10:n.p=10,g=n.v,h=(null===g||void 0===g||null===(f=g.response)||void 0===f||null===(f=f.data)||void 0===f?void 0:f.message)||(null===g||void 0===g?void 0:g.message)||"Error al guardar el prompt",null===(v=e.$notify)||void 0===v||v.call(e,h,"warning");case 11:return n.a(2)}},n,null,[[0,10]])}))()},cleanSpace:function(){this.previewTitulo="",this.previewContent="",this.originalPreviewContent="",this.previewMeta=null,this.currentPrompt=null},deleteCurrent:function(){var e=this;return u()(s()().m(function n(){var t,o;return s()().w(function(n){while(1)switch(n.n){case 0:if(e.previewMeta&&"1"===e.previewMeta.type){n.n=1;break}return n.a(2);case 1:if(t=e.previewMeta.ID_PROMPT,t){n.n=2;break}return n.a(2,null===(o=e.$notify)||void 0===o?void 0:o.call(e,"No se encontró el ID del prompt","warning"));case 2:e.$confirm("¿Eliminar este prompt? Esta acción no se puede deshacer.").onOk(u()(s()().m(function n(){var o,r,i,a,l,u;return s()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,r={id_prompt:t,usucod:e.sie.usucod},n.n=1,vn.$http.delete("api/ChatPromptController/deletePrompt",{params:{params:r}});case 1:return null===(o=e.$notify)||void 0===o||o.call(e,"Prompt eliminado","positive"),n.n=2,e.getPrompts(1);case 2:return n.n=3,e.getPrompts(2);case 3:e.cleanSpace(),n.n=5;break;case 4:n.p=4,u=n.v,l=(null===u||void 0===u||null===(i=u.response)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.message)||(null===u||void 0===u?void 0:u.message)||"Error al eliminar",null===(a=e.$notify)||void 0===a||a.call(e,l,"warning");case 5:return n.a(2)}},n,null,[[0,4]])})));case 3:return n.a(2)}},n)}))()},openGrupoModal:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"create";this.grupoPromptModal=!0,this.modalType=n,"edit"===n?(this.titleModal="Editar Grupo Prompt",this.form={ID_GRUPO_PROMPT:e.ID_GRUPO_PROMPT,NAME_GRUPO_PROMPT:e.NAME_GRUPO_PROMPT||"",FAVORITO:Number(e.FAVORITO)||0}):(this.titleModal="Nuevo Grupo Prompt",this.form={ID_GRUPO_PROMPT:null,NAME_GRUPO_PROMPT:"",FAVORITO:0})},toggleGroupFav:function(){this.form.FAVORITO=this.form.FAVORITO?0:1},submitGrupoPrompt:function(){var e=this;return u()(s()().m(function n(){var t,o,r,i,a,l,u,c,d,m,p,f,v,h;return s()().w(function(n){while(1)switch(n.p=n.n){case 0:if(n.p=0,t="edit"===e.modalType,o={id_grupo_prompt:t?e.form.ID_GRUPO_PROMPT:null,usucod:e.sie.usucod,name_grupo_prompt:e.form.NAME_GRUPO_PROMPT||"",visibilidad:e.form.VISIBILIDAD||1,favorito:e.form.FAVORITO||0},e.form.NAME_GRUPO_PROMPT){n.n=1;break}return n.a(2,null===(r=e.$notify)||void 0===r?void 0:r.call(e,"El nombre del grupo es obligatorio","warning"));case 1:if(!t||e.form.ID_GRUPO_PROMPT){n.n=2;break}return n.a(2,null===(i=e.$notify)||void 0===i?void 0:i.call(e,"El ID del grupo es obligatorio para editar","warning"));case 2:if(!t){n.n=4;break}return n.n=3,vn.$http.put("api/ChatPromptController/putGrupoPrompt",{params:o});case 3:l=n.v,u=(null===l||void 0===l?void 0:l.message)||"Grupo Prompt actualizado",null===(a=e.$notify)||void 0===a||a.call(e,u,"positive"),n.n=6;break;case 4:return n.n=5,vn.$http.post("api/ChatPromptController/postGrupoPrompt",{params:o});case 5:d=n.v,m=(null===d||void 0===d?void 0:d.message)||"Grupo Prompt guardado.",null===(c=e.$notify)||void 0===c||c.call(e,m,"positive");case 6:e.getGrupoPrompts(),e.grupoPromptModal=!1,n.n=8;break;case 7:n.p=7,h=n.v,v=(null===h||void 0===h||null===(p=h.response)||void 0===p||null===(p=p.data)||void 0===p?void 0:p.message)||(null===h||void 0===h?void 0:h.message)||"Error al guardar el prompt",null===(f=e.$notify)||void 0===f||f.call(e,v,"warning");case 8:return n.a(2)}},n,null,[[0,7]])}))()},togglePromptFav:function(e){var n=this;return u()(s()().m(function t(){var o,r;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:if(t.p=0,o=1===Number(e.FAVORITO),!o){t.n=2;break}return t.n=1,vn.$http.put("api/ChatPromptController/putPrompt",{params:{id_prompt:e.ID_PROMPT,name_prompt:e.NAME_PROMPT,usucod:n.sie.usucod,visibilidad:e.VISIBILIDAD||1,content:e.CONTENT,inGroup:e.ID_GRUPO_PROMPT?1:0,grupo:e.ID_GRUPO_PROMPT||null,favorito:0}});case 1:e.FAVORITO=0,n.getPrompts(1),t.n=4;break;case 2:return t.n=3,vn.$http.put("api/ChatPromptController/putPrompt",{params:{id_prompt:e.ID_PROMPT,name_prompt:e.NAME_PROMPT,usucod:n.sie.usucod,visibilidad:e.VISIBILIDAD||1,content:e.CONTENT,inGroup:e.ID_GRUPO_PROMPT?1:0,grupo:e.ID_GRUPO_PROMPT||null,favorito:1}});case 3:e.FAVORITO=1,n.getPrompts(1);case 4:t.n=6;break;case 5:t.p=5,t.v,null===(r=n.$notify)||void 0===r||r.call(n,"No se pudo actualizar favorito","warning");case 6:return t.a(2)}},t,null,[[0,5]])}))()},toggleGroupFavItem:function(e){var n=this;return u()(s()().m(function t(){var o,r;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:if(t.p=0,o=1===Number(e.FAVORITO),!o){t.n=2;break}return t.n=1,vn.$http.put("api/ChatPromptController/putGrupoPrompt",{params:{id_grupo_prompt:e.ID_GRUPO_PROMPT,usucod:n.sie.usucod,name_grupo_prompt:e.NAME_GRUPO_PROMPT||"",visibilidad:e.VISIBILIDAD||1,favorito:0}});case 1:e.FAVORITO=0,n.getGrupoPrompts(),t.n=4;break;case 2:return t.n=3,vn.$http.put("api/ChatPromptController/putGrupoPrompt",{params:{id_grupo_prompt:e.ID_GRUPO_PROMPT,usucod:n.sie.usucod,name_grupo_prompt:e.NAME_GRUPO_PROMPT||"",visibilidad:e.VISIBILIDAD||1,favorito:1}});case 3:e.FAVORITO=1,n.getGrupoPrompts();case 4:t.n=6;break;case 5:t.p=5,t.v,null===(r=n.$notify)||void 0===r||r.call(n,"No se pudo actualizar favorito","warning");case 6:return t.a(2)}},t,null,[[0,5]])}))()},hasEdits:function(){return this.form.CONTENT!==this.previewContent},onEditorUpdate:function(e){this.previewContent="string"===typeof e?e:e||""},onEditorReady:function(){var e,n=this,t=null===(e=this.$refs.editor)||void 0===e?void 0:e.editor;t&&!this._editorBound&&(t.on("update",function(){var e,t,o;n.previewContent=null!==(e=null===(t=n.$refs.editor)||void 0===t||null===(o=t.getText)||void 0===o?void 0:o.call(t))&&void 0!==e?e:n.previewContent}),this._editorBound=!0)},saveInlineEdit:function(){var e=this;return u()(s()().m(function n(){var t,o,r,i,a,l;return s()().w(function(n){while(1)switch(n.p=n.n){case 0:if(e.isDirty&&e.previewMeta&&"1"===e.previewMeta.type){n.n=1;break}return n.a(2);case 1:return t=e.previewMeta,n.p=2,n.n=3,vn.$http.put("api/ChatPromptController/putPrompt",{params:{id_prompt:t.ID_PROMPT,name_prompt:t.NAME_PROMPT,usucod:e.sie.usucod,visibilidad:t.VISIBILIDAD||1,content:e.previewContent,inGroup:t.ID_GRUPO_PROMPT?1:0,grupo:t.ID_GRUPO_PROMPT||null,favorito:t.FAVORITO||0}});case 3:return e.originalPreviewContent=e.previewContent,null===(o=e.$notify)||void 0===o||o.call(e,"Cambios guardados","positive"),n.n=4,e.getPrompts(1);case 4:return n.n=5,e.getPrompts(2);case 5:n.n=7;break;case 6:n.p=6,l=n.v,a=(null===l||void 0===l||null===(r=l.response)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.message)||(null===l||void 0===l?void 0:l.message)||"Error al guardar",null===(i=e.$notify)||void 0===i||i.call(e,a,"warning");case 7:return n.a(2)}},n,null,[[2,6]])}))()},discardInlineEdit:function(){this.canEdit&&(this.previewContent=this.originalPreviewContent,this.editorKey++)},duplicatePrompt:function(e){e&&this.openModal(e,"duplicate")},movePrompt:function(e){var n=this;e&&(this.openModal(e,"edit"),this.$nextTick(function(){n.formData.INGROUP=1}))},deletePrompt:function(e){var n=this;return u()(s()().m(function t(){return s()().w(function(t){while(1)switch(t.n){case 0:if(null!==e&&void 0!==e&&e.ID_PROMPT){t.n=1;break}return t.a(2);case 1:n.$confirm("¿Eliminar este prompt? Esta acción no se puede deshacer.").onOk(u()(s()().m(function t(){var o,r,i,a,l,u,c;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,i={id_prompt:e.ID_PROMPT,usucod:n.sie.usucod},t.n=1,vn.$http.delete("api/ChatPromptController/deletePrompt",{params:{params:i}});case 1:return null===(o=n.$notify)||void 0===o||o.call(n,"Prompt eliminado","positive"),t.n=2,n.getPrompts(1);case 2:return t.n=3,n.getPrompts(2);case 3:(null===(r=n.currentPrompt)||void 0===r?void 0:r.ID_PROMPT)===e.ID_PROMPT&&n.cleanSpace(),t.n=5;break;case 4:t.p=4,c=t.v,u=(null===c||void 0===c||null===(a=c.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.message)||(null===c||void 0===c?void 0:c.message)||"Error al eliminar",null===(l=n.$notify)||void 0===l||l.call(n,u,"warning");case 5:return t.a(2)}},t,null,[[0,4]])})));case 2:return t.a(2)}},t)}))()},deleteGroup:function(e){var n=this;return u()(s()().m(function t(){return s()().w(function(t){while(1)switch(t.n){case 0:if(null!==e&&void 0!==e&&e.ID_GRUPO_PROMPT){t.n=1;break}return t.a(2);case 1:n.$confirm("¿Eliminar este grupo? Los prompts NO se borrarán, solo perderán la asignación.").onOk(u()(s()().m(function t(){var o,r,i,a,l,u;return s()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,r={id_grupo_prompt:e.ID_GRUPO_PROMPT,usucod:n.sie.usucod},t.n=1,vn.$http.delete("api/ChatPromptController/deleteGrupoPrompt",{params:{params:r}});case 1:return null===(o=n.$notify)||void 0===o||o.call(n,"Grupo eliminado","positive"),t.n=2,n.getGrupoPrompts();case 2:return t.n=3,n.getPrompts(1);case 3:t.n=5;break;case 4:t.p=4,u=t.v,l=(null===u||void 0===u||null===(i=u.response)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.message)||(null===u||void 0===u?void 0:u.message)||"Error al eliminar grupo",null===(a=n.$notify)||void 0===a||a.call(n,l,"warning");case 5:return t.a(2)}},t,null,[[0,4]])})));case 2:return t.a(2)}},t)}))()}},beforeMount:function(){var e=this;return u()(s()().m(function n(){return s()().w(function(n){while(1)switch(n.n){case 0:return e.esAdmin=e.sie.ruta.nivel>=3,n.n=1,e.getPrompts(1);case 1:return n.n=2,e.getPrompts(2);case 2:return n.n=3,e.getGrupoPrompts();case 3:return n.a(2)}},n)}))()}};const Zo=(0,Xn.A)(Yo,[["render",Wo]]);var er=Zo,nr=t(64303),tr=(t(33950),{components:{QCard:d.A,QItem:m.A,QItemSection:p.A,QAvatar:f.A,QItemLabel:v.A,QSeparator:Cn.A,crearBotones:nr.A,SieUpload:Jt.A,sieModal:gn.A,planificacion:Nt,documentos:fo,prompts:er},data:function(){return{componente:"ProgramacionCurricularIA",nivelAcceso:(0,c["default"])().ruta.nivel,botones:[],BG_COLOR:"white",LECTURA_ESCRITURA:Fn["default"].LECTURA_ESCRITURA,isVisible:!1,hijos:[],estadoActual:"inicio",titulo:"Asistente Curricular con Inteligencia Artificial",dataMenu:{},esSieAdmin:["SIE"].includes((0,c["default"])().usucod)}},methods:{showElements:function(){this.isVisible=!this.isVisible},clasesFinal:function(e){return this.isVisible?"enter-".concat(e," mostrar"):""},openEstado:function(e){var n=e.URL,t=e.MENUNOM;this.estadoActual=n,this.dataMenu=e,this.titulo=t||"Asistente Curricular con Inteligencia Artificial"},goHome:function(){this.openEstado({URL:"inicio"})},enviar:function(){this.$refs.envio.$refs.envioMETA.enviar()},agregarPlantilla:function(){this.$refs.plantillas.nuevaPlantilla()},agregarPlan:function(){this.$refs.analytics.agregarPlan()},agregarExclusion:function(){this.$refs.exclusiones.openModalRegistrar("agregar")},generarBotones:function(){this.botones=this.hijos.sort(function(e,n){return e.ORDEN-n.ORDEN}).map(this.generarRowButton)},generarRowButton:function(e){var n=this;return{label:e.MENUNOM,icon:e.ICONO,minAcceso:Fn["default"].SOLO_LECTURA,big:!0,color:this.BG_COLOR,click:function(){return n.openEstado(e)}}},clickSubirDocumento:function(){this.$refs.documentos.clickSubirDocumento()},clickNewPrompt:function(){this.$refs.prompts.openModal()},clickNewGroupPrompt:function(){this.$refs.prompts.openGrupoModal()}},computed:{buttons:function(){if("inicio"!==this.estadoActual&&this.hijos.length>1){var e=[{label:"Volver",icon:"arrow_left",click:this.goHome}];return"documentos"===this.estadoActual&&e.push({label:"Subir documento",icon:"cloud_upload",click:this.clickSubirDocumento,permiso:this.nivelAcceso<Fn["default"].LECTURA_ESCRITURA}),"prompts"===this.estadoActual&&(e.push({label:"Nuevo Grupo",icon:"folder_plus",click:this.clickNewGroupPrompt,permiso:this.nivelAcceso<Fn["default"].LECTURA_ESCRITURA}),e.push({label:"Nuevo prompt",icon:"add",click:this.clickNewPrompt,permiso:this.nivelAcceso<Fn["default"].LECTURA_ESCRITURA})),e}}},beforeMount:function(){var e=this;return u()(s()().m(function n(){var t,o;return s()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,e.$http.get("api/menus/obtListaMenuAyudaAcademico");case 1:t=n.v,o=t.json,e.hijos=o.find(function(e){return e.URL===(0,c["default"])().ruta.name}).children,1===e.hijos.length&&e.openEstado(e.hijos[0]),e.generarBotones(),setTimeout(function(){e.isVisible=!0},3e3);case 2:return n.a(2)}},n)}))()}});const or=(0,Xn.A)(tr,[["render",i]]);var rr=or}}]);