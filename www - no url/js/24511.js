"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[24511],{24511:function(e,a,o){o.r(a),o.d(a,{default:function(){return oe}});var t=o(61758),l=o(58790),i={class:"row q-px-sm q-pt-sm"},r={class:"col-xs-12 col-md-2"},n={class:"col-xs-12 col-md-2"},s={class:"row q-px-sm col"},c={class:"col-xs-12 listaDetalle"},u={class:"col-10"},d={key:1,class:"column"},p={key:0},f={key:1},b={class:"row"},m={class:"col"},g={class:"q-ma-md-lg text-bold"},C={class:"row q-px-sm text-weight-bold text-warning"},h={class:"col-auto row flex-center"},v={class:"row"},O={class:"col"},S={key:1};function E(e,a){var o=(0,t.g2)("header-btn"),E=(0,t.g2)("q-select"),A=(0,t.g2)("q-spinner-oval"),T=(0,t.g2)("q-inner-loading"),R=(0,t.g2)("q-search"),D=(0,t.g2)("q-td"),I=(0,t.g2)("q-table"),k=(0,t.g2)("sie-vacio"),P=(0,t.g2)("q-card"),_=(0,t.g2)("sie-upload"),L=(0,t.g2)("q-icon"),x=(0,t.g2)("sie-modal"),F=(0,t.g2)("q-page");return(0,t.uX)(),(0,t.Wv)(F,{class:"bg-white"},{default:(0,t.k6)(function(){return[(0,t.bF)(P,null,{default:(0,t.k6)(function(){return[(0,t.bF)(o,{name:"Programa Especial",buttons:e.buttons},null,8,["buttons"]),(0,t.Lk)("div",i,[(0,t.Lk)("div",r,[(0,t.bF)(E,{class:"q-if-outlined",color:"secondary",modelValue:e.vmFiltro.idAmbito,"onUpdate:modelValue":a[0]||(a[0]=function(a){return e.vmFiltro.idAmbito=a}),options:e.dataSelect.ambito,"float-label":e.$t("ambito")},null,8,["modelValue","options","float-label"])]),(0,t.Lk)("div",n,[(0,t.bF)(E,{class:"q-if-outlined",color:"secondary",modelValue:e.vmFiltro.periodo,"onUpdate:modelValue":a[1]||(a[1]=function(a){return e.vmFiltro.periodo=a}),options:e.dataSelect.periodos,"float-label":e.$t("periodo")},null,8,["modelValue","options","float-label"])])]),(0,t.Lk)("div",s,[(0,t.Lk)("div",c,[(0,t.bF)(T,{visible:e.loadingDetalle},{default:(0,t.k6)(function(){return[(0,t.bF)(A,{size:"50px",color:"primary"})]}),_:1},8,["visible"]),e.dataDetalle.length>0?((0,t.uX)(),(0,t.Wv)(I,{key:0,style:{height:"calc(100vh - 155px)"},selection:e.configTblClase.tipoSeleccion,"row-key":"ID_CLASE",color:"secondary",data:e.dataDetalle,columns:e.configTblClase.columnas,selected:e.configTblClase.registrosSeleccionados,"onUpdate:selected":a[3]||(a[3]=function(a){return e.configTblClase.registrosSeleccionados=a}),pagination:e.configTblClase.paginacion,"onUpdate:pagination":a[4]||(a[4]=function(a){return e.configTblClase.paginacion=a}),filter:e.filtroTabla},{top:(0,t.k6)(function(o){return[(0,t.Lk)("div",u,[(0,t.bF)(R,{"hide-underline":"",color:"secondary",modelValue:e.filtroTabla,"onUpdate:modelValue":a[2]||(a[2]=function(a){return e.filtroTabla=a})},null,8,["modelValue"])])]}),"body-cell-CURSONOM":(0,t.k6)(function(e){return[(0,t.bF)(D,{props:e},{default:(0,t.k6)(function(){return[(0,t.eW)((0,l.v_)(e.row.CURSONOM),1)]}),_:2},1032,["props"])]}),"body-cell-PROFESOR":(0,t.k6)(function(e){return[(0,t.bF)(D,{class:"cursor-pointer",props:e},{default:(0,t.k6)(function(){return[(0,t.eW)((0,l.v_)(e.row.PROFESOR),1)]}),_:2},1032,["props"])]}),_:1},8,["selection","data","columns","selected","pagination","filter"])):((0,t.uX)(),(0,t.CE)("div",d,[(0,t.bF)(k,{icon:"settings_applications"})]))])])]}),_:1}),(0,t.bF)(x,{modelValue:e.openModal,"onUpdate:modelValue":a[5]||(a[5]=function(a){return e.openModal=a}),ok:e.lblBtn,"btn-load":e.btnLoad,escClick:!0,esc:!0,noClose:e.btnLoad,title:e.$t("registroDeNotas.importarRegNotasExcel"),header:!0,footer:!0,loading:e.loadingModal,onSubmit:e.importarArchivo},{default:(0,t.k6)(function(){return[e.verCargaXls?((0,t.uX)(),(0,t.CE)("div",p,[(0,t.bF)(_,{class:"no-wrap imagen",onUpload:e.added,allow:["xlsx"],icon:"file_excel"},null,8,["onUpload"])])):((0,t.uX)(),(0,t.CE)("div",f,[(0,t.Lk)("div",b,[(0,t.Lk)("div",m,[(0,t.Lk)("p",g,(0,l.v_)(e.lblImportar),1)])]),(0,t.Lk)("div",C,[(0,t.Lk)("div",h,[(0,t.bF)(L,{class:"q-mr-sm",name:"warning",size:"28px"})]),a[6]||(a[6]=(0,t.Lk)("div",{class:"col self-center"},[(0,t.Lk)("div",null,"Recalculando Notas... No cierre la ventana")],-1))]),(0,t.Lk)("div",v,[(0,t.Lk)("div",O,[(0,t.bF)(I,{class:"q-ma-sm","row-key":"ID_CLASE",color:"secondary",data:e.dataClasesImp,columns:e.tblClasesImp.columnas},{"body-cell-ESTADOPROCESO":(0,t.k6)(function(e){return[(0,t.bF)(D,{props:e},{default:(0,t.k6)(function(){return[1==e.value?((0,t.uX)(),(0,t.Wv)(L,{key:0,class:"text-green",name:"check",size:"24px"})):(0,t.Q3)("v-if",!0),0==e.value?((0,t.uX)(),(0,t.CE)("p",S,"-")):(0,t.Q3)("v-if",!0),-1==e.value?((0,t.uX)(),(0,t.Wv)(A,{key:2,color:"primary",size:"15px"})):(0,t.Q3)("v-if",!0)]}),_:2},1032,["props"])]}),_:1},8,["data","columns"])])])]))]}),_:1},8,["modelValue","ok","btn-load","noClose","title","loading","onSubmit"])]}),_:1})}var A=o(76080),T=o.n(A),R=o(8445),D=o.n(R),I=o(45254),k=o.n(I),P=o(99550),_=o.n(P),L=(o(71225),o(23825),o(10239),o(50310),o(5962),o(90095),o(92802),o(83190),o(27153),o(66307),o(13715),o(24066),o(6123)),x=o(30545),F=o(80660),M={getListaAmbito:function(){var e=k()(T()().m(function e(a){var o,t,l;return T()().w(function(e){while(1)switch(e.n){case 0:return o={salonesEspeciales:!0},a&&(o.ano=a),e.n=1,F.$http.get("api/HyoAmbito/obtListar",{params:o});case 1:return t=e.v,l=t.json,e.a(2,l)}},e)}));function a(a){return e.apply(this,arguments)}return a}(),getClaseDetalle:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return F.$http.get("api/HyoClase/obtListarCursosEspeciales",{params:{params:e}}).then(function(e){var a=e.json;return a}).catch(function(){return[]})},recalculoDesdeXls:function(e,a){return F.$http.post("api/HyoClaseNota/recalculoDesdeXls",{dataSalones:e,idClasePeriodo:a}).then(function(e){var a=e.json;return a})},getCursosOficiales:function(e){var a={instrucod:"S",gradocod:"5",arrCursos:e};return F.$http.get("api/HyoTipoCalculo/getCursoGrado",{params:a}).then(function(e){return e})},recalculoCursoOficial:function(e,a,o,t){return F.$http.put("api/HyoClasenota/recalcularDesdeOficial",{ano:e,nemos:[a],cursopad:o,periodo:t}).then(function(e){var a=e.json;return a})}},U=o(30640),Q=o(93616),w=o(80340),y=o(68777),N=o(13813),$=o(6583),q=(o(69027),o(982)),B=(o(33001),o(99637),o(2819)),X=o(57668),V=o(65229),G=o(81288),j=o(95523),W=o(9736),z=o(95477),H=o(23564),J=o(59089),K=o(33950),Z=o(33777),Y={directives:{sieActive:V.A},components:{QTime:H.A,QPopupProxy:z.A,sieInput:W.A,QCard:L.C$,QPopover:L.VM,QSearch:L.Ks,QModalLayout:L.hT,QCheckbox:L.vZ,QPageSticky:L._U,QInnerLoading:L.SQ,QSpinnerOval:L.VA,QToggle:L.c5,QFab:L.l6,QFabAction:L.B$,QSelect:L.Si,QTable:x.A,QTh:L.EJ,QTr:L.qh,QTd:L.Ef,QTableColumns:L.$s,QPopupEdit:L.GT,QTabs:L.uw,QTab:L.zu,QTabPane:L.dg,QChip:L.wQ,QOptionGroup:L.EX,sieModal:U.A,sieSelect:Q.A,sieVacio:w.A,virtualList:y.ET,selectMultiple:j.A,sieUpload:J.A,sieTable:Z.A,QPage:L.Tu,QIcon:L.bP},data:function(){return{sie:(0,X["default"])(),file:null,vmFiltro:{idAmbito:"",periodo:1,asignatura:1},dataSelect:{ambito:[],periodos:[]},dataDetalleTemp:[],vmEditar:{idClase:null,profe:null,replica:0,programa:null,periodos:[],profexPeriodo:!1,origenReplica:0,descripcion:""},openModal:!1,loadingDetalle:!1,loadingModal:!1,lblImportar:"",configTblClase:{},filtroTabla:"",tblClasesImp:{},dataClasesImp:[],verCargaXls:!0,btnLoad:!1,lblBtn:"Importar Archivo",buttons:[{label:"Importar",icon:"upload",click:this.abrirModal},{label:"Exportar",icon:"import_export_excel",click:this.exportarNotas}]}},computed:{dataDetalle:function(){var e=this,a=this.dataDetalleTemp;return this.loadingDetalle=!0,""!==this.vmFiltro.idAmbito?a=a.filter(function(a){return a.ID_AMBITO===e.vmFiltro.idAmbito}):"R"===this.vmFiltro.asignatura&&(a=a.filter(function(e){return parseInt(e.REPORTE)>0})),this.loadingDetalle=!1,a},isLess:function(){return(0,G.isLess)()}},methods:{init:function(){var e=this;Promise.all([M.getClaseDetalle(),M.getListaAmbito()]).then(function(a){var o=_()(a,2),t=o[0],l=o[1];e.dataDetalleTemp=t.data,e.dataSelect.ambito=(0,N["default"])(l,function(e){return{label:e.DESCRIPCION,value:e.ID_AMBITO}}),e.vmFiltro.idAmbito=l[0].ID_AMBITO,e.dataPeriodos(t.totPeriodos)})},dataPeriodos:function(e){this.dataSelect.periodos=[];for(var a=1;a<=e;a++)this.dataSelect.periodos.push({label:"PERIODO "+a,value:a})},configurarTablaClases:function(){var e={};e.columnas=[{name:"NGS",label:this.$t("ngs"),field:"NGS",align:"left",sortable:!0},{name:"DESCAMBITO",label:this.$t("ambito"),field:"DESCAMBITO",align:"left",sortable:!0},{name:"CURSONAT_DESC",label:this.$t("tipo"),field:"CURSONAT_DESC",align:"left",sortable:!0},{name:"CURSONOM",label:this.$t("curso"),field:"CURSONOM",align:"left",sortable:!0},{name:"GRUPO",label:this.$t("grupo"),field:"GRUPO",align:"center",sortable:!0},{name:"PROFESOR",label:this.$t("profesor"),field:"PROFESOR",align:"left",sortable:!0}],e.paginacion={page:1,rowsPerPage:500},e.registrosSeleccionados=[],e.tipoSeleccion="multiple",this.configTblClase=e},abrirModal:function(){this.openModal=!0,this.verCargaXls=!0,this.dataClasesImp=[],this.file=null,this.btnLoad=!1,this.lblBtn="Importar Archivo"},exportarNotas:function(){if(""===this.vmFiltro.idAmbito)(0,q["default"])(this.$t("validaciones.seleccioneSalon"),"error");else if(0===this.configTblClase.registrosSeleccionados.length)(0,q["default"])(this.$t("seleccioneCurso"),"error");else{var e=[];this.configTblClase.registrosSeleccionados.forEach(function(a){e.push(a.ID_CLASE)});var a={formato:"xlsx",repcod:"exportacionRegistro",idAmbito:this.vmFiltro.idAmbito,periodo:this.vmFiltro.periodo,idsClases:e,tipo:"notasPorSalon"};(0,B.exportFilePhp)(a,"webservice/reportes/reporte")}},added:function(e){this.file=e[0]},configurarTablaRecalculo:function(e,a){var o=this;return k()(T()().m(function t(){var l,i,r,n,s,c,u,d,p;return T()().w(function(t){while(1)switch(t.n){case 0:if(o.btnLoad=!0,o.verCargaXls=!1,l={},l.columnas=[{name:"CURSONOM",label:o.$t("curso"),field:"CURSONOM",align:"left",sortable:!0},{name:"GRUPO",label:o.$t("grupo"),field:"GRUPO",align:"center",sortable:!0},{name:"ESTADOPROCESO",label:o.$t("estado"),field:"ESTADOPROCESO",align:"left",sortable:!0}],o.tblClasesImp=l,i=D()(o.dataClasesImp),r="",n=[],s=!0,c="",o.dataDetalleTemp.forEach(function(a){var t=a.ID_CLASE;e.hasOwnProperty(t)&&(a["ESTADOPROCESO"]=0,a["ID_CLASE_PERIODO"]=e[t].id_clase_periodo,c=e[t].nemo,a["CURSOPAD"]&&null!==a["CURSOPAD"]&&n.push(a["CURSOPAD"]),r=parseInt(e[t].periodo),i.push(a),o.dataClasesImp=D()(i),s=a.PERICIE<r)}),!s){t.n=2;break}return t.n=1,M.getCursosOficiales(n);case 1:u=t.v,d=(0,$["default"])(u),d.length>0&&(d.forEach(function(e){e.ID_CLASE="CO-"+e.CURSOCOD,e.CURSONAT="O",e.NEMO=c,e.PERIODO=r,e.CURSONOM=e.CURSOCOD+"- "+e.CURSONOM,e.GRUPO="Curso Oficial",i.push(e)}),o.dataClasesImp=D()(i)),o.lblImportar="Importando notas al salón: "+i[0].DESCAMBITO+" periodo:"+r,p=i.reduce(function(e,t,l){return e.then(function(){var e;i[t["__index"]].ESTADOPROCESO=-1,o.dataClasesImp=D()(i),e="O"===i[t["__index"]].CURSONAT?M.recalculoCursoOficial(t.ANO,t.NEMO,t.CURSOCOD,r):M.recalculoDesdeXls(a[t.ID_CLASE_PERIODO],t.ID_CLASE_PERIODO);var l=e.then(function(e){return i[t["__index"]].ESTADOPROCESO=1,o.dataClasesImp=D()(i),e}).catch(console.log);return l})},Promise.resolve(1)),p.then(function(){(0,q["default"])(o.$t("mensajes.m0008"),"success"),o.btnLoad=!1,o.lblBtn="Cerrar"}).catch(function(e){(0,q["default"])(o.$t("mensajes.m0009"),"error"),o.deshabilitar=!1,o.btnLoad=!1,o.lblBtn="Cerrar"}),t.n=3;break;case 2:return(0,q["default"])("No se puede importar notas al salón: "+i[0].DESCAMBITO+" el periodo:"+r+" esta cerrado","error"),o.deshabilitar=!1,o.btnLoad=!1,o.lblBtn="Cerrar",o.openModal=!1,t.a(2,!1);case 3:return t.a(2)}},t)}))()},importarArchivo:function(){var e=this;if("Cerrar"===this.lblBtn)return this.openModal=!1,!1;this.loadingModal=!0;var a=this.file,o=(0,K.Basic)({root:!0,url:"webservice/reportes/reporte/repcod/importacionRegistro",file:a,data:{tipo:"notasPorSalon"}});o.then(function(a){e.loadingModal=!1,a.estado>=1?e.configurarTablaRecalculo(a.data,a.dataRetorno):(0,q["default"])(a.msjError,"warning")}).catch(function(a){e.loadingModal=!1,(0,q["default"])("error al subir archivo","error")})}},created:function(){this.init(),this.configurarTablaClases()}},ee=o(12807);const ae=(0,ee.A)(Y,[["render",E]]);var oe=ae}}]);