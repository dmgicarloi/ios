"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[12099],{12099:function(a,e,t){t.r(e),t.d(e,{default:function(){return T}});var o=t(61758),n=t(58790),r={class:"row justify-center q-mt-md"},s={class:"row justify-center q-mb-md"},i={class:"row"},l={class:"row"},u={key:1,class:"col"},c={class:"row justify-center q-mb-md"},d={class:"col q-ma-md"},m={class:"col q-ma-xs"};function f(a,e){var t=(0,o.g2)("q-select"),f=(0,o.g2)("q-input"),b=(0,o.g2)("q-btn"),h=(0,o.g2)("qr"),g=(0,o.g2)("q-item"),p=(0,o.g2)("q-item-separator"),E=(0,o.g2)("sie-usuario"),v=(0,o.g2)("q-item-side"),O=(0,o.g2)("q-item-tile"),R=(0,o.g2)("q-item-main"),C=(0,o.g2)("q-list"),k=(0,o.g2)("q-radio"),S=(0,o.g2)("sie-modal"),A=(0,o.g2)("q-page");return(0,o.uX)(),(0,o.Wv)(A,{class:"famAsis bg-white"},{default:(0,o.k6)(function(){return[e[6]||(e[6]=(0,o.Lk)("div",{class:"row justify-center q-ma-md"},[(0,o.Lk)("span",{class:"text-bold"},"Registro de Asistencia de Familia")],-1)),(0,o.Lk)("div",r,[(0,o.bF)(t,{class:"q-if-outlined",modelValue:a.modoRegistro,"onUpdate:modelValue":e[0]||(e[0]=function(e){return a.modoRegistro=e}),options:a.tipoLecturaObj,"stack-label":"Tipo de Lectura"},null,8,["modelValue","options"]),(0,o.bF)(f,{class:"q-if-outlined",modelValue:a.famcod,"onUpdate:modelValue":e[1]||(e[1]=function(e){return a.famcod=e}),autofocus:!0,"stack-label":"famcod"==a.modoRegistro?"Codigo de Familia":"DNI",onKeydown:a.registraPistola},null,8,["modelValue","stack-label","onKeydown"])]),(0,o.Lk)("div",s,[(0,o.Lk)("div",i,[(0,o.bF)(b,{label:a.estadoObj.label,color:a.estadoObj.color,onClick:a.abrirModal},null,8,["label","color","onClick"])])]),(0,o.Lk)("div",l,[!a.sinCamara&&a.modoRegistro?((0,o.uX)(),(0,o.Wv)(h,{key:0,class:"col",onLeeQr:a.leer},null,8,["onLeeQr"])):(0,o.Q3)("v-if",!0),a.hijos.length>0?((0,o.uX)(),(0,o.CE)("div",u,[e[4]||(e[4]=(0,o.Lk)("div",{class:"row justify-center"},null,-1)),(0,o.Lk)("div",c,[(0,o.bF)(C,null,{default:(0,o.k6)(function(){return[(0,o.bF)(g,{class:"text-bold q-pa-md",color:"secondary"},{default:(0,o.k6)(function(){return[(0,o.eW)((0,n.v_)(a.configTblListado.columns[0].label),1)]}),_:1}),(0,o.bF)(p),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.hijos,function(e,t){return(0,o.uX)(),(0,o.Wv)(g,{key:t,style:(0,n.Tr)({"background-color":"P"===e.ESTADO?"green":"#ffc107",color:"white"})},{default:(0,o.k6)(function(){return[(0,o.bF)(v,null,{default:(0,o.k6)(function(){return[(0,o.bF)(E,{usucod:e.USUCODALU},null,8,["usucod"])]}),_:2},1024),(0,o.bF)(R,null,{default:(0,o.k6)(function(){return[(0,o.bF)(O,{label:""},{default:(0,o.k6)(function(){return[(0,o.eW)((0,n.v_)(e.NOMBRES),1)]}),_:2},1024),(0,o.bF)(O,{sublabel:""},{default:(0,o.k6)(function(){return[(0,o.eW)((0,n.v_)(a.date(e.FH_REGISTRO,"DD/MM/YYYY hh:mm a")),1)]}),_:2},1024),(0,o.bF)(O,{sublabel:""},{default:(0,o.k6)(function(){return[(0,o.eW)((0,n.v_)(e.ESTADODES),1)]}),_:2},1024)]}),_:2},1024),(0,o.bF)(v,null,{default:(0,o.k6)(function(){return[(0,o.bF)(O,{label:""},{default:(0,o.k6)(function(){return[(0,o.eW)((0,n.v_)(e.USUNOM),1)]}),_:2},1024)]}),_:2},1024)]}),_:2},1032,["style"])}),128))]}),_:1})])])):(0,o.Q3)("v-if",!0)]),(0,o.bF)(S,{class:"sie-modal-adjuntos",modelValue:a.modalEstados,"onUpdate:modelValue":e[3]||(e[3]=function(e){return a.modalEstados=e}),title:"Estado actual",onSubmit:a.grabarModal},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",d,[e[5]||(e[5]=(0,o.Lk)("div",{class:"col"},[(0,o.Lk)("span",{class:"subtitle"},"Seleccione el estado con el que se marcaran las asistencias desde este momento")],-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.estados,function(t,n){return(0,o.uX)(),(0,o.CE)("div",m,[(0,o.bF)(k,{modelValue:a.preEstado,"onUpdate:modelValue":e[2]||(e[2]=function(e){return a.preEstado=e}),val:t.value,label:t.label,color:"secondary",onInput:function(e){return a.modificarEstado(n)}},null,8,["modelValue","val","label","onInput"])])}),256))])]}),_:1},8,["modelValue","onSubmit"])]}),_:1})}var b=t(76080),h=t.n(b),g=t(45254),p=t.n(g),E=(t(10239),t(56285),t(50310),t(90095),t(83190),t(27153),t(13715),t(51500)),v=t(6123),O=t(80660),R=t(57668),C=t(69027),k=t(30640),S=t(24974),A=t(18105),F=t(81288),L=t(23527),j=t(982),D=function(a){return(0,A.Ay)(a,"DD/MM/YYYY HH:mm:SS")},M={components:{QrcodeStream:E.tR,QrcodeCapture:E.Z3,QList:v.Mb,QListHeader:v.XR,QItem:v.H0,QItemMain:v.mF,QItemSeparator:v.CL,QItemSide:v.n1,QItemTile:v.lp,sieUsuario:S.A,QRadio:v.$,sieModal:k.A,QOptionGroup:v.EX,qr:L.A,QSelect:v.Si,QPage:v.Tu,QInput:v.ie,QBtn:v.Il},data:function(){return{now:new Date,sie:(0,R["default"])(),camera:"off",hijos:[],error:null,pregunta:!1,sinCamara:!1,configTblListado:{},famcod:"",modalEstados:!1,estados:[{label:"Presente",value:"P",color:"green"},{label:"Tardanza",value:"T",color:"amber"}],modoRegistro:"",tipoLecturaObj:[{label:"Codigo de Familia",value:"famcod"},{label:"DNI Padres",value:"DNI"}],estadoObj:{},estado:null,preEstado:null,preEstadoObj:null}},methods:{date:A.Ay,cargaInicial:function(){this.estadoObj=this.estados[0],this.estado=this.estados[0].value,this.preEstado=this.estados[0].value},cargaAsistencia:function(a){var e=this,t={};return"famcod"===this.modoRegistro?t.famcod=a:t.numdoc=a,new Promise(function(a,o){O.$http.get("api/HyoHorasisfam/obtAsistenciaFamilia",{params:t}).then(function(t){var o=t.json;o.length>0&&(e.configTblListado.columns[0].label="Familia: "+o[0].FAMDES,o.forEach(function(a){e.estados.forEach(function(e){e.value===a.ESTADO&&(a.ESTADODES=e.label)})})),a(o)}),e.famcod=null})},onInitQr:function(a){var e=this;return p()(h()().m(function t(){var o;return h()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,t.n=1,a;case 1:t.n=3;break;case 2:t.p=2,o=t.v,e.sinCamara=!0,"NotAllowedError"===o.name?e.error="ERROR: you need to grant camera access permisson":"NotFoundError"===o.name?e.error="ERROR: no camera on this device":"NotSupportedError"===o.name?e.error="ERROR: secure context required (HTTPS, localhost)":"NotReadableError"===o.name?e.error="ERROR: is the camera already in use?":"OverconstrainedError"===o.name?e.error="ERROR: installed cameras are not suitable":"StreamApiNotSupportedError"===o.name&&(e.error="ERROR: Stream API is not supported in this browser");case 3:return t.p=3,e.pregunta||(e.isLess?e.camera="auto":a&&a["_c"]?(0,C.dialogConfirm)({title:"Como desea Registrar su Asistencia ",ok:"Manualmente",cancel:"Camara"}).then(function(a){e.sinCamara=a,a||(e.camera="auto")}):e.sinCamara=!0,e.pregunta=!0),t.f(3);case 4:return t.a(2)}},t,null,[[0,2,3,4]])}))()},registraPistola:function(a){13===a.which&&this.leer(this.famcod)},leer:function(a,e){var t=this;a?(this.hijos=[],this.turnCameraOff(),this.cargaAsistencia(a).then(function(e){var o=e.length,n=[];if(e.forEach(function(a){a.ESTADO?o-=1:n.push(a)}),e.length>0)if(0===o){var r="La Familia "+e[0].FAMDES+" ya registr√≥ su asistencia anteriormente";t.sinCamara?((0,j["default"])(r,"error"),t.cargaAsistencia(a).then(function(a){t.hijos=a,t.turnCameraOn()})):(0,C.dialogConfirm)({title:r,ok:"Aceptar",cancel:!1}).then(function(e){e&&t.cargaAsistencia(a).then(function(a){t.hijos=a,t.turnCameraOn()})})}else t.registraAsistencia(n);else{var s="La Familia No tiene Hijos Disponibles";t.sinCamara?(0,j["default"])(s,"error"):((0,C.alertModal)(s),t.turnCameraOn())}})):this.sinCamara=e},registraAsistencia:function(a){var e=this,t=[],o="famcod"===this.modoRegistro?a[0].FAMCOD:a[0].DOCIDE;a.forEach(function(a){t.push({ALUCOD:a.ALUCOD,NEMO:a.NEMO})}),O.$http.post("api/HyoHorasisfam/registrarAsistencia",{arrAlumnos:t,estado:this.estado}).then(function(t){var n=t.json;if(e.sinCamara){var r=e.$t(n);"asistenciaConfirmada"===n&&(r=r+" de la Familia "+a[0].FAMDES),(0,j["default"])(r,"success")}"asistenciaConfirmada"===n?e.cargaAsistencia(o).then(function(a){e.hijos=a}):(0,j["default"])(e.$t(n),"error")})},turnCameraOff:function(){this.sinCamara||(this.camera="off")},turnCameraOn:function(){this.sinCamara||(this.camera="auto")},creaTabla:function(){var a={};a.columns=[{name:"NOMBRES",field:"NOMBRES",align:"left"},{name:"FH_REGISTRO",field:"FH_REGISTRO",align:"center",format:D},{name:"USUNOM",field:"USUNOM",align:"center"}],a.paginacion={page:1,rowsPerPage:500},a.registrosSeleccionados=[],a.filter="",a.estado="T",this.configTblListado=a},abrirModal:function(){this.preEstado=this.estadoObj.value,this.modalEstados=!0},modificarEstado:function(a){this.preEstadoObj=this.estados[a]},grabarModal:function(){this.estadoObj=this.preEstadoObj,this.estado=this.preEstadoObj.value,this.modalEstados=!1}},computed:{isLess:function(){return(0,F.isLess)()}},created:function(){this.creaTabla(),this.cargaInicial(),this.modoRegistro=this.tipoLecturaObj[0].value}},q=t(12807);const w=(0,q.A)(M,[["render",f]]);var T=w}}]);