"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[8540],{8540:function(e,t,n){n.r(t),n.d(t,{default:function(){return ie}});var o=n(8445),r=n.n(o),a=n(61758),c=n(58790),i={class:"intranet--control-pases-evento col column q-pa-sm"},s={ref:"audioOk",src:"statics/sound/ok.mp3"},u={ref:"audioInfo",src:"statics/sound/duplicate.mp3"},l={ref:"audioError",src:"statics/sound/error.mp3"},d={class:"row q-col-gutter-lg items-center"},f={key:0,class:"col-12 q-mt-xs"},v={class:"col-12"},m={class:"col-md-4 col-xs-6"},g={class:"col-md-4 col-xs-6"},k={class:"col-md-4 col-xs-12 row justify-center"},p={class:"col-md-6 col-xs-12"},b={class:"q-pa-md q-gutter-sm"},h={class:"row justify-center"},A={class:"col col-6"},w={key:0,class:"col"},q={key:0,class:"row contador absolute full-height full-width items-center justify-center"},C={class:"col-md-6 col-xs-12"},L={class:"row q-col-gutter-md"},F={class:"col-12 row justify-center"},I={class:"col-12"},E={class:"row justify-center"},_={class:"text-center"},Q={class:"col-12"},y={class:"row justify-center"},x={class:"q-caption"};function O(e,t){var n=(0,a.g2)("header-btn"),o=(0,a.g2)("q-select"),O=(0,a.g2)("q-item-label"),M=(0,a.g2)("q-item-section"),R=(0,a.g2)("q-item"),U=(0,a.g2)("q-clock"),D=(0,a.g2)("q-input"),S=(0,a.g2)("qr"),N=(0,a.g2)("sie-usuario"),W=(0,a.g2)("q-card-section"),X=(0,a.g2)("q-card"),Y=(0,a.g2)("sie-vacio"),$=(0,a.g2)("q-scroll-area"),T=(0,a.g2)("q-page");return(0,a.uX)(),(0,a.Wv)(T,null,{default:(0,a.k6)(function(){return[(0,a.Lk)("div",i,[(0,a.Lk)("audio",s,null,512),(0,a.Lk)("audio",u,null,512),(0,a.Lk)("audio",l,null,512),(0,a.bF)(X,{class:"col column",dense:"",flat:"",bordered:""},{default:(0,a.k6)(function(){return[(0,a.bF)(n,{name:"Control de pases"}),(0,a.bF)(W,{class:"col column"},{default:(0,a.k6)(function(){return[e.conEventos?((0,a.uX)(),(0,a.Wv)($,{key:0,class:"col"},{default:(0,a.k6)(function(){return[(0,a.Lk)("div",d,[e.soloUnEvento?(0,a.Q3)("v-if",!0):((0,a.uX)(),(0,a.CE)("div",f,[(0,a.bF)(o,{outlined:"","emit-value":"",modelValue:e.idcronograma,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.idcronograma=t}),label:"Seleccionar Evento","option-label":"TITULO","option-value":"IDCRONOGRAMA",options:e.eventos},null,8,["modelValue","options"])])),e.idcronograma?((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.Lk)("div",v,[(0,a.bF)(R,null,{default:(0,a.k6)(function(){return[(0,a.bF)(M,null,{default:(0,a.k6)(function(){return[(0,a.bF)(O,{class:"text-weight-bold text-center uppercase q-card-title",overline:""},{default:(0,a.k6)(function(){return[(0,a.eW)((0,c.v_)(e.dataEvento.TITULO),1)]}),_:1})]}),_:1})]}),_:1})]),(0,a.Lk)("div",m,[(0,a.bF)(O,{class:"text-weight-bold",overline:""},{default:(0,a.k6)(function(){return r()(t[2]||(t[2]=[(0,a.eW)("FECHA DE INICIO",-1)]))}),_:1}),(0,a.bF)(O,{class:"q-caption",caption:""},{default:(0,a.k6)(function(){return[(0,a.eW)((0,c.v_)(e.formatoFecha(e.dataEvento.FECINI,"DD/MM/YYYY hh:mm a")),1)]}),_:1})]),(0,a.Lk)("div",g,[(0,a.bF)(O,{class:"text-weight-bold",overline:"",lines:"1"},{default:(0,a.k6)(function(){return r()(t[3]||(t[3]=[(0,a.eW)("FECHA DE FINALIZACIÃ“N",-1)]))}),_:1}),(0,a.bF)(O,{class:"q-caption",caption:""},{default:(0,a.k6)(function(){return[(0,a.eW)((0,c.v_)(e.formatoFecha(e.dataEvento.FECFIN,"DD/MM/YYYY hh:mm a")),1)]}),_:1})]),(0,a.Lk)("div",k,[(0,a.bF)(U,{size:"36px"})]),(0,a.Lk)("div",p,[(0,a.Lk)("div",b,[(0,a.Lk)("div",h,[(0,a.Lk)("div",A,[(0,a.bF)(D,{modelValue:e.codigo,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.codigo=t}),autofocus:!0,label:"Usuario",onKeydown:e.registraPistola},null,8,["modelValue","onKeydown"])])]),e.sinCamara?(0,a.Q3)("v-if",!0):((0,a.uX)(),(0,a.CE)("div",w,[(0,a.bF)(S,{onLeeQr:e.leerRegistro,cargaAnterior:e.cargaAnterior,continuo:""},{default:(0,a.k6)(function(){return[e.contador?((0,a.uX)(),(0,a.CE)("div",q,"Espere ...")):(0,a.Q3)("v-if",!0)]}),_:1},8,["onLeeQr","cargaAnterior"])]))])]),(0,a.Lk)("div",C,[e.cardMostrar?((0,a.uX)(),(0,a.Wv)(X,{key:0,dense:"",flat:"",bordered:""},{default:(0,a.k6)(function(){return[(0,a.bF)(W,null,{default:(0,a.k6)(function(){return[(0,a.Lk)("div",L,[(0,a.Lk)("div",F,[(0,a.bF)(N,{usucod:e.dataAsistencia.USUCOD,size:"xll"},null,8,["usucod"])]),(0,a.Lk)("div",I,[(0,a.Lk)("div",E,[(0,a.Lk)("div",_,(0,c.v_)(e.dataAsistencia.USUNOM),1)])]),(0,a.Lk)("div",Q,[(0,a.Lk)("div",y,[(0,a.Lk)("div",x,(0,c.v_)(e.dataAsistencia.FH_REGISTRO),1)])])])]}),_:1})]}),_:1})):((0,a.uX)(),(0,a.Wv)(X,{key:1,dense:"",flat:"",bordered:""},{default:(0,a.k6)(function(){return[(0,a.bF)(W,null,{default:(0,a.k6)(function(){return[(0,a.bF)(Y,{class:"col column",icon:"person",title:"Marque su asistencia",subtitle:"Ingrese su usuario o permita la lectura de un QR"})]}),_:1})]}),_:1}))])],64)):(0,a.Q3)("v-if",!0)])]}),_:1})):((0,a.uX)(),(0,a.Wv)(Y,{key:1,class:"col column",subtitle:"No existen eventos registrados",icon:"calendar_plus_o"}))]}),_:1})]}),_:1})])]}),_:1})}var M=n(76080),R=n.n(M),U=n(45254),D=n.n(U),S=n(6123),N=n(80340),W=n(65818),X=n(23527),Y=n(24974),$=n(16648),T=n(9736),V=n(88567),j=n(95718),B=n(82327),G=n(88865),P=n(66824),H=n(12205),K=n(18105),z=n(982),Z=n(78786),J=n(84262),ee=n(87725),te=n(80660),ne={registrarAsistencia:function(e){return D()(R()().m(function t(){return R()().w(function(t){while(1)switch(t.n){case 0:return t.a(2,te.$http.post("api/cronograma/registrarAsistencia",e))}},t)}))()},obtConfiguracion:function(){return D()(R()().m(function e(){return R()().w(function(e){while(1)switch(e.n){case 0:return e.a(2,te.$http.get("api/cronograma/getConfiguration"))}},e)}))()}},oe=ne,re={computed:{dataEvento:function(){var e=(0,Z["default"])(this.eventos,this.idcronograma,{key:"IDCRONOGRAMA"});return this.eventos[e]}},components:{Qr:X.A,SieVacio:N.A,SieUsuario:Y.A,QClock:W.A,QInput:T.A,QSelect:$.A,QCard:V.A,QCardSection:j.A,QItem:B.A,QItemSection:G.A,QItemLabel:P.A,QScrollArea:H.A,QPage:S.Tu},data:function(){return{eventos:[],idcronograma:null,soloUnEvento:!1,conEventos:!1,now:new Date,tipoLectura:"qr",sinCamara:!1,cargaAnterior:!1,camera:"auto",codigo:"",dataAsistencia:{},cardMostrar:!1,bloqueado:!1,tiempoBloqueo:0,contador:0,intervalId:null,continuo:!1}},methods:{formatoFecha:function(e,t){return(0,K.Ay)(e,t)},proccessQR:function(e){var t=this;return D()(R()().m(function n(){var o,r,a,c,i;return R()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,o={idcronograma:t.idcronograma,codigo:e},n.n=1,oe.registrarAsistencia(o);case 1:r=n.v,a=r.success,c=r.data,t.dataAsistencia=c,t.cardMostrar=!0,t.$refs.audioOk.play(),(0,z["default"])(a,"success"),n.n=3;break;case 2:n.p=2,i=n.v,t.$refs.audioError.play(),t.cardMostrar=!1,(0,z["default"])(i.error.message,"error");case 3:setTimeout(function(){t.cardMostrar=!1},9e3);case 4:return n.a(2)}},n,null,[[0,2]])}))()},leerRegistro:function(e,t){var n=this;return D()(R()().m(function o(){return R()().w(function(o){while(1)switch(o.n){case 0:if(e&&e.indexOf("|")>=0&&(e=e.split("|")[0]),!n.bloqueado){o.n=1;break}return o.a(2);case 1:if(n.bloqueado=n.continuo,!e){o.n=3;break}return o.n=2,n.proccessQR(e.toUpperCase());case 2:o.n=4;break;case 3:n.sinCamara=t;case 4:if(n.cargaAnterior=!0,n.codigo=null,!n.bloqueado){o.n=6;break}return n.contador=n.tiempoBloqueo/1e3,n.iniciarContador(),o.n=5,(0,J.wait)(n.tiempoBloqueo);case 5:n.bloqueado=!1;case 6:return o.a(2)}},o)}))()},registraPistola:function(e){13===e.which&&this.leerRegistro(this.codigo)},selected:function(){this.$refs.input.$el&&this.$refs.input.$el.querySelector("input").select()},init:function(){var e=this;return D()(R()().m(function t(){var n,o,r;return R()().w(function(t){while(1)switch(t.n){case 0:return n={api:"controlPaseEvento"},t.n=1,ee.A.getEventos(n);case 1:return o=t.v,o.length&&(e.conEventos=!0,1===o.length&&(e.soloUnEvento=!0,e.idcronograma=o[0].IDCRONOGRAMA)),e.eventos=o,t.n=2,oe.obtConfiguracion();case 2:r=t.v,e.continuo=r.lecturaQrContinua,e.tiempoBloqueo=1e3*r.intervaloLecturaQr;case 3:return t.a(2)}},t)}))()},iniciarContador:function(){var e=this;(0,J.startCountdown)({getContador:function(){return e.contador},setContador:function(t){e.contador=t},getIntervalId:function(){return e.intervalId},setIntervalId:function(t){e.intervalId=t}})}},created:function(){this.init()}},ae=n(12807);const ce=(0,ae.A)(re,[["render",O]]);var ie=ce}}]);