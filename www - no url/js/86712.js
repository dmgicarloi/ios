"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[86712],{86712:function(e,t,a){a.r(t),a.d(t,{default:function(){return N}});var r=a(8445),n=a.n(r),o=a(61758),s=a(58790),i={class:"row justify-center"},c={class:"col-12"},l={class:"row items-center justify-center q-mb-lg"},u={class:"row items-center q-mb-md"},d={class:"row items-center justify-between"},g={class:"col-auto"},f={key:0,class:"row q-mt-sm"},v={class:"col"},m={class:"row q-mt-lg"},p={class:"col"},b={key:0,class:"col"},F={class:"info-box q-mb-sm text-primary"},k={class:"row items-center justify-center"},w={class:"text-subtitle1 text-weight-medium"},h={class:"row items-center justify-center"},x={key:1,class:"col"},q={class:"row items-center justify-center"};function A(e,t){var a=(0,o.g2)("q-tooltip"),r=(0,o.g2)("q-btn"),A=(0,o.g2)("header-btn"),L=(0,o.g2)("q-icon"),T=(0,o.g2)("q-card-section"),C=(0,o.g2)("q-card"),E=(0,o.g2)("q-toggle"),S=(0,o.g2)("q-banner"),_=(0,o.g2)("q-page");return(0,o.uX)(),(0,o.Wv)(_,{class:"q-pa-sm"},{default:(0,o.k6)(function(){return[(0,o.bF)(A,{class:"q-mb-sm",name:"2FA"},{beforeText:(0,o.k6)(function(){return[(0,o.bF)(r,{icon:"arrow_back",flat:"",round:"",size:"md",color:"primary",onClick:t[0]||(t[0]=function(t){return e.$router.go(-1)})},{default:(0,o.k6)(function(){return[(0,o.bF)(a,null,{default:(0,o.k6)(function(){return n()(t[1]||(t[1]=[(0,o.eW)("Volver",-1)]))}),_:1})]}),_:1})]}),_:1}),(0,o.Lk)("div",i,[(0,o.Lk)("div",c,[e.colegioActivo2FA?((0,o.uX)(),(0,o.Wv)(C,{key:1,class:"q-pa-md"},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",u,[(0,o.bF)(L,{class:"q-mr-md",name:"security",size:"xx-large",color:"primary"}),t[6]||(t[6]=(0,o.Lk)("div",{class:"col"},[(0,o.Lk)("p",{class:"q-ma-none text-weight-bold"},"Verificación en dos pasos (2FA)")],-1))]),t[14]||(t[14]=(0,o.Lk)("div",{class:"row q-mb-lg"},[(0,o.Lk)("div",{class:"col"},[(0,o.Lk)("p",{class:"q-ma-none text-grey-7"},"Cuando inicie sesión, se le pedirá un código de 6 dígitos que estará disponible en su correo seguro.")])],-1)),(0,o.Lk)("div",d,[t[7]||(t[7]=(0,o.Lk)("div",{class:"col-auto"},[(0,o.Lk)("div",{class:"text-subtitle1 text-weight-medium"},"Estado actual:")],-1)),(0,o.Lk)("div",g,[(0,o.bF)(E,{modelValue:e.isTwoFactorEnabled,label:e.isTwoFactorText,"true-value":1,disable:!e.colegioActivo2FA||e.activacionForzada,"false-value":0,color:"primary",size:"lg",onInput:e.handleToggleInput},null,8,["modelValue","label","disable","onInput"])])]),e.activacionForzada?((0,o.uX)(),(0,o.CE)("div",f,[(0,o.Lk)("div",v,[(0,o.bF)(S,{class:"bg-grey-2 text-grey-8",dense:"",rounded:""},{default:(0,o.k6)(function(){return[(0,o.bF)(L,{class:"q-mr-sm",name:"lock",color:"grey-7",size:"20px"}),t[8]||(t[8]=(0,o.Lk)("span",{class:"text-caption"},"Esta opción es administrada por su organización.",-1))]}),_:1})])])):(0,o.Q3)("v-if",!0),(0,o.Lk)("div",m,[(0,o.Lk)("div",p,[(0,o.bF)(C,{class:(0,s.C4)(["text-white",1===e.isTwoFactorEnabled?"bg-positive":"bg-warning"]),flat:""},{default:(0,o.k6)(function(){return[(0,o.bF)(T,{class:"text-center"},{default:(0,o.k6)(function(){return[(0,o.bF)(L,{class:"q-mb-sm",name:1===e.isTwoFactorEnabled?"check_circle":"warning",size:"30px"},null,8,["name"]),1===e.isTwoFactorEnabled?((0,o.uX)(),(0,o.CE)("div",b,[t[11]||(t[11]=(0,o.Lk)("div",{class:"text-h6 text-weight-bold q-mb-xs"},"2FA Activado",-1)),(0,o.Lk)("div",F,[(0,o.Lk)("div",k,[(0,o.bF)(L,{class:"q-mr-xs",name:"email",size:"sm"}),t[9]||(t[9]=(0,o.Lk)("div",{class:"text-body2"},"Correo Seguro:",-1))]),(0,o.Lk)("div",w,(0,s.v_)(e.correoSeguro),1)]),(0,o.Lk)("div",h,[(0,o.bF)(L,{class:"q-mr-xs",name:"verified",size:"20px"}),t[10]||(t[10]=(0,o.Lk)("div",{class:"text-caption"},"Su cuenta tiene protección adicional",-1))])])):((0,o.uX)(),(0,o.CE)("div",x,[t[13]||(t[13]=(0,o.Lk)("div",{class:"text-h6 text-weight-bold q-mb-xs"},"2FA Desactivado",-1)),(0,o.Lk)("div",q,[(0,o.bF)(L,{class:"q-mr-xs",name:"info",size:"20px"}),t[12]||(t[12]=(0,o.Lk)("div",{class:"text-caption"},"Active 2FA para mayor seguridad",-1))])]))]}),_:1})]}),_:1},8,["class"])])])]}),_:1})):((0,o.uX)(),(0,o.Wv)(C,{key:0,class:"q-pa-md"},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",l,[(0,o.bF)(L,{class:"q-mr-md",name:"admin_panel_settings",size:"xx-large",color:"orange"}),t[2]||(t[2]=(0,o.Lk)("div",{class:"col text-center"},[(0,o.Lk)("p",{class:"q-ma-none text-h6 text-weight-bold text-orange"},"Función no disponible")],-1))]),(0,o.bF)(C,{class:"bg-orange-1 q-pa-lg text-center"},{default:(0,o.k6)(function(){return[(0,o.bF)(T,null,{default:(0,o.k6)(function(){return[(0,o.bF)(L,{class:"q-mb-md",name:"settings_applications",size:"60px",color:"orange"}),t[3]||(t[3]=(0,o.Lk)("div",{class:"text-h6 text-weight-bold q-mb-md text-orange-9"},"La verificación en dos pasos (2FA) no está habilitada",-1)),t[4]||(t[4]=(0,o.Lk)("div",{class:"text-body1 q-mb-lg text-grey-8"},"Esta función debe ser activada a nivel del sistema por el administrador antes de poder utilizarla.",-1))]}),_:1})]}),_:1}),(0,o.bF)(T,{class:"text-center q-pt-lg"},{default:(0,o.k6)(function(){return n()(t[5]||(t[5]=[(0,o.Lk)("div",{class:"text-caption text-grey-6"},"Una vez activado por el administrador, podrá configurar su verificación en dos pasos desde esta sección.",-1)]))}),_:1})]}),_:1}))])])]}),_:1})}var L=a(76080),T=a.n(L),C=a(45254),E=a.n(C),S=(a(10239),a(6123)),_=a(80660),y=a(88567),z=a(57668),I=a(11654),O=a(982),R=a(41615),Q={components:{QCard:y.A,QBtn:I.A,QPage:S.Tu,QTooltip:S.nC,QIcon:S.bP,QToggle:S.c5},data:function(){return{sieInfo:(0,z["default"])(),isTwoFactorEnabled:0,correoSeguro:"",colegioActivo2FA:"",showDialog:!1,activacionForzada:!1}},methods:{onToggleChange:function(){var e=this;return E()(T()().m(function t(){var a,r;return T()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,t.n=1,_.$http.post("api/ControlLoginController/activar2Fa",{params:{status:e.isTwoFactorEnabled,usucod:e.sieInfo.usucod}});case 1:return a=1===e.isTwoFactorEnabled?"Verificación de 2 factores activada.":"Verificación de 2 factores desactivada.",t.n=2,e.getCorreoSeguro();case 2:(0,O["default"])(a,"success"),t.n=5;break;case 3:return t.p=3,r=t.v,t.n=4,e.getCole2Fa();case 4:e.colegioActivo2FA=t.v,(0,O["default"])(r.message||"Ocurrió un problema.","warning");case 5:return t.a(2)}},t,null,[[0,3]])}))()},forzar2Fa:function(){var e=this;return E()(T()().m(function t(){var a,r;return T()().w(function(t){while(1)switch(t.n){case 0:return a={ID_CONSTANTE:[R["default"].CONSTANTES_SISTEMA.G_FORZAR_2FA]},t.n=1,R["default"].API_CONSTANTES_SISTEMAS(a);case 1:r=t.v,e.activacionForzada=r.G_FORZAR_2FA;case 2:return t.a(2)}},t)}))()},get2FaStatus:function(){var e=this;return E()(T()().m(function t(){var a,r;return T()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,t.n=1,_.$http.get("api/ControlLoginController/get2FaStatus",{params:{usucod:e.sieInfo.usucod}});case 1:return a=t.v,t.a(2,a.STATUS);case 2:t.p=2,r=t.v,console.error("Error fetching 2FA status:",r);case 3:return t.a(2)}},t,null,[[0,2]])}))()},getCole2Fa:function(){return E()(T()().m(function e(){var t,a;return T()().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,e.n=1,_.$http.get("api/ControlLoginController/getCole2Fa");case 1:return t=e.v,e.a(2,t.STATUS);case 2:e.p=2,a=e.v,console.error("Error fetching 2FA status:",a);case 3:return e.a(2)}},e,null,[[0,2]])}))()},getCorreoSeguro:function(){var e=this;return E()(T()().m(function t(){var a,r;return T()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,console.log("componente 2fa"),t.n=1,_.$http.get("api/SeguridadCorreoController/getCorreoSeguroPorUsuario",{params:{usucod:e.sieInfo.usucod}});case 1:return a=t.v,e.correoSeguro=a.CORREO,t.a(2,a.CORREO);case 2:return t.p=2,r=t.v,console.error("Error fetching seguridad correo status:",r),t.a(2,!1)}},t,null,[[0,2]])}))()},handleToggleInput:function(e){var t=this;return E()(T()().m(function a(){var r,n,o,s;return T()().w(function(a){while(1)switch(a.n){case 0:if(r=t.isTwoFactorEnabled,n=1===r&&0===e,!n){a.n=2;break}return a.n=1,t.$confirmar("¿Está seguro de desactivar la verificación en dos pasos?","warning");case 1:if(o=a.v,o){a.n=2;break}return a.a(2);case 2:if(n){a.n=4;break}return a.n=3,t.getCorreoSeguro();case 3:if(s=a.v,s){a.n=4;break}return(0,O["default"])("Debe configurar un correo seguro antes de activar la verificación en dos pasos.","warning"),a.a(2);case 4:return t.isTwoFactorEnabled=e,a.n=5,t.onToggleChange();case 5:return a.a(2)}},a)}))()}},computed:{isTwoFactorText:function(){return 1===this.isTwoFactorEnabled?"Activado":"Desactivado"}},mounted:function(){var e=this;return E()(T()().m(function t(){return T()().w(function(t){while(1)switch(t.n){case 0:return(0,z["default"])().profcod||e.$router.push("/login"),t.n=1,e.forzar2Fa();case 1:return t.n=2,e.get2FaStatus();case 2:return e.isTwoFactorEnabled=t.v,t.n=3,e.getCole2Fa();case 3:if(e.colegioActivo2FA=t.v,1!==e.isTwoFactorEnabled){t.n=4;break}return t.n=4,e.getCorreoSeguro();case 4:return t.a(2)}},t)}))()}},$=a(12807);const j=(0,$.A)(Q,[["render",A]]);var N=j}}]);