"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[68881],{68881:function(e,r,a){a.r(r),a.d(r,{default:function(){return _}});var o=a(8445),s=a.n(o),t=a(61758),n=a(29104),l=a(58790),i={class:"column botoncito q-px-md"},c={class:"row q-pl-sm q-pt-sm"},u={class:"col"},p={class:"row"},d={class:"row q-col-gutter-sm"},f={class:"col-12 row q-gutter-sm"},g={class:"text-h6"},b={class:"col-12"},m={class:"absolute-full flex flex-center"};function v(e,r){var a=(0,t.g2)("header-btn"),o=(0,t.g2)("q-option-group"),v=(0,t.g2)("q-select"),h=(0,t.g2)("sie-table"),P=(0,t.g2)("q-bar"),k=(0,t.g2)("q-icon"),C=(0,t.g2)("q-linear-progress"),q=(0,t.g2)("q-badge"),Q=(0,t.g2)("q-card-section"),U=(0,t.g2)("q-btn"),$=(0,t.g2)("q-card-actions"),w=(0,t.g2)("q-card"),y=(0,t.g2)("q-dialog");return(0,t.uX)(),(0,t.CE)("div",i,[(0,t.bF)(a,{name:"Generación de claves aleatorias",buttons:e.buttons},null,8,["buttons"]),(0,t.Lk)("div",c,[(0,t.Lk)("div",null,[(0,t.bF)(o,{class:"q-if-outlined",modelValue:e.option,"onUpdate:modelValue":r[0]||(r[0]=function(r){return e.option=r}),options:e.opciones,inline:"",onInput:e.cambiaPerfilUsuario},null,8,["modelValue","options","onInput"])]),(0,t.Lk)("div",u,[(0,t.bo)((0,t.bF)(v,{class:"q-if-outlined",modelValue:e.selectModel,"onUpdate:modelValue":r[1]||(r[1]=function(r){return e.selectModel=r}),options:e.Perfiles,all:!0,onInput:e.seleccionar,"float-label":e.$t("seguridad.perfiles")},null,8,["modelValue","options","onInput","float-label"]),[[n.aG,"Usuario"==e.option]])])]),(0,t.bF)(h,{ref:"tablaPerfiles",dense:"",flat:"",bordered:"","wrap-cells":"",css:"height: calc(100vh - 200px)","show-search":!0,context:this,columns:e.columns,data:e.dataTable,selection:"multiple"},null,8,["columns","data"]),(0,t.bF)(y,{modelValue:e.inProgress,"onUpdate:modelValue":r[3]||(r[3]=function(r){return e.inProgress=r}),persistent:""},{default:(0,t.k6)(function(){return[(0,t.bF)(w,{class:"clave--component-aleatoria"},{default:(0,t.k6)(function(){return[(0,t.bF)(P,{class:"row bg-primary text-white"},{default:(0,t.k6)(function(){return s()(r[4]||(r[4]=[(0,t.Lk)("div",{class:"col"},"SieWeb",-1)]))}),_:1}),(0,t.Lk)("div",p,[(0,t.bF)(k,{class:"q-icon-ticket",name:"account_key",size:"40px",color:"primary"}),(0,t.bF)(Q,{class:"col"},{default:(0,t.k6)(function(){return[(0,t.Lk)("div",d,[(0,t.Lk)("div",f,[(0,t.Lk)("div",g,(0,l.v_)(e.messageProgress),1)]),(0,t.Lk)("div",b,[(0,t.bF)(C,{size:"50px",value:e.progress,color:"secondary",rounded:"",stripe:""},null,8,["value"]),(0,t.Lk)("div",m,[(0,t.bF)(q,{color:"white","text-color":"primary",label:e.progressLabel},null,8,["label"])])])])]}),_:1})]),(0,t.bF)($,{align:"right"},{default:(0,t.k6)(function(){return[(0,t.bF)(U,{size:"sm",label:"Cerrar",color:"primary",onClick:r[2]||(r[2]=function(r){return e.inProgress=!1}),disable:!e.complete},null,8,["disable"])]}),_:1})]}),_:1})]}),_:1},8,["modelValue"])])}var h=a(76080),P=a.n(h),k=a(45254),C=a.n(k),q=(a(71225),a(52133),a(10239),a(50310),a(5962),a(6724),a(15547),a(83190),a(6123)),Q=a(24729),U=a(93616),$=a(80660),w=a(69027),y=a(42205),F=a(88567),T=a(95718),A=a(20456),S=a(11654),L=a(62565),x=a(34963),M=a(34262),G=a(41126),I={emits:["save"],components:{Dialog:Q.A,QOptionGroup:q.EX,QTh:q.EJ,QTr:q.qh,QTd:q.Ef,QTableColumns:q.$s,QFab:q.l6,QFabAction:q.B$,QPageSticky:q._U,QTable:q.kH,QRadio:q.$,QSelect:q.Si,sieSelect:U.A,QDialog:y.A,QCard:F.A,QCardSection:T.A,QCardActions:A.A,QBtn:S.A,QBadge:L.A,QLinearProgress:x.A,QIcon:M.A,QBar:G.A},data:function(){return{opciones:[{label:"Usuarios",value:"Usuario"},{label:"Perfiles",value:"Perfiles"}],selectModel:[],selectedTable:[],dataTable:[],Perfiles:[],Usuario:[],option:"Perfiles",botones:!0,selection:"multiple",columns:[{name:"value",label:"Código",field:"value",align:"center",sortable:!0},{name:"label",label:"Nombre",field:"label",align:"left",sortable:!0}],pagination:{page:1,rowsPerPage:500},progress:0,complete:!1,inProgress:!1,messageProgress:"Se está preparando para inciar el proceso..."}},computed:{progressLabel:function(){return"".concat((100*this.progress).toFixed(2)," %")},buttons:function(){var e=[{label:"Generar clave",icon:"settings",click:this.generarClave},{label:"Enviar claves a los correos",icon:"email",click:this.enviarCorreo},{label:"Restaurar clave anterior",icon:"restore",click:this.revertir}];return e}},methods:{cambiaPerfilUsuario:function(e){this.dataTable=this[e],this.selectedTable=[],this.selectModel=[]},seleccionar:function(e){this.dataTable=this.Usuario.filter(function(r){return r.tipcod===e})},generarClave:function(){var e=this;return C()(P()().m(function r(){var a,o,s,t,n,l,i,c,u,p;return P()().w(function(r){while(1)switch(r.p=r.n){case 0:return a=e.$refs.tablaPerfiles.rowsSelected().map(function(e){return e.value}),r.n=1,e.$confirmar("Esta seguro de realizar el Proceso. ¿Desea continuar?","info");case 1:if(o=r.v,!o){r.n=5;break}return r.p=2,e.errores=[],e.progress=0,e.complete=!1,e.noGenerarPase=!1,e.inProgress=!0,e.messageProgress="Se está preparando para inciar el proceso...",r.n=3,(0,$.streamFetch)("api/Hyo".concat(e.option,"/generarClaveAleatoria"),{method:"POST",data:{pryKeys:a}},function(r){if(r&&"error"in r){e.inProgress=!1;var a=r.error;e.$alert(a.message,"info"),e.complete=!0}if(r&&"progress"in r){e.messageProgress="Generando claves...";var o=r.progress;e.progress=o.progress/o.total}});case 3:s=r.v,t=s.length,t&&(n=s[t-2],l=s[t-1],n&&"progress"in n&&(i=n.progress,e.progress=i.progress/i.total),l&&"final"in l&&(c=l.final,e.errores=c.errores,e.complete=!0,e.messageProgress="Proceso finalizado.",e.progress=1,e.$emit("save")),l&&"noGenerarPase"in l&&(u=l.noGenerarPase,e.noGenerarPase=u,e.complete=!0)),r.n=5;break;case 4:r.p=4,p=r.v,console.log(p);case 5:return r.a(2)}},r,null,[[2,4]])}))()},enviarCorreo:function(){var e=this,r=[];this.$refs.tablaPerfiles.rowsSelected().map(function(a){"Perfiles"===e.option?e.Usuario.map(function(e){e.tipcod===a.value&&r.push(e.value)}):r.push(a.value)}),(0,w.confirmar)(this.$t("confirmar"),function(a){$.$http.post("api/HyoUsuario/enviarClaves",{pryKeys:r}).then(function(r){var a=r.json;(0,w.alertModal)(e.$t("mensajes."+a))}).catch(function(r){(0,w.alertModal)(e.$t(r))})})},revertir:function(){var e=this,r=this.$refs.tablaPerfiles.rowsSelected().map(function(e){return e.value});(0,w.confirmar)(this.$t("confirmar"),function(a){$.$http.post("api/Hyo".concat(e.option,"/revertirClaveAleatoria"),{pryKeys:r}).then(function(r){var a=r.json;(0,w.alertModal)(e.$t("mensajes."+a))}).catch(function(r){(0,w.alertModal)(e.$t(r))})})},getClaves:function(){var e=this;$.$http.get("api/HyoPerfiles/obtPerfilesExistentes",{params:{claves:!0}}).then(function(r){var a=r.json;e.dataTable=e.Perfiles=a.map(function(e){var r=e.TIPCOD,a=e.TIPNOM,o=e.TIPCOD;return{value:r,label:a,tipcod:o}})}),$.$http.get("api/HyoUsuario/obtListaUsuariosSeguridad",{params:{claves:!0}}).then(function(r){var a=r.json;e.Usuario=a.map(function(e){var r=e.USUNOM,a=e.USUCOD,o=e.TIPCOD;return{value:a,label:r,tipcod:o}})})}},created:function(){this.getClaves()}},V=a(12807);const O=(0,V.A)(I,[["render",v]]);var _=O}}]);