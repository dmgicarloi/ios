"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[97785],{97785:function(e,a,t){t.r(a),t.d(a,{default:function(){return Ne}});var o=t(61758),n=t(29104),r=t(58790),l={class:"col-xs-12"},i={class:"row"},c={class:"col-xs-12 col-sm-3 q-pa-xs"},u={class:"col-xs-12 col-sm-3 q-pa-xs"},s={class:"col-xs-12 col-sm-3 q-pa-xs"},d={class:"col-xs-12 col-sm-3 q-pa-xs"},O={class:"col-xs-12 col-sm-3 q-pa-xs"},N={class:"col-xs-12 col-sm-3 q-pa-xs"},A={class:"col-xs-12 col-sm-3 q-pa-xs"},T={class:"col-xs-12 col-sm-3 q-pa-xs"},C={class:"col-xs-12 col-sm-3 q-pa-xs"},m={class:"col-xs-12 col-sm-3 q-pa-xs"},M={class:"col-xs-12 col-sm-3 q-pa-xs"},E={class:"col-xs-12 col-sm-3 q-pa-xs"},b={class:"col-xs-12 col-sm-3 q-pa-xs"},p={class:"col-xs-12 col-sm-3 q-pa-xs"},f={class:"col-xs-12 col-sm-3 q-pa-xs"},I={key:0,class:"col-xs-3 q-pa-xs"},g={key:1,class:"col-xs-12 col-sm-3 q-pa-xs"},h={key:2,class:"col-xs-3 q-pa-xs"},D={key:3,class:"col-xs-3 q-pa-xs"},U={key:4,class:"col-xs-9 q-pa-xs"},P={key:0},R={class:"column ptotal"};function v(e,a){var t=(0,o.g2)("q-page-header"),v=(0,o.g2)("q-separator"),_=(0,o.g2)("q-select"),G=(0,o.g2)("q-icon"),L=(0,o.g2)("q-input"),F=(0,o.g2)("q-card-main"),V=(0,o.g2)("q-card"),w=(0,o.g2)("q-date"),S=(0,o.g2)("q-popup-proxy"),k=(0,o.g2)("q-checkbox"),x=(0,o.g2)("q-option-group"),B=(0,o.g2)("sie-grid"),y=(0,o.g2)("q-card-section"),q=(0,o.g2)("consultarComprobante"),$=(0,o.g2)("box-cuotas");return(0,o.uX)(),(0,o.Wv)(V,{class:"layout-v1 my-card",flat:"",bordered:""},{default:(0,o.k6)(function(){return[(0,o.bF)(t,{botones:e.pageHeader.botones,title:e.pageHeader.title,tabs:e.pageHeader.tabs,useTab:"",nivelAcceso:e.pageHeader.nivelAcceso,componente:e.pageHeader.componente,onActionTab:e.actionTab},null,8,["botones","title","tabs","nivelAcceso","componente","onActionTab"]),e.pageHeader.tabActive===e.pageHeader.tabsKeys.registro?((0,o.uX)(),(0,o.Wv)(v,{key:0})):(0,o.Q3)("v-if",!0),e.pageHeader.tabActive===e.pageHeader.tabsKeys.registro?((0,o.uX)(),(0,o.Wv)(y,{key:1},{default:(0,o.k6)(function(){return[(0,o.bF)(V,{class:"col-12 q-card-legend",title:"Comprobante Origen"},{default:(0,o.k6)(function(){return[(0,o.bF)(F,{class:"row"},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",l,[(0,o.Lk)("div",i,[(0,o.Lk)("div",c,[(0,o.bF)(_,{class:"truncate-label",modelValue:e.NUMTAL,"onUpdate:modelValue":a[0]||(a[0]=function(a){return e.NUMTAL=a}),"option-value":"NUMTAL","option-label":"TALDES",options:e.talonarios,label:"Talonario",onInput:e.buscarDocumento},null,8,["modelValue","options","onInput"])]),(0,o.Lk)("div",u,[(0,o.bF)(L,{modelValue:e.NUMPAG,"onUpdate:modelValue":a[1]||(a[1]=function(a){return e.NUMPAG=a}),label:"Nro. Comprobante",onKeyup:(0,n.jR)(e.buscarDocumento,["enter"])},{default:(0,o.k6)(function(){return[(0,o.bF)(G,{class:"cursor-pointer",name:"search",style:{"font-size":"2rem"},color:"primary",onClick:e.buscarDocumento},null,8,["onClick"])]}),_:1},8,["modelValue","onKeyup"])]),(0,o.Lk)("div",s,[(0,o.bF)(L,{modelValue:e.cabecera.ESTADO,"onUpdate:modelValue":a[2]||(a[2]=function(a){return e.cabecera.ESTADO=a}),readonly:"",label:"Estado"},null,8,["modelValue"])]),(0,o.Lk)("div",d,[(0,o.bF)(L,{modelValue:e.cabecera.TIPO_OPERACION,"onUpdate:modelValue":a[3]||(a[3]=function(a){return e.cabecera.TIPO_OPERACION=a}),readonly:"",label:"Tipo de operación"},null,8,["modelValue"])]),(0,o.Lk)("div",O,[(0,o.bF)(L,{modelValue:e.cabecera.CODIGO,"onUpdate:modelValue":a[4]||(a[4]=function(a){return e.cabecera.CODIGO=a}),readonly:"",label:"Código"},null,8,["modelValue"])]),(0,o.Lk)("div",N,[(0,o.bF)(L,{modelValue:e.cabecera.CLIENTE,"onUpdate:modelValue":a[5]||(a[5]=function(a){return e.cabecera.CLIENTE=a}),readonly:"",label:"Girado a"},null,8,["modelValue"])]),(0,o.Lk)("div",A,[(0,o.bF)(L,{modelValue:e.cabecera.NOMBRE,"onUpdate:modelValue":a[6]||(a[6]=function(a){return e.cabecera.NOMBRE=a}),readonly:"",label:"Nombre"},null,8,["modelValue"])]),(0,o.Lk)("div",T,[(0,o.bF)(L,{modelValue:e.cabecera.USUARIO,"onUpdate:modelValue":a[7]||(a[7]=function(a){return e.cabecera.USUARIO=a}),readonly:"",label:"Usuario"},null,8,["modelValue"])]),(0,o.Lk)("div",C,[(0,o.bF)(L,{modelValue:e.cabecera.FECEMI,"onUpdate:modelValue":a[8]||(a[8]=function(a){return e.cabecera.FECEMI=a}),readonly:"",label:"Fecha de Emisión"},null,8,["modelValue"])]),(0,o.Lk)("div",m,[(0,o.bF)(L,{modelValue:e.cabecera.FECPAG,"onUpdate:modelValue":a[9]||(a[9]=function(a){return e.cabecera.FECPAG=a}),readonly:"",label:"Fecha de Pago"},null,8,["modelValue"])]),(0,o.Lk)("div",M,[(0,o.bF)(L,{modelValue:e.cabecera.MONEDA,"onUpdate:modelValue":a[10]||(a[10]=function(a){return e.cabecera.MONEDA=a}),readonly:"",label:"Moneda"},null,8,["modelValue"])]),(0,o.Lk)("div",E,[(0,o.bF)(L,{modelValue:e.cabecera.ORIGEN,"onUpdate:modelValue":a[11]||(a[11]=function(a){return e.cabecera.ORIGEN=a}),readonly:"",label:"Origen"},null,8,["modelValue"])])])])]}),_:1})]}),_:1}),(0,o.bF)(V,{class:"col-12 q-card-legend q-mt-lg",title:"Nota de "+e.tituloNota},{default:(0,o.k6)(function(){return[(0,o.bF)(F,{class:"row"},{default:(0,o.k6)(function(){return[(0,o.Lk)("div",b,[(0,o.bF)(_,{class:"truncate-label",modelValue:e.notaCredito.NUMTAL,"onUpdate:modelValue":a[12]||(a[12]=function(a){return e.notaCredito.NUMTAL=a}),"option-value":"NUMTAL","option-label":"TALDES",options:e.talonarioNc,label:"Talonario"},null,8,["modelValue","options"])]),(0,o.Lk)("div",p,[(0,o.bF)(L,{label:"Fec. Emisión",debounce:"500",maxlength:"10",format:"##/##/####",modelValue:e.fecemi,"onUpdate:modelValue":a[15]||(a[15]=function(a){return e.fecemi=a}),mask:"##/##/####",readonly:""},{append:(0,o.k6)(function(){return[(0,o.bF)(G,{class:"cursor-pointer",name:"date_range"},{default:(0,o.k6)(function(){return[(0,o.bF)(S,{ref:"qDateProxy1","transition-show":"scale","transition-hide":"scale"},{default:(0,o.k6)(function(){return[(0,o.bF)(w,{mask:"DD/MM/YYYY",modelValue:e.fecemi,"onUpdate:modelValue":a[13]||(a[13]=function(a){return e.fecemi=a}),onInput:a[14]||(a[14]=function(a){return e.closeModalCalendar("qDateProxy1")})},null,8,["modelValue"])]}),_:1},512)]}),_:1})]}),_:1},8,["modelValue"])]),(0,o.Lk)("div",f,[(0,o.bF)(_,{class:"truncate-label",modelValue:e.notaCredito.MOTNOTA,"onUpdate:modelValue":a[16]||(a[16]=function(a){return e.notaCredito.MOTNOTA=a}),"option-value":"CLAVE","option-label":"VALOR",options:e.motivos,label:"Motivo",onInput:e.cambiaMotivo},null,8,["modelValue","options","onInput"])]),e.debito?(0,o.Q3)("v-if",!0):((0,o.uX)(),(0,o.CE)("div",I,[(0,o.bF)(k,{label:"Afectar SOLO Mora",modelValue:e.notaCredito.AFECTO_MORA,"onUpdate:modelValue":a[17]||(a[17]=function(a){return e.notaCredito.AFECTO_MORA=a}),"true-value":1,"false-value":0},null,8,["modelValue"])])),e.showOrigen?((0,o.uX)(),(0,o.CE)("div",g,[(0,o.bF)(x,{name:"Origen",color:"purple",options:e.origenes,inline:"",modelValue:e.selectOrigen,"onUpdate:modelValue":a[18]||(a[18]=function(a){return e.selectOrigen=a}),onInput:e.changeOrigen},null,8,["options","modelValue","onInput"])])):(0,o.Q3)("v-if",!0),e.showOrigen&&e.showCtaBanco?((0,o.uX)(),(0,o.CE)("div",h,[(0,o.bF)(_,{class:"truncate-label",modelValue:e.notaCredito.NUMCTA,"onUpdate:modelValue":a[19]||(a[19]=function(a){return e.notaCredito.NUMCTA=a}),"option-value":"NUMCTA","option-label":"CTACTE",options:e.ctaBancos,label:"Cta. Bancaria"},null,8,["modelValue","options"])])):(0,o.Q3)("v-if",!0),e.showOrigen&&e.showCtaBanco?((0,o.uX)(),(0,o.CE)("div",D,[(0,o.bF)(L,{modelValue:e.notaCredito.NUMOPE,"onUpdate:modelValue":a[20]||(a[20]=function(a){return e.notaCredito.NUMOPE=a}),type:"text",label:"Nro. Operación/Cheque",maxlength:e.sizeObs},null,8,["modelValue","maxlength"])])):(0,o.Q3)("v-if",!0),e.showObservacion?((0,o.uX)(),(0,o.CE)("div",U,[(0,o.bF)(L,{modelValue:e.notaCredito.OBSERVACION,"onUpdate:modelValue":a[21]||(a[21]=function(a){return e.notaCredito.OBSERVACION=a}),type:"text",label:"Observación",maxlength:e.sizeObs},null,8,["modelValue","maxlength"])])):(0,o.Q3)("v-if",!0)]}),_:1})]}),_:1},8,["title"]),e.pageHeader.tabActive===e.pageHeader.tabsKeys.registro?((0,o.uX)(),(0,o.CE)("div",P,[(0,o.bF)(B,{class:"q-mt-xs ag-theme-balham",columnDefs:e.columnDefs,rowData:e.rowData,onCellValueChanged:e.editing,rowClassRules:e.rowClassRules,frameworkComponents:e.frameworkComponents,onGridReady:e.onGridReady,style:{width:"100wv",height:"calc(100vh - 580px)"}},null,8,["columnDefs","rowData","onCellValueChanged","rowClassRules","frameworkComponents","onGridReady"]),(0,o.Lk)("p",R,"Total a Pagar: "+(0,r.v_)(e.cabecera.MONSIG)+": "+(0,r.v_)(e.total),1)])):(0,o.Q3)("v-if",!0)]}),_:1})):(0,o.Q3)("v-if",!0),(0,o.bo)((0,o.bF)(q,{ref:e.pageHeader.tabsKeys.consultar,cp:"notaCredito",lessHeight:"360",tab:""},null,512),[[n.aG,e.pageHeader.tabActive===e.pageHeader.tabsKeys.consultar]]),e.openModalCuotas?((0,o.uX)(),(0,o.Wv)($,{key:2,modelValue:e.openModalCuotas,"onUpdate:modelValue":a[22]||(a[22]=function(a){return e.openModalCuotas=a}),onSubmit:e.guardarCuotasFactura,datos:e.datosFactura,numtal:e.NUMTAL,numpag:e.NUMPAG},null,8,["modelValue","onSubmit","datos","numtal","numpag"])):(0,o.Q3)("v-if",!0)]}),_:1})}var _=t(99550),G=t.n(_),L=t(8445),F=t.n(L),V=t(76080),w=t.n(V),S=t(45254),k=t.n(S),x=(t(30683),t(71225),t(39866),t(52133),t(10239),t(50310),t(5962),t(90095),t(6724),t(11777),t(15547),t(83190),t(44264),t(62692),t(13715),t(88567)),B=t(95718),y=t(95051),q=t(53380),$=t(54489),Y=t(64208),H=t(97736),Q=t(12143),X=t(2739),K=t(95477),J=t(80660),j=t(6123),z=t(36408),W=t(57668),Z=t(18105),ee=t(42037),ae=t(54267),te=t(56945),oe=t(27560),ne=t(41615),re=t(64303),le=t(74160),ie=t(3112),ce=t(9820),ue=t(2652),se={props:{tipoNota:{type:String,default:"CREDITO"},codNota:{type:String,default:"07"}},components:{QForm:X.A,QChip:y.A,QDate:Q.A,QPopupProxy:K.A,QCard:x.A,QCardSection:B.A,QSelect:$.S,QOptionGroup:j.EX,QSeparator:q.A,sieGrid:z.A,QInput:Y.A,boxCuotas:H.A,footerGrid:oe.A,crearBotones:re.A,QCheckbox:ie.A,consultarComprobante:ce.A,QPageHeader:ue.A,QCardMain:j.d1,QIcon:j.bP},mixins:[te.A],data:function(){return{nameComponent:"NotaCredito",notaCredito:{NUMTAL:null,ID_PERSONA:0,ID_PERFIL:0,ORIPAG:null,NUMCTA:null,FORPAG:null,FECEMI:(0,Z.Ay)(new Date,"DD/MM/YYYY"),FECPAG:(0,Z.Ay)(new Date,"DD/MM/YYYY"),MOTNOTA:null,OBSERVACION:null,AFECTO_MORA:0},ctaBancos:[],fecemi:(0,Z.Ay)(new Date,"DD/MM/YYYY"),showCtaBanco:!1,NUMTAL:null,NUMPAG:null,total:"0.00",cabecera:{TOTAL:"0.00",NUMTAL:null,NUMPAG:null,CLIENTE:null,CODIGO:null,ID_PERSONA:null,ID_PERFIL:null,FECEMI:null,MONNOM:null,MONEDA:null,ESTADO:null,USUCOD:null,OBSERVA:null,TIPO_OPERACION:null,NOMBRE:null,ORIGEN:null,FECAPG:null,USUARIO:null,MONSIG:"S/"},talonarioNc:[],talonarios:[],nivelAcceso:3,columnDefs:[],pages:null,pagina:1,rowData:[],api:null,frameworkComponents:null,motivos:[],anulacion:!1,botones:[],openModalCuotas:!1,datosFactura:{},itemsNota:[],sizeObs:0,openModlasNt:!0,origenes:[],selectOrigen:ne["default"].ORIPAG_CAJA,showOrigen:!1,selectAfectaMora:0,showObservacion:1,showMora:!1,documentoMora:!1,devolucionTotal:"07",debito:!1,pageHeader:{title:"",botones:[],componente:"notaCredito",nivelAcceso:(0,W["default"])().ruta.nivel,tabs:[{name:"index",label:"registro"},{name:"consultar",label:"consultar"}],tabsKeys:{registro:"index",consultar:"consultar"},tabActive:"index"}}},mounted:function(){this.getOrigenes(),this.getDdl(),this.crearBotones(),this.columns()},computed:{tituloNota:function(){return"CREDITO"===this.tipoNota?"Crédito":"Débito"},tituloGrid:function(){return"CREDITO"===this.tipoNota?"Monto por N.C.":"Monto por N.D."}},methods:{actionTab:function(e){var a=this;return k()(w()().m(function t(){var o;return w()().w(function(t){while(1)switch(t.n){case 0:if(a.pageHeader.tabActive=e,e!==a.pageHeader.tabsKeys.registro){t.n=1;break}return a.crearBotones(),a.pageHeader.title="Nota de ".concat("CREDITO"===a.tipoNota?"Crédito":"Débito"),a.componente="notaCredito",a.nivelAcceso=(0,W["default"])().ruta.nivel,t.a(2,!0);case 1:return t.n=2,a.$refs[e].actionTab();case 2:o=t.v,a.pageHeader.title=o.title,a.pageHeader.botones=o.botones,a.pageHeader.nivelAcceso=o.nivelAcceso,a.pageHeader.componente=o.componente;case 3:return t.a(2)}},t)}))()},columns:function(){this.columnDefs=[{headerName:"Item",field:"NUMITE",width:50},{headerName:"Código",field:"CONCOB",width:70},{headerName:"Concepto",field:"CONCEPTO",width:320},{headerName:"Anio",field:"ANOCOB",hide:!0},{headerName:"Mescob",field:"MESCOB",hide:!0},{headerName:"Deda",field:"ID_DEUDA",hide:!0},{headerName:"Persona",field:"ID_PERSONA",hide:!0},{headerName:"Perfil",field:"ID_PERFIL",hide:!0},{headerName:"Moneda",field:"MONCOD",hide:!0},{headerName:"Monto",field:"MONTOCOB",cellClass:"text-right",valueFormatter:ee.toFixed,width:90},{headerName:"Desc.",field:"MONTODES",cellClass:"text-right",valueFormatter:ee.toFixed,width:70},{headerName:"Mora",field:"MONTOMOR",cellClass:"text-right",valueFormatter:ee.toFixed,width:70},{headerName:"Total",field:"MONTOPAG",cellClass:"text-right",valueFormatter:ee.toFixed,width:90},{headerName:this.tituloGrid,field:"MONTONOTA",cellClass:"text-right",valueFormatter:ee.toFixed,width:120,editable:ne["default"].MOTIVO_NC.DEVOLUCION_TOTAL!==this.notaCredito.MOTNOTA}]},changeOrigen:function(){this.showCtaBanco=this.selectOrigen===ne["default"].ORIPAG_BANCO},getOrigenes:function(){var e=this;return k()(w()().m(function a(){return w()().w(function(a){while(1)switch(a.n){case 0:return a.n=1,ne["default"].ORIGENES(!1);case 1:e.origenes=a.v;case 2:return a.a(2)}},a)}))()},getDdl:function(){var e=this;return k()(w()().m(function a(){var t;return w()().w(function(a){while(1)switch(a.n){case 0:return a.n=1,(0,le.n)(["PAGO"]);case 1:t=a.v,e.sizeObs=t.PAGO.OBSERVA;case 2:return a.a(2)}},a)}))()},crearBotones:function(){this.botones=[{label:"Guardar",icon:"save",click:this.guardarNota,minAcceso:ne["default"].LECTURA_ESCRITURA}],this.pageHeader.botones=this.botones},obtDetalle:function(e){var a=this,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=[];return e.forEach(function(e){if(e.MONTONOTA>0||!0===t){var n={ANOCOB:e.ANOCOB,CONCOB:e.CONCOB,MESCOB:e.MESCOB,MONCOD:e.MONCOD,BOLEMI:e.BOLEMI,FECVEN:e.FECVEN,CONCEPTO:e.CONCEPTO,ID_DEUDA:e.ID_DEUDA,ID_PERSONA:e.ID_PERSONA,ID_PERFIL:e.ID_PERFIL,MONTOCOB:0,MONTOMOR:0,MONTODES:0,MONTOPAG:0,NRODOC:"".concat(e.NUMTAL,"-").concat(e.NUMPAG)};!1===t&&(e.MONTOCOB>0&&0===e.MONTOMOR?n.MONTOCOB=Number(e.MONTONOTA):1===a.notaCredito.AFECTO_MORA&&e.MONTOMOR>0||e.MONTOMOR>0&&0===e.MONTOCOB?n.MONTOMOR=Number(e.MONTONOTA):n.MONTOCOB=Number(e.MONTONOTA)),n.MONTOPAG=Number(n.MONTOCOB)+Number(n.MONTOMOR),o.push(n)}}),o},editing:function(e){this.cellValueChanged(e);var a=0,t=F()(this.rowData);"CREDITO"===this.tipoNota&&e.data.MONTOPAG<e.data.MONTONOTA&&(this.$alert("El monto ingresado (".concat(e.data.MONTONOTA,") no puede ser mayor que el monto total (").concat(e.data.MONTOPAG,")"),"warning"),e.data.MONTONOTA=0),t.forEach(function(t){t.NUMITE!==e.data.NUMITE&&(a+=parseFloat(t.MONTONOTA||0))});var o=e.data.MONTONOTA||0;a=parseFloat(a)+parseFloat(o),this.total=a.toFixed(2)},onGridReady:function(e){this.api=e.api},getRowsNota:function(){return!0===this.anulacion||ne["default"].MOTIVO_NOTA_CREDITO.AJUTES_CUOTAS.includes(this.notaCredito.MOTNOTA)?this.rowData:this.changes.updated},guardarNota:function(){var e=this;return k()(w()().m(function a(){var t,o;return w()().w(function(a){while(1)switch(a.n){case 0:if(e.NUMTAL&&e.NUMPAG){a.n=1;break}return e.$alert("Debe Elegir un talonario e Ingresar el Número de comprobante","warning"),a.a(2,!1);case 1:if(null!==e.notaCredito.NUMTAL){a.n=2;break}return e.$alert("Debe Elegir el talonario de la nota de crédito","warning"),a.a(2,!1);case 2:if(null!==e.notaCredito.MOTNOTA){a.n=3;break}return e.$alert("Debe Elegir el motivo de la nota de crédito","warning"),a.a(2,!1);case 3:if(e.cabecera.ANUPAG!==ne["default"].PAGO_ANUPAG.ANULADO){a.n=4;break}return e.$alert("El comprobante (".concat(e.cabecera.NUMTAL,"-").concat(e.cabecera.NUMPAG,") esta ANULADO. No se puede aplicar nota de crédito"),"warning"),a.a(2,!1);case 4:if(e.cabecera.ANUPAG===ne["default"].PAGO_ANUPAG.CANCELADO||!e.debito){a.n=5;break}return e.$alert("El comprobante (".concat(e.cabecera.NUMTAL,"-").concat(e.cabecera.NUMPAG,") debe estar CANCELADO para poder aplicar la nota de DEBITO"),"warning"),a.a(2,!1);case 5:return a.n=6,e.getRowsNota();case 6:if(e.itemsNota=a.v,0!==e.itemsNota.length){a.n=7;break}return t=e.debito?"debito":"credito",e.$alert("Debe de ingresar el monto por la nota de ".concat(t),"warning"),a.a(2,!1);case 7:if(e.debito){a.n=8;break}return a.a(2,e.guardarNotaCredito());case 8:return o={pago:e.notaCredito,pagoDet:e.obtDetalle(e.itemsNota,!1)},a.n=9,e.ajaxNotaDebito(o,"¿Esta seguro de registrar la nota de debito?");case 9:return a.a(2)}},a)}))()},guardarNotaCredito:function(){var e=this;return k()(w()().m(function a(){var t,o,n,r,l,i,c,u,s,d,O,N,A;return w()().w(function(a){while(1)switch(a.n){case 0:t=0,o=0,n=!1,r=!1,l=0,i=[];while(l<e.itemsNota.length)c=e.itemsNota[l],n=c.MONTONOTA<=0,t+=Number(c.MONTONOTA),o+=Number(c.MONTOPAG),1===e.notaCredito.AFECTO_MORA&&Number(c.MONTONOTA)>Number(c.MONTOMOR)&&i.push("Error al usar Afectación de SOLO Mora: El monto (".concat(Number(c.MONTONOTA).toFixed(2),") del item (").concat(c.NUMITE," - ").concat(c.CONCEPTO,") es mayor a la mora (").concat(Number(c.MONTOMOR).toFixed(2),")")),Number(c.MONTOMOR)>0&&0===Number(c.MONTOCOB)&&Number(c.MONTONOTA)>Number(c.MONTOMOR)&&i.push("El monto (".concat(Number(c.MONTONOTA).toFixed(2),") del item (").concat(c.NUMITE," - ").concat(c.CONCEPTO,") es mayor a la mora (").concat(Number(c.MONTOMOR).toFixed(2),")")),l++;if(!(i.length>0)){a.n=1;break}return u=[].concat(i),s=u[0],e.$alert(s,"warning"),a.a(2,!1);case 1:if(0!==o){a.n=4;break}if(r=!0,!1!==ne["default"].MOTIVO_NOTA_CREDITO.REVERTIR.includes(e.notaCredito.MOTNOTA)){a.n=2;break}return e.$alert("El motivo de nota de crédito no aplica para el comprobante gratuito","warning"),a.a(2,!1);case 2:if(!(o>0)){a.n=3;break}return e.$alert("El monto de la nota de crédito no aplica para el comprobante gratuito","warning"),a.a(2,!1);case 3:a.n=10;break;case 4:if(!(o>0&&n&&0===Number(t)&&!1===ne["default"].MOTIVO_NOTA_CREDITO.AJUTES_CUOTAS.includes(e.notaCredito.MOTNOTA))){a.n=5;break}return e.$alert("El monto de la nota de crédito debe ser mayor a cero (0.00)","warning"),a.a(2,!1);case 5:if(!ne["default"].MOTIVO_NOTA_CREDITO.REVERTIR.includes(e.notaCredito.MOTNOTA)){a.n=6;break}if(Number(t)===Number(o)){a.n=6;break}return e.$alert("El total de la nota (".concat(t.toFixed(2),") es diferente al total del comprobante (").concat(o.toFixed(2),")"),"warning"),a.a(2,!1);case 6:if(!ne["default"].MOTIVO_NOTA_CREDITO.DEVOLUCION.includes(e.notaCredito.MOTNOTA)){a.n=8;break}if(e.cabecera.ANUPAG!==ne["default"].PAGO_ANUPAG.PENDIENTE){a.n=7;break}return e.$alert("El comprobante (".concat(e.cabecera.NUMTAL,"-").concat(e.cabecera.NUMPAG,") esta pendiente. No se puede devolver dinero"),"warning"),a.a(2,!1);case 7:e.selectOrigen===ne["default"].ORIPAG_BANCO?e.notaCredito.ORIPAG=ne["default"].ORIPAG_BANCO:e.notaCredito.ORIPAG=ne["default"].ORIPAG_CAJA;case 8:if(!ne["default"].MOTIVO_NOTA_CREDITO.AJUTES_CUOTAS.includes(e.notaCredito.MOTNOTA)){a.n=10;break}if(e.cabecera.CODSUNAT===ne["default"].CODSUNAT.FACTURA){a.n=9;break}return e.$alert("Este motivo de nota de crédito solo aplica para Facturas al crédito","warning"),a.a(2,!1);case 9:if(e.cabecera.ANUPAG===ne["default"].PAGO_ANUPAG.PENDIENTE){a.n=10;break}return e.$alert("La factura (".concat(e.cabecera.NUMTAL,"-").concat(e.cabecera.NUMPAG,") no esta pendiente de pago"),"warning"),a.a(2,!1);case 10:if(!ne["default"].MOTIVO_NOTA_CREDITO.REDUCIR.includes(e.notaCredito.MOTNOTA)){a.n=11;break}if(!1!==[ne["default"].PAGO_ANUPAG.PENDIENTE,ne["default"].PAGO_ANUPAG.EMITIDO].includes(e.cabecera.ANUPAG)){a.n=11;break}return e.$alert("El comprobante (".concat(e.cabecera.NUMTAL,"-").concat(e.cabecera.NUMPAG,") no esta pendiente. No se puede reducir la deuda"),"warning"),a.a(2,!1);case 11:if(e.selectOrigen!==ne["default"].ORIPAG_BANCO){a.n=13;break}if(e.notaCredito.NUMCTA){a.n=12;break}return e.$alert("Debe seleccionar la cuenta bancaria","warning"),a.a(2,!1);case 12:if(e.notaCredito.NUMOPE){a.n=13;break}return e.$alert("Debe registrar el Nro. de operación/Cheque","warning"),a.a(2,!1);case 13:if(!ne["default"].MOTIVO_NOTA_CREDITO.AJUTES_CUOTAS.includes(e.notaCredito.MOTNOTA)){a.n=14;break}e.openModalCuotas=!0,a.n=18;break;case 14:return d={pago:e.notaCredito,pagoDet:e.obtDetalle(e.itemsNota,r)},O={ID_CONSTANTE:[ne["default"].CONSTANTES_SISTEMA.P_ENVIA_SUNAT_INDIVIDUAL]},a.n=15,ne["default"].API_CONSTANTES_SISTEMAS(O);case 15:if(N=a.v,A="¿Esta seguro de registrar la nota de crédito?",!N.P_ENVIA_SUNAT_INDIVIDUAL){a.n=17;break}if(e.notaCredito.OBSERVACION||ne["default"].MOTIVO_NC.OTROS_CONCEPTOS!==e.notaCredito.MOTNOTA){a.n=16;break}return e.$alert("Debe colocar los siguientes datos en la observación: SERIE y NÚMERO del comprobante, RUC, FECHA DE EMISIÓN, MONTO y MONEDA.","warning"),a.a(2,!1);case 16:A="Este comprobante será enviado automaticamente a SUNAT, ¿Esta seguro de registrar la nota crédito?";case 17:return a.n=18,e.ajaxNotaCredito(d,A);case 18:return a.a(2)}},a)}))()},ajaxNotaDebito:function(e,a){var t=this;return k()(w()().m(function o(){return w()().w(function(o){while(1)switch(o.n){case 0:e.pago.FECEMI=(0,ae.convertToYMD)(t.fecemi),e.pago.FECPAG=(0,ae.convertToYMD)(t.fecemi),t.$confirm(a,"info",!1,!0).onOk(function(){J.$http.post("api/PagoController/postNotaDebito",{datos:e}).then(function(e){t.$q.loading.hide();var a=F()(e.data),o=a[0];t.changes.updated=[],t.itemsNota=[],t.openModalCuotas=!1,t.showMora=!1,t.notaCredito.OBSERVACION="",t.$alert(e.message,"success",!1,!0).onOk(function(e){t.$confirm("¿Desea Imprimir la nota de crédito?","info",!1,!0).onOk(function(){var e=(0,W["default"])().origin;t.clean(),ne["default"].IMPRIMIR_COMPROBANTE(e,o.numtal,o.numpag)}).onCancel(function(e){t.clean()})})}).catch(function(e){var a=e.error;t.$q.loading.hide(),t.$alert(a.message,"warning")})});case 1:return o.a(2)}},o)}))()},guardarCuotasFactura:function(e){var a={pago:this.notaCredito,pagoDet:this.obtDetalle(this.itemsNota,!0),cuotas:e};this.ajaxNotaCredito(a,"¿Esta seguro de registrar la nota de crédito para la factura ".concat(this.notaCredito.NUMTALO,"-").concat(this.notaCredito.NUMPAGO,"? Recuerde que el importe es por cero (0.00) y sólo se modifican las cuotas"))},ajaxNotaCredito:function(e,a){var t=this;return k()(w()().m(function o(){return w()().w(function(o){while(1)switch(o.n){case 0:e.pago.FECEMI=(0,ae.convertToYMD)(t.fecemi),e.pago.FECPAG=(0,ae.convertToYMD)(t.fecemi),t.$confirm(a,"info",!1,!0).onOk(function(){t.$q.loading.show(),J.$http.post("api/PagoController/postNotaCredito",{datos:e}).then(function(e){t.$q.loading.hide();var a=F()(e.data),o=a[0];t.changes.updated=[],t.itemsNota=[],t.openModalCuotas=!1,t.showMora=!1,t.notaCredito.OBSERVACION="",t.$refs[t.pageHeader.tabsKeys.consultar].pagosEmitidos(),t.$alert(e.message,"success",!1,!0).onOk(function(e){t.$confirm("¿Desea Imprimir la nota de crédito?","info",!1,!0).onOk(function(){var e=(0,W["default"])().origin;t.clean(),ne["default"].IMPRIMIR_COMPROBANTE(e,o.numtal,o.numpag)}).onCancel(function(e){t.clean()})})}).catch(function(e){var a=e.error;t.$q.loading.hide(),t.$alert(a.message,"warning")})});case 1:return o.a(2)}},o)}))()},closeModalCalendar:function(e){this.$refs[e].hide()},cambiaMotivo:function(){if(this.columns(),"CREDITO"===this.tipoNota){var e=F()(this.rowData),a=0;ne["default"].CARGO_TOTAL_NC.includes(this.notaCredito.MOTNOTA)?(this.anulacion=!0,e.map(function(t,o){e[o].MONTONOTA=e[o].MONTOPAG,a+=parseFloat(e[o].MONTOPAG)})):(e.map(function(a,t){e[t].MONTONOTA=null}),this.anulacion=!1),this.total=a.toFixed(2),this.rowData=e,this.showOrigen=ne["default"].MOTIVO_NOTA_CREDITO.DEVOLUCION.includes(this.notaCredito.MOTNOTA),this.showMora=ne["default"].MOTIVO_NOTA_CREDITO.DEVOLUCION.includes(this.notaCredito.MOTNOTA)&&this.documentoMora,this.showOrigen||(this.notaCredito.NUMCTA="",this.notaCredito.NUMOPE="",this.selectOrigen=ne["default"].ORIPAG_CAJA),ne["default"].MOTIVO_NOTA_CREDITO.AJUTES_CUOTAS.includes(this.notaCredito.MOTNOTA.toString())&&this.$alert("La nota de credito es solo para modificar las fechas y/o montos de las cuotas de la factura ".concat(this.notaCredito.NUMTALO,"-").concat(this.notaCredito.NUMPAGO,". Por lo tanto no necesita importe"))}},buscarDocumento:function(){var e=this;return k()(w()().m(function a(){var t,o,n,r;return w()().w(function(a){while(1)switch(a.n){case 0:if(null==e.NUMTAL||null==e.NUMPAG){a.n=4;break}return e.NUMPAG&&(e.NUMPAG=(0,ae.agregaZeros)(e.NUMPAG,7)),t={numtal:e.NUMTAL,numpag:e.NUMPAG},a.n=1,J.$http.get("api/PagoController/getComprobante",{params:{parametros:t}});case 1:if(o=a.v,0!==o.length){a.n=2;break}return e.notaCredito={NUMTAL:null,ID_PERSONA:0,ID_PERFIL:0,ORIPAG:null,NUMCTA:null,FORPAG:null,FECEMI:(0,Z.Ay)(new Date,"DD/MM/YYYY"),FECPAG:(0,Z.Ay)(new Date,"DD/MM/YYYY"),MOTNOTA:null,OBSERVACION:null,AFECTO_MORA:0},e.cabecera={TOTAL:"0.00",NUMTAL:null,NUMPAG:null,CLIENTE:null,CODIGO:null,ID_PERSONA:null,ID_PERFIL:null,FECEMI:null,MONNOM:null,MONEDA:null,ESTADO:null,USUCOD:null,OBSERVA:null,TIPO_OPERACION:null,NOMBRE:null,FECPAG:null,ORIGEN:null,USUARIO:null},e.datosFactura={},e.$alert("No existen datos del comprobante (".concat(e.NUMTAL,"-").concat(e.NUMPAG,")"),"warning"),e.rowData=[],a.a(2,!0);case 2:if(!(o.length>0)){a.n=4;break}return n=G()(o,1),r=n[0],e.documentoMora=Number(r.MONTOTMOR)>0,r.TIPCLIENTE===ne["default"].TIPCLIENTE.SUBCLIENTE?(e.cabecera.CLIENTE=r.CLIENTE,e.cabecera.PERFIL=r.PERFIL_SUBCLIENTE,e.notaCredito.ID_PERSONA=r.ID_PERSONA_SUB,e.notaCredito.ID_PERFIL=r.ID_PERFIL_SUB,e.cabecera.NOMBRE=r.CLIENTE):(e.cabecera.CLIENTE=r.CLIENTE,e.cabecera.PERFIL=r.PERFIL_CLIENTE,e.notaCredito.ID_PERSONA=r.ID_PERSONA,e.notaCredito.ID_PERFIL=r.ID_PERFIL),e.cabecera.NOMBRE=r.SUBCLIENTE?r.SUBCLIENTE:r.CLIENTE,e.cabecera.ANUPAG=r.ANUPAG,e.cabecera.MONEDA=r.MONEDA,e.cabecera.MONSIG=r.MONSIG,e.cabecera.FECEMI=(0,Z.Ay)(new Date(r.FECEMI),"DD/MM/YYYY"),r.FECPAG?e.cabecera.FECPAG=(0,Z.Ay)(new Date(r.FECPAG),"DD/MM/YYYY"):e.cabecera.FECPAG="",e.cabecera.CODIGO=r.CODIGO,e.cabecera.ESTADO=r.ESTADO,e.cabecera.NUMTAL=r.NUMTAL,e.cabecera.NUMPAG=r.NUMPAG,e.cabecera.CODSUNAT=r.CODSUNAT,e.notaCredito.MONCOD=r.MONCOD,e.notaCredito.NUMTALO=r.NUMTAL,e.notaCredito.NUMPAGO=r.NUMPAG,e.cabecera.TIPO_OPERACION=r.TIPO_OPERACION,e.cabecera.USUARIO=r.USUCOD,r.ORIPAG?r.ORIPAG===ne["default"].ORIPAG_BANCO?(e.cabecera.ORIGEN="Banco",e.ctaBancos.length>0&&e.ctaBancos.forEach(function(a){if(a.NUMCTA.toString()===r.NUMCTA&&a.CTACTE){var t=a.CTACTE.split("|");e.cabecera.ORIGEN="Banco ".concat(t[0],"-").concat(t[1])}})):r.ORIPAG===ne["default"].ORIPAG_CAJA&&(e.cabecera.ORIGEN="Caja"):e.cabecera.ORIGEN="",a.n=3,J.$http.get("api/PagoController/getComprobantesConceptos",{params:{parametros:t}});case 3:e.rowData=a.v,e.datosFactura={cliente:r.CLIENTE,monsig:r.MONSIG,total:r.MONTOTPAG},e.notaCredito.MOTNOTA&&e.cambiaMotivo();case 4:if(e.NUMPAG&&(e.NUMPAG=(0,ae.agregaZeros)(e.NUMPAG,7)),null!==e.NUMTAL){a.n=5;break}return a.a(2,e.$alert("No selecciono el talonario","warning"));case 5:return a.a(2)}},a)}))()},consultar:function(){this.$router.push({name:"tesoreria.registroConsultarComprobante",params:{cp:"notaCredito"}})},clean:function(){this.notaCredito={NUMTAL:null,OBSERVACION:null,MOTNOTA:null,NUMCTA:null,AFECTO_MORA:0},this.showOrigen=!1,this.NUMTAL=null,this.NUMPAG=null,this.total="0.00",this.cabecera={TOTAL:"0.00",NUMTAL:null,NUMPAG:null,CLIENTE:null,ID_PERSONA:null,ID_PERFIL:null,FECEMI:null,MONNOM:null,ESTADO:null,ANUPAG:null},this.rowData=[]},init:function(){var e=this;this.pageHeader.title="Nota de ".concat("CREDITO"===this.tipoNota?"Crédito":"Débito"),J.$http.get("api/bancoController/getCuentasBancarias",{params:{parametros:{response:"combo"}}}).then(function(a){e.ctaBancos=a});var a=this.debito?ne["default"].ESTADO_TABLA.MOTIVO_NOTA_DEBITO:ne["default"].ESTADO_TABLA.MOTIVO_NOTA_CREDITO;J.$http.get("api/EstadoTablaController/getEstadoTabla",{params:{parametros:{CODIGO:a}}}).then(function(a){e.motivos=a.map(function(e){var a=e.CLAVE,t=e.VALOR;return{CLAVE:a,VALOR:"".concat(a," | ").concat(t)}})}),J.$http.get("api/talonarioController/getTalonariosUsuario",{params:{parametros:{response:"combo",opcionMenu:"nota"}}}).then(function(a){if(a.length>0){if(e.talonarioNc=a.filter(function(a){return e.debito?a.ID_COMPROBANTE===ne["default"].NOTA_DEBITO:a.ID_COMPROBANTE===ne["default"].NOTA_CREDITO&&1===a.ACTIVO}),1===e.talonarioNc.length){var t=G()(e.talonarioNc,1),o=t[0];e.notaCredito.NUMTAL=o.NUMTAL}e.talonarios=a.filter(function(e){return![ne["default"].NOTA_CREDITO,ne["default"].NOTA_DEBITO].includes(e.ID_COMPROBANTE)})}})}},created:function(){this.debito="DEBITO"===this.tipoNota,this.init()}},de=t(12807);const Oe=(0,de.A)(se,[["render",v]]);var Ne=Oe}}]);