"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[24020],{24020:function(e,a,t){t.r(a),t.d(a,{default:function(){return te}});var r=t(61758),n=t(58790),o={class:"row justify-center q-ma-md"},i={class:"row justify-center"},s={class:"row justify-center"},l={class:"row justify-center q-mb-md"},u={class:"row"},c={class:"row"},d={key:0,class:"col"},A={key:1,class:"col",style:{padding:"8px"}},I={key:0},f={key:1,class:"row justify-between"},m={class:"q-ma-sm"},v={key:0,class:"q-ma-sm"},p={key:1,class:"column col items-center justify-center"},h={class:"col q-ma-md"},E={class:"col q-ma-xs"};function D(e,a){var t=(0,r.g2)("q-btn-toggle"),D=(0,r.g2)("sie-select"),C=(0,r.g2)("q-select"),b=(0,r.g2)("q-input"),T=(0,r.g2)("q-btn"),g=(0,r.g2)("qr"),P=(0,r.g2)("sie-usuario"),_=(0,r.g2)("q-item-side"),S=(0,r.g2)("q-item-tile"),R=(0,r.g2)("q-item-main"),k=(0,r.g2)("q-item"),N=(0,r.g2)("q-icon"),O=(0,r.g2)("q-list-header"),y=(0,r.g2)("q-list"),V=(0,r.g2)("q-checkbox"),F=(0,r.g2)("q-item-separator"),L=(0,r.g2)("sie-vacio"),U=(0,r.g2)("sie-modal"),Q=(0,r.g2)("q-radio"),q=(0,r.g2)("q-page");return(0,r.uX)(),(0,r.Wv)(q,{class:"bg-white q-ma-md"},{default:(0,r.k6)(function(){return[(0,r.Lk)("div",o,[(0,r.bF)(t,{modelValue:e.modRegistro,"onUpdate:modelValue":a[0]||(a[0]=function(a){return e.modRegistro=a}),"toggle-color":"secondary",options:e.tiposDetalles,push:"",glossy:"",rounded:""},null,8,["modelValue","options"])]),(0,r.Lk)("div",i,[2===e.modRegistro?((0,r.uX)(),(0,r.Wv)(D,{key:0,class:"col-5",type:"outlined",noBottom:"",modelValue:e.actividad,"onUpdate:modelValue":a[1]||(a[1]=function(a){return e.actividad=a}),options:e.cboActividades,label:"ACTIVIDAD_CBO",val:"ID_ACTIVIDAD_ENCARGADO",placeholder:e.$t("intranet.actividad")},null,8,["modelValue","options","placeholder"])):(0,r.Q3)("v-if",!0)]),(0,r.Lk)("div",s,[(0,r.bF)(C,{class:"q-if-outlined",modelValue:e.tipoLectura,"onUpdate:modelValue":a[2]||(a[2]=function(a){return e.tipoLectura=a}),options:e.tipoLecturaObj,"stack-label":"Lectura por: "},null,8,["modelValue","options"]),"id"===e.tipoLectura||!e.sinCamara&&"barras"!=e.tipoLectura?(0,r.Q3)("v-if",!0):((0,r.uX)(),(0,r.Wv)(b,{key:0,class:"q-if-outlined",modelValue:e.usucod,"onUpdate:modelValue":a[3]||(a[3]=function(a){return e.usucod=a}),autofocus:!0,"stack-label":"qr"==e.tipoLectura?"Usuario":"DNI",onKeydown:e.registraPistola},null,8,["modelValue","stack-label","onKeydown"]))]),(0,r.Lk)("div",l,[(0,r.Lk)("div",u,[(0,r.bF)(T,{label:e.estadoObj.label,color:e.estadoObj.color,onClick:e.abrirModal},null,8,["label","color","onClick"])])]),(0,r.Lk)("div",c,[!e.sinCamara&&["qr","id"].indexOf(e.tipoLectura)>=0?((0,r.uX)(),(0,r.CE)("div",d,[["qr","id"].indexOf(e.tipoLectura)>=0?((0,r.uX)(),(0,r.Wv)(g,{key:0,onLeeQr:e.leerRegistro,cargaAnterior:e.cargaAnterior},null,8,["onLeeQr","cargaAnterior"])):(0,r.Q3)("v-if",!0)])):(0,r.Q3)("v-if",!0),e.regEnc.length>0?((0,r.uX)(),(0,r.CE)("div",A,[(0,r.bF)(y,null,{default:(0,r.k6)(function(){return[(0,r.bF)(k,null,{default:(0,r.k6)(function(){return[(0,r.bF)(_,null,{default:(0,r.k6)(function(){return[(0,r.bF)(P,{class:"sie-usuario-sm",usucod:e.regEnc[0].USUCOD},null,8,["usucod"])]}),_:1}),(0,r.bF)(R,null,{default:(0,r.k6)(function(){return[(0,r.bF)(S,{label:""},{default:(0,r.k6)(function(){return[(0,r.eW)((0,n.v_)(e.regEnc[0].USUNOM),1)]}),_:1})]}),_:1}),(0,r.bF)(_)]}),_:1}),(0,r.bF)(k,{class:"col"},{default:(0,r.k6)(function(){return[(0,r.bF)(R,null,{default:(0,r.k6)(function(){return[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.regEnc,function(a,t){return(0,r.uX)(),(0,r.Wv)(y,{key:t,"inset-separator":""},{default:(0,r.k6)(function(){return[(0,r.bF)(O,null,{default:(0,r.k6)(function(){return[(0,r.bF)(k,{class:"q-pa-none"},{default:(0,r.k6)(function(){return[(0,r.bF)(R,null,{default:(0,r.k6)(function(){return[(0,r.bF)(S,{class:"text-bold row"},{default:(0,r.k6)(function(){return[(0,r.Lk)("span",null,(0,n.v_)(a.DESCRIPCION),1)]}),_:2},1024),(0,r.bF)(S,{sublabel:""},{default:(0,r.k6)(function(){return[(0,r.Lk)("span",null,(0,n.v_)(e.detallePrevio[a.ID_ACTIVIDAD_PARTICIPANTE]),1),!e.detallePrevio[a.ID_ACTIVIDAD_PARTICIPANTE]||e.detallePrevio[a.ID_ACTIVIDAD_PARTICIPANTE]&&0===e.detallePrevio[a.ID_ACTIVIDAD_PARTICIPANTE].length?((0,r.uX)(),(0,r.CE)("span",I,(0,n.v_)(e.date(a.FH_ASISTENCIA,"DD/MM/YYYY hh:mm a")),1)):((0,r.uX)(),(0,r.CE)("div",f,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.detallePrevio[a.ID_ACTIVIDAD_PARTICIPANTE],function(a,t){return(0,r.uX)(),(0,r.CE)("div",{key:t,class:"col column"},[(0,r.Lk)("span",null,(0,n.v_)(a.PARENTESCODET),1),(0,r.Lk)("span",null,(0,n.v_)(e.date(a.FH_REGISTRO,"DD/MM/YYYY hh:mm:a")),1)])}),128))]))]}),_:2},1024)]}),_:2},1024),a.FH_ASISTENCIA?((0,r.uX)(),(0,r.Wv)(_,{key:0},{default:(0,r.k6)(function(){return[e.detallePrevio[a.ID_ACTIVIDAD_PARTICIPANTE]&&0==e.detallePrevio[a.ID_ACTIVIDAD_PARTICIPANTE].length?((0,r.uX)(),(0,r.Wv)(N,{key:0,name:"calendar_check_o",style:{"font-size":"30px",color:"green"}})):(0,r.Q3)("v-if",!0),e.detallePrevio[a.ID_ACTIVIDAD_PARTICIPANTE]&&e.detallePrevio[a.ID_ACTIVIDAD_PARTICIPANTE].length<3&&"barras"!==e.tipoLectura?((0,r.uX)(),(0,r.Wv)(T,{key:1,flat:"",round:"",icon:"calendar_plus_o",style:{"font-size":"20px",color:"green"},onClick:function(t){return e.mostrarParentesco([a.ID_ACTIVIDAD_PARTICIPANTE])}},null,8,["onClick"])):(0,r.Q3)("v-if",!0)]}),_:2},1024)):(0,r.Q3)("v-if",!0)]}),_:2},1024)]}),_:2},1024),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.hijos,function(e,t){return(0,r.uX)(),(0,r.CE)(r.FK,{key:t},[a.hijos&&a.hijos.length>0?((0,r.uX)(),(0,r.Wv)(k,{key:0},{default:(0,r.k6)(function(){return[(0,r.bF)(_,null,{default:(0,r.k6)(function(){return[(0,r.bF)(P,{class:"sie-usuario-sm",usucod:e.USUHIJO},null,8,["usucod"])]}),_:2},1024),(0,r.bF)(R,null,{default:(0,r.k6)(function(){return[(0,r.bF)(S,{label:""},{default:(0,r.k6)(function(){return[(0,r.eW)((0,n.v_)(e.NOMBRES),1)]}),_:2},1024),(0,r.bF)(S,{sublabel:""},{default:(0,r.k6)(function(){return[(0,r.eW)((0,n.v_)(e.NEMODES),1)]}),_:2},1024)]}),_:2},1024)]}),_:2},1024)):(0,r.Q3)("v-if",!0)],64)}),128))]}),_:2},1024)}),128))]}),_:1})]}),_:1})]}),_:1})])):(0,r.Q3)("v-if",!0)]),(0,r.bF)(U,{class:"model-errores",modelValue:e.modalAdicionales,"onUpdate:modelValue":a[5]||(a[5]=function(a){return e.modalAdicionales=a}),ok:"Aceptar",onSubmit:e.grabarAsistencia,title:e.arrSinGrabar.length>0?"Marcar asistencia de evento":"Seleccionar Parentesco",noClose:""},{default:(0,r.k6)(function(){return[(0,r.Lk)("div",m,[a[8]||(a[8]=(0,r.Lk)("div",{class:"row justify-around"},null,-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.parentesco,function(t,n){return(0,r.uX)(),(0,r.Wv)(V,{key:n,modelValue:e.arrParentesco,"onUpdate:modelValue":a[4]||(a[4]=function(a){return e.arrParentesco=a}),label:t.value,val:t.id,readonly:t.disable},null,8,["modelValue","label","val","readonly"])}),128))]),e.arrSinGrabar.length>0?((0,r.uX)(),(0,r.CE)("div",v,[(0,r.bF)(y,{"inset-separator":""},{default:(0,r.k6)(function(){return[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.arrSinGrabar,function(e,t){return(0,r.uX)(),(0,r.Wv)(k,{key:t},{default:(0,r.k6)(function(){return[(0,r.bF)(_,null,{default:(0,r.k6)(function(){return[(0,r.bF)(V,{modelValue:e.ESTADO,"onUpdate:modelValue":function(a){return e.ESTADO=a},"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])]}),_:2},1024),(0,r.bF)(R,null,{default:(0,r.k6)(function(){return[(0,r.bF)(S,{label:""},{default:(0,r.k6)(function(){return[(0,r.eW)((0,n.v_)(e.DESCRIPCION),1)]}),_:2},1024),e.NEMODES?((0,r.uX)(),(0,r.Wv)(S,{key:0,sublabel:""},{default:(0,r.k6)(function(){return[(0,r.eW)((0,n.v_)(e.NEMODES),1)]}),_:2},1024)):(0,r.Q3)("v-if",!0),e.hijos&&e.hijos.length>0?((0,r.uX)(),(0,r.Wv)(S,{key:1,class:"row",sublabel:""},{default:(0,r.k6)(function(){return[a[9]||(a[9]=(0,r.Lk)("span",null,null,-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.hijos,function(e,a){return(0,r.uX)(),(0,r.CE)("span",{key:a,class:"q-mx-xs"},(0,n.v_)(e.NOMBRES)+",",1)}),128))]}),_:2},1024)):(0,r.Q3)("v-if",!0)]}),_:2},1024)]}),_:2},1024)}),128)),(0,r.bF)(F)]}),_:1})])):(0,r.Q3)("v-if",!0),e.vacio?((0,r.uX)(),(0,r.CE)("div",p,[(0,r.bF)(L,{subtitle:"mensajes.m0093",icon:"person"})])):(0,r.Q3)("v-if",!0)]}),_:1},8,["modelValue","onSubmit","title"]),(0,r.bF)(U,{class:"sie-modal-adjuntos",modelValue:e.modalEstados,"onUpdate:modelValue":a[7]||(a[7]=function(a){return e.modalEstados=a}),title:"Estado actual",onSubmit:e.grabarModal},{default:(0,r.k6)(function(){return[(0,r.Lk)("div",h,[a[10]||(a[10]=(0,r.Lk)("div",{class:"col"},[(0,r.Lk)("span",{class:"subtitle"},"Seleccione el estado con el que se marcaran las asistencias desde este momento")],-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.estados,function(t,n){return(0,r.uX)(),(0,r.CE)("div",E,[(0,r.bF)(Q,{modelValue:e.preEstado,"onUpdate:modelValue":a[6]||(a[6]=function(a){return e.preEstado=a}),val:t.value,label:t.label,color:"secondary",onInput:function(a){return e.modificarEstado(n)}},null,8,["modelValue","val","label","onInput"])])}),256))])]}),_:1},8,["modelValue","onSubmit"])]}),_:1})}var C=t(57008),b=t.n(C),T=(t(30683),t(10239),t(50310),t(90095),t(83190),t(27153),t(68017),t(13715),t(6123)),g=t(80660),P=t(57668),_=t(80340),S=t(69027),R=t(36493),k=t(30640),N=t(93616),O=t(24974),y={class:"col"};function V(e,a){var t=(0,r.g2)("q-toggle"),n=(0,r.g2)("qrcode-stream");return(0,r.uX)(),(0,r.CE)("div",y,[(0,r.bF)(n,{onDecode:e.leer,camera:e.camera,onInit:e.onInitQr},{default:(0,r.k6)(function(){return[(0,r.bF)(t,{class:"tgle",modelValue:e.camera,"onUpdate:modelValue":a[0]||(a[0]=function(a){return e.camera=a}),"checked-icon":"videocam",color:"secondary","unchecked-icon":"videocam_off","true-value":"auto","false-value":"off"},null,8,["modelValue"])]}),_:1},8,["onDecode","camera","onInit"])])}var F=t(76080),L=t.n(F),U=t(45254),Q=t.n(U),q=(t(56285),t(51500)),w=t(81288),j={emits:["leeQr"],props:["cargaAnterior"],components:{QrcodeStream:q.tR,QrcodeCapture:q.Z3,QToggle:T.c5},data:function(){return{now:new Date,hijos:[],pregunta:!1,sinCamara:!1,camera:"off"}},methods:{onInitQr:function(e){var a=this;return Q()(L()().m(function t(){var r;return L()().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,t.n=1,e;case 1:t.n=3;break;case 2:t.p=2,r=t.v,a.$emit("leeQr",null,!0),"NotAllowedError"===r.name?a.error="ERROR: you need to grant camera access permisson":"NotFoundError"===r.name?a.error="ERROR: no camera on this device":"NotSupportedError"===r.name?a.error="ERROR: secure context required (HTTPS, localhost)":"NotReadableError"===r.name?a.error="ERROR: is the camera already in use?":"OverconstrainedError"===r.name?a.error="ERROR: installed cameras are not suitable":"StreamApiNotSupportedError"===r.name&&(a.error="ERROR: Stream API is not supported in this browser");case 3:return t.p=3,a.pregunta||a.cargaAnterior||(a.isLess?a.camera="auto":e&&e["_c"]?(0,S.dialogConfirm)({title:"Como desea Registrar su Asistencia ",ok:"Manualmente",cancel:"Camara"}).then(function(e){a.sinCamara=e,e||(a.camera="auto"),a.$emit("leeQr",null,e,a.camera)}):a.$emit("leeQr",null,!0),a.pregunta=!0),t.f(3);case 4:return t.a(2)}},t,null,[[0,2,3,4]])}))()},leer:function(e){this.$emit("leeQr",e)}},computed:{isLess:function(){return(0,w.isLess)()}}},M=t(12807);const X=(0,M.A)(j,[["render",V]]);var x=X,H=t(8445),W=t.n(H),$={class:"v-quagga"};function G(e,a){return(0,r.uX)(),(0,r.CE)("div",$,W()(a[0]||(a[0]=[(0,r.Lk)("video",{class:"camara"},null,-1),(0,r.Lk)("canvas",{class:"captura"},null,-1)])))}var Y={},K={emits:["detected"],props:{cargaAnterior:{type:Boolean,default:!1},readerTypes:{type:Array,default:function(){return["code_39_reader"]}},readerSize:{type:Object,default:function(){return{width:"1600px",height:"960px"}},validator:function(e){return"string"===typeof e.width&&"string"===typeof e.height}}},data:function(){return{}},methods:{onBar:function(){var e=this,a={inputStream:{type:"LiveStream",constraints:{width:{min:e.readerSize.width},height:{min:e.readerSize.height},facingMode:"environment",aspectRatio:{min:1,max:2}},target:e.$el},locator:{patchSize:"medium",halfSample:!0},numOfWorkers:4,frequency:10,decoder:{readers:e.readerTypes},locate:!0};Y.init(a,function(a){a&&e.$emit("leeQr",null,!0),Y.start(),Y.onDetected(e.onDetected),Y.onProcessed(e.onProcessed)})},onProcessed:function(e){var a=Y.canvas.ctx.overlay,t=Y.canvas.dom.overlay;if(e){if(e.boxes){a.clearRect(0,0,parseInt(t.getAttribute("width")),parseInt(t.getAttribute("height")));for(var r=0;r<e.boxes.length;r++)e.boxes[r]!==e.box&&Y.ImageDebug.drawPath(e.boxes[r],{x:0,y:1},a,{color:"green",lineWidth:2})}e.box&&Y.ImageDebug.drawPath(e.box,{x:0,y:1},a,{color:"#00F",lineWidth:2}),e.codeResult&&e.codeResult.code&&Y.ImageDebug.drawPath(e.line,{x:"x",y:"y"},a,{color:"red",lineWidth:3})}},onDetected:function(e){this.$emit("detected",e.codeResult.code)}},mounted:function(){}};const B=(0,M.A)(K,[["render",G]]);var z=B,Z=t(18105),J=t(982),ee={components:{QSelect:T.Si,sieUsuario:O.A,sieModal:k.A,barcode:z,qr:x,sieVacio:_.A,QToggle:T.c5,QCheckbox:T.vZ,QBtnToggle:T.QL,sieSelect:N.A,QRadio:T.$,QPage:T.Tu,QInput:T.ie,QBtn:T.Il,QList:T.Mb,QItem:T.H0,QItemSide:T.n1,QItemMain:T.mF,QItemTile:T.lp,QListHeader:T.XR,QIcon:T.bP,QItemSeparator:T.CL},data:function(){return{now:new Date,sie:(0,P["default"])(),tipoLectura:"qr",sinCamara:!1,camera:"off",usucod:"",modRegistro:0,estados:[{label:"Presente",value:"P",color:"green"},{label:"Tardanza",value:"T",color:"amber"}],tipoLecturaObj:[{label:"Usuario",value:"qr"},{label:"Documento de Identidad",value:"barras"},{label:"Evento",value:"id"}],regEnc:[],cargaAnterior:!1,vacio:!1,actividad:"",arrSinGrabar:[],modalAdicionales:!1,preGrabado:!1,usucodRead:"",tiposDetalles:[{label:"Grupal",value:0,componente:"evento"},{label:"Individual",value:1,componente:"evento"},{label:"Sin Invitación",value:2,componente:"evento"}],cboActividades:[],parentesco:[],arrParentesco:[2],parentescoPrevio:[],detallePrevio:{},estadoObj:{},estado:null,preEstado:null,modalEstados:!1,esFamilia:!1}},methods:{date:function(e,a){return(0,Z.Ay)(e,a)},listarRegistros:function(e){var a=this;e=e.toUpperCase();var t={};switch(this.tipoLectura){case"qr":t.usucod=e;break;case"id":t.id=e;break;default:t.docidenro=e;break}if(2===this.modRegistro&&(t.idActividad=this.actividad,!this.actividad))return new Promise(function(e,t){(0,S.dialogConfirm)({title:a.$t("aviso"),message:a.$t("mensajes.e0078"),cancel:!1}).then(function(a){e(a)})});var r=[];return new Promise(function(n,o){g.$http.get("api/HyoActividadparticipante/obtDatosAsistencia",{params:t}).then(function(o){var i,s=o.json;if(Array.isArray(s)&&s.length>0&&s[0].TIPCODSOL){a.esFamilia=s[0].TIPCODSOL.indexOf("004")>=0,a.vacio=!1,i=[];var l=(0,R["default"])(s,"ID_ACTIVIDAD_PARTICIPANTE");s.forEach(function(e){var t={ID_ACTIVIDAD_PARTICIPANTE:e.ID_ACTIVIDAD_PARTICIPANTE,FH_ASISTENCIA:e.FH_ASISTENCIA,USUCOD:e.USUCOD,USUNOM:e.USUNOM,DESCRIPCION:e.DESCRIPCION,TIPCOD:e.TIPCODSOL,ASISTENCIA_DETALLE:e.ASISTENCIA_DETALLE};if(a.esFamilia&&(t.hijos=l[e.ID_ACTIVIDAD_PARTICIPANTE]),e.PARENTESCO&&(t.PARENTESCO=e.PARENTESCO.trim()),1===e.ASISTENCIA_DETALLE){r.push(e.ID_ACTIVIDAD_PARTICIPANTE);var n=t.PARENTESCO;g.$http.get("api/HyoActividadparentescoasis/obtAsistenciaParentesco",{params:{ID_ACTIVIDAD_PARTICIPANTE:r,parentesco:n}}).then(function(e){var t=e.json;t.forEach(function(e){switch(e.PARENTESCO){case 1:e.PARENTESCODET="Padre";break;case 2:e.PARENTESCODET="Madre";break;case 3:e.PARENTESCODET="Apoderado";break}}),a.detallePrevio=(0,R["default"])(t,"ID_ACTIVIDAD_PARTICIPANTE")})}var o=null;i.forEach(function(a,t){e.ID_ACTIVIDAD_PARTICIPANTE===a.ID_ACTIVIDAD_PARTICIPANTE&&(o=t+1)}),o||i.push(t)})}else 0===s.length&&(a.vacio=!0),i=[],"noHayEventos"===s&&2===a.modRegistro&&a.registrarAsistenciaSinInvitacion(t,e);a.regEnc=i,n(i)}),a.usucod=""})},preparaDataAsistencia:function(e){var a,t=this;return new Promise(function(r,n){t.vacio=!1,a=[];var o=(0,R["default"])(e,"ID_ACTIVIDAD_PARTICIPANTE");e.forEach(function(e){e.PARENTESCO&&(e.PARENTESCO=e.PARENTESCO.trim());var t={ID_ACTIVIDAD_PARTICIPANTE:e.ID_ACTIVIDAD_PARTICIPANTE,FH_ASISTENCIA:e.FH_ASISTENCIA,USUCOD:e.USUCOD,USUNOM:e.USUNOM,DESCRIPCION:e.DESCRIPCION,hijos:o[e.ID_ACTIVIDAD_PARTICIPANTE],TIPCOD:e.TIPCODSOL};1===e.ASISTENCIA_DETALLE&&(t.PARENTESCO=e.PARENTESCO);var r=null;a.forEach(function(a,t){e.ID_ACTIVIDAD_PARTICIPANTE===a.ID_ACTIVIDAD_PARTICIPANTE&&(r=t+1)}),r||a.push(t)}),r(a)})},registrarAsistenciaSinInvitacion:function(e,a){var t=this;e.asistencia=this.estado,g.$http.post("api/HyoActividadparticipante/agregarAsistencia",e).then(function(e){var r=e.json;"m0001"===r&&t.leerRegistro(a)})},generarRegistrosGrabar:function(e){this.arrSinGrabar=e,e.length>1?this.modalAdicionales=!this.preGrabado:this.grabarAsistencia()},grabarAsistencia:function(){var e=this;if(this.arrSinGrabar.length>0&&this.regEnc.length>0){var a=1===this.arrSinGrabar.length?0:1,t=[];this.arrSinGrabar.forEach(function(e){e.ESTADO===a&&t.push(e.ID_ACTIVIDAD_PARTICIPANTE)}),t.length>0&&(this.registarAsistencia(t,this.usucodRead),this.preGrabado=!0,this.modalAdicionales=!1)}else{var r=[];this.dataPreparada(this.regEnc).then(function(a){var t=a.arr;e.arrParentesco.forEach(function(a,t){e.parentescoPrevio.indexOf(a)<0&&r.push(a)}),e.registarAsistencia(t,e.usucodRead,r)})}},dataPreparada:function(e){var a,t=this,r=[];return new Promise(function(n,o){e.forEach(function(e,n){a=e.USUNOM,e.FH_ASISTENCIA?1===e.ASISTENCIA_DETALLE&&(r=e.ID_ACTIVIDAD_PARTICIPANTE):1!==t.modRegistro?(r.push(e.ID_ACTIVIDAD_PARTICIPANTE),t.modalAdicionales||1!==e.ASISTENCIA_DETALLE||"barras"===t.tipoLectura||t.mostrarParentesco(e.ID_ACTIVIDAD_PARTICIPANTE)):r.push(b()(b()({},e),{},{ESTADO:0}))}),n({arr:r,USUNOM:a})})},mostrarParentesco:function(e){var a=this;this.modalAdicionales=!0,g.$http.get("api/HyoActividadparentescoasis/obtAsistenciaParentesco",{params:{ID_ACTIVIDAD_PARTICIPANTE:e,resumen:"S",asistencia:this.estado}}).then(function(e){var t=e.json;a.parentescoPrevio=t,a.arrParentesco=t,a.parentesco=[{id:1,value:"Padre",disable:a.parentescoPrevio.indexOf(1)>=0},{id:2,value:"Madre",disable:a.parentescoPrevio.indexOf(2)>=0},{id:3,value:"Apoderado",disable:a.parentescoPrevio.indexOf(3)>=0}]})},leerRegistro:function(e,a,t){var r=this;this.usucodRead=e,this.preGrabado=!1,e?this.listarRegistros(e).then(function(a){Array.isArray(a)&&a.length>0&&r.dataPreparada(a).then(function(t){var n=t.arr,o=t.USUNOM;if(1===r.modRegistro)return r.generarRegistrosGrabar(n),!1;if(n.length>0)r.modalAdicionales||r.registarAsistencia(n,e,a[0].PARENTESCO?[a[0].PARENTESCO]:null);else{var i;switch(console.log(a[0]),a[0].TIPCOD.trim()){case"004":i="La familia ";break;case"005":i="El/la alumno(a) ";break;default:i="El Usuario ";break}(0,J["default"])("".concat(i).concat(o," ya registró tiene su asistencia anteriormente"),"error")}})}):this.sinCamara=a,this.cargaAnterior=!0,this.camera=t},registraPistola:function(e){13===e.which&&this.leerRegistro(this.usucod)},registarAsistencia:function(e,a,t){var r=this;if(Array.isArray(e)&&e.length>0){var n={arrParticipante:e,asistencia:this.estado};t&&(n.parentesco=t),g.$http.post("api/HyoActividadparticipante/registrarAsistencia",n).then(function(e){var t=e.json;r.modalAdicionales=!1,r.listarRegistros(a),(0,J["default"])(r.$t("mensajes.".concat(t)),"m0001"===t?"success":"error")})}else!Array.isArray(e)&&t.length>0&&g.$http.post("api/HyoActividadparentescoasis/registrarAsistenciaParentesco",{ID_ACTIVIDAD_PARTICIPANTE:e,parentesco:t}).then(function(e){var t=e.json;r.modalAdicionales=!1,r.listarRegistros(a),(0,J["default"])(r.$t("mensajes.".concat(t)),"m0001"===t?"success":"error")})},abrirModal:function(){this.preEstado=this.estadoObj.value,this.modalEstados=!0},modificarEstado:function(e){this.preEstadoObj=this.estados[e]},grabarModal:function(){this.estadoObj=this.preEstadoObj,this.estado=this.preEstadoObj.value,this.modalEstados=!1}},watch:{modRegistro:function(e){this.tipoLecturaObj=e>1?[{label:"Usuario",value:"qr"},{label:"Documento de Identidad",value:"barras"}]:[{label:"Usuario",value:"qr"},{label:"Documento de Identidad",value:"barras"},{label:"Evento",value:"id"}]}},created:function(){var e=this;this.estadoObj=this.estados[0],this.estado=this.estados[0].value,this.preEstado=this.estados[0].value,g.$http.get("api/HyoActividadProgramada/obtActividadesHoy").then(function(a){var t=a.json;t.forEach(function(e){e.FH_ACTIVIDAD_NI=(0,Z.Ay)(e.FH_ACTIVIDAD_I,"DD/MM/YYYY hh:mm A"),e.FH_ACTIVIDAD_NF=(0,Z.Ay)(e.FH_ACTIVIDAD_F,"DD/MM/YYYY hh:mm A"),e.ACTIVIDAD_CBO=e.DESCRIPCION+" de "+e.FH_ACTIVIDAD_NI+" a "+e.FH_ACTIVIDAD_NF+" ("+e.USUNOM+")"}),e.cboActividades=t})}};const ae=(0,M.A)(ee,[["render",D]]);var te=ae}}]);