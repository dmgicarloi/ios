"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[80100],{80100:function(e,n,o){o.r(n),o.d(n,{default:function(){return P}});var a=o(61758),l={class:"col-xs-12 col-sm-6 col-md-4 col-lg-3 col-xl-2"},t={class:"col-xs-12 col-sm-6 col-md-4 col-lg-3 col-xl-2"},r={class:"col-xs-12 col-sm-6 col-md-4 col-lg-3 col-xl-2"},i={class:"col-xs-12 col-sm-9 col-md-8 col-lg-4 col-xl-8"},c={class:"col-xs-12 col-sm-3 col-md-4 col-lg-2 col-xl-4"},s={class:"col-xs-12 col-sm-6"},u={class:"col-xs-12 col-sm-6"},d={class:"col-xs-12 col-sm-6"},m={class:"col-xs-12 column items-center justify-center q-pt-sm"},p={class:"row"},f={class:"col-xs-12"},g={class:"col-xs-12 column items-center justify-center q-pt-sm"};function C(e,n){var o=this,C=(0,a.g2)("header-btn"),b=(0,a.g2)("q-select"),S=(0,a.g2)("q-input"),O=(0,a.g2)("sie-ngs"),v=(0,a.g2)("q-card-section"),N=(0,a.g2)("sie-table"),h=(0,a.g2)("q-card"),E=(0,a.g2)("q-tab"),I=(0,a.g2)("q-btn"),D=(0,a.g2)("q-tab-pane"),x=(0,a.g2)("sie-upload"),A=(0,a.g2)("q-tabs"),w=(0,a.g2)("sie-modal"),k=(0,a.g2)("q-page");return(0,a.uX)(),(0,a.Wv)(k,{class:"bg-white q-pa-sm sie-flat"},{default:(0,a.k6)(function(){return[(0,a.bF)(h,null,{default:(0,a.k6)(function(){return[(0,a.bF)(C,{name:"Asignación de Secciones",buttons:e.buttons},null,8,["buttons"]),(0,a.bF)(v,null,{default:(0,a.k6)(function(){return[(0,a.bF)(O,{class:"q-col-gutter-sm",ref:"ngs",onNivel:e.cambiarNivel,onGrado:e.cambiarGrado,onSeccion:e.cambiarSeccion,"nivel-label":!1,"grado-label":!1,isRequest:"","class-nivel":"col-xs-12 col-sm-6 col-md-4 col-lg-3 col-xl-2","class-grado":"col-xs-12 col-sm-6 col-md-4 col-lg-3 col-xl-2","class-seccion":"col-xs-12 col-sm-6 col-md-4 col-lg-3 col-xl-2"},{default:(0,a.k6)(function(){return[(0,a.Lk)("div",l,[(0,a.bF)(b,{modelValue:e.sexo,"onUpdate:modelValue":n[0]||(n[0]=function(n){return e.sexo=n}),options:e.sexos,label:"Sexo",onInput:e.cambiarFiltro},null,8,["modelValue","options","onInput"])]),(0,a.Lk)("div",t,[(0,a.bF)(b,{modelValue:e.matriculado,"onUpdate:modelValue":n[1]||(n[1]=function(n){return e.matriculado=n}),options:e.matriculados,label:"Matriculado",onInput:e.cambiarFiltro},null,8,["modelValue","options","onInput"])]),(0,a.Lk)("div",r,[(0,a.bF)(b,{modelValue:e.orden,"onUpdate:modelValue":n[2]||(n[2]=function(n){return e.orden=n}),options:e.ordenes,label:"Orden",onInput:e.cambiarFiltro},null,8,["modelValue","options","onInput"])]),(0,a.Lk)("div",i,[(0,a.bF)(S,{modelValue:e.alumno,"onUpdate:modelValue":n[3]||(n[3]=function(n){return e.alumno=n}),debounce:"200",label:"Alumno",onInput:e.cambiarFiltro},null,8,["modelValue","onInput"])]),(0,a.Lk)("div",c,[(0,a.bF)(b,{modelValue:e.seccion,"onUpdate:modelValue":n[4]||(n[4]=function(n){return e.seccion=n}),options:e.secciones,label:"Nueva Sección","option-value":"SECCIONCOD","option-label":"SECCIONDES",onInput:e.setSeccion},null,8,["modelValue","options","onInput"])])]}),_:1},8,["onNivel","onGrado","onSeccion"])]}),_:1}),(0,a.bF)(v,null,{default:(0,a.k6)(function(){return[(0,a.bF)(N,{ref:"sieTable",columns:e.fields,showSearch:!1,data:e.rows,selection:"multiple",config:e.config,context:o,css:{height:"calc(100vh - 260px)"}},null,8,["columns","data","config"])]}),_:1})]}),_:1}),(0,a.bF)(w,{title:"Importar / Exportar",modelValue:e.openModal,"onUpdate:modelValue":n[9]||(n[9]=function(n){return e.openModal=n}),footer:!1,css:{maxWidth:"500px"}},{default:(0,a.k6)(function(){return[(0,a.bF)(A,{class:"full-height q-tab-ev",dense:"",inverted:"",modelValue:e.tab,"onUpdate:modelValue":n[8]||(n[8]=function(n){return e.tab=n})},{title:(0,a.k6)(function(){return[(0,a.bF)(E,{name:"exportar",label:"Exportar"}),(0,a.bF)(E,{name:"importar",label:"Importar"})]}),default:(0,a.k6)(function(){return[(0,a.bF)(D,{name:"exportar"},{default:(0,a.k6)(function(){return[(0,a.bF)(O,{class:"q-col-gutter-sm",ref:"ngsModal","class-nivel":"col-xs-12 col-sm-6","class-grado":"col-xs-12 col-sm-6","class-seccion":"col-xs-12 col-sm-6"},{default:(0,a.k6)(function(){return[(0,a.Lk)("div",s,[(0,a.bF)(b,{modelValue:e.ordenModal,"onUpdate:modelValue":n[5]||(n[5]=function(n){return e.ordenModal=n}),options:e.ordenes,label:"Orden"},null,8,["modelValue","options"])]),(0,a.Lk)("div",u,[(0,a.bF)(b,{modelValue:e.sexoModal,"onUpdate:modelValue":n[6]||(n[6]=function(n){return e.sexoModal=n}),options:e.sexos,label:"Sexo"},null,8,["modelValue","options"])]),(0,a.Lk)("div",d,[(0,a.bF)(b,{modelValue:e.matriculadoModal,"onUpdate:modelValue":n[7]||(n[7]=function(n){return e.matriculadoModal=n}),options:e.matriculados,label:"Matriculado"},null,8,["modelValue","options"])]),(0,a.Lk)("div",m,[(0,a.bF)(I,{label:"Exportar",color:"primary",onClick:e.exportar},null,8,["onClick"])])]}),_:1},512)]}),_:1}),(0,a.bF)(D,{name:"importar"},{default:(0,a.k6)(function(){return[(0,a.Lk)("div",p,[(0,a.Lk)("div",f,[(0,a.bF)(x,{onUpload:e.addFile,icon:"file",title:"Subir Archivo",allow:["xlsx","xls"]},null,8,["onUpload"])]),(0,a.Lk)("div",g,[(0,a.bF)(I,{label:"Importar",color:"primary",onClick:e.importar,loading:e.loadingImportar},null,8,["onClick","loading"])])])]}),_:1})]}),_:1},8,["modelValue"])]}),_:1},8,["modelValue"])]}),_:1})}var b=o(99550),S=o.n(b),O=o(41562),v=o.n(O),N=o(8445),h=o.n(N),E=o(76080),I=o.n(E),D=o(45254),x=o.n(D),A=(o(71225),o(23825),o(52133),o(10239),o(89571),o(56285),o(50310),o(5962),o(6724),o(70199),o(515),o(83190),o(39300),o(17225),o(28743),o(12858),o(32071),o(55520),o(2775),o(46203),o(66307),o(68017),o(7346),o(24066),o(95718)),w=o(16648),k=o(9736),y=o(95477),F=o(11654),M=o(36667),T=(o(30683),{data:function(){return{config:{NEWSECCIONCOD:{prevent:!0,component:"select",options:[],optionValue:"SECCIONCOD",optionLabel:"SECCIONDES",input:function(e,n,o){if(e.NEWSECCIONCOD===e.SECCIONCOD)return o=void 0===o?null:o,n.NEWSECCIONCOD=o,void this.$notify("La nueva sección que intenta cambiar es la misma a la sección actual","warning")}},EDAD:{prevent:!0,renderHtml:function(e,n){return n("span","".concat(e.ANIOS," ").concat(e.ANIOS<2?"año":"años"," y ").concat(e.MESES," ").concat(e.MESES<2?"mes":"meses"))}}},rows:[],fields:[{name:"ANOING",label:"Año de Ingreso",field:"ANOING",align:"center"},{name:"INSTRUCOD",label:"Nivel",field:"INSTRUCOD",align:"center"},{name:"GRADOCOD",label:"Grado",field:"GRADOCOD",align:"center",sortable:!0},{name:"SECCIONCOD",label:"Secc. Actual",field:"SECCIONCOD",align:"center",sortable:!0},{name:"ALUCOD",label:"Código",field:"ALUCOD",align:"center",sortable:!0},{name:"DOCIDENRO",label:"Nro. Documento",field:"DOCIDENRO",align:"center",sortable:!0},{name:"NOMCOMP",label:"Apellidos y Nombres",field:"NOMCOMP",align:"left",sortable:!0},{name:"EDAD",label:"Edad",field:"EDAD",align:"center",sortable:!0},{name:"ESTADODES",label:"Situación",field:"ESTADODES",align:"center"},{name:"NEWSECCIONCOD",label:"Secc. Nueva",field:"NEWSECCIONCOD",align:"center"}]}}}),$=o(30640),V=o(6123),U=o(2819),R=(o(80660),o(59089)),q=o(33950),L=o(57668),W=(o(81288),{components:{sieUpload:R.A,QTabs:V.uw,QTab:V.zu,QTabPane:V.dg,QPopupProxy:y.A,QCardSection:A.A,QSelect:w.A,QInput:k.A,sieNgs:M.A,sieModal:$.A,QBtn:F.A,QPage:V.Tu,QCard:V.C$},mixins:[T],data:function(){return{buttons:[{icon:"file_excel",label:"Importar / Exportar",permiso:">= 2",click:this.importarExportar},{icon:"cogs",label:"Procesar",permiso:">= 2",click:this.procesar},{icon:"man_woman",label:"Sortear Secciones",permiso:">= 2",click:this.sortearSeccion}],sexo:"T",sexos:[{label:"Todos",value:"T"},{label:"Masculino",value:"M"},{label:"Femenino",value:"F"}],matriculado:"T",matriculados:[{label:"Todos",value:"T"},{label:"Si",value:"S"},{label:"No",value:"N"}],orden:"nomcomp",ordenes:[{label:"Nombres y Apellidos",value:"nomcomp"},{label:"Nivel, grado y sección",value:"ngs"}],secciones:[],seccion:"",alumno:"",ngs:{},openModal:!1,tab:"exportar",ordenModal:"nomcomp",sexoModal:"T",matriculadoModal:"T",file:{},loadingImportar:!1,habilitaAcceso:!0}},methods:{importarExportar:function(){this.openModal=!0},exportar:function(){var e=this.$refs.ngsModal,n={pinstrucod:e.ngs.nivel,pgradocod:e.ngs.grado,pseccioncod:e.ngs.seccion,porden:this.ordenModal,psexo:this.sexoModal,pmatricula:this.matriculadoModal,report_cod:"AsignacionCambioSecciones",repcod:"nuevoReporteAcademico",type:"exportar"};(0,U.exportFilePhp)(n,"webservice/reportes/reporte")},importar:function(){var e=this;return x()(I()().m(function n(){var o,a,l,t,r;return I()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,n.n=1,e.validateAnio();case 1:if(o=n.v,o||(e.buttons=[]),!(Object.keys(e.file).length>0&&o)){n.n=5;break}return e.loadingImportar=!0,a=String((new Date).getFullYear()),n.n=2,(0,q.Upload)({url:"api/HyoArchivo/tmp/upload",file:e.file});case 2:return l=n.v,n.n=3,e.$http.post("api/SalonAlController/importar",{params:{ano:a,name:l.name}});case 3:return t=n.v,e.$notify(t.message,"success"),n.n=4,e.cambiarFiltro();case 4:e.loadingImportar=!1,e.openModal=!1,n.n=6;break;case 5:e.$notify("Seleccione un archivo","info");case 6:n.n=8;break;case 7:n.p=7,r=n.v,e.$notify(r.message,"warning"),e.loadingImportar=!1;case 8:return n.a(2)}},n,null,[[0,7]])}))()},addFile:function(e){this.file=e[0]},hasSeccionnueva:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=!0,o='<div style="overflow-y: scroll;max-height:300px"><b>LOS SIGUIENTES USUARIOS NO TIENEN UNA SECCIÓN NUEVA ASIGNADA.</b></br></br>';return e.map(function(e){e.NEWSECCIONCOD||(n=!1,o+="<p>".concat(e.NOMCOMP,"</p></br>"))}),o+="</div>",{html:o,hasSeccion:n}},tienenNotas:function(){var e=arguments,n=this;return x()(I()().m(function o(){var a,l,t,r,i,c;return I()().w(function(o){while(1)switch(o.n){case 0:return a=e.length>0&&void 0!==e[0]?e[0]:[],l=String((document.getElementById("layout-anios").innerText||"").trim()),t=[],a.map(function(e){t.push(e.ID_PERSONA)}),r=h()(new Set(t)),i={ano:l,id_personas:r},o.n=1,n.$http.post("api/SalonAlController/verificaTienenNotas",{params:i});case 1:return c=o.v,o.a(2,c)}},o)}))()},valEstructura:function(){var e=arguments,n=this;return x()(I()().m(function o(){var a,l,t,r,i,c,s,u;return I()().w(function(o){while(1)switch(o.n){case 0:return a=e.length>0&&void 0!==e[0]?e[0]:[],l=!0,t='<div style="overflow-y: scroll;max-height:300px"><b>Se encontraron diferencias en Salones, ¿DESEA CONTINUAR?</b></br></br>',r=String((document.getElementById("layout-anios").innerText||"").trim()),i=[],a.map(function(e){i.push(e.INSTRUCOD+e.GRADOCOD+e.SECCIONCOD),i.push(e.INSTRUCOD+e.GRADOCOD+e.NEWSECCIONCOD)}),c=h()(new Set(i)),s={ano:r,rowNGS:c},o.n=1,n.$http.post("api/SalonController/validarEstructura",{params:s});case 1:return u=o.v,u.length>0&&(l=!1,u.map(function(e){t+="<p>".concat(e.msj,"</p></br>")})),t+="</div>",o.a(2,{html2:t,valEstructura:l})}},o)}))()},validateAnio:function(){var e=this;return x()(I()().m(function n(){var o,a,l,t,r;return I()().w(function(n){while(1)switch(n.n){case 0:if(!document.getElementById("layout-anios")){n.n=6;break}return o=String((new Date).getFullYear()),a=String((document.getElementById("layout-anios").innerText||"").trim()),l=String((0,L["default"])().ano),n.n=1,e.$http.get("api/HyoAnos/obtAnioVigente");case 1:if(t=n.v,Array.isArray(t)||!t){n.n=3;break}if(r=String(t.ANO),r===a){n.n=2;break}return e.$alert("El año de vigente ".concat(r," no coincide con el año seleccionado, cambie al año vigente"),"warning"),n.a(2,!1);case 2:n.n=4;break;case 3:return e.$alert("No existe año vigente","warning"),n.a(2,!1);case 4:if(String(a)===String(l)){n.n=5;break}return e.$alert("El año de sesión no coincide con el año seleccionado, actualizar la página","warning"),n.a(2,!1);case 5:if(!(parseFloat(l)<parseFloat(o))){n.n=6;break}return e.$alert("No se puede procesar debido a que el año seleccionado es inferior al año actual, actualizar la página","warning"),n.a(2,!1);case 6:return n.a(2,!0)}},n)}))()},procesar:function(){var e=this;return x()(I()().m(function n(){var o,a,l,t,r,i,c,s,u,d,m,p,f,g;return I()().w(function(n){while(1)switch(n.p=n.n){case 0:return n.n=1,e.validateAnio();case 1:if(o=n.v,o){n.n=2;break}return e.buttons=[],n.a(2);case 2:if(a=e.$refs.sieTable.rowsSelected(["INSTRUCOD","GRADOCOD","SECCIONCOD","ALUCOD","NEWSECCIONCOD","NOMCOMP","MATRICULA","ID_PERSONA"]),!(a.length<1)){n.n=3;break}return e.$notify("Debe seleccionar al menos un registro.","info"),n.a(2);case 3:return n.n=4,e.$confirmar("Confirma el envío de datos para el cambio de sección de los alumnos?","info");case 4:if(l=n.v,!l){n.n=13;break}if(t=[],r=e.hasSeccionnueva(a),i=r.html,c=r.hasSeccion,!1!==c){n.n=5;break}return e.$alert(i,"info",!0),n.a(2);case 5:return n.n=6,e.tienenNotas(a);case 6:if(s=n.v,!s){n.n=9;break}return n.n=7,e.valEstructura(a);case 7:if(u=n.v,d=u.html2,m=u.valEstructura,!1!==m){n.n=9;break}return n.n=8,e.$confirmar(d,"info",!0);case 8:if(l=n.v,l){n.n=9;break}return n.a(2);case 9:return a.map(function(e){var n={instrucod:e.INSTRUCOD,gradocod:e.GRADOCOD,seccioncod:e.SECCIONCOD,alucod:e.ALUCOD,newseccioncod:e.NEWSECCIONCOD,nomcomp:e.NOMCOMP,matricula:e.MATRICULA,id_persona:e.ID_PERSONA};t[t.length]=n}),n.p=10,e.$q.loading.show(),p=String((document.getElementById("layout-anios").innerText||"").trim()),n.n=11,e.$http.post("api/SalonAlController/cambioSalonBloque",{params:{ano:p,rows:a}});case 11:f=n.v,e.cambiarFiltro(),e.$notify(f.message,"success"),e.$q.loading.hide(),n.n=13;break;case 12:n.p=12,g=n.v,e.$notify(g.message,"warning"),e.$q.loading.hide();case 13:return n.a(2)}},n,null,[[10,12]])}))()},sortearSeccion:function(){this.$refs.sieTable.reset=!1;var e=this.$refs.sieTable.rowsSelected(null,null,!0);if(e.length>0){var n=JSON.parse(JSON.stringify(this.secciones));""==n[0].SECCIONCOD&&n.splice(0,1),e.map(function(e){var o,a=[],l=JSON.parse(JSON.stringify(n)),t=v()(l);try{for(t.s();!(o=t.n()).done;){var r=o.value;r.SECCIONCOD!==e.SECCIONCOD&&(a[a.length]=r)}}catch(e){t.e(e)}finally{t.f()}var i=Math.floor(Math.random()*a.length);e["NEWSECCIONCOD"]=a[i].SECCIONCOD})}else this.$notify("Debe seleccionar al menos un registro","info")},cambiarNivel:function(){var e=this;return x()(I()().m(function n(){var o,a,l,t;return I()().w(function(n){while(1)switch(n.n){case 0:if(o=e.$refs.ngs,a=o.ngs.grados.length>1?o.ngs.grados[1].value:"",o.ngs.grado=a,e.ngs=o.ngs,o.loadGrados(),!(o.ngs.grados.length>0)){n.n=2;break}return l=S()(o.ngs.grados,1),t=l[0].value,o.ngs.grado=t,n.n=1,e.cambiarFiltro();case 1:o.loadSeccion();case 2:return n.a(2)}},n)}))()},cambiarGrado:function(){var e=this;return x()(I()().m(function n(){var o,a;return I()().w(function(n){while(1)switch(n.n){case 0:return o=e.$refs.ngs,e.ngs=o.ngs,o.loadSeccion(),n.n=1,e.cambiarFiltro();case 1:a=JSON.parse(JSON.stringify(o.ngs.secciones)),a.shift(),a=a.map(function(e){return{SECCIONCOD:e.value,SECCIONDES:e.label}}),e.seccion=null,e.secciones=a,e.config.NEWSECCIONCOD.options=a,e.config.NEWSECCIONCOD.options.unshift({SECCIONCOD:"",SECCIONDES:""});case 2:return n.a(2)}},n)}))()},cambiarSeccion:function(){var e=this;return x()(I()().m(function n(){var o,a;return I()().w(function(n){while(1)switch(n.n){case 0:return o=e.$refs.ngs,e.ngs=o.ngs,n.n=1,e.cambiarFiltro();case 1:a=JSON.parse(JSON.stringify(o.ngs.secciones)),a.shift(),a=a.map(function(e){return{SECCIONCOD:e.value,SECCIONDES:e.label}}),a=a.filter(function(e){return o.ngs.seccion!==e.SECCIONCOD}),e.seccion=null,e.secciones=a,e.config.NEWSECCIONCOD.options=a,e.config.NEWSECCIONCOD.options.unshift({SECCIONCOD:"",SECCIONDES:""});case 2:return n.a(2)}},n)}))()},cambiarFiltro:function(){var e=this;return x()(I()().m(function n(){var o;return I()().w(function(n){while(1)switch(n.n){case 0:return e.seccion="",o={instrucod:e.ngs.nivel,gradocod:e.ngs.grado,seccioncod:e.ngs.seccion,nomcomp:e.alumno||"",orden:e.orden,sexo:e.sexo,matricula:e.matriculado},n.n=1,e.$http.get("api/HyoAlumnos/listaAlumnosCambioSecciones",{params:{params:o}});case 1:e.rows=n.v;case 2:return n.a(2)}},n)}))()},setSeccion:function(){var e=this;if(!this.habilitaAcceso)return this.$alert("<p><b>El proceso se debe realizar durante el Año Escolar actual.</b></p>","info",!0),!1;this.rows.map(function(n){n.SECCIONCOD==e.seccion?n.NEWSECCIONCOD="":n.NEWSECCIONCOD=e.seccion})}},created:function(){var e=this;return x()(I()().m(function n(){var o;return I()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,e.$http.get("api/HyoSecciones/getSecciones",{params:{exclude:["T","N"]}});case 1:o=n.v,o.unshift({SECCIONCOD:"",SECCIONDES:""}),e.seccion=null,e.secciones=o,e.config.NEWSECCIONCOD.options=e.secciones;case 2:return n.a(2)}},n)}))()},mounted:function(){var e=this;return x()(I()().m(function n(){var o;return I()().w(function(n){while(1)switch(n.n){case 0:return n.n=1,e.validateAnio();case 1:o=n.v,o||(e.buttons=[]);case 2:return n.a(2)}},n)}))()}}),_=o(12807);const G=(0,_.A)(W,[["render",C]]);var P=G}}]);