"use strict";(self["webpackChunklms"]=self["webpackChunklms"]||[]).push([[52418],{52418:function(e,o,a){a.r(o),a.d(o,{default:function(){return x}});var t=a(8445),l=a.n(t),n=(a(52776),a(53113),a(61758)),u={class:"column"},r={class:"q-mx-md"},i={class:"row q-gutter-sm justify-center"},s={class:"q-mx-md q-mb-md"},c={class:"row q-gutter-sm justify-center"},d={class:"row justify-end q-ma-sm"},f={class:"q-ma-xs"},m={class:"q-mt-sm row justify-between"},O={class:"row justify-center col"},p={key:0,class:"row justify-center col"},b={key:1,class:"row col"},U={class:"q-mt-sm"},q={class:"row q-gutter-sm"},h={class:"q-mt-xs"},v={class:"row q-gutter-sm"},g={class:"q-mt-xs"},B={class:"row q-gutter-sm"},_={class:"column q-card q-ma-sm"},E={class:"col q-ma-sm"},L={class:"row q-gutter-sm"};function D(e,o){var a=(0,n.g2)("header-btn"),t=(0,n.g2)("q-list-header"),D=(0,n.g2)("q-input"),S=(0,n.g2)("q-btn"),k=(0,n.g2)("sie-modal"),V=(0,n.g2)("q-toggle"),C=(0,n.g2)("q-select"),F=(0,n.g2)("sie-table"),Q=(0,n.g2)("q-icon"),w=(0,n.g2)("q-page");return(0,n.uX)(),(0,n.Wv)(w,null,{default:(0,n.k6)(function(){return[(0,n.bF)(a,{name:"Bloqueo de Ingreso",buttons:e.buttons},null,8,["buttons"]),(0,n.bF)(k,{modelValue:e.modalBloquear,"onUpdate:modelValue":o[4]||(o[4]=function(o){return e.modalBloquear=o}),title:"Bloquear Usuarios"},{footer:(0,n.k6)(function(){return[(0,n.Lk)("div",d,[(0,n.bF)(S,{dense:"",label:"Bloquear",onClick:e.procesarModal,color:"primary"},null,8,["onClick"])])]}),default:(0,n.k6)(function(){return[(0,n.Lk)("div",u,[(0,n.bF)(t,{class:"q-my-md text-bold"},{default:(0,n.k6)(function(){return l()(o[17]||(o[17]=[(0,n.eW)("Desde",-1)]))}),_:1}),(0,n.Lk)("div",r,[(0,n.Lk)("div",i,[(0,n.bF)(D,{modelValue:e.dataBloquear.F_BLOQUEO,"onUpdate:modelValue":o[0]||(o[0]=function(o){return e.dataBloquear.F_BLOQUEO=o}),type:"date"},null,8,["modelValue"]),(0,n.bF)(D,{modelValue:e.dataBloquear.H_BLOQUEO,"onUpdate:modelValue":o[1]||(o[1]=function(o){return e.dataBloquear.H_BLOQUEO=o}),type:"time"},null,8,["modelValue"])])]),(0,n.bF)(t,{class:"q-my-md text-bold"},{default:(0,n.k6)(function(){return l()(o[18]||(o[18]=[(0,n.eW)("Hasta",-1)]))}),_:1}),(0,n.Lk)("div",s,[(0,n.Lk)("div",c,[(0,n.bF)(D,{modelValue:e.dataBloquear.F_DESBLOQUEO,"onUpdate:modelValue":o[2]||(o[2]=function(o){return e.dataBloquear.F_DESBLOQUEO=o}),type:"date"},null,8,["modelValue"]),(0,n.bF)(D,{modelValue:e.dataBloquear.H_DESBLOQUEO,"onUpdate:modelValue":o[3]||(o[3]=function(o){return e.dataBloquear.H_DESBLOQUEO=o}),type:"time"},null,8,["modelValue"])])])])]}),_:1},8,["modelValue"]),(0,n.bF)(k,{modelValue:e.modalConfig,"onUpdate:modelValue":o[13]||(o[13]=function(o){return e.modalConfig=o}),ok:"Aceptar",title:"Configurar Bloqueos",onSubmit:e.grabarConfig},{default:(0,n.k6)(function(){return[(0,n.Lk)("div",f,[(0,n.Lk)("div",m,[(0,n.Lk)("div",O,[(0,n.bF)(V,{modelValue:e.info.estado,"onUpdate:modelValue":o[5]||(o[5]=function(o){return e.info.estado=o}),"false-value":0,"true-value":1},{default:(0,n.k6)(function(){return l()(o[19]||(o[19]=[(0,n.eW)("Activo",-1)]))}),_:1},8,["modelValue"])]),1===e.info.estado?((0,n.uX)(),(0,n.CE)("div",p,[(0,n.bF)(V,{class:"col",modelValue:e.info.mensaje,"onUpdate:modelValue":o[6]||(o[6]=function(o){return e.info.mensaje=o}),"false-value":0,"true-value":1},{default:(0,n.k6)(function(){return l()(o[20]||(o[20]=[(0,n.eW)("Enviar Informe",-1)]))}),_:1},8,["modelValue"])])):((0,n.uX)(),(0,n.CE)("div",b))]),1===e.info.estado?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[(0,n.Lk)("div",U,[(0,n.Lk)("div",q,[(0,n.bF)(D,{class:"col",modelValue:e.info.intentos,"onUpdate:modelValue":o[7]||(o[7]=function(o){return e.info.intentos=o}),label:"intentos",type:"number",min:"3",max:"10"},null,8,["modelValue"]),(0,n.bF)(D,{class:"col",modelValue:e.info.diasEx,"onUpdate:modelValue":o[8]||(o[8]=function(o){return e.info.diasEx=o}),type:"number",label:e.$t("passExp"),min:"30",max:"360"},{prepend:(0,n.k6)(function(){return l()(o[21]||(o[21]=[(0,n.Lk)("span",null,"Días",-1)]))}),_:1},8,["modelValue","label"])])]),(0,n.Lk)("div",h,[(0,n.Lk)("div",v,[(0,n.bF)(D,{class:"col",modelValue:e.info.bloqTime,"onUpdate:modelValue":o[9]||(o[9]=function(o){return e.info.bloqTime=o}),label:e.$t("tiempoBloq"),type:"number",min:"0"},null,8,["modelValue","label"]),(0,n.bF)(C,{class:"col",modelValue:e.info.bloqModo,"onUpdate:modelValue":o[10]||(o[10]=function(o){return e.info.bloqModo=o}),options:e.listaFechas},null,8,["modelValue","options"])])]),(0,n.Lk)("div",g,[(0,n.Lk)("div",B,[(0,n.bF)(D,{class:"col",modelValue:e.info.rangoTime,"onUpdate:modelValue":o[11]||(o[11]=function(o){return e.info.rangoTime=o}),label:e.$t("rangoTime"),type:"number",min:"0"},null,8,["modelValue","label"]),(0,n.bF)(C,{class:"col",modelValue:e.info.rangoModo,"onUpdate:modelValue":o[12]||(o[12]=function(o){return e.info.rangoModo=o}),options:e.listaFechas},null,8,["modelValue","options"])])]),1==e.info.mensaje?((0,n.uX)(),(0,n.Wv)(F,{key:0,class:"q-mt-sm col q-card",loadSelection:e.loadNotificacion,dense:"",flat:"",bordered:"","wrap-cells":"",css:"height: calc(75vh - 170px)",config:e.configAlerta,columns:e.columnsAlerta,data:e.dataNotificacion,"show-search":!0,ref:"tablaNotificacion",selection:"multiple"},null,8,["loadSelection","config","columns","data"])):(0,n.Q3)("v-if",!0)],64)):(0,n.Q3)("v-if",!0)])]}),_:1},8,["modelValue","onSubmit"]),(0,n.Lk)("div",_,[(0,n.Lk)("div",E,[(0,n.Lk)("div",L,[(0,n.bF)(D,{class:"col",modelValue:e.search,"onUpdate:modelValue":o[14]||(o[14]=function(o){return e.search=o}),placeholder:"Buscar"},{prepend:(0,n.k6)(function(){return[(0,n.bF)(Q,{name:"search"})]}),_:1},8,["modelValue"]),(0,n.bF)(C,{class:"col-2",modelValue:e.modo,"onUpdate:modelValue":o[15]||(o[15]=function(o){return e.modo=o}),label:"Estado",options:e.estados,onInput:e.cargarData},null,8,["modelValue","options","onInput"]),0===e.modo||3===e.modo?((0,n.uX)(),(0,n.Wv)(C,{key:0,class:"col-2",modelValue:e.tipcod,"onUpdate:modelValue":o[16]||(o[16]=function(o){return e.tipcod=o}),label:"Perfil",options:e.listaPerfiles,onInput:e.cargarData},null,8,["modelValue","options","onInput"])):(0,n.Q3)("v-if",!0)]),e.dataBloqueo&&e.dataBloqueo.length>0?((0,n.uX)(),(0,n.Wv)(F,{key:0,class:"q-mt-sm col q-card",dense:"",flat:"",bordered:"","wrap-cells":"",css:"height: calc(100vh - 170px)",config:e.config,columns:e.columns,data:e.dataBloqueo,"show-search":!1,ref:"tablaBloqueos",selection:"multiple"},null,8,["config","columns","data"])):(0,n.Q3)("v-if",!0)])])]}),_:1})}var S=a(76080),k=a.n(S),V=a(45254),C=a.n(V),F=(a(30683),a(23825),a(52133),a(10239),a(50310),a(90095),a(6724),a(83190),a(13715),a(24066),a(6123)),Q=a(33777),w=a(9736),I=a(16648),T=a(55973),A=a(18105),y=a(13813),H=a(30640),N=a(57668),$={components:{SieTable:Q.A,QInput:w.A,QSelect:I.A,QToggle:T.A,sieModal:H.A,QPage:F.Tu,QListHeader:F.XR,QBtn:F.Il,QIcon:F.bP},data:function(){return{search:null,modo:1,tipcod:null,listaPerfiles:null,modalBloquear:!1,modalConfig:!1,info:{},estados:[{label:this.$t("matricula.bloqueados"),value:1},{label:this.$t("desbloqueados"),value:0},{label:this.$t("todos"),value:3}],dataBloqueo:null,columns:[{name:"USUCOD",field:"USUCOD",label:this.$t("usuario.nombre"),align:"left"},{name:"USUNOM",field:"USUNOM",label:this.$t("seguridad.nombre"),align:"left"},{name:"ESTADO",field:"ESTADO",label:this.$t("matricula.bloqueado"),align:"center"},{name:"FH_BLOQUEO",field:"FH_BLOQUEO",label:this.$t("fechainicio"),align:"center"},{name:"FH_DESBLOQUEO",field:"FH_DESBLOQUEO",label:this.$t("fechafin"),align:"center"},{name:"TIPO_BLOQUEO",field:"TIPO_BLOQUEO",label:"Tipo de bloqueo",align:"center"}],columnsAlerta:[{name:"USUNOM",field:"USUNOM",label:this.$t("usuario.nombre"),align:"left"}],listaFechas:[{value:1,label:this.$t("minutos")},{value:60,label:this.$t("horas")},{value:1440,label:this.$t("dias.dias")}],config:{},configAlerta:{flat:!0,round:!0,color:"primary"},dataBloquear:{},dataNotificacion:[],dataMarcada:[],loadNotificacion:{key:"USUCOD"}}},methods:{cargarData:function(){var e=this;return C()(k()().m(function o(){var a,t,l,n;return k()().w(function(o){while(1)switch(o.n){case 0:a={},n=e.modo,o.n=0===n?1:1===n?3:3===n?4:6;break;case 1:if(a.tipcod=e.tipcod,e.tipcod){o.n=2;break}return e.dataBloqueo=[],o.a(2,!1);case 2:return o.a(3,6);case 3:return a.bloqueados=!0,o.a(3,6);case 4:if(a.tipcod=e.tipcod,a.todos=!0,e.tipcod){o.n=5;break}return e.dataBloqueo=[],o.a(2,!1);case 5:return o.a(3,6);case 6:return o.n=7,e.$http.get("api/HyoControlusuario/obtUsuarios",{params:a});case 7:t=o.v,l=t.json,e.dataBloqueo=l,e.setConfig();case 8:return o.a(2)}},o)}))()},saveBloqueo:function(e){var o=this;return C()(k()().m(function a(){var t;return k()().w(function(a){while(1)switch(a.p=a.n){case 0:return a.p=0,a.n=1,o.$confirmar("¿Esta seguro de realizar este proceso?");case 1:if(t=a.v,!t){a.n=3;break}return a.n=2,o.$http.post("api/HyoControlusuario/grabarEstado",{datos:e});case 2:o.cargarData(),o.$notify("Proceso realizado correctamente"),o.modalBloquear=!1;case 3:a.n=5;break;case 4:a.p=4,a.v;case 5:return a.a(2)}},a,null,[[0,4]])}))()},procesar:function(){var e=this.$refs.tablaBloqueos.rowsSelected();e.length>0?(this.dataBloquear={FH_BLOQUEO:new Date,FH_DESBLOQUEO:new Date,F_BLOQUEO:(0,A.Ay)(new Date,"YYYY-MM-DD"),H_BLOQUEO:(0,A.Ay)(new Date,"HH:mm"),F_DESBLOQUEO:(0,A.Ay)(new Date,"YYYY-MM-DD"),H_DESBLOQUEO:(0,A.Ay)(new Date,"HH:mm")},1===this.modo?(this.dataBloquear.ID_CONTROL_USUARIO=(0,y["default"])(e,function(e){var o=e.ID_CONTROL_USUARIO;return o}),this.saveBloqueo(e.map(function(e){var o=e.USUCOD,a=e.ID_CONTROL_USUARIO;return{usucod:o,ESTADO:0,usucod_bloqueo:(0,N["default"])().usucod,ID_CONTROL_USUARIO:a}}))):(this.dataBloquear.USUCOD=(0,y["default"])(e,function(e){var o=e.USUCOD;return o}),this.modalBloquear=!0)):this.$notify("No hay registros seleccionados","error")},setConfig:function(){var e=this.saveBloqueo;this.config={ACCIONES:{prevent:!0,flat:!0,round:!0,component:"button",icon:["delete"]},ESTADO:{component:"button",prevent:!0,flat:!0,round:!0,open:function(o){var a=o.USUCOD,t=o.FH_BLOQUEO,l=o.FH_DESBLOQUEO,n=o.ID_CONTROL_USUARIO;e([{usucod:a,fh_bloqueo:t,fh_desbloqueo:l,ID_CONTROL_USUARIO:n,ESTADO:0,usucod_bloqueo:(0,N["default"])().usucod}])},close:function(o){var a=o.USUCOD,t=o.FH_BLOQUEO,l=o.FH_DESBLOQUEO,n=o.ID_CONTROL_USUARIO;e([{usucod:a,fh_bloqueo:t,fh_desbloqueo:l,ID_CONTROL_USUARIO:n,ESTADO:1,usucod_bloqueo:(0,N["default"])().usucod}])},validate:{close:function(e){return 0===e.ESTADO},open:function(e){return 1===e.ESTADO}},icon:["lock_open as open","lock_outline as close"],tooltip:{open:function(){return"Desbloquear"},close:function(){return"Bloquear"}}},FH_BLOQUEO:{component:"datetime",input:function(o){var a=o.FH_BLOQUEO,t=o.ID_CONTROL_USUARIO;e([{fh_bloqueo:a,ID_CONTROL_USUARIO:t}])}},FH_DESBLOQUEO:{component:"datetime",input:function(o){var a=o.FH_DESBLOQUEO,t=o.ID_CONTROL_USUARIO;e([{fh_desbloqueo:a,ID_CONTROL_USUARIO:t}])}},TIPO_BLOQUEO:{prevent:!0,renderHtml:function(e,o){return o("span",{},1===e.TIPO_BLOQUEO?"Login":2===e.TIPO_BLOQUEO?"Código 2FA":e.TIPO_BLOQUEO)}},flat:!0,round:!0,color:"primary"}},procesarModal:function(){var e=this,o=this.$refs.tablaBloqueos.rowsSelected().map(function(o){var a=o.USUCOD,t=o.ESTADO,l={usucod:a,fh_bloqueo:new Date(e.dataBloquear.F_BLOQUEO+" "+e.dataBloquear.H_BLOQUEO),fh_desbloqueo:new Date(e.dataBloquear.F_DESBLOQUEO+" "+e.dataBloquear.H_DESBLOQUEO),estado:0===t?1:0};return l});this.saveBloqueo(o)},configBloqueo:function(){var e=this;return C()(k()().m(function o(){var a,t,l;return k()().w(function(o){while(1)switch(o.n){case 0:return o.n=1,e.$http.get("api/HyoControlconfig/obtConfiguracion");case 1:a=o.v,t=a.json,e.info=t.info,e.dataNotificacion=t.data,l=[],t.data.forEach(function(e){1===e.ESTADO&&l.push(e)}),e.loadNotificacion.values=[].concat(l),e.modalConfig=!0;case 2:return o.a(2)}},o)}))()},grabarConfig:function(){var e=this;return C()(k()().m(function o(){var a,t;return k()().w(function(o){while(1)switch(o.p=o.n){case 0:return a=e.info,t={usuarios:[],data:[{estado:a.intentos,valor:"intentos"},{estado:a.rangoTime*a.rangoModo,valor:"rango",duracion:a.rangoModo},{estado:a.bloqTime*a.bloqModo,valor:"bloqueo",duracion:a.bloqModo},{estado:a.mensaje,valor:"mensaje"},{estado:a.diasEx,valor:"expira"},{estado:a.estado,valor:"estado"}]},e.$refs.tablaNotificacion&&(t.usuarios=e.$refs.tablaNotificacion.rowsSelected()),o.p=1,console.log({params:t}),o.n=2,e.$http.post("api/HyoControlconfig/insertarRegistros",t);case 2:e.modalConfig=!1,e.$notify("Guardado Correctamente"),o.n=4;break;case 3:o.p=3,o.v;case 4:console.log({dataVal:a});case 5:return o.a(2)}},o,null,[[1,3]])}))()}},computed:{buttons:function(){var e=[];if((0,N["default"])().ruta.nivel>2&&e.push({label:"Configurar",icon:"cogs",click:this.configBloqueo}),this.dataBloqueo&&this.dataBloqueo.length>0){var o={label:1===this.modo?"Desbloquear":"Bloquear",icon:1===this.modo?"lock_open":"lock_outline",click:this.procesar};e.unshift(o)}return e}},created:function(){var e=this;return C()(k()().m(function o(){var a,t;return k()().w(function(o){while(1)switch(o.n){case 0:return e.cargarData(),o.n=1,e.$http.get("api/HyoPerfiles/obtPerfilesExistentes",{params:{unicos:!0}});case 1:a=o.v,t=a.json,e.listaPerfiles=(0,y["default"])(t,function(e){var o=e.TIPCOD,a=e.TIPNOM;return{value:o,label:a}});case 2:return o.a(2)}},o)}))()}},R=a(12807);const M=(0,R.A)($,[["render",D]]);var x=M}}]);